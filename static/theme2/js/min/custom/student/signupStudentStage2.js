var max_age="";function callForSignUpParents(){if(hideMessage(""),!validateRequestForSignupParent())return!1;setActiveStep(3),showSkeleton(!0,"step3"),$.ajax({type:"POST",contentType:"application/json",url:BASE_URL+CONTEXT_PATH+SCHOOL_UUID+"/student/enrollment/save-parent-details",data:JSON.stringify(getRequestForSignupParent()),dataType:"json",async:!0,global:!1,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status?redirectLoginPage():"ELIGIBLE_CUSTOME_PLAN"==e.statusCode||"REDIRECT_TO_DASHBOOARD"==e.statusCode?window.location.reload():(showMessage(!1,e.message),setActiveStep(2)):(getAllCourseDetails("N",""),"ONE_TO_ONE_FLEX"==$("#learingProgramHeader").attr("val")?showMessage(1,"Academic & Communication Details Updated.","",!0):"English Learning Program - One to One"==$("#learingProgramHeader").html()||"English Learning Program - Self Study"==$("#learingProgramHeader").html()?showMessage(1,"Communication Details Updated","",!0):showMessage(1,"Parent's Details Uploaded","",!0))},error:function(e){checkonlineOfflineStatus()}})}function validateRequestForSignupParent(){if(hideMessage(""),"ONE_TO_ONE_FLEX"==$("#learingProgramHeader").attr("val")){if(0==$("#signupStage2 #workingProfession").val()||""==$("#signupStage2 #workingProfession").val()||null==$("#signupStage2 #workingProfession").val())return showMessage(0,"Student or a working professional is required"),!1;if(""==$("#signupStage2 #institutionName").val())return showMessage(0,"Name of the School/College/Organization is required."),!1;if(0==$("#signupStage2 #institutionCountryId").val()||""==$("#signupStage2 #institutionCountryId").val()||null==$("#signupStage2 #institutionCountryId").val())return showMessage(0,"Country of the School/College/Organization is required"),!1}else{if(39==$("#courseProviderId").val());else{if(""==$("#signupStage2 #parentFirstName").val())return showMessage(0,"First name is required."),!1;if(""==$("#signupStage2 #parentlastName").val())return showMessage(0,"Last name is required."),!1;if(0==$("#signupStage2 #relation").val()||null==$("#signupStage2 #relation").val())return showMessage(0,"Relation with student is required"),!1;if($("#signupStage2 #parentPhoneNumber").val().length<=2&&$("#signupStage2 #parentPhoneNumber").val().length>0)return showMessage(0,"Invalid Phone Number"),!1;if(0==$("#signupStage2 #pCountryId").val()||""==$("#signupStage2 #pCountryId").val())return showMessage(0,"Country is required"),!1;if(0==$("#signupStage2 #pStateId").val()||""==$("#signupStage2 #pStateId").val())return showMessage(0,"State/Province is required"),!1;if(0==$("#signupStage2 #pCityId").val()||""==$("#signupStage2 #pCityId").val())return showMessage(0,"City is required"),!1;$("#signupStage2 #referralCode").val()}}var e=$("#signupStage2 #pcModeWhatsapp").is(":checked")?"Y":"N",t=$("#signupStage2 #pcModeCall").is(":checked")?"Y":"N",a=$("#signupStage2 #pcModeEmail").is(":checked")?"Y":"N";return"Y"==e||"Y"==t||"Y"==a||(showMessage(0,"Your preferred communication is required"),!1)}function getRequestForSignupParent(){var e={},t={},a={themeType:"theme2"};if("ONE_TO_ONE_FLEX"==$("#learingProgramHeader").attr("val"))a.workingProfession=$("#signupStage2 #workingProfession").val(),a.institutionName=$("#signupStage2 #institutionName").val(),a.institutionCountryId=$("#signupStage2 #institutionCountryId").val();else{a.relationship=$("#signupStage2 #relation").val();var n=$("#signupStage2 #relation").val();a.otherRelationName="Other"==n?$("#signupStage2 #otherName").val():"",a.firstName=$("#signupStage2 #parentFirstName").val(),a.middleName=$("#signupStage2 #parentMiddletName").val(),a.lastName=$("#signupStage2 #parentlastName").val(),a.email=$("#signupStage2 #parentEmailId").val(),$("#signupStage2 #parentSwitchIntput").is(":checked")?(a.skipParent="N",a.password=$("#signupStage2 #parentPassword").val(),a.parentEmailStatus=$("#signupStage2 #parentEmailStatus").val()):a.skipParent="Y",a.countryCode=$("#signupStage2 #parentCountryDailCode").val(),a.countryIsdCode2=$("#signupStage2 #parentCountryIsd").val(),a.contactNumber=$("#signupStage2 #parentPhoneNumber").val(),a.gender="DONOTWANTTOSPECIFY",a.countryId=$("#signupStage2 #pCountryId").val(),a.stateId=$("#signupStage2 #pStateId").val(),a.cityId=$("#signupStage2 #pCityId").val()}$("#signupStage2 #referralCode").length>0?a.referralCode=$("#signupStage2 #referralCode").val().trim():a.referralCode="";var s="W="+($("#signupStage2 #pcModeWhatsapp").is(":checked")?"Y":"N")+"|C="+($("#signupStage2 #pcModeCall").is(":checked")?"Y":"N")+"|E="+($("#signupStage2 #pcModeEmail").is(":checked")?"Y":"N");return a.communications=s,a.responsibleConfirm="Yes",t.hash=getHash(),t.schoolId=SCHOOL_ID,t.schoolUUID=SCHOOL_UUID,t.userType="STUDENT",t.userId=$("#userId").val(),e.authentication=t,e.signupParent=a,e}function emailCheckForParent(e,t,a,n,s){var i="";return hideMessage(""),validateEmail(e)?($.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("is-user-available-for-parent"),data:JSON.stringify(getCallRequestForEmailCheckForParent(e,t,a,n)),dataType:"json",async:!1,global:!1,success:function(e){"0003"==e.statusCode?(showMessage(1,e.message),i=!1):"0"==e.status||"2"==e.status?i=e.extra+"|"+e.extra2:"3"==e.status?(showMessage(0,e.message),i=!1):i=!0},error:function(e){checkonlineOfflineStatus()}}),i):(showMessage(0,"Parent email is either empty or invalid"),!1)}function getCallRequestForEmailCheckForParent(e,t,a,n,s){var i={},r={},o={requestKey:"EMAIL-AVAILABLE"};return o.email=e,o.userId=a,o.studentId=n,o.parentName=s,r.hash=getHash(),r.schoolId=SCHOOL_ID,r.schoolUUID=SCHOOL_UUID,r.userType=t,i.authentication=r,i.data=o,i}function emailCheckForParentUser(e,t,a,n,s){var i="";return hideMessage(""),validateEmail(e)?($.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("send-otp-for-parent-verification"),data:JSON.stringify(getCallRequestForEmailCheckForParentUser(e,t,a,n)),dataType:"json",async:!1,success:function(e){"0"==e.status||"2"==e.status?i="Y"==e.extra1||e.extra+"|"+e.extra2:"3"==e.status?(showMessage(0,e.message),i=!1):i=!0}}),i):(showMessage(0,"Parent email is either empty or invalid"),!1)}function getCallRequestForEmailCheckForParentUser(e,t,a,n){var s={},i={},r={requestKey:"EMAIL-AVAILABLE"};return r.email=e,r.userId=a,r.schoolId=SCHOOL_ID,i.hash=getHash(),i.schoolId=SCHOOL_ID,i.schoolUUID=SCHOOL_UUID,i.userType=t,s.authentication=i,s.data=r,s}function mapParentAndAlreadyExistStudent(){return validateEmail($("#signupStage2 #parentEmailId").val())?validateEmail($("#signupStage2 #verifyMailId").val())?($.ajax({type:"POST",url:getURLFor("student","signup/stage-3-mapping-parent-student"),data:JSON.stringify(getRequestForSignupParentMapping()),dataType:"json",contentType:"application/json",success:function(e){return"0"==e.status||"2"==e.status?showMessage(0,e.message):(showMessage(1,e.message),$("#verifyStudentName").val(e.extra),$("#parentEmailVerifyStatus").val(1),$("#parentSwitchIntput").attr("disabled",!1),"Y"==e.extra1&&($("#parentSwitchIntput").prop("checked",!0),$("#parentSwitchIntput").attr("disabled",!0)),populateParentData(e.signupParentDTO)),!1}}),!1):(showMessage(0,"Existing student email is empty or invalid"),!1):(showMessage(0,"Parent email is empty or invalid"),!1)}function getRequestForSignupParentMapping(){var e={},t={},a={},n={};return n.parentEmail=$("#signupStage2 #parentEmailId").val(),n.studentEmail=$("#signupStage2 #verifyMailId").val(),n.studentId=$("#signupStage2 #studentId").val(),a.signupParentStudentMappingDTO=n,t.hash=getHash(),t.schoolId=SCHOOL_ID,t.schoolUUID=SCHOOL_UUID,t.userType="STUDENT",t.userId=$("#signupStage2 #userId").val(),e.authentication=t,e.requestData=a,e}function proceedWithExistingMappings(){if(!$("#signupStage2 #checkTerms").prop("checked"))return showModalMessage(!0,"Please click terms and conditions"),!1;$("#parentExistModal").modal("hide")}function populateParentData(e){$("#signupStage2 #relation").val(e.relationship).trigger("change"),$("#signupStage2 #otherName").val(e.otherRelationName),$("#signupStage2 #parentFirstName").val(e.firstName),$("#signupStage2 #parentMiddletName").val(e.middleName),$("#signupStage2 #parentlastName").val(e.lastName),$("#signupStage2 #parentGender").val(e.gender).trigger("change"),$("#signupStage2 #responsibleConfirm").val(e.responsibleConfirm),$("#signupStage2 #skipParent").val(e.skipParent),$("#signupStage2 #countryCodeParent").val("+"+e.countryCode),$("#signupStage2 #contactNumber").val(e.contactNumber),""!=e.countryCodeAlternate&&$("#signupStage2 #countryCodeAlternateParent").val("+"+e.countryCodeAlternate),""!=e.contactNumberAlternate&&$("#signupStage2 #contactNumberAlternate").val(e.contactNumberAlternate),disabledParentData(!0)}function disabledParentData(e){$("#signupStage2 #relation").prop("disabled",e),$("#signupStage2 #otherName").prop("disabled",e),$("#signupStage2 #parentFirstName").prop("disabled",e),$("#signupStage2 #parentMiddletName").prop("disabled",e),$("#signupStage2 #parentlastName").prop("disabled",e),$("#signupStage2 #parentGender").prop("disabled",e),$("#signupStage2 #responsibleConfirm").prop("disabled",e),$("#signupStage2 #skipParent").prop("disabled",e),$("#signupStage2 #parentEmail").prop("disabled",e),$("#signupStage2 #countryCodeParent").prop("disabled",e),$("#signupStage2 #contactNumber").prop("disabled",e),$("#signupStage2 #guardianConfirmation").prop("disabled",e)}function sendOtpForParentUser(e,t,a){if(!validateEmail(e))return showMessage(0,"Parent email is empty or invalid"),!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("send-otp-for-parent-verification"),data:JSON.stringify(getDataForParentOTPVerification(e,t,a)),dataType:"json",async:!1,success:function(e){"1"==e.statusCode?showMessage(1,e.message,"",!0):"4"==e.statusCode?showMessage(2,e.message,"",!0):"0"==e.statusCode?showMessage(0,e.message,"",!0):showMessage(0,e.statusCode,"",!0)}})}function getDataForParentOTPVerification(e,t,a){var n={},s={},i={};return i.userId=a,i.email=e,i.schoolId=SCHOOL_ID,i.parentName=t,s.hash=getHash(),s.schoolId=SCHOOL_ID,s.schoolUUID=SCHOOL_UUID,n.authentication=s,n.requestData=i,n}function verifyOtp(){if(""==$("#otp").val()||null==$("#otp").val())return showMessage(0," Invalid Otp ","",!0),!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("verify-otp"),data:JSON.stringify(getDataForOtpVerification()),dataType:"json",async:!1,success:function(e){"2"==e.statusCode?($(".otp-process").hide(),$("#parentUserCreateRequest").show(),showMessage(1,e.message,"",!0)):"0"==e.statusCode?showMessage(0,e.message,"",!0):"3"==e.statusCode?showMessage(2,e.message,"",!0):showMessage(0,e.message,"",!0)}})}function getDataForOtpVerification(){var e={},t={},a={};return a.requestValue=$("#parentEmailId").val(),a.requestExtra1=$("#otp").val().trim(),t.hash=getHash(),t.schoolId=SCHOOL_ID,t.schoolUUID=SCHOOL_UUID,e.authentication=t,e.requestData=a,e}function addressSameAs(){$("#sameAsStudentLocation").is(":checked")?($("#sameAsStudentLocation").prop("disabled",!0),$("#signupStage2 #pCountryId").val($("#countryId").val()).trigger("change"),window.setTimeout((function(){$("#signupStage2 #pStateId").val($("#stateId").val()).trigger("change"),$("#signupStage2 #pStateId").prop("disabled",!0),window.setTimeout((function(){$("#signupStage2 #pCityId").val($("#cityId").val()).trigger("change"),$("#signupStage2 #pCityId").prop("disabled",!0).promise().done((function(){$("#sameAsStudentLocation").prop("disabled",!1)}))}),500)}),500),$("#signupStage2 #pCountryId").prop("disabled",!0)):($("#signupStage2 #pCountryId").prop("disabled",!1),$("#signupStage2 #pStateId").prop("disabled",!1),$("#signupStage2 #pCityId").prop("disabled",!1),$("#signupStage2 #pCountryId").val("").trigger("change"),$("#signupStage2 #pStateId").html('<option value="">Select State/Province*</option>'),$("#signupStage2 #pCityId").html('<option value="">Select City*</option>'))}function getRequestForParentSelection(){var e={};return e.userId=USER_ID,e}function callForParentSelection(){$.ajax({type:"POST",contentType:"application/json",url:BASE_URL+CONTEXT_PATH+SCHOOL_UUID+"/student/enrollment/get-parent-details",data:JSON.stringify(getRequestForParentSelection()),dataType:"json",async:!1,global:!1,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status?redirectLoginPage():"ELIGIBLE_CUSTOME_PLAN"==e.statusCode||"REDIRECT_TO_DASHBOOARD"==e.statusCode?window.location.reload():showMessage(!1,e.message):(renderParentDetails(e),$(".step-2-skeleton").html(""),$(".step-2-skeleton").hide(),$("#signupStage2").show()),$(".prev-btn, .next-btn").removeClass("disabled")},error:function(e){checkonlineOfflineStatus()}})}$(document).ready((function(){$("#signupParent").submit((function(e){e.preventDefault()}))})),$("#signupStage2 #parentEmailId").blur((function(){emailCheck($("#signupStage2 #parentEmailId").val(),"STUDENT")})),$("#pCountryId").unbind().bind("change",(function(){$("#pCountryId").valid(),callStates("signupStage2",this.value,"pCountryId","pStateId","pCityId"),$("#pCityId").html("<option value=''>Select City*</option>")})),$("#pStateId").unbind().bind("change",(function(){$("#pStateId").valid(),callCities("signupStage2",this.value,"pStateId","pCityId")})),$("#pCityId").unbind().bind("change",(function(){$("#pCityId").valid()}));