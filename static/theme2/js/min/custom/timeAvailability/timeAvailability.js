var validatToSaveFlag=!0,validatToSaveMsg="",overLapmsg="",dropdownTimeGap=15,totalGivenTime=[],excludeDates=[],dayCounts=[],getDaycurrentDate=new Date,getDayYear=getDaycurrentDate.getFullYear(),getDayMonth=getDaycurrentDate.getMonth()+1,getDayDate=getDaycurrentDate.getDate(),daysNum=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],eventsBasedOnRole={};function getMinutesFromTime(e){var t=e.split(":");return 60*parseInt(t[0],10)+parseInt(t[1],10)}function validateTimes(e,t,a,i,l,s,o){var n=$("."+e),d=$("#errorMessage"),r=[],c=!0;validatToSaveFlag=!0,n.not(".d-none").each((function(){if("Unavailable"==$(this).text());else{var e=$(this).find("."+t).attr("data-status"),i=$(this).find("."+t).val(),o=$(this).find("."+a).val();if(""!=i&&null!=i&&""!=o&&null!=o){let t=convertTo24Hour(i),a=convertTo24Hour(o);if(t&&a){if(t>=a)return showMessageTheme2(0,"Please choose an end time greater than start time.","",!0),validatToSaveMsg="Please choose an end time greater than start time.",validatToSaveFlag=!1,c=!1;if(3==USER_ROLE_ID&&"Y"!=e){var n=getMinutesFromTime(t),d=getMinutesFromTime(a)-n,m=60*l;60!=m&&"23:59"!=a||(m-=1);var u=60*s;if(d<m)return showMessageTheme2(0,"Please add available slots minimum "+l.split(".")[0]+" hours.","",!0),c=!1,validatToSaveFlag=!1,validatToSaveMsg="Please add available slots minimum "+l.split(".")[0]+" hours.",c;if(d>u)return showMessageTheme2(0,"Please add available slots maximum "+s.split(".")[0]+" hours.","",!0),c=!1,validatToSaveFlag=!1,validatToSaveMsg="Please add available slots maximum "+s.split(".")[0]+" hours.",c;if(!(d>=m&&d<=u))return showMessageTheme2(0,"Please add available slots with durations between "+l.split(".")[0]+" to "+s.split(".")[0]+" hours.","",!0),c=!1,validatToSaveFlag=!1,validatToSaveMsg="Please add available slots with durations between "+l.split(".")[0]+" to "+s.split(".")[0]+" hours.",c;validatToSaveFlag=!0}r.push({start:t,end:a,dynamicDataStatus:e})}}else""==i&&""==o&&(r=[])}}));for(var m=0;m<r.length;m++)for(var u=m+1;u<r.length;u++)if(timesOverlap(r[m],r[u],o,i))return showMessageTheme2(0,overLapmsg,"",!0),validatToSaveMsg=overLapmsg,validatToSaveFlag=!1,c=!1;return d.text(""),c}function timesOverlap(e,t,a,i){if(console.log(e.start+" "+t.end),overLapmsg="","N"==t.dynamicDataStatus&&3==i){if(e.start<t.end&&e.end>t.start)return overLapmsg="Please check that one of your time slots is overlapping with another time slot.",!0;if(a>0){var l=getMinutesFromTime(e.end),s=getMinutesFromTime(t.start),o=s-l;if(o<0){o=l-s;var n=getMinutesFromTime(t.end);o=getMinutesFromTime(e.start)-n}if(o<a)return overLapmsg="There must be at least a "+a+" minute gap between each slot.",!0}}else if(3!=i&&e.start<t.end&&e.end>t.start)return msg="Please check that one of your time slots is overlapping with another time slot.",!0}function getCalendarDateAvailability(e,t,a,i,l,s,o,n,d,r,c,m,u,p,v,f,h,y){customLoader(!1);var g=!0,b=$("#inActDate").val();null!=b&&""!=b&&(l=b);var T={userId:t,lUserId:USER_ID,startDate:i,visitDate:l,slotType:s,slotTypeId:c};return $.ajax({type:"POST",url:getURLFor("timeavailability","get-calendar-date"),contentType:"application/json",data:JSON.stringify(T),dataType:"json",cache:!1,async:!1,timeout:6e5,success:function(i){if(console.log(i),"0"==i.status||"2"==i.status)showMessageTheme2(0,i.message,"",!0),g=!1;else{$("#"+a).html("");var s=getCalendarTable(e,t,i,l,r,n,d,a,m,u,p,v,f,h,y);$("#"+a).html(s),2==USER_ROLE_ID&&("calendar"==i.timeSlotType?$("#refreshWeekBtn").removeClass("d-none"):$("#refreshWeekBtn").addClass("d-none")),$(".timesection .fromTime").select2({theme:"bootstrap4",dropdownParent:"#timeAvailabilityPopup",closeOnSelect:!0}),$(".timesection .toTime").select2({theme:"bootstrap4",dropdownParent:"#timeAvailabilityPopup",closeOnSelect:!0}),USER_ROLE_ID,g=!0}}}),g}function getCalendarTable(e,t,a,i,l,s,o,n,d,r,c,m,u,p,v){var f=a.monthName+" - "+a.year;""!=$("#"+e+" #weekDayName").val()&&null!=$("#"+e+" #weekDayName").val()?($("#"+e+" #calMonthYear").html($("#weekDayName").val()+" availability"),$("#"+e+" #preCalMonth").hide(),$("#"+e+" #nextCalMonth").hide()):($("#"+e+" #calMonthYear").html(f),$("#"+e+" #preCalMonth").show(),$("#"+e+" #nextCalMonth").show()),$("#"+e+" #weekDayNum").val(a.weekDayNum),$("#"+e+" #firstStartDate").val(a.startDate),$("#"+e+" #firstDate").val(a.firstDate),$("#"+e+" #firstDateNextMonth").val(a.firstDateNextMonth),$("#"+e+" #firstDatePreMonth").val(a.firstDatePreMonth);var h=parseInt(i.split("-")[2]),y=a.preStartTime,g=a.preEndTime,b=a.dayOfWeekVal,T=b,w=a.timeAvailableList,x=w,k=a.bookingDateList,D=a.calendarDateList;3==USER_ROLE_ID&&k.length<1&&(x=getTimeLastValue(c,w));var C="";if(C+='<table class="table mb-0 text-center" style="table-layout:fixed;">',C+="<thead><tr>",C+='<td class="bold">Sun</td>',C+='<td class="bold">Mon</td>',C+='<td class="bold">Tue</td>',C+='<td class="bold">Wed</td>',C+='<td class="bold">Thu</td>',C+='<td class="bold">Fri</td>',C+='<td class="bold">Sat</td>',C+="</tr>",C+="</thead>",C+="<tbody>",C+="<tr>",7!=b){T=b;for(let e=1;e<=b-1;e++)C+="<td></td>"}if(7==b)for(let e=1;e<=b-1;e++)C+="<td></td>";for(let i=0;i<D.length;i++){var S=D[i],A="";if(A=S.isActive>0?1==S.isActive?"selected-date":"active-date":1==T||7==T?1==S.available?"selected-date":"active-date":0==S.isClick?"expired-date":1==S.available?"selected-date":"active-date",T<=7){if(1==S.isClick){var I="openAvailabilitySection('"+e+"','"+t+"','"+a.startDate+"','"+S.slotDate+"','timeSelectDate"+S.day1+"', '"+T+"', '"+s+"','"+o+"','"+n+"', '"+d+"','"+r+"','"+c+"', '"+m+"','"+u+"','"+p+"', '"+v+"')";C=(C=C+'<td class="'+A+'">')+'<a href="javascript:void(0);" id="timeSelectDate'+S.day1+'" onclick="'+I+'"  class="'+A+' d-inline-block">'+S.day1+"</a>",C+="</td>"}0==S.isClick&&(C=C+'<td class="'+A+'">'+S.day1+"</td>"),T+=1}T>7&&(T=1,C+="</tr>")}C+="</tr>",C+="</tbody>  ",C+="</table>";var E="";if($("."+d).html(""),"Unavailable"==a.dayTimeType)if("add-new-row"==l){E+='<div class="row px-3 align-items-center justify-content-sm-start justify-content-around calday-hours calhours-0 mb-1">';var M="getFromTime(this,'"+s+"','"+o+"','"+r+"','"+c+"','"+m+"','"+u+"','"+p+"', '"+v+"')";if(E=(E+='<div class="mr-1 flex-grow-1 flex-sm-grow-0" style="min-width:100px">')+'<select class="form-control font-12 fromTime" data-id="calday-hours" data-checkid="'+S.day1+'" onchange="'+M+'" data-status="N">',x.length>0){E+='<option value="">Start Time</option>';for(let e=0;e<x.length;e++){const t=x[e];E=E+'<option value="'+t+'" '+(y==t?"selected":"")+">"+t+"</option>"}}E+="</select>",E+="</div>";var N="getToTime(this,'"+s+"','"+o+"','"+r+"','"+c+"','"+m+"','"+u+"','"+p+"', '"+v+"' )";if(E=(E+='<div class="mr-1 flex-grow-1 flex-sm-grow-0" style="min-width:100px">')+'<select class="form-control font-12 toTime" data-id="calday-hours" data-checkid="'+S.day1+'"  onchange="'+N+'" data-status="N">',w.length>0)for(let e=0;e<w.length;e++){const t=w[e];E=E+'<option value="'+t+'" '+(g==t?"selected":"")+">"+t+"</option>"}E+="</select>",E+="</div>",E=(E+="<div>")+'<a href="javascript:void(0)" class="btn btn-lg btn-outline-danger btn-sm" onclick="'+("removeSingleTimeDiv('calhours-0','0', '0', '"+t+"', 'N', '"+y+"', '"+o+"', '"+r+"','time-wise')")+'" style="line-height:5px;"><i class="ion-android-close" style="font-size:14px;line-height:10px;height:14px;"></i></a><span id="calhours-time-0" class="slot-duration"></span>',E+="</div>",E+="</div>"}else E+='<div class="row px-3 align-items-center justify-content-sm-start justify-content-around calday-hours calhours-0 mb-1" data-status="N">',E+="Unavailable",E+="</div>";else if(k.length>0){var R=0;E+='<div class="bold m-0">Total given availability: <span class="specificTotalGivenAvailability"></span></div>';for(let e=0;e<k.length;e++){const a=k[e];duration=0;var L=a.startTime,_=a.endTime;null!=L&&null!=L&&""!=L&&null!=_&&null!=_&&""!=_&&(diff=getTimeDifference(L,_),duration+=diff.asMilliseconds(),R+=diff.asMilliseconds());var O="";if("Y"==a.dataStatus&&3==r&&(O="disabled"),E=E+'<div class="row px-3 align-items-center justify-content-sm-start justify-content-around calday-hours mb-1 calhours-'+e+'">',E=(E+='<div class="mr-1 flex-grow-1 flex-sm-grow-0" style="min-width:100px">')+'<select class="form-control font-12 fromTime" data-id="calday-hours" data-checkid="'+h+'"  onchange="'+(M="getFromTime(this,'"+s+"','"+o+"','"+r+"','"+c+"','"+m+"','"+u+"','"+p+"', '"+v+"')")+'" '+O+' data-status="Y">',x.length>0){E+='<option value="">Start Time</option>';for(let e=0;e<x.length;e++){const t=x[e];E=E+'<option value="'+t+'" '+(a.startTime==t?"selected":"")+">"+t+"</option>"}}if(E+="</select>",E+="</div>",E=(E+='<div class="mr-1 flex-grow-1 flex-sm-grow-0" style="min-width:100px">')+'<select class="form-control font-12 toTime" data-id="calday-hours" data-checkid="'+h+'"  onchange="'+(N="getToTime(this,'"+s+"','"+o+"','"+r+"','"+c+"','"+m+"','"+u+"','"+p+"', '"+v+"' )")+'" '+O+' data-status="Y">',w.length>0){E+='<option value="">End Time</option>';for(let e=0;e<w.length;e++){const t=w[e];E=E+'<option value="'+t+'" '+(a.endTime==t?"selected":"")+">"+t+"</option>"}}E+="</select>",E+="</div>";var U="";"Y"==a.dataStatus&&3==USER_ROLE_ID&&(U="d-none"),E=(E+='<div class="calendar-remove-date ">')+'<a href="javascript:void(0)" class="btn btn-lg btn-outline-danger btn-sm mr-1 '+U+'" onclick="'+("removeSingleTimeDiv('calhours-"+e+"','"+e+"', '"+a.timeid+"', '"+t+"', 'N', '"+a.startTime+"', '"+a.endTime+"', '"+r+"','"+a.timetype+"')")+'" style="line-height:5px;"><i class="ion-android-close" style="font-size:14px;line-height:10px;height:14px;"></i></a><span id="calhours-time-'+e+'" class="slot-duration">'+(duration>0?getTimeWithFormat(duration):"0h 0m")+"</span>",E+="</div>",E+="</div>"}}else if(3==r)if("add-new-row"==l){if(E+='<div class="row px-3 align-items-center justify-content-sm-start justify-content-around calday-hours mb-1 calhours-0">',E=(E+='<div class="mr-1 flex-grow-1 flex-sm-grow-0" style="min-width:100px">')+'<select class="form-control font-12 fromTime" data-id="calday-hours" data-checkid="'+h+'"    onchange="'+(M="getFromTime(this,'"+s+"','"+o+"','"+r+"','"+c+"','"+m+"','"+u+"','"+p+"', '"+v+"')")+'" data-status="N">',x.length>0)for(let e=0;e<x.length;e++){const t=x[e];E=E+'<option value="'+t+'" '+(y==t?"selected":"")+">"+t+"</option>"}if(E+="</select>",E+="</div>",E=(E+='<div class="mr-1 flex-grow-1 flex-sm-grow-0" style="min-width:100px">')+'<select class="form-control font-12 toTime" data-id="calday-hours" data-checkid="'+h+'"    onchange="'+(N="getToTime(this,'"+s+"','"+o+"','"+r+"','"+c+"','"+m+"','"+u+"','"+p+"', '"+v+"' )")+'" data-status="N">',w.length>0)for(let e=0;e<w.length;e++){const t=w[e];E=E+'<option value="'+t+'" '+(g==t?"selected":"")+">"+t+"</option>"}E+="</select>",E+="</div>",E=(E+="<div>")+'<a href="javascript:void(0)" class="btn btn-lg btn-outline-danger btn-sm" onclick="'+("removeSingleTimeDiv('calhours-0','0', '0', '"+t+"', 'N', '"+y+"', '"+o+"', '"+r+"','time-wise')")+'" style="line-height:5px;"><i class="ion-android-close" style="font-size:14px;line-height:10px;height:14px;"></i></a><span id="calhours-time-0" class="slot-duration"></span>',E+="</div>",E+="</div>"}else E+='<div class="row px-3 align-items-center justify-content-sm-start justify-content-around calday-hours mb-1 calhours-0">',E+="Unavailable",E+="</div>";else{if(E+='<div class="row px-3 align-items-center justify-content-sm-start justify-content-around calday-hours mb-1 calhours-0">',E=(E+='<div class="mr-1 flex-grow-1 flex-sm-grow-0" style="min-width:100px">')+'<select class="form-control font-12 fromTime" data-id="calday-hours" data-checkid="'+h+'"    onchange="'+(M="getFromTime(this,'"+s+"','"+o+"','"+r+"','"+c+"','"+m+"','"+u+"','"+p+"', '"+v+"')")+'" data-status="N">',x.length>0)for(let e=0;e<x.length;e++){const t=x[e];E=E+'<option value="'+t+'" '+(y==t?"selected":"")+">"+t+"</option>"}if(E+="</select>",E+="</div>",E=(E+='<div class="mr-1 flex-grow-1 flex-sm-grow-0" style="min-width:100px">')+'<select class="form-control font-12 toTime" data-id="calday-hours" data-checkid="'+h+'"    onchange="'+(N="getToTime(this,'"+s+"','"+o+"','"+r+"','"+c+"','"+m+"','"+u+"','"+p+"', '"+v+"' )")+'" data-status="N">',w.length>0)for(let e=0;e<w.length;e++){const t=w[e];E=E+'<option value="'+t+'" '+(g==t?"selected":"")+">"+t+"</option>"}E+="</select>",E+="</div>",E=(E+="<div>")+'<a href="javascript:void(0)" class="btn btn-lg btn-outline-danger btn-sm mr-1" onclick="'+("removeSingleTimeDiv('calhours-0','0', '0', '"+t+"', 'N', '"+y+"', '"+o+"', '"+r+"','time-wise')")+'" style="line-height:5px;"><i class="ion-android-close" style="font-size:14px;line-height:10px;height:14px;"></i></a><span id="calhours-time-0" class="slot-duration"></span>',E+="</div>",E+="</div>"}return $("."+d).html(E),$(".specificTotalGivenAvailability").text(R>0?getTimeWithFormat(R):"0h 0m"),""!=i&&($("#"+e+" .timesection").show(),$("#"+e+" #inActDate").val(i)),C}function openAvailabilitySection(e,t,a,i,l,s,o,n,d,r,c,m,u,p,v,f){$(".timesection").show(),$("#timeAvailabilitySave").removeClass("d-none"),$("#inActDate").val(i);var h=$("#inActDate").val();if($("#"+l).parent("td").hasClass("selected-date"))return $("#"+l).parent("td").removeClass("selected-date"),$("#"+l).parent("td").addClass("active-date"),$(".timesection").hide(),$("#timeAvailabilitySave").addClass("d-none"),!1;var y=h.split(",").filter((function(e,t,a){return t==a.indexOf(e)})).join(","),g=[],b=y.split(",");if(b.length>0){for(let e=0;e<b.length;e++){const t=b[e];""!=t&&g.push(t)}if(g.length<2){var T=getCalendarDateAvailability(e,t,"timeCalendarPopup",a,y,"Month",!0,""+o,""+n,"open-edit-date",0,"daytime",c,m,u,p,v,f);if(null==T);else if(T){var w,x=$(".calhours-0").find(".toTime").val(),k=0;if(null!=x&&""!=x){x=(x=convertTo24Hour(x)).split(":");var D=new Date(1990,1,1,x[0],x[1],0),C=Date.parse(D),S=new Date(C);if("23"!=x[0]&&"59"!=x[1])var A=getTimePlusInterval(S,0);else A=$(".calhours-0").find(".toTime").val();var I=$(".calhours-0").find(".fromTime").val()}if(A)var E=convertTo24Hour(A);if(null!=E&&""!=E){E=E.split(":");var M=new Date(1990,1,1,E[0],E[1],0),N=Date.parse(M),R=new Date(N);if("23"!=E[0]&&"59"!=E[1])w=getTimePlusInterval(R,0);else w=A}null!=I&&(diff=getTimeDifference(I,w),k+=diff.asMilliseconds()),$(".calhours-0").find("#calhours-time-0").text(k>0?getTimeWithFormat(k):"0h 0m")}else if($("#inActDate").val(""),$(".timesection").hide(),$("#"+l).parent("td").hasClass("selected-date"))return $("#"+l).parent("td").removeClass("selected-date"),$("#"+l).parent("td").addClass("active-date"),h="",!1}}$(".daytime").html()}function addNewRowTime(e,t,a,i,l,s,o,n,d,r,c){validatToSaveFlag=!0,validatToSaveMsg="",3==l&&($(".timeAvailabilityConfirmationAction").hasClass("show")||$(".timeAvailabilityConfirmationAction").addClass("show"));var m=$("#userId").val();3==l?"Unavailable"==$("."+e+"-"+t).text()&&$("#day"+t).removeAttr("disabled"):$("#day"+t).removeAttr("disabled");var u=[];if(!$("#day"+t).is(":checked"))return $("#day"+t).trigger("click"),2==USER_ROLE_ID||3==l&&$("#day"+t).attr("disabled",!0),!1;$(".week-time-available .fromTime").data("select2")&&$(".week-time-available .fromTime").select2("destroy"),$(".week-time-available .toTime").data("select2")&&$(".week-time-available .toTime").select2("destroy");var p=$("."+e+"-"+t).not(".unavailable-"+e+"-"+t).length;if(p>0){$("."+e+"-"+t).each((function(m,u){if(m==p-1){var v=$(this).attr("id"),f=parseInt(v.split("-")[2]);if(""==$("."+e+"-time-"+f).find(".fromTime").val()||""==$("."+e+"-time-"+f).find(".toTime").val())return $("."+e+"-time-"+f).hasClass("d-none")?($("#"+e+"-time-"+f).removeClass("d-none"),!1):(showMessageTheme2(0,"Please select start time and end time","",!0),!1);var h=f+1,y=u.outerHTML;y=(y=y.replace(v,"")).replace(e+"-"+t,e+"-"+t+" "+e+"-time-"+h),$(".cal-hours-"+t).append(y);var g="removeTimeDiv('"+e+"-time-"+h+"','"+t+"','"+a+"','"+i+"','"+l+"','"+s+"' ,'"+o+"','"+n+"','"+d+"' ,'"+r+"','0')";if($("."+e+"-time-"+h).find("a").attr("onclick",g),$("."+e+"-time-"+h+" .remove-time-slot-btn").removeClass("time-save-Y").addClass("time-save-N"),$("."+e+"-time-"+h+" .fromTime").removeClass("startTimeDropDown"+h),$("."+e+"-time-"+h+" .toTime").removeClass("endTimeDropDown"+h),$("."+e+"-time-"+h).find("a").removeClass("d-none"),$("."+e+"-time-"+h).find(".fromTime").attr("data-id",e+"-"+t),$("."+e+"-time-"+h).find(".toTime").attr("data-id",e+"-"+t),$("."+e+"-time-"+h).find(".fromTime").attr("id",e+"-start-time-dropdown-"+h),$("."+e+"-time-"+h).find(".toTime").attr("id",e+"-end-time-dropdown-"+h),$("."+e+"-time-"+h).find(".fromTime").attr("data-status","N"),$("."+e+"-time-"+h).find(".toTime").attr("data-status","N"),$("."+e+"-time-"+h).attr("id",e+"-time-"+h),$("#"+e+"-time-"+h).removeClass("d-none"),$("."+e+"-time-"+h).find(".min-hours").find("span").attr("id",e+"-hour-"+h),3==l&&(0!=f||$("."+e+"-time-"+f).find(".remove-time-slot-btn").hasClass("time-save-Y")||$("."+e+"-time-"+h).find(".fromTime").prepend("<option value=''>Start Time</option>"),$("."+e+"-time-"+h).find(".fromTime").val("").trigger("change")),"remove-slot-week"==c){var b;$("."+e+"-time-"+h).find(".fromTime").val(a),$("."+e+"-time-"+h).find(".toTime").val(i),$("."+e+"-time-"+h+" .remove-time-slot-btn").addClass("d-none"),diff=getTimeDifference(a,i),b=diff.asMilliseconds(),$("#"+e+"-hour-"+h).text(getTimeWithFormat(b))}else{var T,w=$("."+e+"-time-"+f).find(".toTime").val(),x=0;if(null!=w&&""!=w){w=(w=convertTo24Hour(w)).split(":");var k=new Date(1990,1,1,w[0],w[1],0),D=Date.parse(k),C=new Date(D),S=getTimePlusInterval(C,n);if("TEACHER"!=USER_ROLE&&"DIRECTOR"!=USER_ROLE){var A=S;$("."+e+"-time-"+h).find(".fromTime").val(S)}else A="00:00 AM"}if(S)var I=convertTo24Hour(S);if(null!=I&&""!=I){I=I.split(":");var E=new Date(1990,1,1,I[0],I[1],0),M=Date.parse(E),N=new Date(M);if("23"!=I[0]&&"59"!=I[1]){"0.0"==s&&"TEACHER"!=USER_ROLE&&"DIRECTOR"!=USER_ROLE&&(s=1);var R=getTimePlusInterval(N,60*s);"TEACHER"!=USER_ROLE&&"DIRECTOR"!=USER_ROLE?($("."+e+"-time-"+h).find(".toTime").val(R),T=R):T="00:00 AM"}else"TEACHER"!=USER_ROLE&&"DIRECTOR"!=USER_ROLE?($("."+e+"-time-"+h).find(".toTime").val(S),T=S):T="00:00 AM"}null!=A&&(diff=getTimeDifference(A,T),x+=diff.asMilliseconds()),$("."+e+"-time-"+h).find(".fromTime").removeAttr("disabled"),$("."+e+"-time-"+h).find(".toTime").removeAttr("disabled"),$("#"+e+"-hour-"+h).text(x>0?getTimeWithFormat(x):"0h 0m"),$(".week-time-available .fromTime").select2({theme:"bootstrap4"}),$(".week-time-available .toTime").select2({theme:"bootstrap4"})}2==USER_ROLE_ID||3==l&&$("#day"+t).is(":checked")&&$("#day"+t).attr("disabled",!0)}})),3==l&&($(".week-time-available .fromTime").select2({theme:"bootstrap4"}),$(".week-time-available .toTime").select2({theme:"bootstrap4"}));var v=0,f=0;validateTimes(e+"-"+t,"fromTime","toTime",l,s,o,n)&&($("."+e+"-"+t).not(".d-none").each((function(){var e={},t=$(this).find(".fromTime").val(),a=$(this).find(".toTime").val();v=$(this).find(".toTime").attr("data-checkid"),null!=t&&null!=t&&""!=t&&null!=a&&null!=a&&""!=a&&(e.dayid=v,e.startTime=t,e.endTime=a,e.dayCheck="Y",u.push(e),diff=getTimeDifference(t,a),f+=diff.asMilliseconds())})),$(".total-minutes-"+t).text(getTimeWithFormat(f)),3!=l&&saveTimeCalendarWeekWise(m,v,u,"add","new-time",a,i,l,s,o,n,d,r))}else $("#day"+t).is(":checked")&&getDaysCheckUncheck("day"+t,""+a,""+i,""+l,""+s,""+o,""+n,""+d,""+r)}function removeTimeDiv(e,t,a,i,l,s,o,n,d,r,c){timeSlotAvailability=[];var m=$("#userId").val(),u=e.split("-"),p=u[0],v=u[0]+"-"+t;if(3!=l){if($("."+e).remove(),$("."+v).not(".d-none").length>0){validateTimes(v,"fromTime","toTime",l,s,o,n)&&($("."+v).each((function(){var e={},a=$(this).find(".fromTime").val(),i=$(this).find(".toTime").val();e.dayid=t,e.startTime=a,e.endTime=i,e.dayCheck="Y",timeSlotAvailability.push(e)})),saveTimeCalendarWeekWise(m,t,timeSlotAvailability,"add","remove-time",a,i,l,s,o,n,d,r))}else{$("#day"+t).prop("checked",!1);p=$("#day"+t).attr("data-name");$(".cal-hours-"+t).html("");var f="";f='<div class="row justify-content-sm-start justify-content-around  unavailable-'+p+"-"+t+" "+p+"-"+t+" "+p+'-time-0" id="'+p+'-time-0" style="padding-left:50px; font-size:16px">',f+="Unavailable",f+="</div>",$(".cal-hours-"+t).html(f);var h={};h.dayid=t,h.startTime=a,h.endTime=i,h.dayCheck="N",timeSlotAvailability.push(h),saveTimeCalendarWeekWise(m,t,timeSlotAvailability,"add","remove-time",a,i,l,s,o)}0==$("cal-hours-"+t+" .fromTime:not(:disabled)").length&&$("cal-hours-"+t+" .fromTime:disabled")>0&&$("#day"+t).attr("disabled",!0),0==$(".week-time-available .time-save-N").length&&$(".timeAvailabilityConfirmationAction").removeClass("show")}else if(3==l)if(c>0){if(getTeacherMeetingStatus("day-wise",t,m,c,e,"")){if($("."+e).addClass("d-none"),0==$("."+v).not(".d-none").length){$(".cal-hours-"+t).html(""),$(".cal-hours-"+t).addClass("save-slot-wrapper");f="";f='<div class="row justify-content-sm-start justify-content-around unavailable-'+p+"-"+t+" "+p+"-"+t+" "+p+'-time-0" id="'+p+'-time-0" style="padding-left:50px; font-size:16px">',f+="Unavailable",f+="</div>",$(".cal-hours-"+t).html(f),$(".total-minutes-"+t).text("0h 0m")}else{var y=0;$("."+v).not(".d-none").each((function(){var e=$(this).find(".fromTime").val(),t=$(this).find(".toTime").val();null!=e&&null!=e&&""!=e&&null!=t&&null!=t&&""!=t&&(diff=getTimeDifference(e,t),y+=diff.asMilliseconds())})),$(".total-minutes-"+t).text(getTimeWithFormat(y))}return $(".timeAvailabilityConfirmationAction").hasClass("show")||$(".timeAvailabilityConfirmationAction").addClass("show"),!1}}else{if($("."+e).addClass("d-none"),$("."+v).not(".d-none").length>0){y=0;$("."+v).not(".d-none").each((function(){var e=$(this).find(".fromTime").val(),t=$(this).find(".toTime").val();null!=e&&null!=e&&""!=e&&null!=t&&null!=t&&""!=t&&(diff=getTimeDifference(e,t),y+=diff.asMilliseconds())})),$(".total-minutes-"+t).text(getTimeWithFormat(y))}else{$("#day"+t).prop("checked",!1);p=$("#day"+t).attr("data-name");$(".cal-hours-"+t).html("");f="";f='<div class="row justify-content-sm-start justify-content-around  unavailable-'+p+"-"+t+" "+p+"-"+t+" "+p+'-time-0" id="'+p+'-time-0" style="padding-left:50px; font-size:16px">',f+="Unavailable",f+="</div>",$(".cal-hours-"+t).html(f),$(".total-minutes-"+t).text("0h 0m")}$(".week-time-available .time-save-N").length!=$(".available-dropdown-Wrapper.d-none").length||$(".cal-hours-"+t).hasClass("save-slot-wrapper")||$(".timeAvailabilityConfirmationAction").removeClass("show")}}function addSingleRowTime(e,t,a,i,l,s,o,n,d,r,c,m,u){var p=$(".calday-hours").length,v=$("#inActDate").val(),f=$(".calday-hours").text(),h=v.split("-")[2];p>0&&("Unavailable"!=f&&($(".timesection .fromTime").data("select2")&&$(".timesection .fromTime").select2("destroy"),$(".timesection .toTime").data("select2")&&$(".timesection .toTime").select2("destroy")),$(".calday-hours").each((function(y,g){if(0==y)if("Unavailable"==f)getCalendarDateAvailability(e,t,"timeCalendarPopup","",v,"Month",!0,""+i,""+l,"add-new-row",0,"daytime",s,o,n,d,r,c);else{if(""==$(".calhours-"+(p-1)).find(".fromTime").val()||""==$(".calhours-"+(p-1)).find(".toTime").val())return showMessageTheme2(0,"Please select start time and end time","",!0),!1;var b=g.outerHTML;b=(b=b.replace("calhours-0","")).replace("calday-hours","calday-hours calhours-"+p),$("."+a).append(b),$(".calhours-"+p).removeClass("d-none"),null==u&&(u=0);var T="removeSingleTimeDiv('calhours-"+p+"','"+p+"', '"+u+"', '"+t+"', 'N', '"+i+"', '"+l+"', '"+s+"','time-wise')";if($(".calhours-"+p).find("a").attr("onclick",T),$(".calhours-"+p).find(".calendar-remove-date").removeClass("d-none"),$(".calhours-"+p).find(".fromTime").removeAttr("disabled"),$(".calhours-"+p).find(".toTime").removeAttr("disabled"),$(".calhours-"+p).find(".fromTime").attr("data-id","calday-hours"),$(".calhours-"+p).find(".toTime").attr("data-id","calday-hours"),$(".calhours-"+p).find(".fromTime").attr("data-checkid",""+h),$(".calhours-"+p).find(".toTime").attr("data-checkid",""+h),$(".calhours-"+p).find(".fromTime").attr("data-status","N"),$(".calhours-"+p).find(".toTime").attr("data-status","N"),$(".calhours-"+p).find(".slot-duration").attr("id","calhours-time-"+p),"remove-slot-week"==m)$(".calhours-"+p).addClass("hide-remove-button"),$(".calhours-"+p).find(".fromTime").val(i),$(".calhours-"+p).find(".toTime").val(l),$(".calhours-"+p).find(".fromTime").attr("disabled",!0),$(".calhours-"+p).find(".toTime").attr("disabled",!0),$(".calhours-"+p).find(".calendar-remove-date").addClass("d-none");else{var w,x=$(".calhours-"+(p-1)).find(".toTime").val(),k=0;if(null!=x&&""!=x){x=(x=convertTo24Hour(x)).split(":");var D=new Date(1990,1,1,x[0],x[1],0),C=Date.parse(D),S=new Date(C);if("23"!=x[0]&&"59"!=x[1])var A=getTimePlusInterval(S,d);else A=$(".calhours-"+(p-1)).find(".toTime").val();if(3!=s)var I=$(".calhours-"+p).find(".fromTime").val();else I="00:00 AM"}if(A)var E=convertTo24Hour(A);if(null!=E&&""!=E){E=E.split(":");var M=new Date(1990,1,1,E[0],E[1],0),N=Date.parse(M),R=new Date(N);if("23"!=E[0]&&"59"!=E[1]){var L=getTimePlusInterval(R,d);w="TEACHER"!=USER_ROLE&&"DIRECTOR"!=USER_ROLE?L:"00:00 AM"}else w="TEACHER"!=USER_ROLE&&"DIRECTOR"!=USER_ROLE?A:"00:00 AM"}null!=I&&(diff=getTimeDifference(I,w),k+=diff.asMilliseconds()),$(".calhours-"+p).find("#calhours-time-"+p).text(k>0?getTimeWithFormat(k):"0h 0m"),p-1!=0||$(".calhours-"+(p-1)).find(".calendar-remove-date").hasClass("d-none")||""!=$(".calhours-"+p).find(".fromTime option:first-child").val()&&$(".calhours-"+p).find(".fromTime").prepend("<option value=''>Start Time</option>"),3==s&&$(".calhours-"+p).find(".fromTime").val("").trigger("change")}}})),$(".timesection .fromTime").data("select2")&&$(".timesection .fromTime").select2("destroy"),$(".timesection .toTime").data("select2")&&$(".timesection .toTime").select2("destroy"),$(".timesection .fromTime").select2({theme:"bootstrap4",closeOnSelect:!0,dropdownParent:"#timeAvailabilityPopup .timesection"}),$(".timesection .toTime").select2({theme:"bootstrap4",closeOnSelect:!0,dropdownParent:"#timeAvailabilityPopup .timesection"}))}function removeSingleTimeDiv(e,t,a,i,l,s,o,n,d){if(3!=n){if($("."+e).remove(),(m=$(".daytime").find(".calday-hours").length)>0&&$(".calday-hours").each((function(e,t){console.log($(this).attr("class"));var r=$(this).find("a"),c=$(this).attr("class"),m=$.trim(c).split(" "),u=m[m.length-1];console.log(u),$(this).removeClass(u),$(this).addClass("calhours-"+e);var p="removeSingleTimeDiv('calhours-"+e+"','"+e+"', '"+a+"', '"+i+"', '"+l+"', '"+s+"', '"+o+"', '"+n+"','"+d+"')";r.attr("onclick",p)})),0==m){var r="";r+='<div class="row px-3 align-items-center justify-content-sm-start justify-content-around calday-hours mb-1 calhours-0">',r+="Unavailable",r+="</div>",$(".daytime").html(r)}}else if(3==n){var c="time-wise";if("weekwise"==d&&(c="day-wise"),0==a)$("."+e).remove();else{var m,u=$("#inActDate").val();if(getTeacherMeetingStatus(c,0,i,a,e,u))if($("."+e).remove(),0==(m=$(".daytime").find(".calday-hours").length)){r="";r+='<div class="row px-3 align-items-center justify-content-sm-start justify-content-around calday-hours mb-1 calhours-0">',r+="Unavailable",r+="</div>",$(".daytime").html(r)}}}}function getFromTime(e,t,a,i,l,s,o,n,d){3==i&&checkStartTimeVlidation(e,!0,l,s,dropdownTimeGap);var r=[],c=$(e).attr("data-id"),m=($(e).attr("data-id").split("-")[0],$(e).attr("data-checkid")),u=$("#userId").val();if(3!=i||$("#timeAvailabilityPopup").hasClass("show")||$(".timeAvailabilityConfirmationAction").hasClass("show")||$(".timeAvailabilityConfirmationAction").addClass("show"),validateTimes(c,"fromTime","toTime",i,l,s,o)){var p;$("."+c).each((function(){var e={},t=$(this).find(".fromTime").val(),a=$(this).find(".toTime").val();null!=t&&null!=t&&""!=t&&null!=a&&null!=a&&""!=a&&(e.dayid=m,e.startTime=t,e.endTime=a,e.dayCheck="Y",r.push(e));var i=0;if(null!=t&&null!=t&&""!=t&&null!=a&&null!=a&&""!=a){diff=getTimeDifference(t,a),i+=diff.asMilliseconds();var l=$(this).attr("id");if(null!=l){var s=c.split("-")[1];p=l.split("-")[0];var o=l.split("-")[2];$("#"+p+"-hour-"+o).text(i>0?getTimeWithFormat(i):"0h 0m"),$(".total-minutes-"+s).text(i>0?getTimeWithFormat(i):"0h 0m")}}else""==a&&$("#"+p+"-hour-"+o).text("0h 0m")}));var v=0;$("."+p+"-"+m).not(".d-none").each((function(){var e={},t=$(this).find(".fromTime").val(),a=$(this).find(".toTime").val();m=$(this).find(".toTime").attr("data-checkid"),null!=t&&null!=t&&""!=t&&null!=a&&null!=a&&""!=a&&(e.dayid=m,e.startTime=t,e.endTime=a,e.dayCheck="Y",r.push(e),diff=getTimeDifference(t,a),v+=diff.asMilliseconds())})),$(".total-minutes-"+m).text(getTimeWithFormat(v)),3!=i&&saveTimeCalendarWeekWise(u,m,r,"add","from-time",t,a,i,l,s,o,n,d)}}function getToTime(e,t,a,i,l,s,o,n,d){var r=[],c=$(e).attr("data-id"),m=($(e).attr("data-id").split("-")[0],$(e).attr("data-checkid")),u=$("#userId").val();if(3!=i||$("#timeAvailabilityPopup").hasClass("show")||$(".timeAvailabilityConfirmationAction").hasClass("show")||$(".timeAvailabilityConfirmationAction").addClass("show"),validateTimes(c,"fromTime","toTime",i,l,s,o)){var p;if($("."+c).not(".d-none").each((function(e){var t={},a=$(this).find(".fromTime").val(),i=$(this).find(".toTime").val();null!=a&&null!=a&&""!=a&&null!=i&&null!=i&&""!=i&&(t.dayid=m,t.startTime=a,t.endTime=i,t.dayCheck="Y",r.push(t));var l=0;if(null!=a&&null!=a&&""!=a&&null!=i&&null!=i&&""!=i)if(diff=getTimeDifference(a,i),l+=diff.asMilliseconds(),"calday-hours"!=c){if(null!=(n=$(this).attr("id"))){var s=c.split("-")[1];p=n.split("-")[0];var o=n.split("-")[2];$("#"+p+"-hour-"+o).text(l>0?getTimeWithFormat(l):"0h 0m"),$(".total-minutes-"+s).text(l>0?getTimeWithFormat(l):"0h 0m")}}else $("#calhours-time-"+e).text(l>0?getTimeWithFormat(l):"0h 0m");else if(""==i){var n;if("calday-hours"!=c){if(null!=(n=$(this).attr("id"))){s=c.split("-")[1];p=n.split("-")[0];o=n.split("-")[2];$("#"+p+"-hour-"+o).text("0h 0m")}}else $("#calhours-time-"+e).text("0h 0m")}})),"calday-hours"!=c){var v=0;$("."+p+"-"+m).not(".d-none").each((function(){var e={},t=$(this).find(".fromTime").val(),a=$(this).find(".toTime").val();m=$(this).find(".toTime").attr("data-checkid"),null!=t&&null!=t&&""!=t&&null!=a&&null!=a&&""!=a&&(e.dayid=m,e.startTime=t,e.endTime=a,e.dayCheck="Y",r.push(e),diff=getTimeDifference(t,a),v+=diff.asMilliseconds())})),$(".total-minutes-"+m).text(getTimeWithFormat(v))}else{v=0;$(".calday-hours").not(".d-none").each((function(){var e=$(this).find(".fromTime").val(),t=$(this).find(".toTime").val();null!=e&&null!=e&&""!=e&&null!=t&&null!=t&&""!=t&&(diff=getTimeDifference(e,t),v+=diff.asMilliseconds())})),$(".specificTotalGivenAvailability").text(getTimeWithFormat(v))}3!=i&&saveTimeCalendarWeekWise(u,m,r,"add","to-time",t,a,i,l,s,o,n,d)}}function getCalendarAvailabilityData(e,t,a,i,l,s,o,n,d,r,c,m,u){customLoader(!1);var p={},v={userId:t,lUserId:USER_ID,startDate:i,slotType:l,slotDisplyType:"availability",onlyCounts:"Y"};return $.ajax({type:"POST",url:getURLFor("timeavailability","get-calendar-availability"),contentType:"application/json",data:JSON.stringify(v),dataType:"json",async:!1,success:function(e){p=e}}),p}function getTeacherTotalAvailability(e){return customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","get-teacher-availability"),data:JSON.stringify(getRequestForTeacherTotalAvailability(e)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(e){responseData=e},error:function(e){console.log(e)}}),responseData}function getRequestForTeacherTotalAvailability(e){var t={},a={callType:"time-availability"};return a.userId=USER_ID,""!=e&&(a.teacherUserId=e),a.datetype="MONTH",t.teacherTimeListFilterDTO=a,t}function getRequestForTeacherRemainingTime(e,t,a,i,l){var s={};return s.userId=t,s.userRole=a,s.schoolId=SCHOOL_ID,s.callFrom=e,s.callType=i,s.autoForwordStatus=l,s.dataType="MONTH",console.log(s),s}function getTeacherRemainingTime(e,t,a,i,l,s){var o=null;return customLoader(!1),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","get-teacher-time-preference-datewise"),data:JSON.stringify(getRequestForTeacherRemainingTime(e,t,a,l,s)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(e){console.log(e),o=e},error:function(e){"theme2"==tt&&showMessageTheme2(2,TECHNICAL_GLITCH,"",!0)}}),o}function getCalendarAvailability(e,t,a,i,l,s,o,n,d,r,c,m,u){var p=!0;customLoader(!0);var v=$('input[name="availabilitySlot"]:checked').val(),f={userId:t,lUserId:USER_ID,startDate:i,slotType:l,slotDisplyType:v,onlyCounts:"N"};return $.ajax({type:"POST",url:getURLFor("timeavailability","get-calendar-availability"),contentType:"application/json",data:JSON.stringify(f),dataType:"json",cache:!1,async:!0,timeout:6e5,success:function(i){if("0"==i.status||"2"==i.status)showMessage(!0,i.message),p=!1;else{$("#"+a).html("");var l=i.monthName+" - "+i.year;$("#timeCalMonthYear").html(l),$("#timeToDayDate").val(i.startDate),$("#timeFirstDate").val(i.firstDate),$("#timeFirstDateNextMonth").val(i.firstDateNextMonth),$("#timeFirstDatePreMonth").val(i.firstDatePreMonth);var f=getCalendarAvailabilityTable(e,t,i,s,o,v,n,d,r,c,m,u);$("#"+a).html(f),$('[data-toggle="tooltip"]').tooltip(),$(".btnEditDate").hide(),$(".btnEditWeek").hide(),$(".dropdown").on("shown.bs.dropdown",(function(){$(".show-view-more").css({"overflow-y":"inherit"})})),$(".dropdown").on("hidden.bs.dropdown",(function(e){$(".show-view-more").css({"overflow-y":"auto"}),3==n&&$(e).parent().find("bg-danger").removeClass("bg-danger")})),$(".dropdown-toggle").on("click",(function(e){3==n&&($(".dropdown-toggle").removeClass("bg-danger px-1"),$(this).addClass("bg-danger px-1"));var t=$(this).next(".dropdown-menu"),a=$(window).width(),i=$(this).offset(),l=t.outerWidth();a-(i.left+$(this).outerWidth())<l?t.addClass("dropdown-menu-left").removeClass("dropdown-menu-right"):t.addClass("dropdown-menu-right").removeClass("dropdown-menu-left"),$("#timeCalendar .dropdown-menu").hasClass("show")&&($("#timeCalendar .dropdown-menu").removeClass("show"),$("#timeCalendar .dropdown-menu").parent().closest(".scrollbar-container").css({"overflow-y":"auto"}))})),$("#timeCalendar > table > thead td").css({background:"#fff"}),p=!0}customLoader(!1)}}),p}function getCalendarAvailabilityTable(e,t,a,i,l,s,o,n,d,r,c,m){console.log(a);var u=a.dayOfWeekVal,p=u,v=a.calendarDateList,f="";if(f+='<table class="table text-center mb-0">',f+='<thead><tr class="text-uppercase">',f+='<td class="bold">Sun',3==o&&"TEACHER"!=USER_ROLE&&(f=f+'<a href="javascript:void(0);" id="reset-sun" onclick="resetAllDateSpecificByDayAndUserId('+t+",1,'"+i+"', '"+l+"', "+o+",' "+n+"', '"+d+"', "+r+","+c+","+m+')" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Reset-All-Date-specific"><i class="lnr lnr-sync float-right text-primary"></i></a>'),f+="</td>",f+='<td class="bold">Mon',3==o&&"TEACHER"!=USER_ROLE&&(f=f+' <a href="javascript:void(0);" id="reset-mon" onclick="resetAllDateSpecificByDayAndUserId('+t+",2,'"+i+"', '"+l+"', "+o+",' "+n+"', '"+d+"', "+r+","+c+","+m+')" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Reset-All-Date-specific"><i class="lnr lnr-sync float-right text-primary"></i></a>'),f+="</td>",f+='<td class="bold">Tue',3==o&&"TEACHER"!=USER_ROLE&&(f=f+' <a href="javascript:void(0);" id="reset-tue" onclick="resetAllDateSpecificByDayAndUserId('+t+",3,'"+i+"', '"+l+"', "+o+",' "+n+"', '"+d+"', "+r+","+c+","+m+')" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Reset-All-Date-specific"><i class="lnr lnr-sync float-right text-primary"></i></a>'),f+="</td>",f+='<td class="bold">Wed ',3==o&&"TEACHER"!=USER_ROLE&&(f=f+' <a href="javascript:void(0);" id="reset-wed" onclick="resetAllDateSpecificByDayAndUserId('+t+",4,'"+i+"', '"+l+"', "+o+",' "+n+"', '"+d+"', "+r+","+c+","+m+')" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Reset-All-Date-specific"><i class="lnr lnr-sync float-right text-primary"></i></a>'),f+="</td>",f+='<td class="bold">Thu',3==o&&"TEACHER"!=USER_ROLE&&(f=f+' <a href="javascript:void(0);" id="reset-thu" onclick="resetAllDateSpecificByDayAndUserId('+t+",5,'"+i+"', '"+l+"', "+o+",' "+n+"', '"+d+"', "+r+","+c+","+m+')" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Reset-All-Date-specific"><i class="lnr lnr-sync float-right text-primary"></i></a>'),f+="</td>",f+='<td class="bold">Fri',3==o&&"TEACHER"!=USER_ROLE&&(f=f+' <a href="javascript:void(0);" id="reset-fri" onclick="resetAllDateSpecificByDayAndUserId('+t+",6,'"+i+"', '"+l+"', "+o+",' "+n+"', '"+d+"', "+r+","+c+","+m+')" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Reset-All-Date-specific"><i class="lnr lnr-sync float-right text-primary"></i></a>'),f+="</td>",f+='<td class="bold">Sat',3==o&&"TEACHER"!=USER_ROLE&&(f=f+' <a href="javascript:void(0);" id="reset-sat" onclick="resetAllDateSpecificByDayAndUserId('+t+",7,'"+i+"', '"+l+"', "+o+",' "+n+"', '"+d+"', "+r+","+c+","+m+')" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Reset-All-Date-specific"><i class="lnr lnr-sync float-right text-primary"></i></a>'),f+="</td>",f+="</tr>",f+="</thead>",f+="<tbody>",f+="<tr>",7!=u){p=u;for(let e=1;e<=u-1;e++)f+="<td></td>"}if(7==u)for(let e=1;e<=u-1;e++)f+="<td></td>";for(let u=0;u<v.length;u++){var h="",y=v[u],g=y.availabilityDateList,b="";if(b=1==p||7==p?1==y.available?"selected-date":"active-date":0==y.isClick?"expired-date":1==y.available?"selected-date":"active-date",p<=7){var T="openCalendarMenuBtn(this, '"+y.day1+"')",w="openCalendarPopup('"+e+"','"+t+"','"+a.startDate+"', '"+y.slotDate+"', '"+i+"', '"+l+"', '"+o+"', '"+n+"', '"+d+"', '"+r+"', '"+c+"', '"+m+"')",x="openCalendarWeekPopup('"+e+"','"+t+"','"+y.weekDayName+"', '','"+y.slotDate+"','"+y.weekDayId+"', '"+i+"', '"+l+"','"+o+"', '"+n+"', '"+d+"', '"+r+"', '"+c+"', '"+m+"')",k="getRefreshWeek('from-counselor','"+t+"','"+y.slotDate+"','"+y.weekDayId+"', '"+i+"', '"+l+"','"+o+"', '"+n+"', '"+d+"', '"+r+"', '"+c+"', '"+m+"')";if(f=1==y.isClick?f+'<td class="border-top-4 td-bg-white  position-relative '+b+'">':f+'<td class="td-bg-gray position-relative '+b+'">',null!=g&&g.length>0){var D=g.length,C=0;if(D>0)for(let e=0;e<g.length;e++)bookt=g[e],diff=getTimeDifference(bookt.startTime,bookt.endTime),C+=diff.asMilliseconds();0;var S="primary";if("booked"==s?S="danger":"available"==s&&(S="success"),f+=y.day1,"Unavailable"==y.dayTimeType||(f=f+'<span  class="d-inline-block float-right text-white font-12 px-1 bg-'+S+'">'+getTimeWithFormat(C)+"</span>"),f+='<div class="full mt-2 show-view-more scrollbar-container h-auto" style="position:static">',3!=o&&(f=f+'<div class="full btnEditDate pr-3"  id="btnEditDate'+y.day1+'"><a href="javascript:void(0)" onclick="'+w+'" class="mb-1 full btn btn-sm btn-outline-dark d-inline-block "><i class="lnr-calendar-full mr-1"></i>Edit <b>date(s)</b></a></div>'),f="calendar"==y.timeType?f+'<div class="full btnEditWeek pr-3"  id="btnEditWeek'+y.day1+'"><a href="javascript:void(0)" onclick="'+k+'" class="mb-1 full btn btn-sm btn-outline-dark d-inline-block "><i class="lnr-sync mr-1"></i>Reset to Weekly hours</b></a></div>':f+'<div class="full btnEditWeek pr-3"  id="btnEditWeek'+y.day1+'"><a href="javascript:void(0)" onclick="'+x+'" class="mb-1 full btn btn-sm btn-outline-dark d-inline-block "><i class="lnr lnr-frame-expand mr-1"></i>Edit <b>all '+y.weekDayName+"</b></a></div>","Unavailable"==y.dayTimeType)f=f+'<div class="time-row full font-weight-semi-bold p-1 mb-1 text-center" style="color:#9f9c9c;" >'+y.dayTimeType+"</div>";else{for(let e=0;e<g.length;e++){const t=g[e];var A="";if("booked"==s){var I=t.slotDate.toString().replace("-","");A=3==o?"getTeacherTimeBooked('"+t.entityId+"','"+t.entityType+"','"+t.slotDate+"','"+I+"');":"callMeetingBooking('calendar-available','"+t.timeid+"','"+t.timeCategory+"','"+t.slotDate+"','"+t.entityType+"','"+t.entityId+"');"}h=getColorByEntityType(t.entityType),e>2?(f=f+'<div class="time-row full font-weight-semi-bold p-1 mb-1 border-'+h+'" style="display:none">',"booked"!=s?f=f+"<span class='text-"+S+"'>"+t.startTime+" - "+t.endTime+"</span>":(f=f+'<a href="javascript:void(0)" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="btn btn-sm p-1 font-12 dropdown-toggle  btn-'+h+' text-white" onClick="'+A+'" >'+t.startTime+" - "+t.endTime+"</a>",3==o&&"Y"==t.recurringClass&&(f+='&nbsp;<label class="font-12" data-toggle="tooltip" data-placement="top" data-original-title="Recurring Class">R</label>'),f=f+'<div tabindex="-1" role="menu" aria-hidden="true" class="dropdown-menu-md dropdown-menu p-0 mt-2 meetingDetailclass'+t.timeid+'" style="min-width:450px"></div>'),f+="</div>"):(f+='<div class="full font-weight-semi-bold p-1 mb-1 dropdown">',"booked"!=s?f=f+"<span class='text-"+S+"'>"+t.startTime+" - "+t.endTime+"</span>":(f=f+'<a href="javascript:void(0)" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="btn btn-sm p-1 font-12 dropdown-toggle btn-'+h+' text-white" onClick="'+A+'" >'+t.startTime+" - "+t.endTime+"</a>",3==o&&"Y"==t.recurringClass&&(f+='&nbsp;<label class="font-12" data-toggle="tooltip" data-placement="top" data-original-title="Recurring Class">R</label>'),f=f+'<div tabindex="-1" role="menu" aria-hidden="true" class="dropdown-menu-md dropdown-menu p-0 mt-2 meetingDetailclass'+t.timeid+'" style="min-width:450px"></div>'),f+="</div>")}1==y.isClick?"calendar"==y.timeType?3!=o?"booked"!=s&&"available"!=s&&(f=f+'<a href="javascript:void(0);" id="slotSelectDate'+y.day1+'"  onclick="'+T+'" class="'+b+' d-inline-block float-right calendarBtn position-absolute font-size-md" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Date-specific"><i class="lnr-calendar-full float-right text-primary"></i></a>'):f="TEACHER"==USER_ROLE?f+'<span id="slotSelectDate'+y.day1+'"  class="'+b+' d-inline-block float-right position-absolute font-size-md" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Date-specific"><i class="lnr-calendar-full float-right" style="color:#333"></i></span>':f+'<a href="javascript:void(0);" id="slotSelectDate'+y.day1+'" onclick="'+T+'" class="'+b+' d-inline-block float-right position-absolute font-size-md" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Date-specific"><i class="lnr-calendar-full float-right text-primary"></i></a>':3!=o?"booked"!=s&&"available"!=s&&(f=f+'<a href="javascript:void(0);" id="slotSelectDate'+y.day1+'" onclick="'+T+'" class="'+b+' d-inline-block float-right syncBtn position-absolute font-size-md" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Weekly"><i class="lnr lnr-sync float-right text-primary"></i></a>'):f=f+'<span id="slotSelectDate'+y.day1+'"  class="'+b+' d-inline-block float-right position-absolute font-size-md" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Weekly"><i class="lnr lnr-sync float-right" style="color:#333"></i></span>':"calendar"==y.timeType?3==o&&(f=f+'<span id="slotSelectDate'+y.day1+'"  class="'+b+' d-inline-block float-right position-absolute font-size-md" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Date-specific"><i class="lnr-calendar-full float-right" style="color:#333"></i></span>'):3==o&&(f=f+'<span href="javascript:void(0);" id="slotSelectDate'+y.day1+'"  class="'+b+' d-inline-block float-right position-absolute font-size-md" style="right:8px;bottom:50px;font-size:20px" data-toggle="tooltip" data-placement="top" data-original-title="Weekly"><i class="lnr lnr-sync float-right" style="color:#333"></i></span>'),D>3&&(f+='<a href="javascript:void(0)" onclick="viewMore(this)" class="position-absolute" style="right:8px;bottom:20px;font-size:20px"><i class="fa fa-angle-down ml-1 mt-1"></i></a></td>')}f+="</div>"}else 1==y.isClick&&"availability"==y.timeCategory?f=f+'<a href="javascript:void(0);" id="slotSelectDate'+y.day1+'"  onclick="'+T+'"  class="'+b+' d-inline-block">'+y.day1+"</a>":f+=y.day1,f=(f=f+'<div class="full btnEditDate pr-3"  id="btnEditDate'+y.day1+'"><a href="javascript:void(0)" onclick="'+w+'" class="mb-1 full btn btn-sm btn-outline-dark d-inline-block "><i class="lnr-calendar-full mr-1"></i>Edit <b>date(s)</b></a></div>')+'<div class="full btnEditWeek pr-3"  id="btnEditWeek'+y.day1+'"><a href="javascript:void(0)" onclick="'+x+'" class="mb-1 full btn btn-sm btn-outline-dark d-inline-block "><i class="lnr lnr-frame-expand mr-1"></i>Edit <b>all '+y.weekDayName+"</b></a></div>";f+="</td>",p+=1}p>7&&(p=1,f+="</tr>")}return f+="</tr>",f+="</tbody>  ",f+="</table>",$(".totalOccupied").html(getTimeFormat(a.bookedHoursTotal)),$(".totalAvailabilityGiven").html(getTimeFormat(a.toatlAvailableHours)),$(".totalUnoccupied").html(getTimeFormat(a.remainingHoursTotal)),$(".GROUP_CLASS").html(getTimeFormat(a.bookedGroupHoursTotal)),$(".STUDENT_DOUBT_SESSION").html(getTimeFormat(a.bookedOneToOneHoursTotal)),$(".ACTIVITY_CLASS").html(getTimeFormat(a.bookedActivityHoursTotal)),f}function getBookMeetingDetail(e){var t="";return t=t+'<div class="widget-chart text-left card-top-border card-shadow-primary border-'+e.meetingColor+' card w-100" style="min-width:400px">',t+='<ul class="p-0 m-0 w-100">',t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Event Name:</label>')+"<span>"+e.meetingType+"</span>",t+="</li>",t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Invitee Name:</label>')+"<span>"+e.meetingAttandeePerson+"</span>",t+="</li>",t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Event Duration:</label>')+"<span>"+e.eventDuration+"</span>",t+="</li>",t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Slot Buffer Time:</label>')+"<span>"+e.bufferTime+"</span>",t+="</li>",t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Status:</label>')+"<span>"+e.meetingStatus+"</span>",t+="</li>",t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Invitee Date and Time Zone:</label>')+"<span>"+e.studentDateTime+" "+e.meetingAttendeeTimezone+"</span>",t+="</li>",t+="</ul>",t+="</div>"}function viewMore(e){"none"==$(e).parent().find(".time-row").css("display")?($(e).parent().find(".time-row").show(),$(e).html("<i class='fa fa-angle-up'></i>")):($(e).parent().find(".time-row").hide(),$(e).html("<i class='fa fa-angle-down'></i>"))}function openCalendarMenuBtn(e,t){$(".btnEditDate").hide(),$(".btnEditWeek").hide(),$("#btnEditDate"+t).show(),$("#btnEditWeek"+t).show(),$(e).parent().find(".show-view-more").animate({scrollTop:0},"slow")}function openCalendarPopup(e,t,a,i,l,s,o,n,d,r,c,m){$("#timeAvailabilityPopup").modal("show"),$("#inActDate").val(""),$("#weekCount").val(""),$("#weekDayName").val(""),3!=o&&$("#timeAvailabilitySave").removeClass("d-none"),getCalendarDateAvailability(e,t,"timeCalendarPopup",a,i,"Month",!0,""+l,""+s,"open-edit-date",0,"daytime",o,n,d,r,c,m)}function openCalendarWeekPopup(e,t,a,i,l,s,o,n,d,r,c,m,u,p){$("#timeAvailabilityPopup").modal("show"),$("#inActDate").val(""),$("#weekCount").val(""+s),$("#weekDayName").val(""+a),3!=d&&$("#timeAvailabilitySave").removeClass("d-none"),getCalendarDateAvailability(e,t,"timeCalendarPopup",i,l,"Month",!1,""+o,""+n,"open-edit-week-date",0,"daytime",d,r,c,m,u,p)}function dateTimeValidation(e){var t=!1,a="",i=$("."+e);return i.each((function(e,l){var s=$(l).find(".fromTime").val(),o=$(l).find(".toTime").val(),n="1970-12-31 "+s,d=Date.parse(n),r=new Date(d),c="1970-12-31 "+o,m=Date.parse(c),u=new Date(m);return r>u?(t=!0,a="Please make sure To datetime is greater than From datetime.",!1):(i.each((function(i,l){if(e!==i){var s=$(l).find(".fromTime").val(),o=$(l).find(".toTime").val(),n="1970-12-31 "+s,d=Date.parse(n),c=new Date(d),m="1970-12-31 "+o,p=Date.parse(m),v=new Date(p);if(r<v&&u>c)return t=!0,a="Datetime ranges overlap.",!1}})),!t&&void 0)})),!t||(showMessageTheme2(0,a,"",!0),!1)}function saveTimeCalendarAvailability(e,t,a,i,l,s,o,n,d,r,c){if((hideMessageTheme2(""),3!=s)&&!validateTimes("calday-hours","fromTime","toTime",s,o,n,d))return!1;var m=$("#firstStartDate").val();$.ajax({type:"POST",contentType:"application/json",url:getURLFor("timeavailability","save-time-availablity"),data:JSON.stringify(getRequestForTimeAvailability(e,t,a,i,l,s)),dataType:"json",cache:!1,timeout:6e5,success:function(a){return"0"==a.status||"2"==a.status?showMessageTheme2(0,a.message,"",!0):(showMessageTheme2(1,a.message,"",!0),$("#timeAvailabilityPopup").modal("hide"),"from-confirm"==e||getCalendarAvailability("timeAvailabilityPopup",t,"timeCalendar",""+m,"Month",i,l,s,o,n,d,r,c),getUserAvailability("user-time-available",t,"",i,l,s),saveAvailabilityOfActiveEvents("CALL-CALENDAR","ALL",s)),!1},error:function(e){return!1}})}function getRequestForTimeAvailability(e,t,a,i,l,s){var o={},n=[];o.callfrom=e,o.userId=t,o.schoolId=SCHOOL_ID,o.slotAddUserId=USER_ID,o.userRole=3==s?"TEACHER":"ADMIN";var d=$("#inActDate").val();if(o.selectDate=d,o.slotType="",3!=s)if("Unavailable"==$(".calday-hours").text()){o.controlType="edit-unavailable";var r={};let e=i,t=l;null!=e&&null!=e&&""!=e&&null!=t&&null!=t&&""!=t&&(r.startTime=e,r.endTime=t,n.push(r))}else $(".calday-hours").each((function(){var e={},t=$(this).find(".fromTime").val(),a=$(this).find(".toTime").val();null!=t&&null!=t&&""!=t&&null!=a&&null!=a&&""!=a&&(e.startTime=t,e.endTime=a,n.push(e))})),o.controlType="add";else $(".specific-time-add").each((function(){var e={},t=$(this).attr("data-select-date"),a=$(this).attr("data-starttime"),i=$(this).attr("data-endtime"),l=$(this).attr("data-controltype");"edit-unavailable"==l?(o.controlType="edit-unavailable",o.selectDate=t,e.startTime=a,e.endTime=i,e.selectDate=t,e.dateType=l,n.push(e)):null!=a&&null!=a&&""!=a&&null!=i&&null!=i&&""!=i&&(e.startTime=a,e.endTime=i,e.selectDate=t,e.dateType=l,n.push(e))}));return o.timeSlotAvailability=n,console.log(o),o}function getUserAvailability(e,t,a,i,l,s){customLoader(!0);var o={userId:t,slotType:a};$.ajax({type:"POST",url:getURLFor("timeavailability","get-user-availability"),contentType:"application/json",data:JSON.stringify(o),dataType:"json",cache:!1,async:!0,timeout:6e5,success:function(a){if("0"==a.status||"2"==a.status)showMessage(!0,a.message);else{$("."+e).html("");var o=getUserAvailabilityHtml(a,t,i,l,s);$("."+e).html(o),$("#btnTimeCalendar").on("click",(function(){$(".timeAvailabilityConfirmationAction").removeClass("show"),$(".tooltip.show").remove(),$("#timeAvailabilityPopup .timesection").hide(),$("#timeAvailabilityPopup #inActDate").val(""),$("#timeAvailabilityPopup #weekCount").val(""),$("#timeAvailabilityPopup #weekDayName").val(""),$("#timeAvailabilityPopup #refreshWeekBtn").addClass("d-none"),$("#timeAvailabilityPopup").modal("show");var e=$("#slotMin").val(),a=$("#slotMax").val(),o=$("#slotBufferTime").val(),n=$("#slotDateLimit").val(),d=$("#slotMax").val();getCalendarDateAvailability("timeAvailabilityPopup",""+t,"timeCalendarPopup","","","Month",!0,""+i,""+l,"add-specify-date","0","daytime",""+s,""+e,""+a,""+o,""+n,""+d)})),$('[data-toggle="tooltip"]').tooltip()}return!1},error:function(e){return!1}})}function getUserAvailabilityHtml(e,t,a,i,l){var s=$("#btnSpecificHide").val(),o=e.timeAvailable,n=$(".specific_tr").length,d="";if(0==n&&(d=d='<table class="table">',d+="<thead>",d+="<tr>",d+="<th>Specific Date</th>",d+=3==l?"<th>Live Classes Slot</th>":"<th>&nbsp;</th>",d+='<th width="215px">',"N"==s&&(d+='<button class="my-1 mr-2 btn-icon btn btn-outline-primary p-1" id="btnTimeCalendar" data-toggle="tooltip" data-placement="top" title="Override your availability for specific dates when your hours differ from your regular weekly hours."><i class="pe-7s-plus btn-icon-wrapper"> </i>Add date-specific hours</button>'),d+="</th>",d+="</tr>",d+="</thead>",d+='<tbody class="tbody-user-time">'),null!=o&&o.length>0)for(let e=0;e<o.length;e++){var r=e+n,c=o[e],m=c.teacherPreferTime;d=(d=(d=d+'<tr class="specific_tr specific_tr_date_'+c.strSelectDate.toString().replaceAll("-","")+("Y"!=c.dataType?"new-add-availibality-row":"")+'" id="specific_tr_'+r+'" >')+"<td>"+c.selectDate+"</td>")+'<td id="specific_td_'+r+'">';var u="removeTimePrefRence('specific_tr_"+r+"', '"+c.selectDate+"', '"+t+"','Y','"+a+"','"+i+"','"+l+"')",p="";if("Y"!=c.dataType&&(p="specific-time-add text-danger"),"Unavailable"==c.dayTimeType)d=d+'<span class="'+p+'" id="specific_tr_'+r+'_0" data-timeid="0" data-select-date="'+c.strSelectDate+'" data-controlType="edit-unavailable" data-starttime="'+a+'" data-endtime="'+i+'">Unavailable</span>';else if(null!=m)for(let e=0;e<m.length;e++){utime=m[e];var v="removeTimePrefRence('specific_tr_"+r+"_"+e+"', '"+utime.timeid+"','"+t+"','N','"+a+"','"+i+"','"+l+"')";d=d+'<span class="d-inline-block '+p+" specific_tr_"+r+"_"+e+'" style="min-width:135px" data-timeid="'+utime.timeid+'"  data-select-date="'+c.strSelectDate+'" data-controlType="add" data-starttime="'+utime.startTime.split(" - ")[0]+'" data-endtime="'+utime.startTime.split(" - ")[1]+'">'+utime.startTime+"</span>","Y"!=c.dataType&&3==USER_ROLE_ID||"remove-hide"==utime.timetype||3!=USER_ROLE_ID&&"Y"==c.dateValid&&(d=(d=d+'<span class="d-inline-block ml-1 mb-1 remove specific_tr_'+r+"_"+e+'">')+'<a href="javascript:void(0);" class="click-to-catalog btn btn-sm btn-outline-danger" onclick="'+v+'"><i class="ion-android-close"></i></a>',d+="</span>"),d+="<br/>"}d+="</td>","Unavailable"==c.dayTimeType?d+="<td></td>":d=d+'<td class="'+("Y"!=c.dataType?"new-add-availibality-time-td":"")+'">'+c.totalTimeHrsMins+"</td>",3!=l&&(d=d+'<td><a href="javascript:void(0);" class="click-to-catalog btn btn-sm" style="font-size:24px !important" onclick="'+u+'"><i class="lnr lnr-cross"></i></a></td>'),d+="<td>&nbsp;</td>",d+="</tr>",excludeDates.push(new Date(c.selectDate).toDateString())}if(0==n)return d+="</tbody>  ",d+="</table>",3==l&&("--"!=$(".totalAvailabilityLabel .totalAvailabilityGiven").text()&&""!=$(".totalAvailabilityLabel .totalAvailabilityGiven").text()?takedHoursInMinutes=60*parseInt($(".totalAvailabilityLabel .totalAvailabilityGiven").text().split(" ")[0].split("h")[0])+parseInt($(".totalAvailabilityLabel .totalAvailabilityGiven").text().split(" ")[1].split("m")[0]):takedHoursInMinutes=0,dayCounts=0==takedHoursInMinutes?countDaysFromCurrentDate(getDayYear,getDayMonth,1):countDaysFromCurrentDate(getDayYear,getDayMonth,getDayDate)),d;$(".tbody-user-time").append(d),3==l&&(takedHoursInMinutes=60*parseInt($(".totalAvailabilityLabel .totalAvailabilityGiven").text().split(" ")[0].split("h")[0])+parseInt($(".totalAvailabilityLabel .totalAvailabilityGiven").text().split(" ")[1].split("m")[0]),dayCounts=0==takedHoursInMinutes?countDaysFromCurrentDate(getDayYear,getDayMonth,1):countDaysFromCurrentDate(getDayYear,getDayMonth,getDayDate))}function saveTimeCalendarWeekWise(e,t,a,i,l,s,o,n,d,r,c,m,u){customLoader(!0),hideMessageTheme2(""),$.ajax({type:"POST",contentType:"application/json",url:getURLFor("timeavailability","save-availablity-weekwise"),data:JSON.stringify(getRequestForTimeCalendarWeekWise(e,t,a,s,o,l,i,n,d,r,c)),dataType:"json",cache:!1,timeout:6e5,success:function(t){if("0"==t.status||"2"==t.status)showMessageTheme2(0,t.message,"",!0);else if("first"==l);else{showMessageTheme2(1,t.message,"",!0),$(".timeAvailabilityConfirmationAction").removeClass("show"),"edit-all-week"==l?(getCalendarAvailability("timeAvailabilityPopup",e,"timeCalendar","","Month",s,o,n,d,r,c,m,u),getUserAvailability("user-time-available",e,"",s,o,n),$("#timeAvailabilityPopup").modal("hide")):getUserWeeklyAvailability("week-time-available",e,"",s,o,0,0,n,d,r,"",c,m,u),saveAvailabilityOfActiveEvents("CALL-CALENDAR-WEEK","ALL",n),$(".timesection .fromTime").data("select2")&&$(".timesection .fromTime").select2("destroy"),$(".timesection .toTime").data("select2")&&$(".timesection .toTime").select2("destroy"),$(".timesection .fromTime").select2({theme:"bootstrap4",closeOnSelect:!0,dropdownParent:"#timeAvailabilityPopup .timesection"}),$(".timesection .toTime").select2({theme:"bootstrap4",closeOnSelect:!0,dropdownParent:"#timeAvailabilityPopup .timesection"});var a=[];$(".dropdown-menu .copy-times").on("click",(function(){return!1})),$(".dropdown-menu label.day-type-label").on("click",(function(e){var t=$(e.currentTarget).attr("for");if($("#"+t).prop("disabled"))return!1;$(".day-list").each((function(){$(this).is(":checked")&&a.push($(this).val())}));var i,l=$(e.currentTarget),s=l.attr("data-value"),o=s.split("-"),n=(o=parseInt(o[1]),l.parent().find("input"));return(i=a.indexOf(s))>-1?(a.splice(i,1),setTimeout((function(){n.prop("checked",!1)}),0)):(a.push(s),setTimeout((function(){n.prop("checked",!0)}),0)),$(e.target).blur(),console.log(a),!1}))}return customLoader(!1),!1},error:function(e){return customLoader(!1),!1}})}function getRequestForTimeCalendarWeekWise(e,t,a,i,l,s,o,n,d,r,c){var m={},u=[];return m.userId=e,m.slotAddUserId=USER_ID,m.slotType=s,m.dayid=t,m.userRoleId=n,a.length>0?u=a:$(".week-slot-available").each((function(){var e=$(this).attr("data-dayname"),t=$(this).val();if($(this).is(":checked")){if(m.dayid=t,validateTimes(e,"fromTime","toTime",n,d,r,c)&&$("."+e).not(".d-none").each((function(){var e={},a=$(this).find(".fromTime").val(),s=$(this).find(".toTime").val(),o="Y";null==a&&(a=i,s=l,o="N"),null!=a&&null!=a&&""!=a&&null!=s&&null!=s&&""!=s&&(e.dayid=t,e.startTime=a,e.endTime=s,e.dayCheck=o,u.push(e))})),!validatToSaveFlag)return showMessageTheme2(1,validatToSaveMsg,"",!0),!1}else m.dayid=t,$("."+e).each((function(){var e={},a=$(this).attr("data-starttime"),s=$(this).attr("data-endTime");null==a&&(a=i,s=l),null!=a&&null!=a&&""!=a&&null!=s&&null!=s&&""!=s&&(e.dayid=t,e.startTime=a,e.endTime=s,e.dayCheck="N",u.push(e))}))})),m.controlType=o,m.timeSlotAvailability=u,console.log(m),m}function getUserWeeklyAvailability(e,t,a,i,l,s,o,n,d,r,c,m,u,p){customLoader(!0);var v={userId:t,lUserId:USER_ID,slotType:a,dayId:s,slotTypeId:o};$.ajax({type:"POST",url:getURLFor("timeavailability","get-user-week-availability"),contentType:"application/json",data:JSON.stringify(v),dataType:"json",cache:!1,async:!0,timeout:6e5,success:function(a){if("0"==a.status||"2"==a.status)showMessage(!0,a.message);else{var v=a.timeAvailabilityList,f=v;if(3==USER_ROLE_ID&&(f=getTimeLastValue(d,v)),0==s)$("."+e).html(""),getWeekDaysAvailabilityHtml(t,a,e,i,l,o,n,d,r,c,m,u,p,a.timeAvailabilityList);else{var h=a.weekDaysAvailabilityList;if(h.length>0)for(let t=0;t<h.length;t++){htmlw="";const a=h[t];var y=bindTimeAvailableDropdown(a.timeSlotAvailability,f,a,i,l,n,d,r,c,m,u,p,v);$("."+e).html(y);var g=0;"day-check"==c&&($("."+a.dayName+"-"+a.dayId).each((function(){var e=$(this).find(".fromTime").val(),t=$(this).find(".toTime").val();null!=e&&null!=e&&""!=e&&null!=t&&null!=t&&""!=t&&(diff=getTimeDifference(e,t),g+=diff.asMilliseconds())})),$(".total-minutes-"+a.dayId).text(getTimeWithFormat(g)))}}o>0&&getEventWiseWeekHours(a.weekDaysAvailabilityList),$(".week-time-available .fromTime").select2({theme:"bootstrap4"}),$(".week-time-available .toTime").select2({theme:"bootstrap4"})}return!1},error:function(e){return!1}})}function getEventWiseWeekHours(e){var t="";if(t+='<table class="table">',t+="<tbody>",null!=e&&e.length>0)for(let l=0;l<e.length;l++){const s=e[l];var a=s.timeSlotAvailability;if(t=t+'<tr><th width="50">'+s.dayName+"</th><td>",null!=a&&a.length>0){var i=0;for(let e=0;e<a.length;e++){const l=a[e];"N"==l.dayCheck?0==i&&(t+='<span style="color:#9f9c9c">Unavailable</span>',i+=1):t=t+"<span>"+l.startTime+" - "+l.endTime+"</span><br/>"}}t+="</td></tr>"}else t+='<tr><th colspan="2">No Availability</th></tr>';t+="</tbody>",t+="</table>",$("#weeklyHours").html(t)}function getWeekDaysAvailabilityHtml(e,t,a,i,l,s,o,n,d,r,c,m,u,p){console.log(o);var v="",f=t.timeAvailabilityList,h=t.weekDaysAvailabilityList;if(h.length>0){for(let t=0;t<h.length;t++){v="";const E=h[t];var y=E.timeSlotAvailability;v+='<li class="list-group-item px-0 p-md-2">',v+='<div class="widget-content p-0">',v+='<div class="widget-content-wrapper flex-wrap align-items-baseline">',v+='<div class="col-xl-2 col-lg-2 col-md-2 col-sm-12 col-12">',v+='<div class="widget-content-left">',v+='<div class="custom-checkbox custom-control">';var g="getDaysCheckUncheck('day"+E.dayId+"','"+i+"','"+l+"', '"+o+"', '"+n+"', '"+d+"', '"+c+"', '"+m+"', '"+u+"');";if(3!=o)v=(v=v+'<input type="checkbox" id="day'+E.dayId+'" value="'+E.dayId+'" data-name="'+E.dayName+'"  data-dayname="'+E.dayName+"-"+E.dayId+'" onChange="'+g+'"  class="custom-control-input week-slot-available">')+'<label class="custom-control-label bold text-uppercase" for="day'+E.dayId+'">'+E.dayName+"</label>";else{var b="";2==USER_ROLE_ID?b="":"Y"==E.dataType&&3==o&&(b="disabled"),v=(v=v+'<input type="checkbox" id="day'+E.dayId+'" value="'+E.dayId+'" data-name="'+E.dayName+'"  data-dayname="'+E.dayName+"-"+E.dayId+'" onChange="'+g+'" '+b+'  class="custom-control-input week-slot-available">')+'<label class="custom-control-label bold text-uppercase" for="day'+E.dayId+'">'+E.dayName+"</label>"}if(v+="</div>",v+="</div>",v=(v+="</div>")+'<div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 cal-hours-'+E.dayId+'">',v+="</div>",v=(v+='<div class="col-xl-2 col-lg-2 col-md-2 col-sm-12 col-12">')+'<div class="total-minutes-'+E.dayId+'">'+E.totalTimeHrsMins+"</div>",v+="</div>",v=(v+='<div class="col-xl-2 col-lg-2 col-md-2 col-sm-12 col-12 text-right mt-2 mt-sm-0 p-0">')+"<a href=\"javascript:void(0)\" class='btn btn-lg btn-outline-primary btn-sm mr-2 addWeekTimeBtn' onclick=\"addNewRowTime('"+E.dayName+"','"+E.dayId+"','"+i+"','"+l+"','"+o+"', '"+n+"', '"+d+"','"+c+"', '"+m+"', '"+u+'\',\'\' );" style=\'line-height:0\'><i class="icon ion-android-add" style="font-size:15px;line-height:13px"></i><span class="d-md-none">&nbsp; Add</span></a>',s>0);else{var T="";"Y"==E.dataType&&3==o&&(T="d-none"),"first"==r&&3==o&&(T="d-none"),v=v+'<button class="btn btn-lg btn-outline-success btn-sm dropdown-toggle '+T+'" id="copy-hours-'+E.dayId+'" data-bs-auto-close="outside" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-copy" style="font-size:18px;line-height:20px"></i><span class="d-md-none">&nbsp; Clone</span></button>'}v+='<div class="dropdown-menu" style="max-width: 200px;">',v+='<div class="full px-2">',v=(v+='<div class="full font-12 copy-times" style="color:#ccc">Copy times to..</div>')+'<ul class="m-0 p-0 " id="apply-all-days-'+t+'">';var w="Sun-"+E.dayId==E.dayName+"-"+E.dayId?"checked disabled":"",x="Mon-"+E.dayId==E.dayName+"-"+E.dayId?"checked disabled":"",k="Tue-"+E.dayId==E.dayName+"-"+E.dayId?"checked disabled":"",D="Wed-"+E.dayId==E.dayName+"-"+E.dayId?"checked disabled":"",C="Thu-"+E.dayId==E.dayName+"-"+E.dayId?"checked disabled":"",S="Fri-"+E.dayId==E.dayName+"-"+E.dayId?"checked disabled":"",A="Sat-"+E.dayId==E.dayName+"-"+E.dayId?"checked disabled":"";v=(v=(v+='<li class="custom-checkbox custom-control p-0">')+'<input type="checkbox" id="Sun-'+E.dayId+'" '+w+' value="1" data-value="day'+t+'-1" class="custom-control-input day-list apply-all-days-'+E.dayId+'"/>')+'<label for="Sun-'+E.dayId+'" class="py-2 full custom-control-label copy-time day-type-label font-weight-semi-bold" data-value="sun-'+E.dayId+'" >Sunday</label>',v+="</li>",v=(v=(v+='<li class="custom-checkbox custom-control p-0">')+'<input type="checkbox" id="Mon-'+E.dayId+'" '+x+'  value="2" data-value="day'+t+'-2" class="custom-control-input day-list apply-all-days-'+E.dayId+'"/>')+'<label for="Mon-'+E.dayId+'" class="py-2 full custom-control-label copy-time day-type-label font-weight-semi-bold" data-value="mon-'+E.dayId+'" >Monday</label>',v+="</li>",v=(v=(v+='<li class="custom-checkbox custom-control p-0">')+'<input type="checkbox" id="Tue-'+E.dayId+'" '+k+'  value="3" data-value="day'+t+'-3" class="custom-control-input day-list apply-all-days-'+E.dayId+'"/>')+'<label for="Tue-'+E.dayId+'" class="py-2 full custom-control-label copy-time day-type-label font-weight-semi-bold" data-value="tue-'+E.dayId+'" >Tuesday</label>',v+="</li>",v=(v=(v+='<li class="custom-checkbox custom-control p-0">')+'<input type="checkbox" id="Wed-'+E.dayId+'" '+D+' value="4" data-value="day'+t+'-4" class="custom-control-input day-list apply-all-days-'+E.dayId+'"/>')+'<label for="Wed-'+E.dayId+'" class="py-2 full custom-control-label copy-time day-type-label font-weight-semi-bold" data-value="wed-'+E.dayId+'" >Wednesday</label>',v+="</li>",v=(v=(v+='<li class="custom-checkbox custom-control p-0">')+'<input type="checkbox" id="Thu-'+E.dayId+'" '+C+' value="5" data-value="day'+t+'-5" class="custom-control-input day-list apply-all-days-'+E.dayId+'"/>')+'<label for="Thu-'+E.dayId+'" class="py-2 full custom-control-label copy-time day-type-label font-weight-semi-bold" data-value="thr-'+E.dayId+'" >Thursday</label>',v+="</li>",v=(v=(v+='<li class="custom-checkbox custom-control p-0">')+'<input type="checkbox" id="Fri-'+E.dayId+'" '+S+' value="6" data-value="day'+t+'-6" class="custom-control-input day-list apply-all-days-'+E.dayId+'"/>')+'<label for="Fri-'+E.dayId+'" class="py-2 full custom-control-label copy-time day-type-label font-weight-semi-bold" data-value="fri-'+E.dayId+'" >Friday</label>',v+="</li>",v=(v=(v+='<li class="custom-checkbox custom-control p-0">')+'<input type="checkbox" id="Sat-'+E.dayId+'" '+A+' value="7" data-value="day'+t+'-7" class="custom-control-input day-list apply-all-days-'+E.dayId+'"/>')+'<label for="Sat-'+E.dayId+'" class="py-2 full custom-control-label copy-time day-type-label font-weight-semi-bold" data-value="sat-'+E.dayId+'">Saturday</label>',v+="</li>",v+="</ul>",v=(v+="</div>")+'<div class="full px-3 mb-2 mt-2 text-center"><a href="javascript:void(0)" class="btn-pill full btn btn-primary px-3" onclick="'+("applyAllDays('apply-all-days-"+E.dayId+"','"+E.dayName+"-"+E.dayId+"','"+i+"','"+l+"','"+o+"','"+n+"','"+d+"','"+c+"', '"+m+"', '"+u+"')")+'" >Apply</a></div>',v+="</div></div>",v+="</div>",v+="</div>",v+="</li>",$("."+a).append(v);var I=bindTimeAvailableDropdown(y,f,E,i,l,o,n,d,r,c,m,u,p);if($(".cal-hours-"+E.dayId).html(I),null==y)if($("#day"+E.dayId).is(":checked"))validateTimes(E.dayName+"-"+E.dayId,"fromTime","toTime",o,n,d,c)&&(timeSlotAvailability=[],$("."+E.dayName+"-"+E.dayId).each((function(){var e={},t=$(this).find(".fromTime").val(),a=$(this).find(".toTime").val();null!=t&&null!=t&&""!=t&&null!=a&&null!=a&&""!=a&&(e.dayid=E.dayId,e.startTime=t,e.endTime=a,e.dayCheck="Y",timeSlotAvailability.push(e))})),3!=o&&saveTimeCalendarWeekWise(e,E.dayId,timeSlotAvailability,"add","new-time",i,l,o,n,d,c,m,u))}copyListViewTimeDropdownFun()}}function bindTimeAvailableDropdown(e,t,a,i,l,s,o,n,d,r,c,m,u){var p,v,f="";if("day-check"==d&&(e=null),null!=e&&e.length>0)for(let d=0;d<e.length;d++){var h=e[d];if(h.dayid==a.dayId){k=0,p=h.startTime,v=h.endTime,null!=p&&null!=p&&""!=p&&null!=v&&null!=v&&""!=v&&(diff=getTimeDifference(p,v),k+=diff.asMilliseconds());var y="";if("Y"==h.dataType&&3==s&&(y="disabled"),"N"==h.dayCheck)$("#day"+a.dayId).prop("checked",!1),$(".total-minutes-"+a.dayId).text("0h 0m"),f='<div class="row justify-content-sm-start justify-content-around  unavailable-'+a.dayName+"-"+a.dayId+" "+a.dayName+"-"+a.dayId+" "+a.dayName+"-time-"+d+'" id="'+a.dayName+"-time-"+d+'" data-status="Y" style="padding-left:50px; font-size:16px">',f+="Unavailable",f+="</div>";else{$("#day"+a.dayId).prop("checked",!0),f=f+'<div class="my-1 mx-0 row align-items-center justify-content-sm-start available-dropdown-Wrapper justify-content-around available-'+a.dayName+"-"+a.dayId+" "+a.dayName+"-"+a.dayId+" "+a.dayName+"-time-"+d+'" id="'+a.dayName+"-time-"+d+'"  style="gap: 5px;" >';var g="getFromTime(this,'"+i+"','"+l+"','"+s+"','"+o+"','"+n+"','"+r+"', '"+c+"', '"+m+"')";if(f=(f+='<div class="flex-grow-1 flex-sm-grow-0" style="min-width:60px">')+'<select class="form-control font-12 fromTime" '+y+' data-id="'+a.dayName+"-"+a.dayId+'" data-checkid="'+a.dayId+'"  id="'+a.dayName+"-start-time-dropdown-"+d+'" onchange="'+g+'" data-status="Y">',t.length>0){f+='<option value="">Start Time</option>';for(let e=0;e<t.length;e++){f=f+'<option value="'+(T=t[e])+'" '+(h.startTime==T?"selected":"")+">"+T+"</option>"}}f+="</select>",f+="</div>",f+="<div>-</div>";var b="getToTime(this,'"+i+"','"+l+"','"+s+"','"+o+"','"+n+"','"+r+"', '"+c+"', '"+m+"' )";if(f=(f+='<div class="flex-grow-1 flex-sm-grow-0" style="min-width:60px">')+'<select class="form-control font-12 toTime" '+y+' data-id="'+a.dayName+"-"+a.dayId+'" data-checkid="'+a.dayId+'" id="'+a.dayName+"-end-time-dropdown-"+d+'" onchange="'+b+'" data-status="Y">',t.length>0){f+='<option value="">End Time</option>';for(let e=0;e<t.length;e++){var T;f=f+'<option value="'+(T=t[e])+'" '+(h.endTime==T?"selected":"")+">"+T+"</option>"}}f+="</select>",f+="</div>",f+='<div class="min-hours">';var w="";"Y"==h.dataType&&3==USER_ROLE_ID&&(w="d-none"),f=(f=f+'<a href="javascript:void(0)" class="btn btn-lg btn-outline-danger remove-time-slot-btn btn-sm ml-2 mr-1 '+w+"  time-save-"+h.dataType+'" onclick="removeTimeDiv(\''+a.dayName+"-time-"+d+"','"+a.dayId+"','"+i+"','"+l+"','"+s+"','"+o+"','"+n+"','"+r+"','"+c+"' ,'"+m+"','"+h.timeid+'\')" style="line-height:5px;"><i class="ion-android-close d-inline-block" style="font-size:14px;line-height:10px;height:14px;"></i></a>')+"<span id='"+a.dayName+"-hour-"+d+"'>"+(k>0?getTimeWithFormat(k):"0h 0m")+"</span>",f+="</div>",f+="</div>"}}else f=f+'<div class="row justify-content-sm-start justify-content-around unavailable-'+a.dayName+"-"+a.dayId+" "+a.dayName+"-"+a.dayId+" "+a.dayName+"-time-"+d+'"  id="'+a.dayName+"-time-"+d+'" data-status="N" style="width:450px !important; padding-left:50px; font-size:16px">',f+="Unavailable",f+="</div>"}else{var x=!0;if(3==s&&(""!=d&&"first"!=d&&"next"!=d||(x=!1,f=f+'<div class="row justify-content-sm-start justify-content-around unavailable-'+a.dayName+"-"+a.dayId+" "+a.dayName+"-"+a.dayId+" "+a.dayName+'-time-0"  id="'+a.dayName+'-time-0" data-status="N" style="width:450px !important; padding-left:50px; font-size:16px">',f+="Unavailable",f+="</div>")),x){var k=0;diff=getTimeDifference(i,l),k+=diff.asMilliseconds();var D="getFromTime(this,'"+i+"','"+l+"','"+s+"','"+o+"','"+n+"','"+r+"', '"+c+"', '"+m+"')",C="getToTime(this,'"+i+"','"+l+"','"+s+"','"+o+"','"+n+"','"+r+"', '"+c+"', '"+m+"')";if($("#day"+a.dayId).prop("checked",!0),f=f+'<div class="my-1 mx-0 row align-items-center justify-content-sm-start available-dropdown-Wrapper justify-content-around available-'+a.dayName+"-"+a.dayId+" p-1 "+a.dayName+"-"+a.dayId+" "+a.dayName+'-time-0"  id="'+a.dayName+'-time-0" style="gap: 5px;">',f=(f+='<div class="flex-grow-1 flex-sm-grow-0" style="min-width:60px">')+'<select class="form-control font-12 fromTime startTimeDropDown'+a.dayId+'" data-id="'+a.dayName+"-"+a.dayId+'" data-checkid="'+a.dayId+'" onchange="'+D+'" data-status="N">',t.length>0)for(let e=0;e<t.length;e++){const a=t[e];f=f+'<option value="'+a+'" '+(i==a?"selected":"")+">"+a+"</option>"}if(f+="</select>",f+="</div>",f+="<div>-</div>",f=(f+='<div class="flex-grow-1 flex-sm-grow-0" style="min-width:60px">')+'<select class="form-control font-12 toTime endTimeDropDown'+a.dayId+'" data-id="'+a.dayName+"-"+a.dayId+'" data-checkid="'+a.dayId+'"  onchange="'+C+'" data-status="N">',u.length>0)for(let e=0;e<u.length;e++){const t=u[e];f=f+'<option value="'+t+'" '+(l==t?"selected":"")+">"+t+"</option>"}f+="</select>",f+="</div>",f=(f=(f+='<div class="min-hours">')+'<a href="javascript:void(0)" class="btn btn-lg btn-outline-danger remove-time-slot-btn btn-sm ml-2 mr-1 time-save-N" onclick="removeTimeDiv(\''+a.dayName+"-time-0','"+a.dayId+"','"+i+"','"+l+"','"+s+"','"+o+"','"+n+"','"+r+"','"+c+"' ,'"+m+'\',\'0\')" style="line-height:5px;"><i class="ion-android-close d-inline-block" style="font-size:14px;line-height:10px;height:14px;"></i></a>')+"<span id='"+a.dayName+"-hour-0'>&nbsp;"+(k>0?getTimeWithFormat(k):"0h 0m")+"</span>",f+="</div>",f+="</div>"}}return f}function getDaysCheckUncheck(e,t,a,i,l,s,o,n,d){var r="",c=($("#"+e).attr("data-dayname"),$("#"+e).attr("data-name")),m=$("#"+e).val(),u=$("#userId").val();if(3==i&&($(".timeAvailabilityConfirmationAction").hasClass("show")||$(".timeAvailabilityConfirmationAction").addClass("show")),3==USER_ROLE_ID&&$("#"+e).attr("disabled",!0),$("#"+e).is(":checked"))$(".cal-hours-"+m).html(""),3!=i?(getUserWeeklyAvailability("cal-hours-"+m,u,"",t,a,m,0,i,l,s,"",o,n,d),3!=i&&setTimeout((function(){saveAvailabilityOfActiveEvents("CALL-CALENDAR-WEEK","ALL",i)}),800)):getUserWeeklyAvailability("cal-hours-"+m,u,"",t,a,m,0,i,l,s,"day-check",o,n,d);else{r="";var p="",v="",f=[];if($("."+c+"-"+m).length>0)validateTimes(c+"-"+m,"fromTime","toTime",i,l,s,o,"N")&&($("."+c+"-"+m).each((function(){var e={};p=$(this).find(".fromTime").val(),v=$(this).find(".toTime").val(),null!=p&&null!=p&&""!=p&&null!=v&&null!=v&&""!=v&&(e.dayid=m,e.startTime=p,e.endTime=v,e.dayCheck="N",f.push(e))})),3!=i&&saveTimeCalendarWeekWise(u,m,f,"add","day-check-uncheck",t,a,i,l,s,o,n,d));$(".cal-hours-"+m).html(""),r=r+'<div class="row justify-content-sm-start justify-content-around unavailable-'+c+"-"+m+" "+c+"-"+m+'" data-starttime="'+p+'", data-endTime="'+v+'" style="width:450px !important; padding-left:50px; font-size:16px">',r+="Unavailable",r+="</div>",$(".cal-hours-"+m).html(r)}$(".week-time-available .fromTime").select2({theme:"bootstrap4"}),$(".week-time-available .toTime").select2({theme:"bootstrap4"})}function applyAllDays(e,t,a,i,l,s,o,n,d,r){var c=$("#userId").val(),m=[];$("."+t).length>0&&(validateTimes(t,"fromTime","toTime",l,s,o,n)&&($("."+t).each((function(){var t=$(this).find(".fromTime").val(),a=$(this).find(".toTime").val();null!=t&&null!=t&&""!=t&&null!=a&&null!=a&&""!=a&&$("."+e).each((function(){var e={},i=0;$(this).is(":checked")&&(i=$(this).val(),e.dayid=i,e.startTime=t,e.endTime=a,e.dayCheck="Y",m.push(e))}))})),3!=l&&saveTimeCalendarWeekWise(c,"0",m,"add","apply-allday-time",a,i,l,s,o,n,d,r)))}function removeTimePrefRence(e,t,a,i,l,s,o){if($(".request_delete_teacher_time").html(""),$(".request_teacher_time").html(""),3!=o){var n={userId:a,value:t,dateWise:i};$.ajax({type:"POST",url:getURLFor("timeavailability","remove-time-prefrence"),contentType:"application/json",data:JSON.stringify(n),dataType:"json",cache:!1,async:!1,timeout:6e5,success:function(e){return"0"==e.status||"2"==e.status?showMessageTheme2(0,e.message,"",!0):(showMessageTheme2(1,e.message,"",!0),getUserAvailability("user-time-available",a,"",l,s,o)),!1},error:function(e){return!1}})}else if(3==o){var d="time-wise";"Y"==i&&(d="date-wise");var r=$("."+e).attr("data-select-date");if(getTeacherMeetingStatus(d,0,a,t,e,r)){var c=e.split("_")[0]+"_"+e.split("_")[1]+"_"+e.split("_")[2],m=e.split("_")[3],u="";if($("#"+c+" span").not(".remove").each((function(){$(this).hasClass(e)?($(this).removeClass("d-inline-block"),$(this).addClass("d-none"),$("."+e).removeClass("d-inline-block"),$("."+e).addClass("d-none"),u=$("."+e).attr("data-select-date")):$(this).addClass("specific-time-add")})),0==$("#"+c+" span").not(".d-none").length){var p="";p=p+'<span class="d-inline-block  specific-time-add '+c+'"_"'+m+'  text-danger" style="min-width:135px" data-timeid="0" data-select-date="'+u+'" data-controltype="edit-unavailable" data-starttime="'+l+'" data-endtime="'+s+'">Unavailable</span>',$("#specific_td_"+e.split("_")[2]).html(p)}$(".timeAvailabilityConfirmationAction").hasClass("show")||$(".timeAvailabilityConfirmationAction").addClass("show")}}}function getMeetingEvents(e,t,a,i,l,s,o,n,d){var r={userId:USER_ID,lUserId:e};$.ajax({type:"POST",url:getURLFor("timeavailability","get-meeting-events"),contentType:"application/json",data:JSON.stringify(r),dataType:"json",cache:!1,async:!1,timeout:6e5,success:function(r){if(console.log(r),"0"==r.status||"2"==r.status)showMessageTheme2(0,r.message);else{var c=getEventList(r.eventList,e,t,a,i,l,s,o,n,d);$(".eventMeetinglist").html(c),$(".eventDropdownList").html("");getEventDropdownList(r.eventList,"eventDropdownList")}return!1},error:function(e){return!1}})}function getEventList(e,t,a,i,l,s,o,n,d,r){console.log(e),eventsBasedOnRole=e;var c="";if(c+='<div class="d-flex align-items-center w-100"><div class="d-inline-flex perfectScroll oveflow-auto position-relative align-items-center  '+(3==l?"w-100":"")+'">',3==l&&(c+='<div style="min-width:210px;max-width:210px"><h5 class="m-0 font-weight-bold py-2 w-100"><span class="font-weight-bold pull-left p-1 full" style="border-color:#dee2e6;border-style:none none double none; font-size:.88rem">Contract Hours: <label id="agreedHourTotalCount" class="font-weight-bold"></label></span><span class="font-weight-bold pull-left p-1 full font-11">Live Classes: <label id="liveClassesHours" class="font-weight-bold"></label> | Admin Tasks: <label id="adminTaskHours" class="font-weight-bold"></label></span></h5></div><div role="group" class="btn-group-lg btn-group btn-group-toggle totalAvailabilityLabel ml-2 mb-4" style="min-width:fit-content"><label class="text-primary text-white p-1 px-2 font-weight-semi-bold d-inline-block mr-2 mb-0 border-bottom">Availability&nbsp;<span class="totalAvailabilityGiven">--</span></label><label class="text-success text-white p-1 px-2 font-weight-semi-bold d-inline-block mr-2 mb-0 border-bottom">Remaining&nbsp;<span class="totalUnoccupied">--</span></label><label class="text-danger text-white p-1 px-2 font-weight-semi-bold  d-inline-block mr-2 mb-0 border-bottom">Booked&nbsp;<span class="totalOccupied">--</span>&nbsp;:</label></div><div role="group" class="btn-group-lg btn-group-toggle btn-group calendar-tabs d-none totalAvailabilityEvent ml-2" data-toggle="buttons" style="min-width:fit-content"><label class="btn btn-outline-primary mr-2 px-1 rounded active p-1"><input type="radio" name="availabilitySlot" class="availabilitySlot" value="availability" checked  autocomplete="off" onclick="">Availability&nbsp;<span class="totalAvailabilityGiven">--</span></label><label class="btn btn-outline-success mr-2 px-1 rounded p-1"><input type="radio" name="availabilitySlot"  class="availabilitySlot" value="available"  autocomplete="off" onclick="">Remaining&nbsp;<span class="totalUnoccupied">--</span></label><label class="btn btn-outline-danger mr-2 px-1 rounded p-1"><input type="radio" name="availabilitySlot" class="availabilitySlot" value="booked"  autocomplete="off" onclick="">Booked&nbsp;<span class="totalOccupied">--</span></label></div>'),e.length>0){var m=["#e7edf4","#e3e0f9","#e8f6f6"];for(let v=0;v<e.length;v++){const f=e[v];f.slotId;if(3==l)var u="bg-"+f.bgColor;else u="card-shadow-primary border-"+f.bgColor;var p="Y";"Y"==f.activated&&"Y"==f.slotActiveByUser&&(p="N"),c+='<div class="mx-1 widget-chart widget-chart2 text-left mb-2 '+(3==l?"p-1":"px-2 pt-1 pb-2 card-top-border")+"  dynamic-"+u+" rounded w-100  "+("N"==f.activated&&"N"==f.slotActiveByUser?"envetn_overlay":"")+'" style="'+(3==l?"min-width:135px;border-radius:0px !important; max-width:135px; border:2px solid "+m[v]:"min-width:300px")+' "><div class="full position-absolute text-left bg-white pl-2 text-center" style="left:0pxright:0px;top:0;z-index:1"><b class="start-copy-msg-'+v+'"></b></div><div class="widget-chat-wrapper-outer wrapper-overlay-'+v+'">',f.userRole,c+='<div class="widget-chart-content">',"TEACHER"!=f.userRole&&(c+='<div class="d-flex align-items-center font-12 font-weight-semi-bold mb-3 position-relative"><span class="d-inline-flex align-items-center"><label class="small-switch m-0"><input type="checkbox" '+("Y"==f.activated&&"Y"==f.slotActiveByUser?"checked":"")+" onclick=\"inactiveMeetingSlotType('"+t+"','"+f.slotId+"','"+p+"', 'wrapper-overlay-"+v+"', '"+a+"' , '"+i+"', '"+l+"' , '"+s+"', '"+o+"', '"+n+"' , '"+d+"' , '"+r+'\' );"><span class="small-switch-slider round"></span></label>&nbsp;On/Off</span><span class="ml-auto check-disable-overlay '+("N"==f.slotActiveByUser?"envetn_overlay":"")+'">',c+='<a href="javascript:void(0)" style="color:#ccc" onclick="copyURL(\'copyLink-'+v+"','start-copy-msg-"+v+'\')" data-toggle="tooltip" data-placement="top" title="Copy Link"><i class="fa fa-copy"></i></a>',c+='</span><div style="top:18px;left:0;position:absolute;"><input type="text" id="copyLink-'+v+'" value="'+f.meetingBookUrl+'" style="opacity:0;height:0px"></div></div>'),c+='<div class="full"><h6 class="font-weight-bold text-center '+(3==l?"mb-0 text-white":"text-dark mb-1")+'" style="'+(3==l?"font-size:14px; line-height:12px":"font-size:1.1rem !important")+'">'+f.slotName+"</h6>",3==l&&(c+='<h6 class="font-weight-bold text-white mb-0 mt-1 text-center '+f.slotShortName+'" style="font-size:11px"></h6>'),"TEACHER"!=f.userRole&&(c+='<div class="m-0 d-flex check-disable-overlay text-gray" style="color:#ccc"><div><div class="w-100">Duration</div><div class="w-100">Buffer</div></div><div class="ml-auto"><div class="w-100">'+f.timeDuration+' min</div><div class="w-100">'+f.bufferTime+" min</div></div></div>"),c+="</div></div></div></div>"}}return 3==l&&(c+='<div style="min-width:210px" class="ml-auto"><h5 class="m-0 font-weight-bold py-2 w-100"><span class="font-weight-bold pull-left p-1 pr-1 d-inline-block" style="border-color:#dee2e6;border-style:none none double none;font-size:.88rem">Accepted working hrs till now: <label class="font-weight-bold ZOOM_HOURS"></label></span></h5></div>'),c+="</div>",c+="</div>"}function getEventDropdownList(e,t){var a="";if(a+='<a href="javascript:void(0)" class="dropdown-toggle text-decoration-none font-size-lg font-weight-semi-bold" data-bs-auto-close="outside" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">',a+='<span class="eventTotal">0</span> event type<i class="fa fa-angle-down ml-2"></i>',a+="</a>",a+='<div tabindex="-1" role="menu" aria-hidden="true" class="dropdown-menu-md dropdown-menu">',a+='<ul class="nav flex-column" id="activeOnEventList">',a+='<li class="nav-item-header nav-item font-weight-normal">Active on</li>',e.length>0)for(let t=0;t<e.length;t++){const i=e[t];a+='<li class="nav-item-header py-0 nav-item custom-checkbox custom-control">',a+='<input type="checkbox" id="'+i.slotId+'" name="'+i.slotId+'" value="'+i.slotName+'" class="custom-control-input event-type-list" >',a+='<label for="'+i.slotId+'" class="py-2 full custom-control-label copy-time event_type_label slotType'+i.slotId+' text-dark font-weight-semi-bold" data-value="'+i.slotName+'">'+i.slotName+"</label>",a+="</li>"}if(a+="</ul>",a+='<div class="full text-center mt-3">',a+='<a href="javascript:void(0)" class="btn btn-outline-primary mr-2">Cancel</a>',a+='<a href="javascript:void(0)" class="btn btn-primary" onclick="saveAvailabilityOfActiveEvents(\'EVENTS-SAVE\',\'ALL\')">Save</a>',a+="</div>",a+="</div>",$("."+t).html(a),e.length>0){var i=0;for(let t=0;t<e.length;t++){const a=e[t];a.activeAll==a.slotId&&($(".slotType"+a.slotId).trigger("click"),$("#"+a.slotId).prop("checked",!0),i+=1)}$(".eventTotal").text(i)}}function saveAvailabilityOfActiveEvents(e,t,a){customLoader(!1);var i=[];if(3==a){var l=$("#slotTypeIds").val();i.push(l)}$.ajax({type:"POST",contentType:"application/json",url:getURLFor("timeavailability","save-availablity-activeon-events"),data:JSON.stringify(getRequestForSaveAvailabilityOfActiveEvents(t,i,a,e)),dataType:"json",cache:!1,timeout:6e5,success:function(t){return"EVENTS-SAVE"==e&&("0"==t.status||"2"==t.status?showMessageTheme2(0,t.message,"",!0):3!=a&&showMessageTheme2(1,t.message,"",!0)),!1},error:function(e){return!1}})}function getRequestForSaveAvailabilityOfActiveEvents(e,t,a,i){var l={},s=[];l.callfrom=i,l.userId=$("#userId").val(),l.scheduleType=e,l.schoolId=SCHOOL_ID,l.slotAddUserId=USER_ID,l.userRole="ADMIN";return 3==a?t.length>0&&(s=t):$("#activeOnEventList li").each((function(){$(this).find(".event-type-list").prop("checked")&&s.push($(this).find(".event-type-list").attr("id"))})),l.eventList=s,console.log(l),l}function dataForBookAnEventSlot(){$("#timeAvailabilityUIContent").html(skeleton());var e={};e.userId=$("#userId").val(),e.forAllCounselor=$("#forAllCounselor").val(),e.eventId=$("#eventId").val(),e.sendToEmail=$("#sendToEmail").val(),e.sendUserName=$("#sendUserName").val(),e.sendToPhone=$("#sendToPhone").val(),e.schoolId=SCHOOL_ID,e.meetingId=$("#meetingId").val(),customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("timeavailability","get-data-for-book-slot"),data:JSON.stringify(e),dataType:"json",async:!0,success:function(e){customLoader(!1),"0"==e.status||"2"==e.status||(e.forAllCounselor=$("#forAllCounselor").val(),e.counselorAutoSelect=$("#counselorAutoSelect").val(),e.demoRoleId=$("#demoRoleId").val(),getLocationAndSelectCountry("bookSlotForEventForm",e),customLoader(!1))},error:function(e){customLoader(!1)}})}function callFreeSlotsToBookEvent(e,t){var a=$("#eventId").val(),i="";"false"==$("#forAllCounselor").val()&&(i=$("#userId").val());var l=$("#countryTimezoneId option:selected").val();if(null==$("#countryTimezoneId option:selected").val().trim()||"0"==$("#countryTimezoneId option:selected").val().trim())return showMessageTheme2(0,"Please select a timezone","",!0),!1;l=$("#countryTimezoneId option:selected").val();var s={};s.timezone=l,s.visitDate=e,s.dayId=t,s.eventId=a,s.userId=i,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("timeavailability","get-free-slots-to-book-event"),data:JSON.stringify(s),dataType:"json",global:!1,async:!0,success:function(a){if(console.log(a),"0"==a.status||"2"==a.status||"3"==a.status)"3"==a.status?redirectLoginPage():showMessageTheme2(0,a.message,"",!0);else{$(".slot-wrapper").show(),$(".counselor-slot-ui-column.slot-wrapper").css({width:"200px"});$(window).width();var i=!0,l="";$(".slot-rapper-scroll, .day-and-date, #meetingTimeAndDate").html(""),a.slotList.length>=1?($("#slotCounselorIds").val(a.slotCounselorIds),$.each(a.slotList,(function(e,t){t.length>0&&(i=!1,$.each(t,(function(t,i){l+='<li class="mb-3 d-flex justify-content-center"><input type="radio" name="time-slot-list" id="slot_'+t+e+'" class="time-slot-radio" style="opacity: 0;height: 0px;width: 0px;font-size:0px;position: absolute;"><label for="slot_'+t+e+'" class="mb-0 font-weight-semi-bold time-slot-custom rounded text-center">'+i.startTime+'</label><button class="custom-btn rounded mb-0" onclick="scheduleEvent(\''+i.adminUserId+"','"+i.meetingType+"','"+a.visitDateStr+"','"+i.stTime+"','"+i.eventEdTime+"','"+i.startTime+"','"+i.eventEndTime+"','"+a.timezone+"','"+i.timeZoneId+"','"+a.visitDate+"')\">Next</button></li>"})))})),i&&(l='<li class="text-primary"><div class="full text-center"><i class="fa fa-frown fa-2x"></i></div><div class="full text-center font-weight-bold font-size-lg"> No slot available</div><li>',$(".slot-rapper-scroll").html(l)),$(".slot-rapper-scroll").html(l),$(".day-and-date").html(a.visitDate),$("#meetingSelectDate").val(e),$("#meetingSelectDateWeekId").val(t)):(l='<li class="text-primary"><div class="full text-center"><i class="fa fa-frown fa-2x"></i></div><div class="full text-center font-weight-bold font-size-lg"> No slot available</div><li>',$(".slot-rapper-scroll").html(l)),$(".time-slot-radio").change((function(){$(".custom-btn").hide(),$(this).siblings(".custom-btn").show()})),customLoader(!1)}},error:function(e){checkonlineOfflineStatus()||(showMessage(!0,e.responseText),customLoader(!1))}})}function getCalendarForMeeting(e,t,a,i){var l=$("#userId").val(),s=$("#eventId").val(),o={userId:l,eventId:s,startDate:t,slotType:a,timeZone:i};$.ajax({type:"POST",url:getURLFor("timeavailability","get-calendar-meeting-book"),contentType:"application/json",data:JSON.stringify(o),dataType:"json",cache:!1,async:!0,timeout:6e5,success:function(a){if("0"==a.status||"2"==a.status)showMessage(!0,a.message);else{$("."+e).html(""),$(".calender-nav").removeClass("d-none").addClass("d-flex");var i=getMeetingCalendarTable(l,a,t);if("N"==a.slotStatus&&"N"==a.slotNotAvailable){var s=$(".name").text()+" is not taking School Demos at this time. For assistance, please contact us at chat.support@internationalschooling.org";$("#eventOffMessage").html(s)}else if("Y"==a.slotStatus&&"N"==a.slotNotAvailable){s="No slots are available at the moment. For assistance, please contact us at chat.support@internationalschooling.org";$("#eventOffMessage").html(s)}else $("#eventOffMessage").html("");$("."+e).html(i);var o=a.monthName+" - "+a.year;$("#meetingcalMonthYear").html(o),$("#meetingTodayDate").val(a.startDate),$("#meetingFirstDate").val(a.firstDate),$("#meetingFirstDatePreMonth").val(a.firstDatePreMonth),$("#meetingFirstDateNextMonth").val(a.firstDateNextMonth),a.arrowEnabled>0?$("#meetingPreCalMonth").show():$("#meetingPreCalMonth").hide(),customLoader(!1)}return!1},error:function(e){return!1}})}function getMeetingCalendarTable(e,t,a){t.preStartTime,t.preEndTime;var i=t.dayOfWeekVal,l=(a=i,t.timeAvailableList,t.calendarDateList),s=(t.bookingDateList,"");if(s+='<table class="table mb-0 text-center" style="table-layout:fixed;">',s+="<thead><tr>",s+='<td class="bold">Sun</td>',s+='<td class="bold">Mon</td>',s+='<td class="bold">Tue</td>',s+='<td class="bold">Wed</td>',s+='<td class="bold">Thu</td>',s+='<td class="bold">Fri</td>',s+='<td class="bold">Sat</td>',s+="</tr>",s+="</thead>",s+="<tbody>",s+="<tr>",7!=i){a=i;for(let e=1;e<=i-1;e++)s+="<td></td>"}if(7==i)for(let e=1;e<=i-1;e++)s+="<td></td>";for(let e=0;e<l.length;e++){var o=l[e],n="";if(o.isActive>0?n=1==o.isActive?"selected-date":"active-date":1==a||7==a?n="active-date":0==o.isClick?n="expired-date":1==o.isClick&&(n="active-date"),a<=7){if(1==o.isClick){var d="getAvailableSlotByEventDate('"+o.slotDate+"', 'timeSelectDate"+o.day1+"','"+a+"')";s=(s=s+'<td class="'+n+'">')+'<a href="javascript:void(0);" id="timeSelectDate'+o.day1+'" onclick="'+d+'"  class="d-inline-block'+n+'">'+o.day1+"</a>",s+="</td>"}0==o.isClick&&(s=s+'<td class="'+n+'"><span class="disabled-date"><label class="m-0 d-inline-block">'+o.day1+"</label></span></td>"),a+=1}a>7&&(a=1,s+="</tr>")}return s+="</tr>",s+="</tbody>  ",s+="</table>",s+='<div class="d-flex mt-3 pl-4 ml-1 justify-content-center">',s+='<div class="d-inline-flex align-items-center "><span class="disabled-date legend d-inline-block" style="background-color: #e7e7e7;font-weight: bold;color: #676d71;border-radius: 6px;width:20px;height:20px;position: relative;"></span><label class="m-0 d-inline-block ml-1">Not Available</label></div>',s+='<div class="d-inline-flex align-items-center ml-3"><span class="d-inline-block active-date text-center" style="background-color: #d7e5f5;font-weight: bold;color: #007bff;border-radius: 6px;width:20px;height:20px;position: relative;"></span><label class="m-0 d-inline-block ml-1">Available</label></div>',s+="</div>"}function getAvailableSlotByEventDate(e,t,a){$("#"+t).parent("td").hasClass("selected-date")?($("#"+t).parent("td").removeClass("selected-date"),$("#"+t).parent("td").addClass("active-date")):($(".selected-date").addClass("active-date"),$(".selected-date").removeClass("selected-date"),$("#"+t).parent("td").removeClass("active-date"),$("#"+t).parent("td").addClass("selected-date"),$("#"+t).removeClass("active-date"),$("#"+t).addClass("selected-date")),customLoader(!0),getTimeZonesList("bookSlotForEventForm","countryTimezoneId","meetingZoneId",e+" 00:00:00"),callFreeSlotsToBookEvent(e,a)}function getRefreshWeek(e,t,a,i,l,s,o,n,d,r,c,m){"from-teacher"==e&&(a=$("#inActDate").val(),i=$("#timeAvailabilityPopup #weekDayNum").val());var u={userId:t,selectDate:a,dayId:i,updatedBy:USER_ID};$.ajax({type:"POST",url:getURLFor("timeavailability","refresh-time-prefrence"),contentType:"application/json",data:JSON.stringify(u),dataType:"json",cache:!1,async:!1,timeout:6e5,success:function(a){return"0"==a.status||"2"==a.status?showMessageTheme2(0,a.message,"",!0):(showMessageTheme2(1,a.message,"",!0),"from-teacher"==e?($("#weekRefreshStatus").val("N"),$("#timeAvailabilityPopup").modal("hide"),getUserAvailability("user-time-available",t,"",l,s,o)):getCalendarAvailability("timeAvailabilityPopup",t,"timeCalendar","","Month",l,s,o,n,d,r,c,m)),!1},error:function(e){return!1}})}function inactiveMeetingSlotType(e,t,a,i,l,s,o,n,d,r,c,m){var u={userId:e,slotTypeId:t,activeSlot:a,updatedBy:USER_ID};$.ajax({type:"POST",url:getURLFor("timeavailability","inactive-meeting-slottype"),contentType:"application/json",data:JSON.stringify(u),dataType:"json",async:!1,success:function(t){return"0"==t.status||"2"==t.status?showMessageTheme2(0,t.message,"",!0):"TEACHER"!=USER_ROLE&&(showMessageTheme2(1,t.message,"",!0),getMeetingEvents(e,l,s,o,n,d,r,c,m),$(".dropdown-menu label.event_type_label").on("click",(function(e){eventOptions=[],$(".event-type-list").each((function(){$(this).is(":checked")&&eventOptions.push($(this).val())}));var t,a=$(e.currentTarget),i=a.attr("data-value"),l=i.split("-"),s=(l=parseInt(l[1]),a.parent().find("input"));return(t=eventOptions.indexOf(i))>-1?(eventOptions.splice(t,1),setTimeout((function(){s.prop("checked",!1)}),0)):(eventOptions.push(i),setTimeout((function(){s.prop("checked",!0)}),0)),$(e.target).blur(),console.log(eventOptions),$(".eventTotal").text(eventOptions.length),!1})),"Y"==a?$("."+i).find(".check-disable-overlay").removeClass("envetn_overlay"):$("."+i).find(".check-disable-overlay").addClass("envetn_overlay")),!1}})}function scheduleMeetingForEvent(e){var t=$("#eventId").val(),a="";if("true"==$("#forAllCounselor").val()&&"true"!=$("#counselorAutoSelect").val()){if(null==(a=$("#counselorName").val())||null==a||""==a||0==a&&"0"==a)return showMessageTheme2(0,"Counselor field is mandatory","",!0),!1;if(null!=$("#counselorLeadSource").val()&&""==$("#counselorLeadSource").val())return showMessageTheme2(0,"Lead source field is mandatory","",!0),!1}else a=$("#userId").val();var i=$("#name").val();if(null==i||null==i||""==i)return showMessageTheme2(0,"Name field is mandatory","",!0),!1;var l=$("#email").val();if(null==l||null==l||!validateEmail(l))return showMessageTheme2(0,"Email is either empty or invalid","",!0),!1;if(null!=$("#"+e+" #gradeId").val()){if(null==$("#"+e+" #gradeId").val()||null==$("#"+e+" #gradeId").val()||""==$("#"+e+" #gradeId").val())return showMessageTheme2(0,"Grade field is mandatory","",!0),!1;if(null==$("#"+e+" #countryId").val()||null==$("#"+e+" #countryId").val()||""==$("#"+e+" #countryId").val())return showMessageTheme2(0,"Country field is mandatory","",!0),!1;if(null==$("#"+e+" #phoneNo").val()||null==$("#"+e+" #phoneNo").val()||""==$("#"+e+" #phoneNo").val())return showMessageTheme2(0,"Phone No. field is mandatory","",!0),!1}customLoader(!0),$("#meetingScheduleform").hide(),$("#thankyouPageSkeleton").show(),$.ajax({type:"POST",contentType:"application/json",url:getURLFor("timeavailability","meetingslots-new-submit-for-event"),data:JSON.stringify(getRequestForSubmitMeetingForEvent(e)),dataType:"json",success:function(e){if(console.log(e),"0"==e.status||"2"==e.status)customLoader(!1),showMessageTheme2(0,e.message,"",!0),setTimeout((function(){window.location.reload()}),1500);else{customLoader(!1),$("#thankyouPageSkeleton").html($("#thankyouContent").html());var i=$("#meetingTimeDuration").text(),l=$(".cName").text(),s=$("#meetingTimeAndDate").text(),o=$("#countryTimezoneId option:selected").text(),n=$("#gradeId option:selected").text(),d=$("#meetingFor").val(),r="/timeavailability/send-thank-you-page?moduleId="+moduleId+"&schoolId="+SCHOOL_ID+"&userId="+a+"&eventId="+t+"&minDuration="+i+"&userName="+l+"&selectTime="+s+"&selectTimeZone="+o+"&grade="+n+"&forAllCounselor="+$("#forAllCounselor").val()+"&counselorAutoSelect="+$("#counselorAutoSelect").val()+"&counselorName="+$("#counselorName :selected").text()+"&meetingFor="+d;console.log(r),getAsPostWithoutUUID(r,"_self"),customLoader(!1)}return customLoader(!1),!1}})}function getRequestForSubmitMeetingForEvent(e){var t={};t.timezone=$("#"+e+" #meetingTimzoneId").val(),t.timeZoneCheck=$("#"+e+" #userTimeZone").val(),t.meetingPersoneId=0;var a="",i="";if("true"==$("#forAllCounselor").val())if("true"==$("#counselorAutoSelect").val()){var l=$("#autoSelectCounselorIds").val().split(",");a=l[Math.floor(Math.random()*l.length)]}else a=$("#counselorName").val(),null!=$("#counselorLeadSource").val()&&(i=$("#counselorLeadSource").val());else a=$("#"+e+" #schoolPersonId").val();return t.leadSource=i,t.schoolPersonId=a,t.userId=a,t.meetingId=$("#meetingId").val(),t.meetingType=$("#"+e+" #meetingSlotType").val(),""!=$("#loginId").val()&&null!=$("#loginId").val()?t.lastUserId=$("#loginId").val():t.lastUserId=null!=USER_ID?USER_ID:a,t.meetingDate=$("#"+e+" #meetingSelectDate").val(),t.subject=$("#"+e+" #meetingSlotType").val(),t.startTime=$("#"+e+" #meetingStartTime").val(),t.endTime=$("#"+e+" #meetingEndTime").val(),t.email=$("#"+e+" #email").val().trim(),t.name=$("#"+e+" #name").val().trim(),t.slotTypeId=$("#"+e+" #slotTypeId").val(),null!=$("#location").val()&&(t.userlocation=$("#location").val()),t.schoolId=SCHOOL_ID,t.dataFrom="COPY-URL",null!=$("#"+e+" #gradeId").val()&&(t.standardId=$("#"+e+" #gradeId").val()),t.countryId=$("#"+e+" #countryId").val(),t.isdCode=$("#"+e+" #isdCode").val(),t.countryCode=$("#"+e+" #pCountryCode").val(),t.phoneNo=$("#"+e+" #phoneNo").val(),console.log(t),t}function callCreateNewMeeitingSlot(){$("#createNewEventModal").modal("show")}function getDataForTimeAvailability(){window.location.reload()}function initializePerfectScrollbar(e){e[0].scrollHeight>e.innerHeight()&&(new PerfectScrollbar(e[0],{wheelSpeed:2,wheelPropagation:!1,minScrollbarLength:20}),e.css("overflow","auto"))}function convertTime(e,t,a,i,l,s){var o=moment.utc(moment.tz(e,t,a).utc()).tz(i),n={};return n.date=o.format(l),n.time=o.format(s),n.hours=o.format("hh"),n.mins=o.format("mm"),n.sec=o.format("ss"),n.ampm=o.format("a"),n.offset=o.format("Z"),n.timezone=o.tz(),n}function dropdownparseTime(e){var[t,a]=e.split(" "),[i,l]=t.split(":").map(Number);return"PM"===a&&12!==i&&(i+=12),"AM"===a&&12===i&&(i=0),60*i+l}var bindStartTimeDorpDownFlag=!0;function checkStartTimeVlidation(e,t,a,i,l){var s=a,o=i;s=parseInt(s,10),o=parseInt(o,10);var n,d=$(e).val(),r=!1;""==d||null==d||null==d?(d="12:00 AM",n="12:00 AM"):n=d;$(e);var c=$(e).parent().parent().find(".toTime");if(null!=d&&null!=d)if($(e).find("option").length==$(e).find("option:selected").index()+1)c.empty(),c.append('<option value="">End Time</option>'),c.append('<option value="11:59 PM">11:59 PM</option>'),c.val("").trigger("change");else{if(c.empty(),c.append('<option value="">End Time</option>'),c.val("").trigger("change"),t)$(e).parent().parent().find(".toTime").val();if("TEACHER"==USER_ROLE){dropdownparseTime(n),dropdownparseTime("11:59 PM");var m=dropdownparseTime(d)+60*s;(u=dropdownparseTime(d)+60*o)>1440&&(r=!0,u=1440)}else{m=dropdownparseTime(d)+15;var u=dropdownparseTime(d)}if("TEACHER"==USER_ROLE)for(var p=m;p<=(r?u-15:u);p+=15){var v=p%60,f=(y=Math.floor(p/60))>=12?"PM":"AM";y>12&&(y-=12),0===y&&(y=12);var h=`${y=prefixZero(y)}:${v.toString().padStart(2,"0")} ${f}`;c.append(`<option value="${h}">${h}</option>`)}else{for(p=m;p<1440;p+=15){var y;v=p%60,f=(y=Math.floor(p/60))>=12?"PM":"AM";y>12&&(y-=12),0===y&&(y=12);h=`${y=prefixZero(y)}:${v.toString().padStart(2,"0")} ${f}`;c.append(`<option value="${h}">${h}</option>`)}1440==p&&c.append('<option value="11:59 PM">11:59 PM</option>')}r&&c.append('<option value="11:59 PM">11:59 PM</option>')}}function prefixZero(e){return e<10?"0"+e:e}function checkendTimeVlidation(e){var t=$(e).val(),a=$(e).parent().parent().find(".fromTime").val();a&&t&&(dropdownparseTime(a)>=dropdownparseTime(t)&&(showMessageTheme2(0,"Please choose an end time greater than start time."),$(this).val("").trigger("change")))}function getEditEvents(e,t,a,i,l,s,o,n,d,r,c){customLoader(!0);var m={};m.eventId=e,m.controlType=t,m.schoolId=SCHOOL_ID,m.userId=a,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("timeavailability","get-data-for-add-edit-event"),data:JSON.stringify(m),dataType:"json",async:!0,globle:!1,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status?redirectLoginPage():(showMessageTheme2(2,e.message,"",!0),$("#createNewEventModal").length<1||$("#createNewEventModal").remove(),$("body").append(renderAddEditEventModal(e,""+a,""+i,""+l,""+s,""+o,""+n,""+d,""+r,""+c)),$("#createNewEventModal").modal("show")):($("#createNewEventModal").length<1||$("#createNewEventModal").remove(),$("body").append(renderAddEditEventModal(e,""+a,""+i,""+l,""+s,""+o,""+n,""+d,""+r,""+c)),$(".custom_duration").hide(),$("#createNewEventModal").modal("show"),getUserWeeklyAvailability("custom-week-time-available",""+a,"",""+i,""+l,"0",""+e.eventId,s,o,n,"",d,r,c),$("#toggleWeekAndhours").click((function(){$("#toggleWeekAndhours i").toggleClass("fa-angle-right fa-angle-down"),$("#WeekdaysWrapper").slideToggle(),$("#availableHoursWrapper").slideToggle()})),$("#showAddBySpecificDate").click((function(){$("#createNewEventModal #inActDate").val(""),$("#createNewEventModal #weekCount").val(""),$("#createNewEventModal #weekDayName").val(""),$("#addBySpecificDate").show(),$("#weeklyHoursList").hide(),$("#createNewEventModal .timesection").hide();var t=$("#userRoleid").val(),s=$("#slotMin").val(),o=$("#slotMax").val(),n=$("#slotBufferTime").val(),d=$("#slotDateLimit").val(),r=$("#slotMax").val();getCalendarDateAvailability("createNewEventModal",""+a,"timeCalendarSepcificDate","","","Month",!0,""+i,""+l,"add-specify-date",""+e.eventId,"daySpecifictime",t,s,o,n,d,r),$("#preSpecificCalMonth").unbind("click").bind("click",(function(){getCalendarDateAvailability("createNewEventModal","${euid}","timeCalendarSepcificDate",""+$("#createNewEventModal #firstDatePreMonth").val(),""+$("#createNewEventModal #inActDate").val(),"Month",!0,"${fromTime}","${toTime}","prev-specify-date","0","daySpecifictime",t,s,o,n,d,r)})),$("#nextSpecificCalMonth").unbind("click").bind("click",(function(){getCalendarDateAvailability("createNewEventModal","${euid}","timeCalendarSepcificDate",""+$("#createNewEventModal #firstDateNextMonth").val(),""+$("#createNewEventModal #inActDate").val(),"Month",!0,"${fromTime}","${toTime}","next-specify-date","0","daySpecifictime",t,s,o,n,d,r)}))})),$(".meeting-color-wrapper .dropdown-menu span.d-flex.align-items-center").on("click",(function(e){return!1})),$(".back-step").click((function(){$('input[name="dateSpecificHour"]').prop("checked",!1),"weeklyHoursList"==$(this).parent().attr("id")?($("#weeklyHoursList").hide(),$(".tab-wrapper").show()):"addBySpecificDate"==$(this).parent().attr("id")&&($("#weeklyHoursList").show(),$("#addBySpecificDate").hide())})),customLoader(!1))},error:function(e){customLoader(!1)}})}function getDataForSaveDataAddEditEvents(e,t){var a={};return a.userId=USER_ID,a.schoolId=SCHOOL_ID,a.controlType=t,a.eventId=5,a}function saveDataAddEditEvents(e,t){customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("timeavailability","save-data-of-add-edit-event"),data:JSON.stringify(getDataForSaveDataAddEditEvents(e,t)),dataType:"json",async:!0,globle:!1,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status?redirectLoginPage():showMessageTheme2(0,e.message,"",!0):customLoader(!1)},error:function(e){customLoader(!1)}})}function viewBookSlotDetails(){$("#bookSlotDetailsModal").modal("show")}function renderAddEditEventModal(e,t,a,i,l,s,o,n,d,r){return'<div class="modal fade" id="createNewEventModal" tabindex="-1" role="dialog" aria-modal="true" ><div class="modal-dialog" role="document" style="max-width: 500px;"><div class="modal-content"><div class="modal-header py-2"><h5 class="modal-title text-dark font-weight-semi-bold">Event Type</h5><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"><i class="fa fa-times"></i></span></button></div><div class="modal-body"><form class="full"><div class="row"><div class="col-12 mb-2"><label class="m-0 font-size-lg font-weight-semi-bold">Event</label><div class="input-group mb-3"><div class="input-group-prepend"><button class="btn btn-outline-secondary dropdown-toggle d-flex align-items-center" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><a class="bg-success d-inline-block mx-1 prev-event-color" data-event-color="bg-success" href="#" style="width:20px;height: 20px;border-radius: 50%;"></a><i class="fa fa-angle-down mr-1"></i></button><div class="dropdown-menu"><div class="font-weight-semi-bold dark px-2">Event Color</div><div role="separator" class="dropdown-divider"></div><div class="full px-2"><a class="bg-success d-inline-block mx-1" data-event-color="bg-success" href="javascript:void(0)" onclick="chooseEventColor(this)" style="width:20px;height: 20px;border-radius: 50%;"></a><a class="bg-danger d-inline-block mx-1" data-event-color="bg-danger" href="javascript:void(0)" onclick="chooseEventColor(this)" style="width:20px;height: 20px;border-radius: 50%;"></a><a class="bg-primary d-inline-block mx-1" data-event-color="bg-primary" href="javascript:void(0)" onclick="chooseEventColor(this)" style="width:20px;height: 20px;border-radius: 50%;"></a><a class="bg-warning d-inline-block mx-1" data-event-color="bg-warning" href="javascript:void(0)" onclick="chooseEventColor(this)" style="width:20px;height: 20px;border-radius: 50%;"></a><a class="bg-orange d-inline-block mx-1" data-event-color="bg-orange" href="javascript:void(0)" onclick="chooseEventColor(this)" style="width:20px;height: 20px;border-radius: 50%;"></a></div></div></div><input type="text" id="slotName" class="form-control" aria-label="Text input with dropdown button" placeholder="Name your event" '+("N"==e.userStatus?"disabled":"")+'  value="'+e.slotName+'"></div></div><div class="col-12 mb-2"><div class="row"><div class="col-xl-5 col-lg-5 col-md-7 col-sm-10 col-12"><label class="m-0 font-size-lg font-weight-semi-bold">Duration</label><select name="duration" id="duration" class="form-control" '+("N"==e.userStatus?"disabled":"")+'><option value="CUSTOM">Custom</option><option '+(15==e.timeDuration?"selected":"")+' value="15">15 min</option><option '+(30==e.timeDuration?"selected":"")+' value="30">30 min</option><option '+(40==e.timeDuration?"selected":"")+' value="40">40 min</option><option '+(50==e.timeDuration?"selected":"")+' value="50">50 min</option></select></div></div></div><div class="col-xl-5 col-lg-5 col-md-7 col-sm-10 col-12 mb-2 custom_duration" ><div class="row"><div class="col-5 pr-0"><input id="customDuration" name="customDuration" type="text" class="form-control"></div><div class="col-7"><select name="customDurationTimeIn" id="customDurationTimeIn" class="form-control"><option value="M">Min</option></select></div></div></div><div class="col-12 mb-2 mt-2"><label class="m-0 font-size-lg font-weight-semi-bold full">Buffer time <span class="float-right text-primary">None</span></label><div class="d-flex align-items-center mb-2"><span class="d-inline-flex mr-2" style="width: 90px;">Before event:</span><select name="beforeTime" id="beforeTime" class="form-control w-auto"><option value="CUSTOM">Custom</option><option '+(0==e.beforeTime?"selected":"")+' value="0">0 min</option><option '+(5==e.beforeTime?"selected":"")+' value="5">5 min</option><option '+(10==e.beforeTime?"selected":"")+' value="10">10 min</option><option '+(15==e.beforeTime?"selected":"")+' value="15">15 min</option><option '+(30==e.beforeTime?"selected":"")+' value="30">30 min</option></select></div><div class="d-flex align-items-center mb-2"><span class="d-inline-flex mr-2" style="width: 90px;">After event:</span><select name="afterTime" id="afterTime" class="form-control w-auto"><option value="CUSTOM">Custom</option><option '+(0==e.afterTime?"selected":"")+' value="0">0 min</option><option '+(5==e.afterTime?"selected":"")+' value="5">5 min</option><option '+(10==e.afterTime?"selected":"")+' value="10">10 min</option><option '+(15==e.afterTime?"selected":"")+' value="15">15 min</option><option '+(30==e.afterTime?"selected":"")+' value="30">30 min</option></select></div></div><div class="col-12 mb-2 mt-2"><div class="d-flex align-items-center"><label class="m-0 font-size-lg font-weight-semi-bold">Available hours</label><span class="d-inline-flex ml-1 meeting-color-wrapper"><button class="btn btn-lg dropdown-toggle d-flex align-items-center" style="border: 1px solid #ced4da;" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Copy from<i class="fa fa-angle-down ml-1"></i></button><div class="dropdown-menu" style="max-width: 200px;"><span class="d-flex align-items-center"><a class="d-inline-block mx-1 bg-success" data-color-class="bg-success" href="#" style="width:20px;height: 20px;border-radius: 50%;"></a>IS Demo Meetings</span><div role="separator" class="dropdown-divider"></div><span class="d-flex align-items-center"><a class="d-inline-block mx-1 bg-primary" data-color-class="bg-primary" href="#" style="width:20px;height: 20px;border-radius: 50%;"></a>Demo Meetings</span><div role="separator" class="dropdown-divider"></div><span class="d-flex align-items-center"><a class="d-inline-block mx-1 bg-danger" data-color-class="bg-danger" href="#" style="width:20px;height: 20px;border-radius: 50%;"></a>Meetings</span></div></span></div><div style="color:#9f9c9c">Set repeating times or date-specific orerrides for the free time Calendly will offer on your calendar.</div><hr class="mb-0"/></div><div class="col-12 mb-2"><div class="full"><div class="full" id="WeekdaysWrapper"><label class="full font-weight-bold text-dark m-0">Weekdays, 9am - 5pm</label><div class="#9f9c9c">+1 date-specific time</div></div><a href="javascript:void(0)" class="position-absolute" id="toggleWeekAndhours"  style="right:12px; top:2px;"><i class="fa fa-angle-right font-weight-semi-bold text-dark" style="font-size: 26px;"></i></a><div class="full" id="availableHoursWrapper" style="display: none;"><div class="full"><label class="full font-weight-bold text-dark mb-0">Available Hours</label><div class="mt-2" style="color:#9f9c9c">Set repeating times or date-specific orerrides for the free time Calendly will offer on your calendar.</div></div><div class="full bg-light rounded mt-2"><div class="card-header card-header-tab-animation bg-light rounded"><ul class="nav nav-justified"><li class="nav-item"><a data-toggle="tab" href="#weeklyHours" class="active nav-link">Weekly hours</a></li><li class="nav-item"><a data-toggle="tab" href="#DateSpecificHours" class="nav-link">Date-specifics hours</a></li></ul></div><div class="tab-wrapper"><div class=" tab-content p-3"><div class="tab-pane active" id="weeklyHours" role="tabpanel"></div><div class="tab-pane" id="DateSpecificHours" role="tabpanel"><div class="d-flex"><div>Override your available for specific dates when your hours differ from your regular weekly hours.</div><a href="javascript:void(0)" class="text-dark" style="width:80px" onclick="showEventTypeRadioButton()"><i class="fa fa-edit"></i></a></div></div></div></div><div class="full p-2" id="weeklyHoursList" style="display: none;"><div class="cursor d-inline-block back-step"><i class="fa fa-angle-left mr-1"></i>Back</div><label class="full font-weight-bold text-dark mb-0">Weekly hours</label><ul class="list-group list-group-flush custom-week-time-available"></ul><label class="full font-weight-bold text-dark mb-0 mt-2">Date-specific hours</label><div class="my-1">Override your available for specific dates when your hours differ from your regular weekly hours.</div><a href="javascript:void(0)" class="btn btn-outline-dark mb-2" id="showAddBySpecificDate">Add date-specific hours</a><p class="my-2"><i class="fa fa-globe mr-1"></i>Indian standard time</p></div><div class="full p-2" id="addBySpecificDate" style="display: none;"><div class="cursor d-inline-block back-step"><i class="fa fa-angle-left mr-1"></i>Back</div><label class="full font-weight-bold text-dark mb-0 font-size-lg">Select the date(s) you want to assign specific hours</label><div class="row"><div><h3 class="cal-title font-20px" id="calMonthYear"></h3></div><div class="arrowBtn ml-auto"><button type="button" id="preSpecificCalMonth" class="mb-2 mr-2 btn-icon btn-pill btn" ><i class="fa fa-angle-left" style="font-size:25px"></i> </button><button type="button" id="nextSpecificCalMonth" class="mb-2 mr-2 btn-icon btn-pill btn" ><i class="fa fa-angle-right" style="font-size:25px"></i> </button></div><input type="hidden" name="weekDayName" id="weekDayName" value="" /><input type="hidden" name="weekCount" id="weekCount" value="" /><input type="hidden" name="weekDayNum" id="weekDayNum" value="" /><input type="hidden" name="inActDate" id="inActDate" value="" /><input type="hidden" name="firstStartDate" id="firstStartDate" value="" /><input type="hidden" name="firstDate" id="firstDate" value="" /><input type="hidden" name="firstDateNextMonth" id="firstDateNextMonth" value="" /><input type="hidden" name="firstDatePreMonth" id="firstDatePreMonth" value="" /><input type="hidden" name="timeZoneId" id="timeZoneId" value="" /></div><div class="my-1" id="timeCalendarSepcificDate"></div><div class="full mt-2 timesection"><div class="bold my-2"><span>What hours are you available? </span><a href="javascript:void(0)" class="btn btn-lg btn-outline-primary btn-sm float-right bhagat1" onclick="addSingleRowTime(\'createNewEventModal\',\''+t+"','daySpecifictime','"+a+"','"+i+"', '"+l+"','"+s+"', '"+o+"', '"+n+"','"+d+"', '"+r+'\',\'\',\'0\');" style="line-height:0"><i class="icon ion-android-add" style="font-size:15px;line-height:13px"></i></a></div><div class="row overflow-y-auto scrollbar-container" style="height:170px"><div class="col-12 daySpecifictime"></div></div></div><hr/><div class="full text-center mb-2"><a href="javascript:void(0)" class="btn btn-outline-primary">Cancel</a><a href="javascript:void(0)" class="btn btn-primary">Apply</a></div></div></div></div></div></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-secondary close-modal-btn" data-dismiss="modal">Close</button><button type="button" class="btn btn-primary close-modal-btn" id="">Apply</button></div> </div></div></div>'}function bookSlotDetailsModal(){return'<div id="bookSlotDetailsModal" class="modal fade fade-scale" tabindex="" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true"><div class="modal-dialog modal-md modal-dialog-centered box-shadow-none"><div class="modal-content border-0"><div class="modal-header pt-2 pb-2 theme-bg text-white"><h5 class="modal-title" id="exampleModalLabel">Booked Slot Detials</h5><button type="button" class="close text-white" data-dismiss="modal" aria-label="Close"><span aria-hidden="true"></span></button></div><div class="modal-body"><div class="widget-chart text-left mb-2 card-top-border card-shadow-primary border-success card w-100 "><ul class="p-0 m-0 w-100"><li class="d-flex flex-wrap"><label class="m-0 font-weight-bold mr-1">Event Name:</label><span>School Demo</span></li><li class="d-flex flex-wrap"><label class="m-0 font-weight-bold mr-1">Invitee Name:</label><span>Bhagat Singh Garakoti</span></li><li class="d-flex flex-wrap"><label class="m-0 font-weight-bold mr-1">Event Duration:</label><span>30 minute</span></li><li class="d-flex flex-wrap"><label class="m-0 font-weight-bold mr-1">Status:</label><span>Pending</span></li><li class="d-flex flex-wrap"><label class="m-0 font-weight-bold mr-1">Invitee Date and Time Zone:</label><span>Jun 29, 2024 05:20 AM - 05:50 AM Netherlands | Amsterdam | UTC +01:00</span></li></uli></div></div><div class="modal-footer"><button type="button" class="btn btn-info btn-shadow float-right pr-4 pl-4 ml-2" data-dismiss="modal">Close</button></div></div></div></div>'}function showDeleteEventWarningModal(){$("#eventDeleteWarningModal").modal("show")}function callMeetingBooking(e,t,a,i,l,s){customLoader(!0),data={},data.bookingId=t,data.bookType=a,data.startDate=i,data.entityType=l,data.entityId=s,$.ajax({type:"POST",contentType:"application/json",url:getURLFor("timeavailability","get-meeting-booking-time"),data:JSON.stringify(data),dataType:"json",cache:!1,timeout:6e5,async:!0,success:function(e){if(console.log(e),"0"==e.status||"2"==e.status||"3"==e.status)"3"==e.status&&redirectLoginPage();else{var a=getBookMeetingDetail(e);$(".meetingDetailclass"+t).html(a)}customLoader(!1)},error:function(e){"theme2"==tt&&showMessageTheme2(2,TECHNICAL_GLITCH,"",!0)}})}function getColorByEntityType(e){var t="";"COUNSELORMEET"==e||"CUSTOM"==e||"INTERVIEW"==e||"PTM"==e||"MEETINS"==e||"MEETINGS"==e?t="STUDENT_DOUBT_SESSION":"REQUESTDEMO"==e||"CONNECTMEET"==e||"B2B-INTERVIEW"==e||"SYS-TRAINING"==e?t=e:"BATCH_CLASS_RESCHEDULE"==e||"BATCH_TEACHER_MAPPING"==e?t="GROUP_CLASS":"EXTRA_ACTIVITY_DETAILS"==e&&(t="ACTIVITY_CLASS");var a="";return $.each(eventsBasedOnRole,(function(e,i){i.slotShortName==t&&(a=i.bgColor)})),a}function getSepcificDateTime(){var e={},t=[],a=$("#inActDate").val().split(",");for(let e=0;e<a.length;e++){const r=a[e];if(""!=r){$(".specific_tr_date_"+r.toString().replaceAll("-","")).remove();var i=[],l={},s=new Date(r),o=s.toString().split(" ")[0]+", "+s.toString().split(" ")[1]+" "+s.toString().split(" ")[2]+" "+s.toString().split(" ")[3];l.selectDate=o,l.strSelectDate=r,l.startTime=null,l.endTime=null,l.dayId=null,l.dayName=null,l.slotType=null,l.duration=null,l.dayTimeType="",l.dataType="N",l.dateValid="Y";var n,d=0;$(".calday-hours").not(".d-none").each((function(){var e={},t="remove-hide";$(this).hasClass("hide-remove-button")&&(t="remove-hide");var a=$(this).find(".fromTime").val(),s=$(this).find(".toTime").val();if(null!=a&&null!=a&&""!=a&&null!=s&&null!=s&&""!=s){e.timeid=0,e.dayid=null,e.dayCheck=null,e.startTime=a+" - "+s,e.endTime=null,e.slotType=null,e.slotTypeId=null,e.dataType="N",e.timetype=t,i.push(e),a=convertTo24Hour(a),s=convertTo24Hour(s);var o=new Date("1970-01-01T"+a+"Z"),n=new Date("1970-01-01T"+s+"Z"),r=(Date.parse(n)-Date.parse(o))/1e3/60;d+=r}else l.dayTimeType="Unavailable"})),n=String(100+Math.floor(d/60)).substr(1)+"h "+String(100+d%60).substr(1)+"m",l.totalTimeHrsMins=n,l.teacherPreferTime=i,t.push(l)}}return e.timeAvailable=t,e.status=1,e.statusCode="SUCCESS",e.message=null,e.userId=null,e}function getTeacherMeetingStatus(e,t,a,i,l,s){customLoader(!0);var o=!0;return data={},data.availableType=e,data.weekDayId=t,data.userId=a,data.daySlotId=i,null!=s&&(data.selectDate=s),$.ajax({type:"POST",contentType:"application/json",url:getURLFor("timeavailability","get-meeting-status-booking-time"),data:JSON.stringify(data),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(s){if(console.log(s),"0"==s.status||"2"==s.status||"3"==s.status)o=!0;else{var n="<span>"+s.teacherPreferSlotStime+"</span>";$(".request_delete_teacher_time").html(n);var d="";$(".request_teacher_time").html(d);var r=s.preferSlotList,c="'','','',''";if(r.length>0){for(let e=0;e<r.length;e++){var m=r[e];"N"==m.slotDelStatus&&(d+='<span class="d-none add-time-after-remove" data-userid="'+a+'" data-timeid="'+i+'" data-select-date="'+m.selectDate+'" data-controltype="'+m.slotAddType+'" data-starttime="'+m.tStartTime+'" data-endtime="'+m.tEndTime+'"></span>',c="'"+m.slotAddType+"', '"+m.selectDate+"','"+m.tStartTime+"','"+m.tEndTime+"'")}$(".request_teacher_time").html(d)}var u=bindClassData(s.leetingList);$("#avialabilityRemoveList").html(u);var p="removeWeekSlot('"+l+"','"+e+"','"+t+"',"+c+")";$("#timeAvailabilityRemoveSave").attr("onClick",p),$("#timeRemoveReschedule").attr("onClick","markAsRescheduleConfirm()"),$("#timeAvailabilityRemovePopup").modal("show"),o=!1}customLoader(!1)},error:function(e){"theme2"==tt&&showMessageTheme2(2,TECHNICAL_GLITCH,"",!0)}}),o}function bindClassData(e){var t="";if(e.length>0)for(let a=0;a<e.length;a++){const i=e[a];t=(t=(t=(t+="<tr>")+'<td style="vertical-align:top"><input type="hidden" class="timeId" value='+(i.meetingType.replaceAll(" ","_")+"|"+i.timeId+"|"+i.adminClassDate)+"></input>"+i.meetingType+"<br/>"+i.recurringClassStart+"</td>")+'<td style="vertical-align:top">'+i.studentName+"</td>")+'<td style="vertical-align:top">'+i.teacherName+"</td>",t=(t=(t=(t+='<td style="vertical-align:top">')+'<span class="text-danger" style="font-size:14px"><b>Teacher: </b>'+i.teacherDatetime+" "+i.teacherTimezone.toString().replace("/"," | ")+"</span><br/>")+"<span><b>Student: </b>"+i.studentDateTime+" "+i.studentTimezone.toString().replace("/"," | ")+"</span><br/>")+"<span><b>Admin: </b>"+i.adminDatetime+" "+i.adminTimeZone.toString().replace("/"," | ")+"</span>",t+="</td>",t+="</tr>"}return t}function removeWeekSlot(e,t,a,i,l,s,o){var n=$("#userId").val(),d=$("#userRoleId").val(),r=$("#slotFromTime").val(),c=$("#slotToTime").val(),m=$("#slotMin").val(),u=$("#slotMax").val(),p=$("#slotDateLimit").val(),v=$("#slotBufferTime").val(),f=$("#dayChangeLimit").val(),h=e.split("-")[0];if("calhours"==h&&(t="day-wise"),"week-wise"==t||"day-wise"==t){$("#"+e).addClass("d-none");var y=e.split("-")[0],g=a,b=parseInt(e.split("-")[2]);$(".add-time-after-remove").each((function(){s=$(this).attr("data-starttime"),o=$(this).attr("data-endtime");var t=$(this).attr("data-timeid"),a=$(this).attr("data-userid");if("calhours"==h)$("."+e).addClass("d-none"),addSingleRowTime("createNewEventModal",""+a,"daytime",""+s,""+o,""+d,""+m,""+u,""+p,""+v,""+f,"remove-slot-week",t);else{addNewRowTime(""+y,""+g,""+s,""+o,""+d,""+m,""+u,""+p,""+v,""+f,"remove-slot-week"),$(".fromTime").select2({theme:"bootstrap4"}),$(".toTime").select2({theme:"bootstrap4"});var i=b+1;$("#"+y+"-time-"+i).find(".fromTime").attr("disabled",!0),$("#"+y+"-time-"+i).find(".toTime").attr("disabled",!0)}setTimeout((function(){$("body").addClass("modal-open"),$("body").css({"padding-right":"7px"})}),500)}))}else{var T=e.split("_")[0]+"_"+e.split("_")[1]+"_"+e.split("_")[2],w=e.split("_")[2],x=0,k="",D="",C=0;$("#"+T+" span").not(".remove").each((function(){$(this).hasClass("text-danger")?$(this).remove():$(this).hasClass(e)?(D=$(this).attr("data-select-date"),s=$(this).attr("data-starttime"),o=$(this).attr("data-endtime"),C=$(this).attr("data-timeid"),onFunc="removeTimePrefRence('specific_tr_"+w+"_"+x+"', '"+C+"','"+n+"','N','"+r+"','"+c+"','"+d+"')",k=(k=(k=k+'<span class="d-none specific_tr_'+w+"_"+x+'" style="min-width:135px" data-timeid="'+C+'" data-select-date="'+D+'" data-controltype="add" data-starttime="'+s+'" data-endtime="'+o+'">'+s+" - "+o+"</span>")+'<span class="d-none ml-2 mb-1 remove specific_tr_'+w+"_"+x+'">')+'<a href="javascript:void(0);" class="click-to-catalog btn btn-sm btn-outline-danger" onclick="'+onFunc+'"><i class="ion-android-close"></i></a>',k+="</span></br>",x+=1):(D=$(this).attr("data-select-date"),s=$(this).attr("data-starttime"),o=$(this).attr("data-endtime"),C=$(this).attr("data-timeid"),onFunc="removeTimePrefRence('specific_tr_"+w+"_"+x+"', '"+C+"','"+n+"','N','"+r+"','"+c+"','"+d+"')",k=(k=(k=k+'<span class="d-inline-block  specific-time-add specific_tr_'+w+"_"+x+' " style="min-width:135px" data-timeid="'+C+'" data-select-date="'+D+'" data-controltype="add" data-starttime="'+s+'" data-endtime="'+o+'">'+s+" - "+o+"</span>")+'<span class="d-inline-block ml-2 mb-1 remove specific_tr_'+w+"_"+x+'">')+'<a href="javascript:void(0);" class="click-to-catalog btn btn-sm btn-outline-danger" onclick="'+onFunc+'"><i class="ion-android-close"></i></a>',k+="</span></br>",x+=1)})),$(".add-time-after-remove").each((function(){var e=$(this).attr("data-select-date"),t=$(this).attr("data-starttime"),a=$(this).attr("data-endtime"),i=$(this).attr("data-timeid");onFunc="removeTimePrefRence('specific_tr_"+w+"_"+x+"', '"+i+"','"+n+"','N','"+r+"','"+c+"','"+d+"')",k=k+'<span class="d-inline-block  specific-time-add specific_tr_'+w+"_"+x+'  text-danger" style="min-width:135px" data-timeid="'+i+'" data-select-date="'+e+'" data-controltype="add" data-starttime="'+t+'" data-endtime="'+a+'">'+t+" - "+a+"</span>",k+="</br>",x+=1})),$("#specific_td_"+w).html(k)}$("#timeAvailabilityRemovePopup").modal("hide"),"calhours"!=h&&($(".timeAvailabilityConfirmationAction").hasClass("show")||$(".timeAvailabilityConfirmationAction").addClass("show"))}function getSepcificDateTimeRemove(e,t,a){var i={},l=[];const s=e;if(""!=s){var o=[],n={},d=new Date(s),r=d.toString().split(" ")[0]+", "+d.toString().split(" ")[1]+" "+d.toString().split(" ")[2]+" "+d.toString().split(" ")[3];n.selectDate=r,n.strSelectDate=s,n.startTime=null,n.endTime=null,n.dayId=null,n.dayName=null,n.slotType=null,n.duration=null,n.dayTimeType="",n.dataType="N",n.dateValid="Y";var c,m=0;$(".calday-hours").each((function(){var e={},i=t,l=a;if(null!=i&&null!=i&&""!=i&&null!=l&&null!=l&&""!=l){e.timeid=null,e.dayid=null,e.dayCheck=null,e.startTime=i+" - "+l,e.endTime=null,e.slotType=null,e.slotTypeId=null,e.dataType="N",o.push(e),i=convertTo24Hour(i),l=convertTo24Hour(l);var s=new Date("1970-01-01T"+i+"Z"),d=new Date("1970-01-01T"+l+"Z"),r=(Date.parse(d)-Date.parse(s))/1e3/60;m+=r}else n.dayTimeType="Unavailable"})),c=String(100+Math.floor(m/60)).substr(1)+"h "+String(100+m%60).substr(1)+"m",n.totalTimeHrsMins=c,n.teacherPreferTime=o,l.push(n)}return i.timeAvailable=l,i.status=1,i.statusCode="SUCCESS",i.message=null,i.userId=null,i}function callTimeBookingTeacher(e,t,a,i,l){customLoader(!0),data={},data.bookingId=t,data.bookType=a,data.startDate=i,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","get-booking-time"),data:JSON.stringify(data),dataType:"json",cache:!1,timeout:6e5,async:!0,success:function(e){if("0"==e.status||"2"==e.status||"3"==e.status)"3"==e.status&&redirectLoginPage();else{var a=bindTeacherBookedClass(e);$(".meetingDetailclass"+t).html(a)}customLoader(!1)},error:function(e){"theme2"==tt&&showMessageTheme2(2,TECHNICAL_GLITCH,"",!0)}})}function getTeacherTimeBooked(e,t,a,i){callTimeBookingTeacher("",e,t,a,i)}function bindTeacherBookedClass(e){var t="";return t=t+'<div class="widget-chart text-left card-top-border card-shadow-primary border-'+e.meetingColor+' card w-100" style="min-width:450px">',t+='<ul class="p-0 m-0 w-100">',"Activity"==e.meetingType?(t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Activity Title:</label>')+"<span>"+e.subjectName+"</span>",t+="</li>",t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Class Type:</label>')+"<span>"+e.meetingType+"</span>",t+="</li>",3!=USER_ROLE_ID&&(t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Admin Timings:</label>')+"<span>"+e.adminDatetime+"</span>",t+="</li>")):"Group"==e.meetingType?(t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Class with:</label>')+"<span>"+e.studentName+"</span>",t+="</li>",t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Course Name:</label>')+"<span>"+e.subjectName+"</span>",t+="</li>",t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Class Type:</label>')+"<span>"+e.meetingType+"</span>",t+="</li>",3!=USER_ROLE_ID&&(t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Admin Timings:</label>')+"<span>"+e.adminDatetime+"</span>",t+="</li>")):(t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Class with:</label>')+"<span>"+e.studentName+"</span>",t+="</li>",t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Course Name:</label>')+"<span>"+e.subjectName+"</span>",t+="</li>",t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Class Type:</label>')+"<span>"+e.meetingType+"</span>",t+="</li>",t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Student Timings:</label>')+"<span>"+e.studentDateTime+"</span>",t+="</li>",3!=USER_ROLE_ID&&(t+='<li class="d-flex flex-wrap">',t=(t+='<label class="m-0 font-weight-bold mr-1">Admin Timings:</label>')+"<span>"+e.adminDatetime+"</span>",t+="</li>")),t+="</ul>",t+="</div>"}function getTimeLastValue(e,t){var a=e;a=parseInt(a,10);var i=t,l=i.filter((function(e){return e.endsWith(":00 AM")||e.endsWith(":00 PM")}));return l=l.reverse(),i.slice(0,i.indexOf(l[a-1])+1)}function markAsRescheduleRequest(){var e="";return $("#avialabilityRemoveList tr").each((function(){e+=","+$(this).find(".timeId").val()})),e.slice(1,e.length)}function markAsReschedule(){var e={allMeetingTypeAndIds:markAsRescheduleRequest()};customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","remove-availability-reschedule-class"),data:JSON.stringify(e),dataType:"json",cache:!1,timeout:6e5,async:!0,success:function(e){if("0"==e.status||"2"==e.status||"3"==e.status)"3"==e.status?redirectLoginPage():showMessageTheme2(2,e.message,"",!0);else{showMessageTheme2(1,e.message,"",!0),$("#timeAvailabilityRemovePopup").modal("hide");var t=markAsRescheduleRequest();(t=t.split(",")).forEach((e=>{var t=e.split("|")[0],a=e.split("|")[1],i=e.split("|")[2];i=new Date(i),i=changeDateFormat(i,"mm-dd-yyyy"),"Group"==t&&sendMailCancelClassSlotRemove("sendmail-cancel",a,i)}))}customLoader(!1)},error:function(e){"theme2"==tt&&showMessageTheme2(2,TECHNICAL_GLITCH,"",!0),customLoader(!1)}})}function sendMailCancelClassSlotRemove(e,t,a){let i={};i.batchTeacherMappingId=t,i.status=e,i.classCancelDate=a,i.userId=USER_ID,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","class-cancel-and-reschedule"),data:JSON.stringify(i),dataType:"json",cache:!1,timeout:6e5,success:function(e){"0"!=e.status&&"2"!=e.status||showMessageTheme2(0,e.message)}})}function showWarningMessageShow(e,t,a){if("info-modal-sm"==a){if($("#remarksresetDelete2").length<1&&$("body #schoolReportContent").append(deleteWarning(e,t)),""==t?($("#resetDeleteErrorWarningYes2").hide(),$("#resetDeleteErrorWarningNo2").hide(),$("#resetDeleteErrorWarningCancel2").show()):($("#resetDeleteErrorWarningYes2").show(),$("#resetDeleteErrorWarningNo2").show(),$("#resetDeleteErrorWarningCancel2").hide()),t="$('#remarksresetDelete2').modal('hide');"+t+";",$("#warningMessage2").html(e),"info-modal-sm"!==a){var i="Please note that any recurring class created for this student will be deactivated after the student is withdrawn. If for any reason the class is not deactivated, kindly do the same from the Recurring Class menu";$("#statusMessage-2").html(i)}else $("#statusMessage-2").html('<i class="fas fa-sync fa-4x text-info"></i>');$("#resetDeleteErrorWarningYes2").attr("onclick",t),$("#remarksresetDelete2").modal("show")}else{if(""==t?($("#resetDeleteErrorWarningYes1").hide(),$("#resetDeleteErrorWarningNo1").hide(),$("#resetDeleteErrorWarningCancel1").show()):($("#resetDeleteErrorWarningYes1").show(),$("#resetDeleteErrorWarningNo1").show(),$("#resetDeleteErrorWarningCancel1").hide()),t="$('#remarksresetDelete1').modal('hide');"+t+";",$("#warningMessage1").html(e),a){i="Please note that any recurring class created for this student will be deactivated after the student is withdrawn. If for any reason the class is not deactivated, kindly do the same from the Recurring Class menu";$("#statusMessage-1").html(i)}else $("#statusMessage-1").html('<i class="fa fa-refresh fa-4x" style="color:#337ab7 !important;"></i>');$("#resetDeleteErrorWarningYes1").attr("onclick",t),$("#remarksresetDelete1").modal("show")}}function markAsRescheduleConfirm(){showWarningMessageShow("Are you sure you want to reschedule and cancel classes ?","markAsReschedule()")}function countDaysFromCurrentDate(e,t,a){for(var i=new Date(e,t,0).getDate(),l=new Date(e,t-1,a).getDay(),s=[0,0,0,0,0,0,0],o=a-1;o<i;o++){var n=new Date(e,t-1,o+1);excludeDates.includes(n.toDateString())||s[(l+o-(a-1))%7]++}for(var d=["0","1","2","3","4","5","6"],r={},c=0;c<7;c++)r[d[c]]=s[c];return console.log(excludeDates),r}function callRefreshWeek(e,t,a){3==a&&($("#weekRefreshStatus").val("Y"),$(".timeAvailabilityConfirmationAction").hasClass("show")||$(".timeAvailabilityConfirmationAction").addClass("show"))}function getCounselerByDateTimeAndTimeZone(e,t,a,i,l,s,o){customLoader(!0);var n={date:e,startTime:t,endTime:a,timeZone:i,slotCounselorIds:l};$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("timeavailability","get-counselor-for-demo-book"),data:JSON.stringify(n),dataType:"json",async:!0,globle:!1,success:function(e){if("0"==e.status||"2"==e.status)showMessage(!0,e.message);else{var t=e.counselorList;if("true"==$("#forAllCounselor").val()&&"true"!=$("#counselorAutoSelect").val()){var a=$("#"+s);a.html(""),o&&a.append('<option value="0">'+o+"</option>"),$.each(t,(function(e,t){a.append('<option value="'+t.userId+'">'+t.userName+"</option>")}))}else{var i="";$.each(t,(function(e,t){i+=t.userId+","})),$("#autoSelectCounselorIds").val(i.slice(0,i.length-1))}}},error:function(e){customLoader(!1)}})}function resetAllDateSpecificDayAndUserId(e,t,a,i,l,s,o,n,d,r){var c={userId:e,dayId:t,updatedBy:USER_ID};$.ajax({type:"POST",url:getURLFor("timeavailability","refresh-all-time-prefrence"),contentType:"application/json",data:JSON.stringify(c),dataType:"json",cache:!1,async:!1,timeout:6e5,success:function(t){return"0"==t.status||"2"==t.status?showMessageTheme2(0,t.message,"",!0):(showMessageTheme2(1,t.message,"",!0),$(".resetAvailabilityConfirmationAction").removeClass("show"),getCalendarAvailability("timeAvailabilityPopup",e,"timeCalendar","","Month",a,i,l,s,o,n,d,r)),!1},error:function(e){return!1}})}function resetAllDateSpecificByDayAndUserId(e,t,a,i,l,s,o,n,d,r){$(".resetAvailabilityConfirmationAction").addClass("show"),$("#restAllDateSpecific").on("click",(function(){resetAllDateSpecificDayAndUserId(e,t,a,i,l,s,o,n,d,r)}))}function copyListViewTimeDropdownFun(){$(".dropdown-menu .copy-times").on("click",(function(){return!1}));var e=[];$(".dropdown-menu label.day-type-label").on("click",(function(t){var a=$(t.currentTarget).attr("for");if($("#"+a).prop("disabled"))return!1;$(".day-list").each((function(){$(this).is(":checked")&&e.push($(this).val())}));var i,l=$(t.currentTarget),s=l.attr("data-value"),o=s.split("-"),n=(o=parseInt(o[1]),l.parent().find("input"));return(i=e.indexOf(s))>-1?(e.splice(i,1),setTimeout((function(){n.prop("checked",!1)}),0)):(e.push(s),setTimeout((function(){n.prop("checked",!0)}),0)),$(t.target).blur(),!1}))}$("#duration").on("change",(function(){"CUSTOM"==$(this).val()?$(".custom_duration").show():$(".custom_duration").hide()})),$(document).on("visibilitychange",(function(){if($("#timeAvailabilityPopup").on("hide.bs.modal",(function(){$(".week-time-available .fromTime").data("select2")&&$(".week-time-available .fromTime").select2("destroy"),$(".week-time-available .toTime").data("select2")&&$(".week-time-available .toTime").select2("destroy"),$(".week-time-available .fromTime").select2({theme:"bootstrap4"}),$(".week-time-available .toTime").select2({theme:"bootstrap4"}),$("#timeAvailabilityPopup .modal-footer #timeAvailabilitySave").addClass("d-none")})),"visible"==document.visibilityState){var e=setInterval((function(){$(".tooltip").hasClass("show")&&$(".tooltip").remove()}),10);setTimeout((function(){clearInterval(e)}),1e3)}})),$(document).click((function(e){$(e.target).closest(".dropdown").length?($("#timeCalendar .dropdown-menu").removeClass("show"),$("#timeCalendar .dropdown-menu").parent().closest(".scrollbar-container").css({"overflow-y":"auto"}),$(e.target).closest(".dropdown-menu").addClass("show"),$(e.target).closest(".dropdown-menu").parent().closest(".scrollbar-container").css({"overflow-y":"inherit"})):($("#timeCalendar .dropdown-menu").removeClass("show"),$("#timeCalendar .dropdown-menu").parent().closest(".scrollbar-container").css({"overflow-y":"auto"}))})),$(document).ready((function(){getWaringContent1(),$(".dropdown-toggle").click((function(){$("#timeCalendar .dropdown-menu").hasClass("show")&&($("#timeCalendar .dropdown-menu").removeClass("show"),$("#timeCalendar .dropdown-menu").parent().closest(".scrollbar-container").css({"overflow-y":"auto"}))}))}));