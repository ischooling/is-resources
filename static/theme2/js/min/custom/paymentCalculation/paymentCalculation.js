var currency="$ ";function getRequestForPaymentDetails(){var e={};return e.uniqueId=UNIQUEUUID,e.userId=$("#studentDetailsId").attr("userId"),e.studentStandardId=$("#studentDetailsId").attr("studentStandardId"),e}function getPaymentDetails(){customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","custom-fee-calculation-process/"),data:JSON.stringify(getRequestForPaymentDetails()),dataType:"json",global:!1,success:function(e){if(customLoader(!1),"0"==e.status||"2"==e.status||"3"==e.status)"3"==e.status?redirectLoginPage():"E002"==e.statusCode?($("#eligible").hide(),$("#notEligible").show(),$(".studentDetails").html(e.message)):($("#eligible").show(),$("#notEligible").hide(),showMessageTheme2(0,e.message,"",!0));else{$("#eligible").show(),$("#notEligible").hide();var t=e.paymentDetails,a=t.customPlan,n=t.studentDetails,l=t.selectedCourseDetails;$(".studentDetails").html(n.enrollmentType+" | "+n.grade+" | "+n.learingPlan+" | "+n.studentName);$("#selectedCourses thead").append('<tr><th>S.No</th><th>Course Name</th><th class="text-center">AP/H/REG/ADV</th><th class="text-right">Credit</th><th class="text-right">Course Fee</th><th class="text-right">Material Fee</th></tr>');var o=0;$.each(l.courses,(function(e,t){var a="<tr><td>"+(o+=1)+"</td><td>"+t.name+'</td><td class="text-center">'+t.courseType+'</td><td class="text-right">'+t.creditLimit.toFixed(1)+'</td><td class="text-right">'+t.courseFeeString+'</td><td class="text-right">'+t.materialFeeString+"</td></tr>";$("#selectedCourses tbody").append(a)}));var s='<tr><td colspan="3" class="text-right"><b>Total:</b></td><td class="text-right"><b>'+parseFloat(l.totalCredits).toFixed(1)+'</b></td><td class="text-right"><b></b></td><td class="text-right"><b></b></td></tr>';if($("#selectedCourses tbody").append(s),$("#defaultPlanName").html(l.defaultPlanName),$("#enrollmentFeeString").html(l.enrollmentFeeString),$("#bookAnEnrollmentFeeString").html(l.bookAnEnrollmentFeeString),"expired"==l.bookAnEnrollmentStatus.expiryStatus?$(".enrollmentFeePaidType").html("(expired)"):"nonExpired"==l.bookAnEnrollmentStatus.expiryStatus?$(".enrollmentFeePaidType").html("(Paid - Expiry date: "+l.bookAnEnrollmentStatus.expiryDate+")"):$(".enrollmentFeePaidType").html("(Not Paid)"),$("#courseFeeString").html(l.courseFeeString),$("#planDiscountString").html(l.planDiscountString),$("#scholarshipDiscountString").html(l.scholarshipDiscountString),$("#extraCourseFeeString").html(l.extraCourseFeeString),$("#materialFeeString").html(l.materialFeeString),$(".payableFeeString").html(l.payableFeeString),$("#minimumPayment").html(a.firstPaymentAmount),$("#firstInstallmentHidden").val(a.firstPaymentAmount),$("#paymentModeHidden").val(l.paymentMode),$("#planDiscountHidden").val(l.planDiscount),$("#materialFeeHidden").val(l.materialFee),$("#payableFeeHidden").val(l.payableFee),l.userOnProgresss?($(".enrollmentFeeStringDiv").hide(),$(".bookAnEnrollmentFeeStringDiv").css("display","table-row")):($(".enrollmentFeeStringDiv").css("display","table-row"),$(".bookAnEnrollmentFeeStringDiv").hide()),"annually"==l.paymentMode?($("#payableFeeAnnually").val(l.payableFee.toFixed(2)),$("#payableFeeInstallment").val(parseFloat(l.payableFee+l.planDiscount).toFixed(2)),$("#payableFee").val($("#payableFeeAnnually").val())):($("#payableFeeAnnually").val(parseFloat(l.payableFee-l.planDiscount).toFixed(2)),$("#payableFeeInstallment").val(l.payableFee.toFixed(2)),$("#payableFee").val($("#payableFeeInstallment").val())),console.log("bookAnEnrollmentStatus: "+l.bookAnEnrollmentStatus),$("#customePlanId").val(a.customePlanId),$("#studentStandardId").val(a.studentStandardId),$("#customPaymentPlan").html('<option value="c_annually">Advantage Plan</option><option value="c_installment">Easy Plan</option>'),$("#customPaymentPlan").val(a.customPlanNamme),$("#premiumPercentage").val(a.premiumPercentage.toFixed(2)+"%"),$("#premiumAmount").val(a.premiumAmount.toFixed(2)),$("#payableFeeAfterPremium").val(a.payableFeeAfterPremium.toFixed(2)),$("#discountPercentage").val(a.discountPercentage.toFixed(2)+"%"),$("#discountAmount").val(a.discountAmount.toFixed(2)),$("#payableFeeAfterDiscount").val(a.payableAmountAfterDiscount.toFixed(2)),$("#firstInstallmentPercentage").val(a.firstPaymentPercentage.toFixed(2)+"%"),$("#firstInstallment").val(a.firstPaymentAmount.toFixed(2)),$("#remainingPayableFee").val(a.remainingAmount.toFixed(2)),$("#noOfInstallment").html('<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>'),$("#noOfInstallment").val(a.noOfInstallment),$("#durationWithin").html('<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>'),$("#durationWithin").val(a.durationWithin),$("#gapBetweenTwoIntstallment").val(a.gapBetweenTwoIntstallment),$("#tentativeFirstPayDate").val(a.tentativeFirstPayDate),$("#discountApplicableFor").val(a.discountApplicableFor),0==a.customePlanId)customPlanChange(),generateDiscountApplicableFor(!0);else if(generateDiscountApplicableFor(!1),null!=t.schedulePayments){$("#paymentScheduleDiv").show();var i=0,r=0;$.each(t.schedulePayments,(function(e,t){i+=1,singleIntallment(t.id,i,t.schedulePayDate,t.paymentTitle,t.payAmount,t.paymentLink,!0),r+=t.payAmount})),singleIntallment("","","","",r=parseFloat(r).toFixed(2),"",!1)}else generateSchedule();if("C"!=a.status){var d="showWarningMessageShow('Are you sure you want to save the payment details? Please note you will not be able to edit them once saved.','saveCustomPaymentPlan(\\'C\\')',false)";$("#saveNConfirm").html('<button class="btn btn-outline-success btn-sm" onClick="'+d+'">Save & Confirm</button>')}else{$(".card-body *").prop("disabled",!0);d="showWarningMessageShow('Are you sure you want to delete the custom payment details?','saveCustomPaymentPlan(\\'D\\')',false)";$("#saveNConfirm").html('<button class="btn btn-danger btn-sm" onClick="'+d+'">Delete custom payment</button>')}}},error:function(e){checkonlineOfflineStatus()||showMessageTheme2(0,e.responseText,"",!0)}})}function customPlanChange(){var e=$("#payableFee").val(),t=$("#planDiscountHidden").val(),a=$("#paymentModeHidden").val(),n=$("#customPaymentPlan").val();console.log("payableFee "+e),console.log("planDiscount "+t),console.log("paymentMode "+a),console.log("customPaymentPlan "+n),"c_annually"==n?"annyally"==a?$("#payableFee").val($("#payableFeeInstallment").val()):$("#payableFee").val($("#payableFeeAnnually").val()):"c_installment"==n&&("annyally"==a?$("#payableFee").val($("#payableFeeAnnually").val()):$("#payableFee").val($("#payableFeeInstallment").val())),calculatePremiumAmount()}function calculatePremiumAmount(){var e=$("#payableFee").val(),t=$("#premiumAmount").val();""==t?t=0:parseFloat(t)>parseFloat(e)&&(t=e);var a=parseFloat(100*t/e),n=parseFloat(e)+parseFloat(t);$("#payableFeeAfterPremium").val(parseFloat(n).toFixed(2)),$("#premiumAmount").val(t),$("#premiumPercentage").val(parseFloat(a).toFixed(2)+"%"),calculateDiscountAmount()}function premiumPercentageChange(){var e=$("#premiumPercentage").val(),t=$("#payableFee").val();""==e?e=0:parseFloat(e)>parseFloat(100)&&(e=100);var a=parseFloat(t*e*.01);$("#premiumAmount").val(a.toFixed(2));var n=parseFloat(t)+parseFloat(a);$("#payableFeeAfterPremium").val(parseFloat(n).toFixed(2)),$("#premiumPercentage").val(parseFloat(e).toFixed(2))}function calculateDiscountAmount(){var e=$("#payableFeeAfterPremium").val(),t=$("#discountAmount").val();""==t?t=0:parseFloat(t)>parseFloat(e)&&(t=e);var a=parseFloat(100*t/e),n=e-t;$("#payableFeeAfterDiscount").val(parseFloat(n).toFixed(2)),$("#discountAmount").val(t),$("#discountPercentage").val(parseFloat(a).toFixed(2)+"%"),firstIntallmentFlatChange()}function discountercentageChange(){var e=$("#discountPercentage").val(),t=$("#payableFeeAfterPremium").val();""==e?e=0:parseFloat(e)>parseFloat(100)&&(e=100);var a=parseFloat(t*e*.01),n=parseFloat(t)-parseFloat(a);$("#payableFeeAfterDiscount").val(parseFloat(n).toFixed(2)),$("#discountAmount").val(parseFloat(a).toFixed(2)),$("#discountPercentage").val(parseFloat(e).toFixed(2))}function firstIntallmentFlatChange(){var e=$("#firstInstallment").val(),t=$("#payableFeeAfterDiscount").val(),a=$("#firstInstallmentHidden").val();""==e||parseFloat(e)<parseFloat(a)?(e=a,$("#firstInstallment").val(e)):parseFloat(e)>parseFloat(t)&&(e=t,$("#firstInstallment").val(e));var n=parseFloat(t)-parseFloat(e);$("#remainingPayableFee").val(parseFloat(n).toFixed(2));var l=parseFloat(100*e/t);$("#firstInstallmentPercentage").val(parseFloat(l).toFixed(2)+"%"),generateInstallments()}function firstIntallmentPercentageChange(){var e=$("#firstInstallmentPercentage").val(),t=$("#payableFeeAfterDiscount").val(),a=parseFloat(t*e*.01);$("#firstInstallment").val(a.toFixed(2));var n=parseFloat(t)-parseFloat(a);$("#remainingPayableFee").val(parseFloat(n).toFixed(2))}function generateInstallments(){generateInstallmentsWithinDuration(),generateDiscountApplicableFor(!0)}function generateInstallmentsWithinDuration(){var e=$("#noOfInstallment").val(),t=1;if(1==e);else{var a=$("#durationWithin").val();t=parseFloat(30*a/e).toFixed(0)}$("#gapBetweenTwoIntstallment").val(t)}function generateDiscountApplicableFor(e){var t=$("#noOfInstallment").val(),a='<option value="D">Distribute on all remaining installment</option>';for(startIndex=2;startIndex<=t;startIndex++)1==startIndex?a+='<option value="1">1st Installment</option>':2==startIndex?a+='<option value="2">2nd Installment</option>':3==startIndex?a+='<option value="3">3rd Installment</option>':4==startIndex?a+='<option value="4">4th Installment</option>':5==startIndex?a+='<option value="5">5th Installment</option>':6==startIndex?a+='<option value="6">6th Installment</option>':7==startIndex?a+='<option value="7">7th Installment</option>':8==startIndex?a+='<option value="8">8th Installment</option>':9==startIndex?a+='<option value="9">9th Installment</option>':10==startIndex&&(a+='<option value="10">10th Installment</option>');$("#discountApplicableFor").html(a),e&&generateSchedule()}function generateSchedule(){$("#paymentScheduleDiv").show(),$("#paymentScheduleTable tbody").html("");var e=$("#noOfInstallment").val()-1,t=$("#gapBetweenTwoIntstallment").val(),a=$("#durationWithin").val(),n=getDateInDateFormat($("#tentativeFirstPayDate").val()),l=$("#payableFeeAfterPremium").val(),o=$("#firstInstallment").val(),s=parseFloat(l)-parseFloat(o),i=$("#discountAmount").val(),r=($("#payableFeeAfterDiscount").val(),$("#discountApplicableFor").val()),d=0,u=0;u="D"==r?parseFloat(s)-parseFloat(i):parseFloat(s),d=parseFloat(u/e);var p=0;for(index=1;index<=e+1;index++){var c="";1==index?(c+=parseFloat(o).toFixed(2),p+=parseFloat(o)):(n.setDate(parseInt(n.getDate())+parseInt(t)),"D"==r?(c+=d.toFixed(2),p+=parseFloat(d)):r==index?(c+=(d-i).toFixed(2),p+=parseFloat(d-i)):(c+=d.toFixed(2),p+=parseFloat(d))),singleIntallment(index,index,changeDateFormat(n,"MMM-dd-yyyy"),getPaymentTitleCalculation(index,a),c,"",!0)}singleIntallment("","","","",p=parseFloat(p).toFixed(2),"",!1)}function getPaymentTitleCalculation(e,t){var a="Course Fee";null!=$("#forGradeId option:selected").text()&&null!=$("#forGradeId option:selected").text()&&""!=$("#forGradeId option:selected").text()&&(a=$("#forGradeId option:selected").text());var n=$(".studentDetails").text();if(null!=n&&null!=n&&""!=n){a=n.split("|")[1]}return 1==$("#noOfInstallment").val()?a+" - One Time Payment":1==e?a+" - 1<sup>st</sup> of "+t+" Months Installment":2==e?a+" - 2<sup>nd</sup> of "+t+" Months Installment":3==e?a+" - 3<sup>rd</sup> of "+t+" Months Installment":4==e?a+" - 4<sup>th</sup> of "+t+" Months Installment":5==e?a+" - 5<sup>th</sup> of "+t+" Months Installment":6==e?a+" - 6<sup>th</sup> of "+t+" Months Installment":7==e?a+" - 7<sup>th</sup> of "+t+" Months Installment":8==e?a+" - 8<sup>th</sup> of "+t+" Months Installment":9==e?a+" - 9<sup>th</sup> of "+t+" Months Installment":10==e?a+" - 10<sup>th</sup> of "+t+" Months Installment":void 0}function singleIntallment(e,t,a,n,l,o,s){var i='<tr><td class="text-center" id="updid'+e+'">'+t+"</td>";i+=s?'<td class="text-center schedulePayDate" style="max-width:96px"><input type="text" placeholder="Please select schedule date" class="paymentScheduleDate" value="'+a+'" style="max-width:96px"/></td>':'<td class="text-center schedulePayDate">&nbsp;</td>',i+=s?'<td class="text-center paymentTitle" >'+n+"</td>":'<td class="text-right paymentTitle" >Calculated Course Fee</td>',i+=s?'<td class="text-right scheduleFeeInput" style="max-width:100px"><span class="d-flex align-items-center">'+currency+'<input type="text" class="text-right ml-1 installmentValue" id="'+e+'-installmentValue" value="'+l+'" style="max-width:80px" onblur="totalInstallmentAmount(\'paymentScheduleTable\',\'totalFeeAlternate\')"/><span></td>':""==e?'<td class="text-right scheduleFee">'+currency+'<span id="totalFeeAlternate">'+l+"</span></td>":'<td class="text-right scheduleFee">'+currency+"<span>"+l+"</span></td>",s?(i+='<td class="text-center" id="paymentLink'+t+'">',i+=null!=o&&""!=o?'<span><input type="text" id="paymentCopyLink'+t+'" style="float:right; opacity:0; height:0;padding:0;" value="'+o+'"><a href="javascript:void(0)" class="btn btn-primary btn-sm" onclick="copyToClipboard(\'paymentCopyLink'+t+'\')"><i class="fa fa-clone" aria-hidden="true">Copy Payment Link</i></a></span>':"NA"):i+='<td class="text-center">&nbsp;</td>',i+="</tr>",$("#paymentScheduleTable tbody").append(i),$(".paymentScheduleDate").datepicker({startDate:new Date,format:"M d, yyyy",todayHighlight:!0})}function totalInstallmentAmount(e,t){var a=0;$("#"+e+" tbody tr td.scheduleFeeInput .installmentValue").each((function(){a=parseFloat(parseFloat(a)+parseFloat($(this).val())).toFixed(2)})),$("#"+e+" #"+t).text(a);var n=$("#paymentMode").val();"a_annually"==n||"a_installment"==n&&$(".ad_installment1").html(currency+getNumberWithPrecision($("#ad_installment1").val(),2))}function generatePercentage(e,t,a,n){var l='<option value="0.00">Select</option>';for(index=t;a>=index;)l+='<option value="'+index.toFixed(2)+'">'+(100*index).toFixed(0)+"%</option>",index+=parseFloat(n);$("#"+e).html(l)}function saveCustomPaymentPlan(e){if("D"==e);else{var t=$("#totalFeeAlternate").text();if(parseFloat(t)!=parseFloat($("#payableFeeAfterDiscount").val()))return showMessageTheme2(0,"Please note the Calculated Course Fee and the Net Payable Fee do not match"),!1}customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","custom-fee-calculation-save/"),data:JSON.stringify(getRequestForSaveCustomPaymentPlan(e)),dataType:"json",global:!1,success:function(t){customLoader(!1),"0"==t.status||"2"==t.status||"3"==t.status?"3"==t.status?redirectLoginPage():showMessageTheme2(0,t.message,"",!0):(setCopyPaymentLink(t.paymentLinks),showMessageTheme2(1,t.message,"",!0),"C"==e?$(".card-body *").prop("disabled",!0):"D"==e&&($("#saveNConfirm").html(""),setTimeout((function(){window.location.reload()}),2e3)))},error:function(e){checkonlineOfflineStatus()||showMessageTheme2(0,e.responseText,"",!0)}})}function setCopyPaymentLink(e){if(null!=e&&e.length>0)for(i=0;i<e.length;i++)$("#paymentLink"+(i+1)).html('<span><input type="text" id="paymentCopyLink'+(i+1)+'" style="float:right; opacity:0; height:0;padding:0;" value="'+e[i]+'"><a href="javascript:void(0)" class="btn btn-primary btn-sm" onclick="copyToClipboard(\'paymentCopyLink'+(i+1)+'\')"><i class="fa fa-clone" aria-hidden="true">Copy Payment Link</i></a></span>')}function getRequestForSaveCustomPaymentPlan(e){var t={},a={};a.Id=$("#customePlanId").val(),a.schoolId=SCHOOL_ID,a.studentStandardId=$("#studentStandardId").val(),a.payableFee=$("#payableFee").val(),a.firstPaymentType=$("#firstPaymentType").val(),a.firstPaymentPercentage=$("#firstInstallmentPercentage").val().replace("%",""),a.firstPaymentAmount=$("#firstInstallment").val(),a.remainingAmount=$("#remainingPayableFee").val(),a.premiumType=$("#premiumType").val(),a.premiumPercentage=$("#premiumPercentage").val().replace("%",""),a.premiumAmount=$("#premiumAmount").val(),a.payableFeeAfterPremium=$("#payableFeeAfterPremium").val(),a.discountType=$("#discountType").val(),a.discountPercentage=$("#discountPercentage").val().replace("%",""),a.discountAmount=$("#discountAmount").val(),a.payableAmountAfterDiscount=$("#payableFeeAfterDiscount").val(),a.noOfInstallment=$("#noOfInstallment").val(),a.durationWithin=$("#durationWithin").val(),a.gapBetweenTwoIntstallment=$("#gapBetweenTwoIntstallment").val(),a.tentativeFirstPayDate=$("#tentativeFirstPayDate").val(),a.discountApplicableFor=$("#discountApplicableFor").val();var n=[];$("#paymentScheduleTable tbody tr").each((function(){if(null!=$(this).find(".paymentScheduleDate").val()&&""!=$(this).find(".paymentScheduleDate").val()&&"updid"!=$(this).find("td:first-child").attr("id")){var e={};null!=$(this).attr("#id")&&(e.id=$(this).find("td:first-child").attr("id")),e.schedulePayDate=$(this).find(".paymentScheduleDate").val(),e.paymentTitle=$(this).find(".paymentTitle").html(),e.payAmount=$(this).find(".installmentValue").val(),n.push(e)}})),n.length>1?a.customPlanNamme="c_installment":a.customPlanNamme="c_annually";var l={};return l.uniqueId=UNIQUEUUID,l.status=e,l.studentStandardId=$("#studentStandardId").val(),l.saveCustomPlan=a,l.schedulePayments=n,t.request=l,t}function applyGradeFee(e,t){var a=$(e).val();if(console.log("learningProgram =>"+a),"LP"==t)if("ONE_TO_ONE_FLEX"==a||"DUAL_DIPLOMA"==a?$("#courseFee").removeAttr("disabled"):$("#courseFee").attr("disabled","disabled"),"ONE_TO_ONE_FLEX"==a)actualGrades=["13","14","15","16","17"],$("#forGradeId").html(getGrades(getGradesData(actualGrades)));else{actualGrades=[];var n=$("#forGradeIdHidden").val();"DUAL_DIPLOMA"==a?(n>=10&&actualGrades.push(n-1),actualGrades.push(n)):"ONE_TO_ONE_FLEX"==$("#currentLearningProgramHidden").val()?19==n?actualGrades=[1,2,3,4,5,6,7,8,9,10,11,12]:9==n?actualGrades=[6,7,8,9,10,11,12]:10!=n&&21!=n&&22!=n||(actualGrades=[9,10,11,12]):(actualGrades.push(n-1),actualGrades.push(n)),$("#forGradeId").html(getGrades(getGradesData(actualGrades))),$("#forGradeId option").filter((function(){return $(this).text()=="Grade "+n})).prop("selected",!0)}var l=getGradeFeeDetails();$("#paymentMode").val("a_annually");var o=l.standardFee;if(null!=o){var s=parseFloat(o.annualFee+o.registrationFee+o.additionalFee);$("#courseFee").val(getNumberWithPrecision(s,2)),$("#planDiscount").val(getNumberWithPrecision(o.annualDiscount,2)),"SCHOLARSHIP"==$("#learningProgram").val()||"SSP"==$("#learningProgram").val()?$("#progressionDiscount").val("0.00"):$("#progressionDiscount").val(getNumberWithPrecision(o.progressionDiscount,2));var i=$("#paymentMode").find(":selected").attr("alreadyPaid");$("#alreadyPaid").val(getNumberWithPrecision(i,2)),$("#paymentMode").html(getPaymentOptionDetails(o.annualDiscount,i))}else $("#courseFee").val("0.00"),$("#transactionCharge").val("0.00"),$("#progressionDiscount").val("0.00"),$("#planDiscount").val("0.00"),$("#additionalDiscount").val("0.00"),$("#alreadyPaid").val("0.00");$("#creditLimitId").html("Course Fee"),$("#courseFee").attr("placeholder","Course Fee"),calculatePayableAdvanceFee(),getAdvanceFeeDetailsContent()}function getRequestForGradeFees(){var e={};e.schoolId=SCHOOL_ID,e.gradeId=$("#forGradeId").val(),e.learningProgram=$("#learningProgram").val();var t=37;"BATCH"==$("#learningProgram").val()?t=38:"SCHOLARSHIP"!=$("#learningProgram").val()&&"SSP"!=$("#learningProgram").val()||(t=$("#forGradeId").val()>=11&&$("#forGradeId").val()>=17?37:40),e.courseProviderId=t;var a={};return a.request=e,a}function getGradeFeeDetails(){var e={};return customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","standard-fee/"),data:JSON.stringify(getRequestForGradeFees()),dataType:"json",global:!1,async:!1,success:function(t){customLoader(!1),"0"==t.status||"2"==t.status||"3"==t.status?"3"==t.status?redirectLoginPage():"E002"==t.statusCode?($("#eligible").hide(),$("#notEligible").show(),$(".studentDetails").html(t.message)):($("#eligible").show(),$("#notEligible").hide(),showMessageTheme2(0,t.message,"",!0)):e=t},error:function(e){checkonlineOfflineStatus()||showMessageTheme2(0,e.responseText,"",!0)}}),e}function getRequestForAdvancePaymentDetails(e){var t={};return t.uniqueId=UNIQUEUUID,t.studentStandardId=e,t}function getAdvancePaymentDetails(e){var t={};return customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","advance-fee-calculation-process/"),data:JSON.stringify(getRequestForAdvancePaymentDetails(e)),dataType:"json",global:!1,async:!1,success:function(e){customLoader(!1),"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status?redirectLoginPage():"E002"==e.statusCode?($("#eligible").hide(),$("#notEligible").show(),$(".studentDetails").html(e.message)):($("#eligible").show(),$("#notEligible").hide(),showMessageTheme2(0,e.message,"",!0)):t=e},error:function(e){checkonlineOfflineStatus()||showMessageTheme2(0,e.responseText,"",!0)}}),t}function getAdvanceFeeDetailsContent(){var e=$("#paymentMode").val(),t=$("#paymentMode").find(":selected").attr("planDiscount"),a=$("#paymentMode").find(":selected").attr("alreadyPaid");$("#planDiscount").val(getNumberWithPrecision(t,2)),$("#alreadyPaid").val(getNumberWithPrecision(a,2)),calculatePayableAdvanceFee(),getAdvanceFeeDetailsContentDetails(e,"")}function getAdvanceFeeDetailsContentDetails(e,t){$("#oneTimeFeeContentDiv, #installmentFeeContentDiv, #partialFeeContentDiv").addClass("d-none"),"a_annually"==e?$("#oneTimeFeeContentDiv").removeClass("d-none"):"a_installment"==e?$("#installmentFeeContentDiv").removeClass("d-none"):"a_partially"==e&&$("#partialFeeContentDiv").removeClass("d-none"),recalculateAccourdingToSelectedPlan(e,t)}function recalculateAccourdingToSelectedPlan(e,t){"a_annually"==e?$("#oneTimeFeeContentDiv").html(getOnetimeFeeContent(t)):"a_installment"==e?$("#installmentFeeContentDiv").html(getIntallmentFeeContent(t)):"a_partially"==e&&($("#partialFeeContentDiv").html(getPartialFeeContent(t)),$("#paymentScheduleDiv").show(),$("#paymentScheduleTablePartial").show(),$("#noOfInstallment").html('<option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>'),$("#durationWithin").html('<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option>'),""!=t&&null!=t.schedulePayments&&($.each(t.schedulePayments,(function(e,t){0==e&&$("#firstInstallment").val(t.payAmount)})),$("#noOfInstallment").val(t.noOfInstallment),$("#durationWithin").val(t.durationWithin),$("#gapBetweenTwoIntstallment").val(t.gapBetweenTwoIntstallment),$("#discountApplicableFor").val(t.discountApplicableFor)),generateDiscountApplicableForAdv(!1));var a=new Date,n=new Date;a.setDate(n.getDate()-30),n.setDate(n.getDate()+180),$(".dataPicker").datepicker({startDate:a,endDate:n,format:"M d, yyyy",autoclose:!0,todayHighlight:!0}).on("changeDate",(function(e){generateScheduleAdv(t)})),""==t?$(".dataPicker").datepicker("setDate",new Date):$(".dataPicker").datepicker("setDate",t.firstScheduledDate),"a_annually"!=e&&"a_installment"!=e||($("#installment1").datepicker({startDate:a,endDate:n,format:"M d, yyyy",autoclose:!0,todayHighlight:!0}).on("changeDate",(function(){"C"!=t.advanceFeeStatus&&generateTentativeScheduleDate(e)})),$("#installment2, #installment3").datepicker({startDate:a,endDate:n,format:"M d, yyyy",autoclose:!0,todayHighlight:!0})),"a_annually"==e||("a_installment"==e?"C"!=t.advanceFeeStatus&&generateTentativeScheduleDate(e):"a_partially"==e&&""==t&&generateInstallmentsAdv())}function generateTentativeScheduleDate(e){var t=$("#installment1").val();if("a_installment"==e){var a=new Date(t);a.setDate(a.getDate()+31);var n=new Date(t);n.setDate(n.getDate()+61),$("#installment2").datepicker("setDate",changeDateFormat(a,"MMM-dd-yyyy")),$("#installment3").datepicker("setDate",changeDateFormat(n,"MMM-dd-yyyy"))}}function calculatePayableAdvanceFee(){var e=getVauleAsNumber("courseFee"),t=getVauleAsNumber("transactionCharge"),a=getVauleAsNumber("progressionDiscount"),n=getVauleAsNumber("planDiscount"),l=0,o=getVauleAsNumber("alreadyPaid"),s=parseFloat(e)+parseFloat(t)-parseFloat(a)-parseFloat(n)-parseFloat(l)-parseFloat(o);parseFloat(getVauleAsNumber("additionalDiscount"))>=parseFloat(s)?$("#payableFee").html("<b>0.00</b>"):$("#payableFee").html("<b>"+getNumberWithPrecision(parseFloat(s)-parseFloat(getVauleAsNumber("additionalDiscount")),2)+"</b>"),$("#payableFee").attr("payableFee-data",s);var i=$("#paymentMode").val();if("a_annually"==i)s=(l=getVauleAsNumber("additionalDiscount"))<=s?parseFloat(s)-parseFloat(l):0,$(".installment1, .scheduleFee").val(getNumberWithPrecision(s,2)),$("#ad_installment1").val(getNumberWithPrecision(s,2)),$(".ad_installment1").html(currency+getNumberWithPrecision(s,2));else if("a_installment"==i){s=parseFloat($("#payableFee").attr("payableFee-data"));var r=.4*parseFloat(s),d=.3*parseFloat(s),u=.3*parseFloat(s);(l=getVauleAsNumber("additionalDiscount"))>0&&(l<=u?u=parseFloat(u)-parseFloat(l):(l=parseFloat(l)-parseFloat(u))<=d?(d=parseFloat(d)-parseFloat(l),u=0):(l=parseFloat(l)-parseFloat(d)-parseFloat(u))<=r?(r=parseFloat(r)-parseFloat(l),d=0,u=0):(r=0,d=0,u=0)),r=getNumberWithPrecision(r,2),d=getNumberWithPrecision(d,2),u=getNumberWithPrecision(u,2),$("#ad_installment1").val(r),$("#ad_installment2").val(d),$("#ad_installment3").val(u),$(".ad_installment1").html(currency+r),$("#installmentFinalPaybleFee").html($("#payableFee").text())}else"a_partially"==i&&generateInstallmentsAdv();firstIntallmentFlatChangeAdv()}function saveAdvanceFeeDetails(e){"D"==e&&$(".card-body *").prop("disabled",!1);var t=$("#paymentMode").val();if("a_annually"==t?totalAmount=$("#payableFee").text():"a_installment"==t?totalAmount=$("#installmentFinalPaybleFee").html():"a_partially"==t&&(totalAmount=$("#ad_partially_fee").html()),"D"==e&&$(".card-body *").prop("disabled",!0),"S"!=e&&"C"!=e||parseFloat(totalAmount)==parseFloat($("#payableFee b").text())){var a=$("#paymentMode").val();0!=parseFloat($("#firstInstallment").val())||"a_partially"!=a?(customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","advance-fee-calculation-save/"),data:JSON.stringify(getRequestForSaveAdvanceFeeDetails(e)),dataType:"json",global:!1,success:function(t){"0"==t.status||"2"==t.status||"3"==t.status?"3"==t.status?redirectLoginPage():showMessageTheme2(0,t.message,"",!0):(showMessageTheme2(1,t.message,"",!0),"C"==e?setTimeout((function(){window.location.reload(),customLoader(!1)}),3e3):"D"==e?($("#saveNConfirm").html(""),setTimeout((function(){window.location.reload(),customLoader(!1)}),2e3)):customLoader(!1))},error:function(e){checkonlineOfflineStatus()||showMessageTheme2(0,e.responseText,"",!0)}})):showMessageTheme2(2,"1st Installment Fee amount can not be zero.")}else showMessageTheme2(0,"Please note the Calculated Course Fee and the Net Payable Fee do not match")}function getRequestForSaveAdvanceFeeDetails(e){"D"!=e&&"C"!=e||$(".card-body *").prop("disabled",!1);var t={},a={};a.schoolId=SCHOOL_ID,a.studentStandardId=$("#studentDetailsId").attr("studentstandardid"),a.learningProgram=$("#learningProgram").val(),a.registrationType="REGISTRATION_NEXT_GRADE",a.paymentMode=$("#paymentMode").val(),a.forGradeId=$("#forGradeId").val(),a.courseFee=$("#courseFee").val(),a.transactionCharge=$("#transactionCharge").val(),a.progressionDiscount=$("#progressionDiscount").val(),a.planDiscount=$("#planDiscount").val(),a.additionalDiscount=$("#additionalDiscount").val(),a.alreadyPaid=$("#alreadyPaid").val(),a.payableFee=$("#payableFee").attr("payableFee-data");var n={},l=[],o="";if("a_annually"==$("#paymentMode").val())o="paymentScheduleTableOnetime";else if("a_installment"==$("#paymentMode").val())o="paymentScheduleTableInstallment";else if("a_partially"==$("#paymentMode").val()){o="paymentScheduleTablePartial";var s={};s.noOfInstallment=$("#noOfInstallment").val(),s.durationWithin=$("#durationWithin").val(),s.gapBetweenTwoIntstallment=$("#gapBetweenTwoIntstallment").val(),s.tentativeFirstPayDate=$("#tentativeFirstPayDate").val(),s.discountApplicableFor=$("#discountApplicableFor").val(),n.saveAdvanceFeePartial=s}return $("#"+o+" tbody tr").each((function(){if(null!=$(this).find(".schedulePayDate").val()&&""!=$(this).find(".schedulePayDate").val()){var e={};null!=$(this).find(".id").attr("updid")&&(e.id=$(this).find(".id").attr("updid")),e.schedulePayDate=$(this).find(".schedulePayDate").val(),e.paymentTitle=$(this).find(".paymentTitle").html(),e.payAmount=$(this).find(".installmentValue").val(),l.push(e)}})),n.id=$("#advanceFeeId").val(),n.uniqueId=UNIQUEUUID,n.studentStandardId=$("#studentDetailsId").attr("studentstandardid"),n.status=e,n.saveAdvanceFee=a,n.schedulePayments=l,$(".card-body *:not(.card-body .btn)").prop("disabled",!0),t.request=n,t}function firstIntallmentFlatChangeAdv(){var e=$("#firstInstallment").val(),t=$("#payableFee").attr("payableFee-data"),a=$("#firstInstallmentHidden").val();""==e||parseFloat(e)<parseFloat(a)?(e=a,$("#firstInstallment").val(e)):parseFloat(e)>parseFloat(t)&&(e=t,$("#firstInstallment").val(e));var n=parseFloat(t)-parseFloat(e);$("#remainingPayableFee").val(parseFloat(n).toFixed(2));parseFloat(100*e/t);generateInstallmentsAdv()}function generateInstallmentsAdv(){generateInstallmentsWithinDurationAdv(),generateDiscountApplicableForAdv(!0)}function generateInstallmentsWithinDurationAdv(){var e=$("#noOfInstallment").val(),t=1;if(1==e);else{var a=$("#durationWithin").val();t=parseFloat(30*a/e).toFixed(0)}$("#gapBetweenTwoIntstallment").val(t)}function generateDiscountApplicableForAdv(e){var t=$("#noOfInstallment").val(),a='<option value="D">Distribute on all remaining installment</option>';for(startIndex=2;startIndex<=t;startIndex++)1==startIndex?a+='<option value="1">1st Installment</option>':2==startIndex?a+='<option value="2">2nd Installment</option>':3==startIndex?a+='<option value="3">3rd Installment</option>':4==startIndex?a+='<option value="4">4th Installment</option>':5==startIndex?a+='<option value="5">5th Installment</option>':6==startIndex?a+='<option value="6">6th Installment</option>':7==startIndex?a+='<option value="7">7th Installment</option>':8==startIndex?a+='<option value="8">8th Installment</option>':9==startIndex?a+='<option value="9">9th Installment</option>':10==startIndex&&(a+='<option value="10">10th Installment</option>');$("#discountApplicableFor").html(a),e&&generateScheduleAdv()}function generateScheduleAdv(e){if("a_partially"==$("#paymentMode").val()){$("#paymentScheduleDiv").show(),$("#paymentScheduleTablePartial").show(),$("#paymentScheduleTablePartial tbody").html("");var t=$("#noOfInstallment").val()-1,a=$("#gapBetweenTwoIntstallment").val(),n=$("#durationWithin").val(),l=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),o=getDateInDateFormat(l),s=$("#payableFee").attr("payableFee-data"),i=$("#firstInstallment").val(),r=parseFloat(s)-parseFloat(i);if(""==$("#additionalDiscount").val())var d=0;else d=$("#additionalDiscount").val();var u=$("#discountApplicableFor").val(),p=0,c=0;c="D"==u?d>=r?0:parseFloat(r)-parseFloat(d):parseFloat(r),p=parseFloat(c/t);var m=0;for(index=1;index<=t+1;index++){var v="";1==index?(v+=parseFloat(i).toFixed(2),m+=parseFloat(i)):(o.setDate(parseInt(o.getDate())+parseInt(a)),"D"==u?(v+=p.toFixed(2),m+=parseFloat(p)):u==index?(d>=p?v=0:v+=(p-d).toFixed(2),m+=parseFloat(p-d)):(v+=p.toFixed(2),m+=parseFloat(p))),null!=e&&null!=e.schedulePayments?singleIntallmentAdv(index,index,changeDateFormat(o,"MMM-dd-yyyy"),getPaymentTitleCalculation(index,n),v,e.schedulePayments[index-1].paymentLink,!0):singleIntallmentAdv(index,index,changeDateFormat(o,"MMM-dd-yyyy"),getPaymentTitleCalculation(index,n),v,"",!0)}singleIntallmentAdv("","","","",m=parseFloat(m).toFixed(2),"",!1)}}function singleIntallmentAdv(e,t,a,n,l,o,s){var i='<tr id="updid'+e+'"><td class="text-center">'+t+"</td>";i+=""!=a?'<td class="text-center"><input class="form-control dataPicker schedulePayDate" text="text" id="dataPicker'+t+'"/></td>':'<td class="text-center"></td>',i+=""!=n?'<td class="paymentTitle">'+n+" - Advance</td>":'<td class="text-right"><b>Final Payable Fee</b></td>',i+=s?'<td class="text-right scheduleFeeInput" style="max-width:100px"><span class="d-flex align-items-center">'+currency+'<input type="text" class="text-right ml-1 installmentValue" id="'+e+'-ad-installmentValue" value="'+l+'" style="max-width:80px" onblur="totalInstallmentAmount(\'paymentScheduleTablePartial\',\'ad_partially_fee\')"/></span></td>':'<td class="text-right scheduleFee">'+currency+'<span id="ad_partially_fee">'+l+"</span></td>",i+=s?'<td class="text-right">'+a+"</td>":"<td>"+a+"</td>",i+=s?o?'<td class="text-center" id="paymentLink'+t+'"><span><input type="text" id="paymentCopyLink'+t+'" style="float:right; opacity:0; height:0;padding:0;" value="'+o+'"><a href="javascript:void(0)" class="btn btn-primary btn-sm" onclick="copyToClipboard(\'paymentCopyLink'+t+'\')"><i class="fa fa-clone" aria-hidden="true">Copy Payment Link</i></a></span></td>':'<td class="text-center" id="paymentLink"'+t+">NA</td>":'<td class="text-center" id="paymentLink"'+t+">&nbsp;</td>",i+="</tr>",$("#paymentScheduleTablePartial tbody").append(i),$("#dataPicker"+t).datepicker({format:"M d, yyyy",autoclose:!0,todayHighlight:!0});var r=new Date(a);if($("#dataPicker"+t).datepicker("setDate",r),""!=a){var d='<tr><td class="installment"></td><td class="text-right scheduleFee" >'+l+"</td>";d+=1==t?'<td class="text-right">'+l+"</td>":"<td>&nbsp;</td>",d+="</tr>",$("#paymentInstallmentTable tbody").append(d);var u=["st","nd","rd","th"];$(".installment").each((function(e){var t=e+1,a=(t-1)%10<4?(t-1)%10:3;$(this).text(t+u[a]+" Installment")}))}}5==SCHOOL_ID&&(currency="R ");