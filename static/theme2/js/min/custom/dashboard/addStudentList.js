function validateRequestForAddStudent(e){if(!validateFormAscii(e))return showMessage(!1,"Please use the English Keyboard while providing information"),!1;if(!validateFormAscii("tbl_gen_marks_pre tbody tr"))return showMessage(!1,"Please use the English Keyboard while providing information"),!1;if(""==$("#"+e+" #studentFirstName").val()||null==$("#"+e+" #studentFirstName").val())return showMessage(!1,"Student Name is required"),!1;if(""==$("#"+e+" #fatherFirstName").val()||null==$("#"+e+" #fatherFirstName").val())return showMessage(!1,"Father Name is required"),!1;if(""==$("#"+e+" #fatherLastName").val()||null==$("#"+e+" #fatherLastName").val())return showMessage(!1,"Father Last Name is required"),!1;if(""==$("#"+e+" #motherFirstName").val()||null==$("#"+e+" #motherFirstName").val())return showMessage(!1,"Mother Name is required"),!1;if(""==$("#"+e+" #motherLastName").val()||null==$("#"+e+" #motherLastName").val())return showMessage(!1,"Mother Last Name is required"),!1;if("0"==$("#"+e+" #gender").val()||null==$("#"+e+" #gender").val())return showMessage(!1,"Gender is required"),!1;if(""==$("#"+e+" #dob").val()||null==$("#"+e+" #dob").val())return showMessage(!1,"DOB is required"),!1;if(0==$("#currentGrade option:selected").index())return showMessage(!1,"Grade must be selected"),!1;var a=$("#fileupload1").parent("span").parent("p").parent("div").find("span.fileName").html();return""==a||null==a||-1!=$.inArray($.trim(a.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg"])||(showMessage(!0,"Please upload Student Passport Size Photo in following formats (jpg, jpeg or png)."),!1)}function callForAddStudentDetails(e){if(console.log("validateDuplicateSubjects: "+validateDuplicateSubjects()),!validateDuplicateSubjects())return customLoader(!1),!1;hideMessage(""),$.ajax({type:"POST",url:getURLForHTML("dashboard","save-student-details"),data:encodeURI("request="+JSON.stringify(getRequestForAddStudentDetails(e))),dataType:"html",cache:!1,timeout:6e5,success:function(e){if(""!=e){var a;if(a=e.split("|"),console.log("stringMessage: "+a),"FAILED"==a[0]||"EXCEPTION"==a[0]||"SESSIONOUT"==a[0])showMessage(!0,a[1]);else{showMessage(!0,a[1]),$("#form-modal").modal("hide"),$("#studentFirstName").val(""),$("#studentMiddleName").val(""),$("#studentLastName").val(""),$("#fatherFirstName").val(""),$("#fatherMiddleName").val(""),$("#fatherLastName").val(""),$("#motherFirstName").val(""),$("#motherMiddleName").val(""),$("#motherLastName").val(""),$("#gender").val("0"),$("#disablityTypes").val(""),$("#currentGrade").val("0"),$("#disablityTypes").hide(),$("#subHide").hide(),$("#passportPhoto").val(""),$("#dob").val(""),$("#fileupload1").parents(".file-tab").find("span.fileName").text(""),$("#fileupload2").parents(".file-tab").find("span.fileName").text(""),$("#fileupload6").parents(".file-tab").find("span.fileName").text(""),$("#fileupload4").parents(".file-tab").find("span.fileName").text(""),$("#fileupload5").parents(".file-tab").find("span.fileName").text(""),$("#subject").hide("");var t=$("#dashboardFor").val();""!=t&&null!=t&&"SCHOOL_ADMIN"!=t?(setTimeout((function(){callDashboardPageSchoolB2B("3a")}),1e3),$("html, body").animate({scrollTop:$("#divStudentBucketList").offset().top-100},"slow")):setTimeout((function(){callDashboardPageSchool("21a1")}),1e3)}return!1}customLoader(!1)},error:function(e){return!1}})}function callForAddStudentModal(e){return customLoader(!0),validateRequestForAddStudent(e)&&validateCurrSubjectDetails()?validateMarks("tbl_gen_marks_pre")?($("#form-modal").modal({backdrop:"static",keyboard:!1}),void customLoader(!1)):(customLoader(!1),$("#callPreviousSubMarksModal").modal("show"),!1):(customLoader(!1),!1)}function getRequestForAddStudentDetails(e){var a,t={},s={},r={},i={};i.id=$("#studentId").val(),i.schoolId=$("#schoolId").val(),i.studentFirstName=escapeCharacters($("#"+e+" #studentFirstName").val()),i.studentMiddleName=escapeCharacters($("#"+e+" #studentMiddleName").val()),i.studentLastName=escapeCharacters($("#"+e+" #studentLastName").val()),i.fatherFirstName=escapeCharacters($("#"+e+" #fatherFirstName").val()),i.fatherMiddleName=escapeCharacters($("#"+e+" #fatherMiddleName").val()),i.fatherLastName=escapeCharacters($("#"+e+" #fatherLastName").val()),i.motherFirstName=escapeCharacters($("#"+e+" #motherFirstName").val()),i.motherMiddleName=escapeCharacters($("#"+e+" #motherMiddleName").val()),i.motherLastName=escapeCharacters($("#"+e+" #motherLastName").val()),i.gender=$("#"+e+" #gender").val(),""!=(a=$("#fileupload1").parent("span").parent("p").parent("div").find("span.fileName").html())&&null!=a&&(-1==$.inArray($.trim(a.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg"])?showMessage(!0,"Please upload Student Sign in following formats (jpg, jpeg or png)."):i.passportPhoto=a),""!=(a=$("#fileupload2").parent("span").parent("p").parent("div").find("span.fileName").html())&&null!=a&&(-1==$.inArray($.trim(a.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg","pdf"])||(i.birthCertificate=a)),""!=(a=$("#fileupload6").parent("span").parent("p").parent("div").find("span.fileName").html())&&null!=a&&(-1==$.inArray($.trim(a.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg","pdf"])||(i.addressProof=a)),""!=(a=$("#fileupload4").parent("span").parent("p").parent("div").find("span.fileName").html())&&null!=a&&(-1==$.inArray($.trim(a.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg","pdf"])||(i.immunizationCard=a)),""!=(a=$("#fileupload5").parent("span").parent("p").parent("div").find("span.fileName").html())&&null!=a&&(-1==$.inArray($.trim(a.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg","pdf"])||(i.academicProof=a)),i.currentGrade=$("#"+e+" #currentGrade").val(),i.currentSubjectId=calculateCurrentSubjects(),i.dob=$("#"+e+" #dob").val(),i.disablity=$("input[name='isDisablity']:checked").val(),i.disablityType=escapeCharacters($("#"+e+" #disablityType").val()),i.isFromSameSchool=$("input[name='isFromSameSchool']:checked").val();var n={};return n.studentPrevGenerateMarksDTO=calculatePreviousMarks(),i.prevQualificationData=JSON.stringify(n),r.addStudentListDTO=i,s.hash=getHash(),s.schoolId=SCHOOL_ID,s.schoolUUID=SCHOOL_UUID,s.userType="SCHOOL",s.userId=$("#"+e+" #userId").val(),t.authentication=s,t.requestData=r,t}function calculatePreviousMarks(){var e=[];return $("#tbl_gen_marks_pre tbody tr").each((function(){var a={};if($(this).find("select.subjectId option:selected").val()>0){a.practicalMarks=$(this).find("input.e_p_marks").val(),a.theoryMarks=$(this).find("input.e_t_marks").val(),a.marksCount=$(this).find("span.marks-count").text(),a.subjectId=$(this).find("select.subjectId option:selected").val(),a.subjectName=$(this).find("select.subjectId option:selected").attr("subNameAttr"),a.maxTheoryMarks=$(this).find("span.maxTheoryMarks").text(),a.theoryPassingMarks=$(this).find("span.theoryPassingMarks").text(),a.maxPracticalMarks=$(this).find("span.maxPracMarks").text(),a.practicalPassingMarks=$(this).find("span.pracPassigMarks").text();var t=$(this).find("input.sub_maxid").val();a.maxMarks=""!=t?parseInt(t):"0",a.grade=$(this).find("span.grade").text(),console.log("grade::: :"+a.grade),a.cumulativeGrade=escapeCharacters($(this).find("input.credit").val()),a.preSubResult=$(this).find("span.result").text()}e.push(a)})),e}function validateDuplicateSubjects(){var e=!0,a=[];$("#tbl_gen_marks_pre tbody tr").each((function(){var e;0!=(e=$(this).find("select.subjectId option:selected").val())&&a.push(e)})),console.log("sorted: "+a.sort());a.sort();for(var t=0;t<a.length-1;t++)if(a[t+1]==a[t])return showMessage(!0,"Two Subjects can not be same"),e=!1;return e}function callMandSubjects(e,a,t){if(hideMessage(""),!validateRequestForMaster(e,t))return $("#"+e+" #currentsubject11").val(0),resetDropdown($("#"+e+" #currentsubject11"),"Select course"),!1;$("#"+e+" #currentsubject11").prop("disabled",!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","COMP-SUBJECT-LIST-BY-GRADE",a,$("#schoolId").val())),dataType:"json",cache:!1,timeout:6e5,success:function(a){"0"==a.status||"2"==a.status?showMessage(!0,a.message):(console.log("mastersData "+a.mastersData.currentSub),$.each(a.mastersData.currentSub,(function(e,a){var t='<tr onclick="selectSubject(this, false);" id="'+a.key+'" class="block greenDiv"><td><strong>'+a.value+" - "+a.extra+'</strong></td><td style="text-align:center;"><i class="fa fa-check"></i></td></tr>';$("#mandatorySubjects tbody").append(t)})),$("#"+e+" #countAreaOfspecialization").text(a.mastersData.currentSub.length)),$("#currentsubject11").prop("disabled",!1)},error:function(e){$("#currentsubject11").prop("disabled",!1)}})}function callOptSubjects(e,a,t){if(hideMessage(""),!validateRequestForMaster(e,t))return $("#"+e+" #currentsubject11").val(0),resetDropdown($("#"+e+" #currentsubject11"),"Select course"),!1;$("#"+e+" #currentsubject11").prop("disabled",!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","OPTIONAL-SUBJECT-LIST-BY-GRADE",a,$("#schoolId").val())),dataType:"json",cache:!1,timeout:6e5,success:function(a){"0"==a.status||"2"==a.status?showMessage(!0,a.message):(console.log("mastersData "+a.mastersData.currentSub),$.each(a.mastersData.currentSub,(function(e,a){var t='<tr onclick="selectSubject(this, true);" id="'+a.key+'" class="block "><td><strong>'+a.value+" - "+a.extra+'</strong></td><td style="text-align:center;"><i class="fa fa-check"></i></td></tr>';$("#optionalSubjects tbody").append(t)})),$("#"+e+" #countAreaOfspecialization").text(a.mastersData.currentSub.length)),$("#currentsubject11").prop("disabled",!1)},error:function(e){showMessage(!0,e.responseText),$("#currentsubject11").prop("disabled",!1)}})}function callSubjectsByGrade(e,a,t){if(hideMessage(""),!validateRequestForMasterGrade(e,t))return $("#"+e+" #"+t).val(0),resetDropdown($("#"+e+" #"+t),"Select course"),!1;$("#"+e+" #prevSubject").prop("disabled",!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster(e,"PREVSUBJECT-LIST",a)),dataType:"json",cache:!1,timeout:6e5,success:function(a){"0"==a.status||"2"==a.status?showMessage(!0,a.message):(buildDropdown(a.mastersData.prevSub,$("#prevSubject"),"Select course"),$("#"+e+" #prevSubject").prop("disabled",!1)),$("#"+e+" #prevSubject").prop("disabled",!1)},error:function(a){$("#"+e+" #prevSubject").prop("disabled",!1)}})}function selectSubject(e,a){a&&($(e).hasClass("greenDiv")?$(e).removeClass("greenDiv"):$(e).addClass("greenDiv"))}$("#exampleRadios1").click((function(){$("#disablityTypes").show()})),$("#exampleRadios2").click((function(){$("#disablityTypes").hide()})),$("#isFromSameSchool1").click((function(){$("#isFromSameSchool").show()})),$("#isFromSameSchool2").click((function(){$("#isFromSameSchool").hide()}));var PRESERVE_AREA_OF_SPECIALIZATION="";function calculateCurrentSubjects(e){if(null==e||""==e);else if(null==$("#currentGrade").val()||0==$("#currentGrade").val()||""==$("#currentGrade").val())return"0";var a="",t=1;$("#mandatorySubjects tbody tr").each((function(){-1!=this.className.indexOf("greenDiv")&&(a=a+","+this.id,$("#totalSubjectSelected").text(t),t++)})),$("#optionalSubjects tbody tr").each((function(){-1!=this.className.indexOf("greenDiv")&&(a=a+","+this.id,$("#totalSubjectSelected").text(t),t++)}));var s=PRESERVE_AREA_OF_SPECIALIZATION;return $("#countAreaOfspecialization").text(a.substr(1).split(",").length),PRESERVE_AREA_OF_SPECIALIZATION=a.substr(1),""!=s&&s!=PRESERVE_AREA_OF_SPECIALIZATION&&(needToCallPreviousSubject=!0),PRESERVE_AREA_OF_SPECIALIZATION}function validateCurrSubjectDetails(){var e=!1;return $("#mandatorySubjects tbody tr").each((function(){console.log(),$(this).hasClass("greenDiv")&&(e=!0)})),e||(showMessage(!0,"Mandatory Subjects are required."),showCurrentSubject(!0)),e}function applyPassingRule(e,a){console.log("src.id "+e.id),console.log("applyPassingRule called");var t=$("#"+e.id+" option:selected").attr("pracMandAttr");1==t?($("#maxPracMarks-"+a).text($("#"+e.id+" option:selected").attr("maxpracmarks")),$("#pracPassigMarks-"+a).text($("#"+e.id+" option:selected").attr("maxpracmarks")),$("#practicalMarks-"+a).val(""),$("#practicalMarks-"+a).prop("disabled",!1)):($("#maxPracMarks-"+a).text("N/A"),$("#pracPassigMarks-"+a).text("N/A"),$("#practicalMarks-"+a).val(""),$("#practicalMarks-"+a).prop("disabled",!0)),$("#maximumMarks-"+a).text($("#"+e.id+" option:selected").attr("totalMarks")),$("#maxTheoryMarks-"+a).text($("#"+e.id+" option:selected").attr("maxTheoryMarks")),1==t&&$("#pracPassigMarks-"+a).text($("#"+e.id+" option:selected").attr("pracPassingMarks")),$("#theoryPassingMarks-"+a).text($("#"+e.id+" option:selected").attr("theoryPassingMarks")),$("#maximumMarks-"+a).val($("#"+e.id+" option:selected").attr("totalMarks")),0==(s=$(e).val())&&($("#maxTheoryMarks-"+a).text(""),$("#theoryPassingMarks-"+a).text(""),$("#theoryMarks-"+a).val(""),$("#practicalMarks-"+a).val(""),$("#pracPassigMarks-"+a).text(""),$("#practicalMarks-"+a).val(""),$("#maxPracMarks-"+a).text(""),$("#marksCount-"+a).text(""),$("#grade-"+a).text(""),$("#credits-"+a).val(""),$("#cumulativeGrade-"+a).val(""),$("#result-"+a).text(""));var s=$(e).val(),r=$("#schoolId").val();return console.log("subjectId: "+s+" schoolId: "+r),0==s||null==s?(showMessage(!0,"Please select course"),!1):(1==$("input[name='isFromSameSchool']:checked").val()||$(".sub_maxid").val("100"),!0)}function changeMarks(e,a){$("#cumulativeGrade-"+a).val("")}function calculatePassingRule(e,a){console.log("calculatePassingRule called");var t=!0;$("#tr-"+a).removeClass("tr-red");var s=$("#subjectId-"+a).val(),r=$("#subjectId-"+a+" option:selected").attr("pracMandAttr"),i=parseInt($("#maxTheoryMarks-"+a).text()),n=($("#theoryPassingMarks-"+a).text(),$("#theoryMarks-"+a).val()),l=$("#maxPracMarks-"+a).text(),o=($("#pracPassigMarks-"+a).text(),$("#practicalMarks-"+a).val()),d=(parseInt($("#maximumMarks-"+a).val()),$("#cumulativeGrade-"+a).val()),c=$("#grade-"+a).text(),u=$("#result-"+a).text();if(s>0&&(o>=0||n>=0)){if(n>0&&o>0&&(n=parseInt(n),o=parseInt(o)),n>i)return showMessage(!0,"Theory Marks can not be more than Max Theory Marks"),$("#tr-"+a).addClass("tr-red"),t=!1;if(1==r&&o>l)return showMessage(!0,"Practical Marks can not be more than Max Practical Marks"),$("#tr-"+a).addClass("tr-red"),t=!1;if(""==n)return showMessage(!0,"Theory Marks is required"),$("#tr-"+a).addClass("tr-red"),t=!1;if(1==r&&""==o)return showMessage(!0,"Practical Marks is required"),$("#tr-"+a).addClass("tr-red"),t=!1;if(""==d)return showMessage(!0,"Credit is required"),$("#tr-"+a).addClass("tr-red"),t=!1;var p=0;p=1==r?parseInt(n)+parseInt(o):n,$("#marksCount-"+a).text(p);c=getGradeNew(p,50);$("#grade-"+a).html(c);u=getResult(p,50);if($("#result-"+a).text(u),""!=c&&("NA"==c||"N/A"==c))return showMessage(!0,"Grade is not valid"),$("#tr-"+a).addClass("tr-red"),t=!1;if(""!=u&&("NA"==u||"N/A"==u))return showMessage(!0,"Result is not valid"),$("#tr-"+a).addClass("tr-red"),t=!1}return t}function validateMarks(e){console.log("validateMarks called");var a=[],t=!0,s=1,r=!0;return $("#"+e+" tbody tr").each((function(){$(this).removeClass("tr-red");var e=$(this).find("select.sub_id").val();e>0&&(0==$.inArray(e,a)?($("#tr-"+s).addClass("tr-red"),t=!1):a.push(e));if(t){var i=calculatePassingRule(this,s);console.log("ruleStatus :: "+i),i||r&&(r=!1)}s++})),0==a.length?(showMessage(!0,"Subjects is required"),!1):t?(r&&$("#callPreviousSubMarksModal").modal("hide"),r?t:r):(showMessage(!0,"Two Subjects cannot be same"),!1)}function getGradeNew(e,a){var t="N/A";return console.log("GRADE_CAL_RULE: "+GRADE_CAL_RULE),$.each(GRADE_CAL_RULE,(function(a,s){parseInt(s.minMark)<=e&&parseInt(s.maxMark)>=e&&(t=s.grade)})),t}function getResult(e,a){var t="N/A";return $.each(GRADE_CAL_RULE,(function(a,s){parseInt(s.minMark)<=e&&parseInt(s.maxMark)>=e&&(t=s.result)})),t}function getCurrentSubjectMarks(e,a,t){hideMessage(""),$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","GET_CURRENT_SUBJECT_MARKS_BY_SUBJECT_ID",a,$("#schoolId").val())),dataType:"json",cache:!1,timeout:6e5,success:function(e){"0"==e.status||"2"==e.status?showMessage(!0,e.message):(console.log("mastersData "+e.mastersData.currentSubjectMarks.value),$("#tbl_gen_marks_pre tbody tr").each((function(){$(this).find("select.subjectId").val()==a&&$(this).find("input.sub_maxid").val(e.mastersData.currentSubjectMarks.value)})),$("#currentSubMarkstbl tbody tr").each((function(){$(this).find("select.subjectId").val()==a&&$(this).find("input.sub_maxid").val(e.mastersData.currentSubjectMarks.value)})))},error:function(e){}})}function removeDocument(e,a){console.log(e),1==a||2==a||3==a&&($("#fileupload"+e).parent("span").next("a.view").hide(),$("#fileupload"+e).parent("span").next("a.view").next("a.remove").hide(),$("#fileupload"+e).parent("span").parent("p").parent("div").find("span.fileName").html(""),$("#fileupload"+e).parent("span").parent("p").parent("div").find("i").removeClass("fa-check-circle-o"),$("#fileupload"+e).parent("span").parent("p").parent("div").find("i").removeClass("fa-close"),$("#fileupload"+e).parent("span").parent("p").parent("div").find("h1").removeAttr("style"),$("#fileupload"+e).parent("span").next("a.view").attr("href",""),$("#fileupload"+e).parent("span").next("a.remove").attr("href",""))}