function validateRequestForRecurringClass(e){var t=$("#"+e+" #meetingType").val();if("classroomSessionFilter"!=e){if("CUSTOM"!=t){if(null==$("#"+e+" #studentId").val()||""==$("#"+e+" #studentId").val())return showMessage(!0,"Search student using email or name"),!1;if(null==$("#"+e+" #subjectIds").val()||""==$("#"+e+" #subjectIds").val())return showMessage(!0,"Course is required."),!1;if(null==$("#"+e+" #teacherId").val()||""==$("#"+e+" #teacherId").val())return showMessage(!0,"Teacher is required."),!1;if(null==$("#"+e+" #recurringType").val()||""==$("#"+e+" #recurringType").val())return showMessage(!0,"CLass Type is required."),!1}if(null==$("#"+e+" #meetingVendor").val()||""==$("#"+e+" #meetingVendor").val())return showMessage(!0,"Meeting Vendor is required."),!1;if("External"==$("#"+e+" #meetingVendor").val()&&(null==$("#"+e+" #joiningLink").val()||""==$("#"+e+" #joiningLink").val()))return showMessage(!0,"Joining Link is required."),!1}var a=e;if("classroomSessionFilter"==e&&("ODM"!=(t=$("#classroomSessionFilter #meetingFor").val())&&"RM"!=t||(t="STUDENT_DOUBT_SESSION"),"STUDENT_DOUBT_SESSION"==t)){var s=$("#classroomSessionFilter #studentName").val(),r=$("#classroomSessionFilter #subjectIds").val(),n=$("#classroomSessionFilter #standardId").val();if(""==n||0==n)return showMessageTheme2(0,"Grade field is required"),!1;if(""==s||0==s||null==s||null==s)return showMessageTheme2(0,"Student Name required"),!1;if(""==r||0==r||null==r||null==r)return showMessageTheme2(0,"Course Name required"),!1}if(null==$("#"+e+" #startFromTime").val()||""==$("#"+e+" #startFromTime").val())return showMessageTheme2(0,"Start From Time is required"),!1;if(null==$("#"+e+" #countryTimezoneFromId").val()||""==$("#"+e+" #countryTimezoneFromId").val())return"TEACHER"!=USER_ROLE?showMessage(!0,"TimeZone is required."):showMessageTheme2(0,"TimeZone is required."),!1;if(null==$("#"+e+" #classDuration").val()||"00"==$("#"+e+" #classDuration").val())return"TEACHER"!=USER_ROLE?showMessage(!0,"Classroom Duration is required."):showMessageTheme2(0,"Classroom Duration is required."),!1;if(null==$("#"+e+" #bufferTime").val()||"00"==$("#"+e+" #bufferTime").val())return"TEACHER"!=USER_ROLE?showMessage(!0,"Buffer Time Duration is required."):showMessageTheme2(0,"Buffer Time Duration is required."),!1;if(null==$("#"+e+" #classStartDate").val()||""==$("#"+e+" #classStartDate").val())return"TEACHER"!=USER_ROLE?showMessage(!0,"Start Date is required."):showMessageTheme2(0,"Start Date is required."),!1;if(null==$("#"+e+" #classEndDate").val()||""==$("#"+e+" #classEndDate").val())return"TEACHER"!=USER_ROLE?showMessage(!0,"End Date is required."):showMessageTheme2(0,"End Date is required."),!1;var i=!0,l=1,o=0;return null==$(".teachDays").html()&&getSplitTime(e),$(".teachDays").each((function(){this.checked?""==$("#"+e+" #scheduleTime"+l).val()&&(i=!1):""!=$("#"+e+" #scheduleTime"+l).val()?(i=!1,o++):o++,l++})),i&&7!=o?("classroomSessionFilter"==a&&(e="classroomSessionFilter"),!0):("TEACHER"!=USER_ROLE?showMessage(!0,"Please select both day and time."):showMessageTheme2(0,"Please select both day and time."),!1)}function booksclassOutsideAvailabilityConfirmationModal(e,t,a){var s,r=$("#studentName option:selected").text().split(" (")[0],n=$("#subjectIds option:selected").text().split(" (")[0],i=$("#meetingDate").val(),l=$("#startTimeHours").val(),o=$("#startTimeMins").val(),c=" AM";$("#meetingType").val();l>=12&&(12!=l&&(l-=12),c=" PM"),i=i+" at "+l+":"+o,$("#booksclassOutsideAvailabilityConfirmationModal").modal("show"),$("#confirmationBookClassBtn").show(),(null!=r&&""!=r||null!=(r=$("#studentName").val())&&""!=r)&&$("#studentBatchName").text(r),null!=n&&""!=n&&$("#courseActivity").text(n),null!=i&&""!=i&&"hide-on-odm"!=e&&$("#meetingDateTime").text(" for "+i+c),"hide-on-odm"==e?(s="submitRecurringClassWarning('"+t+"','"+a+"')",$("#confirmationBookClassBtn").attr("onclick",s)):(s="meetingSlotModalForScheduleClass('"+t+"','"+a+"')",$("#confirmationBookClassBtn").attr("onclick",s))}function submitRecurringClassWarning(e,t){return $("#booksclassOutsideAvailabilityConfirmationModal").modal("hide"),sendRecurringWarning("classroomSessionFilter"==e?"Are you sure you want to create recurring classes for "+$("#studentName option:selected").text().split(" (")[0]+" of "+$("#standardId option:selected").text()+" for "+$("#subjectIds option:selected").text()+"? Please note that all the classes will be created in about 30 mins from the time of saving.":"Are you sure you want to create recurring classes for "+$("#studentName").val()+" of "+$("#gradeName").val()+" and "+$("#teacherId option:selected").text().split(" (")[0]+" for "+$("#subjectIds option:selected").text()+"? Please note that all the classes will be created in about 30 mins from the time of saving.","submitRecurringClass('"+e+"','"+t+"')")}function submitRecurringClass(e,t){if(hideMessage(""),!validateRequestForRecurringClass(e))return!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","recurring-class-submit"),data:JSON.stringify(getRequestForRecurringClass(e)),dataType:"json",cache:!1,timeout:6e5,success:function(a){return"0"==a.status||"2"==a.status?"TEACHER"!=USER_ROLE?showMessage(!0,a.message):showMessageTheme2(0,a.message):($("#"+e+" #studentId").val("").trigger("change"),$("#"+e)[0].reset(),"TEACHER"!=USER_ROLE?showMessage(!1,a.message):showMessageTheme2(1,a.message),"classroomSessionFilter"==e?window.setTimeout((function(){callDashboardPageSchool(155,"schedule-a-session")}),1e3):window.setTimeout((function(){callDashboardPageSchool(t,"recurring-class-list")}),1e3)),!1},error:function(e){return!1}})}function getRequestForRecurringClass(e){var t={},a={},s={};s.userId=$("#userId").val(),s.schoolId=SCHOOL_ID,"recurringClass"==e?(s.paymentCheck=$("#"+e+" #paymentCheck").val(),s.studUserId=$("#"+e+" #studentId").val(),s.subjectIds=$("#"+e+" #subjectIds").val(),s.teachUserId=$("#"+e+" #teacherId").val(),s.recurringType=$("#"+e+" #recurringType").val(),s.meetingVendor=$("#"+e+" #meetingVendor").val(),s.joiningLink=$("#"+e+" #joiningLink").val(),s.showLinkBefore=$("#"+e+" #showLinkBefore").val()):(s.studentStandardId=$("#classroomSessionFilter #studentName option:selected").attr("data-studentStandardId"),s.studUserId=$("#classroomSessionFilter #studentName option:selected").attr("data-studentid"),s.subjectIds=$("#classroomSessionFilter #subjectIds").val(),s.teachUserId=$("#userId").val(),s.meetingVendor="LENS",s.recurringType="Complement",s.showLinkBefore="30");var r=getDateInDateFormat($("#"+e+" #classStartDate").val());s.startDate=changeDateFormat(r,"mm-dd-yyyy");var n=getDateInDateFormat($("#"+e+" #classEndDate").val());s.endDate=changeDateFormat(n,"mm-dd-yyyy"),s.timezoneId=$("#"+e+" #countryTimezoneFromId").val(),s.studentTimezoneId=$("#"+e+" #studentTimezoneId").val(),s.classDuration=$("#"+e+" #classDuration").val(),s.buffertime=$("#"+e+" #bufferTime").val();var i,l,o=[],c=1;return $(".teachDays").each((function(){this.checked&&(i=$("#"+e+" #scheduleTime"+c).val(),l=$("#"+e+" #teachDays"+c).val(),$.each(i,(function(e,t){o.push(t+"-"+l)})),console.log(o)),c+=1})),s.scheduleTime=o,a.hash=getHash(),a.schoolId=SCHOOL_ID,a.schoolUUID=SCHOOL_UUID,a.userType=moduleId,a.userId=$("#userId").val(),a.sessionUserId=USER_ID,t.authentication=a,t.recurringClassDTO=s,t}function callSubjectNameByStudent(e,t){if(""==t)return!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","SUBJECT-BY-STUDENT",t)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(t){if("0"==t.status||"2"==t.status)showMessage(!0,t.message);else{$("#"+e+" #teacherId").empty();var a=t.mastersData.courseList,s=$("#"+e+" #subjectIds");s.html(""),s.append('<option value="">Select</option>'),$.each(a,(function(e,t){s.append('<option value="'+t.key+'">'+t.value+" </option>")}))}}})}var daysCount,startDaysCount;function callTeacherBySubject(e,t,a,s,r){if(""==t)return!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster(e,"TEACHER-BY-SUBJECT",t,a)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(t){if("0"==t.status||"2"==t.status)showMessage(!0,t.message);else{var a=t.mastersData.data;if("CUSTOM"!=s||""!=r)var n=$("#"+e+" #teacherId");else n=$("#"+e+" #customTeacherId");n.html(""),n.append('<option value="">Select</option>');var i="",l="",o="",c="";daysCount=15,startDaysCount=15,$.each(a,(function(e,t){n.append('<option value="'+t.key+'">'+t.value+" ("+t.extra+") </option>"),i=t.extra2,l=t.extra1,o=t.key,c=t.extra3,daysCount=t.extra4,startDaysCount=t.extra5})),"classroomSessionFilter"!=e&&$("#"+e+" #countryTimezoneFromId").length>0&&$("#"+e+" #countryTimezoneFromId").val(i).trigger("change"),$("#"+e+" #teacherId").val(o),null!=c&&""!=c?($("#"+e+" #meetingVendor").val(c),$("#"+e+" #meetingVendor").prop("disabled",!0)):($("#"+e+" #meetingVendor").val(""),$("#"+e+" #meetingVendor").prop("disabled",!1)),console.log("coursesEndDate "+l),""==l?(l=new Date,startDate.setMonth(startDate.getMonth()+10)):l=new Date(l),console.log("coursesEndDate "+l),$("#"+e+" #classStartDate").val("");var u=new Date;u.setDate(u.getDate()+parseInt(startDaysCount)),"TEACHER"==USER_ROLE?initiateRecurringDateStart(e,"classStartDate","classEndDate",l,u):($("#"+e+" #classEndDate").val(changeDateFormat(l,"MMM-dd-yyyy")),initiateRecurringDateStart(e,"classStartDate","classEndDate",l,"")),initiateRecurringDateEnd(e,"classStartDate","classEndDate",l)}}})}function initiateRecurringDateStart(e,t,a,s,r){var n=new Date;console.log("initiateRecurringDateStart minDate: "+n),console.log("initiateRecurringDateStart coursesEndDate: "+s),$("#"+e+" #"+t).data("datepicker")?($("#"+e+" #"+t).datepicker("setStartDate",n),$("#"+e+" #"+t).datepicker("setEndDate",s)):$("#"+e+" #"+t).datepicker({autoclose:!0,format:"M dd, yyyy",startDate:n,endDate:r}).on("changeDate",(function(r){$("#timeSlotSession").show(),console.log("initiateRecurringDateStart : "+new Date(r.date.valueOf()));var n=r.date,i=new Date(n);i.setDate(i.getDate()+parseInt(daysCount)),i.valueOf()>s.valueOf()&&(i=new Date(s)),"TEACHER"==USER_ROLE&&$("#"+e+" #"+a).val(changeDateFormat(i,"MMM-dd-yyyy")),getSplitTime(e),"TEACHER"==USER_ROLE?initiateRecurringDateEnd(e,t,a,i):initiateRecurringDateEnd(e,t,a,s),checkUpdates()}))}function initiateRecurringDateEnd(e,t,a,s){var r=$("#"+e+" #"+t).val();console.log("initiateRecurringDateEnd minDate: "+r),r=""!=r?new Date(r):new Date,"TEACHER"!=USER_ROLE&&null!=$("#"+e+" #"+a).val()&&""!=$("#"+e+" #"+a).val()&&(s=$("#"+e+" #"+a).val()),console.log("initiateRecurringDateEnd minDate: "+r),console.log("initiateRecurringDateEnd coursesEndDate: "+s);var n=!1;$("#"+e+" #"+a).data("datepicker")?($("#"+e+" #"+a).datepicker("setStartDate",r),$("#"+e+" #"+a).datepicker("setEndDate",s),"TEACHER"==USER_ROLE&&$("#"+e+" #"+a).val("").datepicker("update")):$("#"+e+" #"+a).datepicker({autoclose:!0,format:"M dd, yyyy",todayHighlight:!0,startDate:r,endDate:s}).on("changeDate",(function(t){n=!0,getSplitTime(e),checkUpdates()})).on("hide",(function(t){n||"TEACHER"!=USER_ROLE&&$("#"+e+" #"+a).val(changeDateFormat(s,"MMM-dd-yyyy"))}))}function parseTime(e){var t=e.split(":"),a=new Date;return a.setHours(parseInt(t[0],10)),a.setMinutes(parseInt(t[1],10)),a}function overlapExists(e,t,a){return e.some((function(e){var s=e.split("-"),r=parseTime(s[0]),n=parseTime(s[1]);return n<r&&n.setDate(n.getDate()+1),r<a&&n>t}))}function callTimeSlotByStartTime(e,t,a,s,r,n,i,l){if(""==t)return!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster(e,"SPLIT-TIMESLOT-BY-STARTTIME",t,a,s,r,n,i,l)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(e){if("0"==e.status||"2"==e.status)showMessage(!0,e.message);else{var t=e.mastersData.timeTableList,a="",s=[];s.push("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),$.each(s,(function(e,s){a+=' <div class="col-md-4 col-sm-4 col-xs-12 mb-1 recurring-mapping-set-time-item">',a=(a=(a=(a+=' <div style="display:flex;align-items:center;justify-content:space-between;border: 1px solid #e3e3e3; padding: 0 5px"> ')+' <span><input type="checkbox" class="teachDays" style="position:relative;top:2px;" name="teachDays1" value="'+(e+=1)+'" data-batchid="0" id="teachDays'+e+"\" onchange='checkUpdates()'> ")+" <label>"+s+"</label></span> ")+' <span style="width:220px;display:inline-block"><select name="scheduleTime" class="scheduleTime form-control time-selec2" multiple="multiple" id="scheduleTime'+e+"\" onchange='checkUpdates()'> ",$.each(t,(function(e,t){a=a+" <option value="+t.startTime+"-"+t.endTime+">"+t.startTime+" - "+t.endTime+"</option>"})),a+=" </select></span></div></div> "})),$("#timeSlotSession").html(a);var r="";r="theme1"!=tt?"bootstrap4":void 0,$(".scheduleTime").select2({placeholder:"Select Time",theme:r}).on("select2:select select2:unselect",(function(e){var t=$(this).val()||[];$("#"+this.id+" option").each((function(){var e=$(this).val().split("-"),a=parseTime(e[0]),s=parseTime(e[1]);s<a&&s.setDate(s.getDate()+1),overlapExists(t,a,s)?$(this).prop("disabled",!0):$(this).prop("disabled",!1)})),t.forEach((function(t){$("#"+e.target.id+' option[value="'+t+'"]').prop("disabled",!1)}))}))}}})}function dropdownTeachertimeSlot(e,t){var a=$("#scheduleTime"+t).val(),s=$("#teachDays"+t).val(),r=$("#"+e+" #classStartDate").val();if(""==r)return showMessage(!1,"Please select start date"),!1;var n=$("#"+e+" #classEndDate").val();if(""==n)return showMessage(!1,"Please select end date"),!1;var i=$("#"+e+" #teacherId").val();if(""==i)return showMessage(!1,"Please select teacher"),!1;checkTimeSlotByTeacher(e,i,r,n,a+"-"+s,t)}function checkTimeSlotByTeacher(e,t,a,s,r,n){if(""==t)return!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster(e,"AVAILABLE-TEACHER-TIME-SLOT",t,a,s,r)),dataType:"json",async:!1,success:function(e){return"0"==e.status||"2"==e.status?(showMessage(!0,e.message),!1):!1===e.mastersData.teacherTimeAvaile?(showMessage(!0,"your time already book"),$("#scheduleTime"+n).val(""),!1):void 0}})}function sendRecurringWarning(e,t){$("#resetDeleteErrorWarningYes1").show(),$("#resetDeleteErrorWarningNo1").show(),$("#resetDeleteErrorWarningCancel1").hide(),$("#remarksresetDelete1Icon").removeAttr("class"),$("#remarksresetDelete1Icon").attr("class","fa fa-ban fa-4x"),t="$('#remarksresetDelete1').modal('hide');"+t+";",$("#warningMessage1").html(e),$("#resetDeleteErrorWarningYes1").attr("onclick",t),$("#remarksresetDelete1").modal("show")}function updateRecurring(e,t,a,s,r){hideMessage("");var n={};n.controllType=a,n.recurringClassId=t,n.schoolId=SCHOOL_ID,n.userId=e,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","recurring-update"),data:JSON.stringify(n),dataType:"json",success:function(e){"0"==e.status||"2"==e.status?showMessage(!0,e.message):(showMessage(!1,e.message),$("#recurringClasses").DataTable().row($("#"+r)).remove().draw());return!1},error:function(e){return!1}})}var recruringMappingSetTime=[],updatedRecruringMappingSetTime=[];const callRecurringShowDebounce=debouncing(callRecurringShow,300);function getDaysDifference(e,t){const a=Math.abs(t.getTime()-e.getTime());return Math.ceil(a/864e5)}function callRecurringShow(e){var t=$("#meetingFor").val();if(null!=t&&null!=t||(t=$("#meetingType").val()),hideMessage(""),!validateRequestForRecurringClass(e))return!1;recruringMappingSetTime=[],$("#timeSlotSession .recurring-mapping-set-time-item").each((function(e){var t=$("#classStartDate").val(),a=$("#classEndDate").val(),s=$("#teachDays"+(e+1)).prop("checked"),r=$(this).find("#scheduleTime"+(e+1)).val();recruringMappingSetTime.push(new Object({startDate:t,endDate:a,dayValue:s,timeInterval:r}))})),console.log(recruringMappingSetTime),JSON.stringify(updatedRecruringMappingSetTime)===JSON.stringify(recruringMappingSetTime)?$(".proceedRecurringClassbtn").show():$(".proceedRecurringClassbtn").hide(),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","recurring-show-class"),data:JSON.stringify(getRequestForRecurringClass(e)),dataType:"json",cache:!1,timeout:6e5,success:function(a){if("0"==a.status||"2"==a.status)null!=a.message?showMessage(!0,a.message):showMessage(!0,"Recurring class range does not match the date(s) selected.");else{var s=a.extra,r=a.dateSpecificDays,n=$("#meetingType").val(),i="";$("#teacherAvailabilityTable #teacherAvailabilityTbody").html(i),$("#availaibilityHeading").hide();var l=a.recurringClassListForAvailability,o=0;if("RM"==n)o=getDaysDifference(getDateInDateFormat($("#"+e+" #classStartDate").val()),getDateInDateFormat($("#"+e+" #classEndDate").val()));if(l.length>0&&"RM"!=n||l.length>0&&"RM"==n&&o<=r?$("#teacherAvailabilityWarningTitle").html('<h4 class="text-center bold text-danger">This slot is not in teacher\'s availability. If you book this class a date-specific availability will be created for this date.</h4>'):$("#teacherAvailabilityWarningTitle").html(""),"RM"==n&&"N"==s&&o>r){if(l.length>0){var c=[];$.each(l,(function(e,t){var a=t.meetingDate.split("<br/>"),s=[];$.each(a,(function(e,t){0!=e&&""!==t.trim()&&s.push(t)})),c.push({time:s})}));var u=[];$.each(l,(function(e,t){var a=t.teacherTime.split("<br/>"),s=[];$.each(a,(function(e,t){0!=e&&""!==t.trim()&&s.push(t)})),u.push({time:s})})),$("#needToAddTimePreferrence").val(!0),$("#teacherAvailabilityTable").show(),$("#availaibilityHeading").show();for(var d=0;d<l.length;d++){i+="<tr class='text-danger'>\n\t\t\t\t\t\t\t\t\t<td>"+l[d].meetingDate+"</td>";var m=findMatchingAndMissMatchingSlots(u[d].time,c[d].time);i+="<td>",$.each(m,(function(e,t){0==e?$.each(t.Matching,(function(e,t){i+=`<span class="text-success">${t}</span><br/>`})):$.each(t.MissMatching,(function(e,t){i+=`<span class="text-danger">${t}</span><br/>`}))})),i+="</td>\n\t\t\t\t\t\t\t\t\t<td>"+l[d].slotAvailableReason+"</td>\n\t\t\t\t\t\t\t\t</tr>"}$("#teacherAvailabilityTable #teacherAvailabilityTbody").html(i),"RM"==n&&($(".proceedRecurringClassbtn").hide(),$("#recurringClassShowModel").modal("show"))}else $("#recurringClassShowModelValidation").modal("show"),$("#recurringClassShowModel").modal("hide"),$("#teacherAvailabilityTable").hide(),$("#needToAddTimePreferrence").val(!1);"Y"==s&&"RM"==n&&($("#recurringClassShowModel").modal("hide"),$("#recurringClassShowModelValidation").modal("show"),$(".proceedRecurringClassbtn").show()),$("#saveForcefully").val(s)}else $("#recurringClassShowModel").modal("hide"),$("#recurringClassShowModelValidation").modal("show"),$(".proceedRecurringClassbtn").show(),$("#saveForcefully").val(s);for(var g=a.recurringClassList,h="",p=1,v=!0,T=0;T<g.length;T++){"Available"!=g[T].slotAvailable?h+="<tr class='text-danger'>":h+="<tr>",h=(h=(h=(h=h+" <td>"+p+++"</td>")+'<td><p class="mb-0">'+g[T].studentName+'</p><p class="mb-0">'+g[T].teachName+'</p><p class="mb-0">'+g[T].subjects+"</p></td>")+'<td><p class="mb-0"><b>Teacher Timezone: </b>'+g[T].teacherTime+'</p><p class="mb-0"><b>Student Timezone: </b>'+g[T].studentTime+'</p><p class="mb-0"><b>Admin Timezone: </b>'+g[T].meetingDate+" ("+g[T].startTime+" - "+g[T].endTime+")</p></td>")+" <td>"+g[T].slotAvailable+"</td>";var f=g[T].slotAvailableReason;h=null!=f&&""!=f&&"NA"!=f&&null!=f?h+" <td>"+f.replaceAll("~","<br>")+"</td>":h+" <td>"+f+"</td>",h+="</tr>","Available"!=g[T].slotAvailable&&(v=!1)}v?($(".proceedRecurringClassbtn").show(),$(".validator-message").hide()):($(".proceedRecurringClassbtn").hide(),$(".validator-message").show()),$("#trRecurring").html(h),"ODM"==t?($("#meetingType").val("ODM"),$(".hide-on-odm").hide(),$(".hide-on-rm, #meetingTypeNote").show()):"RM"==t&&($(".hide-on-odm").show(),$(".hide-on-rm, #meetingTypeNote").hide())}}})}function checkUpdates(){updatedRecruringMappingSetTime=[],$("#timeSlotSession .recurring-mapping-set-time-item").length>0&&($("#timeSlotSession .recurring-mapping-set-time-item").each((function(e){var t=$("#classStartDate").val(),a=$("#classEndDate").val(),s=$("#teachDays"+(e+1)).prop("checked"),r=$(this).find("#scheduleTime"+(e+1)).val();updatedRecruringMappingSetTime.push(new Object({startDate:t,endDate:a,dayValue:s,timeInterval:r}))})),console.log(updatedRecruringMappingSetTime),JSON.stringify(updatedRecruringMappingSetTime)===JSON.stringify(recruringMappingSetTime)||$(".proceedRecurringClassbtn").hide(),console.log(updatedRecruringMappingSetTime))}function getStudentDetails(e,t){hideMessage("");var a="";if(null==$("#"+e+" #meetingType").val()||null==$("#"+e+" #meetingType").val()||""==$("#"+e+" #meetingType").val())return showMessage(!0,"Meeting Type Required"),!1;if(""==(a="classroomSessionFilter"==e?$("#"+e+" #studentName option:selected").attr("data-studentemail"):$("#"+e+" #userNameOrEmail").val().trim()))return!1;var s={};s.userNameOrEmail=a,s.schoolId=SCHOOL_ID,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","get-student-for-recurring"),dataType:"json",data:JSON.stringify(s),success:function(t){if("classroomSessionFilter"!=e&&($("#"+e+" #studentId").val(""),$("#"+e+" #studentName").val(""),$("#"+e+" #subjectIds").html(""),$("#"+e+" #teacherId").html(""),$("#"+e+" #studentStandardId").html("")),"0"==t.status||"2"==t.status)"classroomSessionFilter"==e?showMessageTheme2(0,t.message):showMessage(!0,t.message),customLoader(!1);else{var a=t.userData;"classroomSessionFilter"!=e&&($("#"+e+" #studentId").val(a.userId),$("#"+e+" #studentName").val(a.studentName),$("#"+e+" #studentTimezone").val(a.countryTimezone),$("#"+e+" #studentTimezoneId").val(a.studentTimezoneId),$("#"+e+" #learningProgram").val(a.registrationType),$("#"+e+" #gradeName").val(a.gradeName),$("#"+e+" #studentStandardId").val(a.studentStandardId),null!=a.meetingVendor&&""!=a.meetingVendor?($("#"+e+" #meetingVendor").val(a.meetingVendor),$("#"+e+" #meetingVendor").prop("disabled",!0)):($("#"+e+" #meetingVendor").val(""),$("#"+e+" #meetingVendor").prop("disabled",!1))),callSubjectNameByStudent(e,a.userId),$("#selectTeacher").show(),$("#customTeacherDropDown").hide()}return!1}})}function getTeacherList(e){var t=$("#"+e+" #meetingType").val(),a=$("#"+e+" #userNameOrEmail").val(),s=$("#"+e+" #studentId").val();if("classroomSessionFilter"==e)s=$("#"+e+" #studentName option:selected").attr("data-studentid");else{var r=$("#"+e+" #studentName").val()+" ("+$("#"+e+" #subjectIds option:selected").text()+")";$("#"+e+" #meetingSubject").val(r)}var n=$("#"+e+" #subjectIds").val();""!=s&&null!=s&&(s.length>0&&n.length>0?callTeacherBySubject(e,n,s,t,a):"CUSTOM"!=t||""!=a?($("#"+e+" #teacherId").html(""),$("#"+e+" #countryTimezoneFromId").val("").trigger("change")):$("#"+e+" #customTeacherId").html(""))}function resetRecurring(e,t){var a=$("#"+e+" #meetingType").val(),s=$("#"+e+" #meetingFor").val();$("#"+e)[0].reset(),"theme2"!=tt?$("#"+e+" #meetingType").val(a).trigger("change"):$("#"+e+" #meetingFor").val(s).trigger("change"),"CUSTOM"==a?($("#customTeacherDropDown").show(),$("#selectTeacher").hide()):$("#teacherId").html(""),$("#studentName").html(""),$("#"+e+" #joiningLink").prop("readonly",!0),$("#"+e+" #startFromTime").select2("val"," "),$("#"+e+" .scheduleTime").select2("val"," "),$("#"+e+" .scheduleTime option").each((function(){$(this).prop("disabled",!1)})),$("#"+e+" #subjectIds").html(""),$("#"+e+" #standardId").val("").trigger("change"),$("#"+e+" #studentName").val("").trigger("change"),$("#"+e+" #meetingDate").val("").datepicker("update"),$("#timeSlotSession .select2-search__field").css({width:"100%"})}function getSplitTime(e){if("classroomSessionFilter"==e){if("00"==(a=$("#"+e+" #classDuration").val()))return showMessageTheme2(0,"Please select class Duration"),!1;if("00"==(s=$("#"+e+" #bufferTime").val()))return showMessageTheme2(0,"Please select buffer Time"),!1;var t=$("#"+e+" #startFromTime").val();if(""==(r=$("#"+e+"  #classStartDate").val()))return showMessageTheme2(0,"Please select start date"),!1;if(""==(n=$("#"+e+" #classEndDate").val()))return showMessageTheme2(0,"Please select end date"),!1;if(new Date(r).getTime()>new Date(n).getTime())return showMessageTheme2(0,"End Date Should be Greater than Start Date"),!1;if(null==(i=$("#"+e+" #countryTimezoneFromId option:selected").text().trim())||null==i||""==i)return showMessageTheme2(0,"Please select timezone"),!1}else{var a,s;if("00"==(a=$("#"+e+" #classDuration").val()))return showMessage(!1,"Please select class Duration"),!1;if("00"==(s=$("#"+e+" #bufferTime").val()))return showMessage(!1,"Please select buffer Time"),!1;var r,n,i;t=$("#"+e+" #startFromTime").val();if(""==(r=$("#"+e+"  #classStartDate").val()))return showMessage(!1,"Please select start date"),!1;if(""==(n=$("#"+e+" #classEndDate").val()))return showMessage(!1,"Please select end date"),!1;if(new Date(r).getTime()>new Date(n).getTime())return showMessage(!1,"End Date Should be Greater than Start Date"),!1;if(null==(i=$("#"+e+" #countryTimezoneFromId option:selected").text().trim())||null==i||""==i)return showMessageTheme2(0,"Please select timezone"),!1}callTimeSlotByStartTime("recurringClass","00:00:00","23:59:00",a,s,t,n,i)}function updateRecurringClassProceed(e,t,a,s,r,n){$("#"+e+" #userId").val(t),$("#"+e+" #recurringClassId").val(a),$("#"+e+" #controllType").val(s),$("#"+e+" #moduleId").val(r),$("#"+e+" #currentMeetingVendor").val(n),$("#updateRecurringClassModel").modal({backdrop:"static",keyboard:!1})}function validateRequestForUpdateRecurringClassUrl(e){return null==$("#"+e+" #meetingVendor").val()||""==$("#"+e+" #meetingVendor").val()?(showMessage(!0,"Meeting Vendor is required."),!1):"External"!=$("#"+e+" #meetingVendor").val()||null!=$("#"+e+" #joiningLink").val()&&""!=$("#"+e+" #joiningLink").val()?$("#"+e+" #currentMeetingVendor").val()!=$("#"+e+" #meetingVendor").val()||(showMessage(!0,"Existing and opted meeting vendor cann't same."),!1):(showMessage(!0,"Joining Link is required."),!1)}function updateRecurringClassVendorWarning(e,t){return sendRecurringWarning("Are you sure you want to update recurring classes URL ","updateRecurringClasses('"+e+"','"+t+"')")}function updateRecurringClasses(e,t){if(hideMessage(""),!validateRequestForUpdateRecurringClassUrl(e))return!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","recurring-class-update"),data:JSON.stringify(getRequestForUpdateRecurringClassUrl(e,t)),dataType:"json",cache:!1,timeout:6e5,success:function(a){if("0"==a.status||"2"==a.status)showMessage(!0,a.message);else{showMessage(!1,a.message);var s=$("#"+e+" #recurringClassId").val(),r=$("#"+e+" #meetingVendor").val(),n="("+r+")<br/>";"ZOOM"==r?(n+='<button value="'+a.startMeetingUrl+'" id="start_url_'+s+'"  onclick="copyURL(\'start_url_'+s+"', 'start-copy-msg-"+s+'\')" class="btn btn-primary btn-sm">Copy Start URL</button> <b class="start-copy-msg-'+s+'"></b><br/>',n+='<button value="'+a.joinMeetingUrl+'" id="start_url_'+s+'"  onclick="copyURL(\'start_url_'+s+"', 'start-copy-msg-"+s+'\')" class="btn btn-primary btn-sm">Copy Join URL</button> <b class="start-copy-msg-'+s+'"></b>'):n+='<button value="'+a.startMeetingUrl+'" id="start_url_'+s+'"  onclick="copyURL(\'start_url_'+s+"', 'start-copy-msg-"+s+'\')" class="btn btn-primary btn-sm">Copy URL</button> <b class="start-copy-msg-'+s+'"></b>',$("#recurring_class_"+s).html(n),resetUpdateRecurringClass(e,t),$("#updateRecurringClassModel").modal("hide")}return!1},error:function(e){return!1}})}function getRequestForUpdateRecurringClassUrl(e,t){var a={},s={},r={};return r.id=$("#"+e+" #recurringClassId").val(),r.meetingVendor=$("#"+e+" #meetingVendor").val(),r.joiningLink=$("#"+e+" #joiningLink").val(),r.showLinkBefore=$("#"+e+" #showLinkBefore").val(),s.hash=getHash(),s.schoolId=SCHOOL_ID,s.schoolUUID=SCHOOL_UUID,s.userType=t,s.userId=$("#userId").val(),a.authentication=s,a.recurringClassDTO=r,a}function resetUpdateRecurringClass(e,t){$("#"+e)[0].reset(),$("#"+e+" #joiningLink").prop("readonly",!0)}function parseTimeFor(e){if(" Not Available "!=e){var t=e.match(/(\d+):(\d+) (\w+)/),a=parseInt(t[1]),s=parseInt(t[2]),r=t[3];return"PM"===r&&12!==a?a+=12:"AM"===r&&12===a&&(a=0),{hours:a,minutes:s}}return!0}function matchSlotBetweenGivenAvailability(e,t){if(" Not Available "!=t){var[a,s]=e.split(" - ").map(parseTimeFor),[r,n]=t.split(" - ").map(parseTimeFor),i=60*a.hours+a.minutes,l=60*s.hours+s.minutes,o=60*r.hours+r.minutes,c=60*n.hours+n.minutes;return i>=o&&i<c&&l>o&&l<c}return 0}function findMatchingAndMissMatchingSlots(e,t){for(var a=[],s=[],r=0;r<e.length;r++){for(var n=!1,i=0;i<t.length;i++)if(matchSlotBetweenGivenAvailability(e[r],t[i])){a.push(e[r]),n=!0;break}n||s.push(e[r])}return[{Matching:a},{MissMatching:s}]}