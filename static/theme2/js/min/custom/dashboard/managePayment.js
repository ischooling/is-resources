function setpaymentDateFrom(){$("#paymentDateFrom").prop("disabled",!1),$("#paymentDateFrom").datepicker({autoclose:!0,format:"mm-dd-yyyy"}),$("#paymentDateFrom").datepicker("setDate",today)}function setpaymentDateTo(){$("#paymentDateTo").prop("disabled",!1),$("#paymentDateTo").datepicker({autoclose:!0,format:"mm-dd-yyyy"}),$("#paymentDateTo").datepicker("setDate",today)}function addCustomPayment(){$(".addPayment-wrapper").stop().slideToggle()}function advancePaymentSerch(){$("#advSerch").modal("show"),$("#advancePaymentSearchForm #paymentType").html(getPaymentTitle("S",$("#allSchoolId").val()),"")}function sendmail(e){var a={id:e};$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","sendmail-for-advance-payment-for-second-time"),data:JSON.stringify(a),dataType:"json",async:!1,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?"3"==a.status?redirectLoginPage():"theme1"==tt?showMessage(!1,e.message):showMessage(0,e.message,"",!0):showMessage(1,e.message,"",!0)}})}function advancePaymentSearchStudent(e,a){var t=$("#"+e+" #paymentDateFrom").val(),s=$("#"+e+" #paymentDateTo").val();return hideMessage(""),""==t||null==t||""!=s&&null!=s?""==s||null==s||""!=t&&null!=t?void $.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","advance-payment-search-content"),data:JSON.stringify(getCallRequestForAdvancePaymentSearchStudent(e,a)),dataType:"json",async:!1,success:function(a){var t="advPaymentSearch";if("0"==a.status||"2"==a.status||"3"==a.status)"3"==a.status?redirectLoginPage():"theme1"==tt?showMessage(!1,a.message):showMessageTheme2(0,a.message,"",!0),$("#"+t+" tbody").html("");else if($("#advSerch").modal("hide"),null!=a.advancePaymentSearchResponseDTO&&null!=a.advancePaymentSearchResponseDTO&&a.advancePaymentSearchResponseDTO.length>0){$.fn.dataTable.isDataTable("#"+t)&&$("#"+t).dataTable().fnDestroy(),$("#"+t+" tbody").html(getAdvancePaymentSearchResult(e,a));$("#"+t).DataTable();$("#autoWeeklyMailStudent").DataTable()}else showMessage(!1,a.message),$("#"+t+" tbody").html("")}}):(showMessage(!0,"Payment Date From field is mandatory if you choose a date from Payment Date To field."),!1):(showMessage(!0,"Payment Date To field is mandatory if you choose a date from Payment Date From field."),!1)}function getCallRequestForAdvancePaymentSearchStudent(e,a){var t={},s={},n={};n.moduleId=a,n.userRegistrationType=$("#"+e+" #userRegistrationType").select2("val"),n.paymentType=$("#"+e+" #paymentType").select2("val"),n.paymentVia=$("#"+e+" #paymentVia").select2("val"),"BLANK"!=$("#"+e+" #paymentGateway").select2("val")&&(n.paymentGateway=$("#"+e+" #paymentGateway").select2("val")),n.registrationType=$("#"+e+" #registrationType").select2("val"),n.academicSession=$("#"+e+" #academicSession").val(),n.gradeId=$("#"+e+" #gradeId").select2("val"),n.enrollStatus=$("#"+e+" #enrollStatus").val(),n.studentName=$("#"+e+" #studentName").val().trim(),n.studentEmail=$("#"+e+" #studentEmail").val().trim(),n.countryId=$("#"+e+" #countryId").select2("val");for(var r=$("#"+e+" #paymentMode").select2("val"),l=0;l<r.length;l++)"customized"===r[l]&&(r.splice(l,1),r.push("c_installment"),r.push("c_annually"));return n.paymentMode=r,n.transactionRefNumber=$("#"+e+" #transactionRefNumber").val().trim(),n.userRefNumber=$("#"+e+" #userRefNumber").val().trim(),n.paymentStatus=$("#"+e+" #paymentStatus").select2("val"),n.paymentDateFrom=$("#"+e+" #paymentDateFrom").val().trim(),n.paymentDateTo=$("#"+e+" #paymentDateTo").val().trim(),n.sortBy=$("#"+e+" #sortBy").select2("val"),n.orderBy=$("#"+e+" #orderBy").select2("val"),n.startPosition=$("#"+e+" #startPosition").val().trim(),n.numberOfRecords=$("#"+e+" #numberOfRecords").val().trim(),n.schoolId=$("#"+e+" #schoolId").select2("val"),n.studentStringId=$("#"+e+" #studentId").val().trim(),n.schoolUUID=SCHOOL_UUID,t.advancePaymentSearchDTO=n,s.hash=getHash(),s.schoolId=SCHOOL_ID,s.schoolUUID=SCHOOL_UUID,s.userType="SCHOOL",t.authentication=s,t}function advancePaymentSearchStudentReset(e){$("#"+e+" #userRegistrationType").val("Registered").trigger("change"),$("#"+e+" #paymentType").val("").trigger("change"),$("#"+e+" #paymentVia").val("").trigger("change"),$("#"+e+" #paymentGateway").val("BLANK").trigger("change"),$("#"+e+" #gradeId").val("-1").trigger("change"),$("#"+e+" #registrationType").val("").trigger("change"),$("#"+e+" #enrollStatus").val("").trigger("change"),$("#"+e+" #studentName").val(""),$("#"+e+" #studentId").val(""),$("#"+e+" #studentEmail").val(""),$("#"+e+" #countryId").val("-1").trigger("change"),$("#"+e+" #paymentMode").val("").trigger("change"),$("#"+e+" #transactionRefNumber").val(""),$("#"+e+" #userRefNumber").val(""),$("#"+e+" #paymentStatus").val("").trigger("change"),$("#"+e+" #paymentDateFrom").val(""),$("#"+e+" #paymentDateTo").val(""),$("#"+e+" #sortBy").val("DESC").trigger("change"),$("#"+e+" #orderBy").val("PAY_DATE").trigger("change"),$("#"+e+" #startPosition").val("0"),$("#"+e+" #numberOfRecords").val("25")}function searchStudentByNameAndEmail(){var e=$("#searchName").val().trim(),a=$("#searchEmail").val().trim(),t=$("#schoolId").val();""==t&&(t=$("#allSchoolId").val());var s=$("#studentId").val(),n={searchName:e,searchEmail:a,schoolId:t,studentId:s};if(hideMessage(""),""==e&&""==a&&""==s)return showMessage(!0,"To search desired user, required either name or email or student id"),!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","search-student"),data:JSON.stringify(n),dataType:"json",async:!1,success:function(e){if("0"==e.status||"2"==e.status||"3"==e.status)"3"==e.status?redirectLoginPage():"theme1"==tt?showMessage(!1,e.message):showMessageTheme2(0,e.message,"",!0);else if(e.results.length>0){var a="paymentTable";$.fn.dataTable.isDataTable("#"+a)&&$("#"+a).dataTable().fnDestroy(),$("#"+a+" tbody").html(getAddPaymentSearchResult(e));var t=$("#"+a).DataTable();$("#"+a).on("page.dt",(function(){t.responsive.recalc()}))}}})}function addExternalPayment(e){hideMessage(""),$("#addPaymentModal").modal("show"),$(".hideWhenlearningProgramFlexy").show(),$("#copyViewPaymentUrlElement, #viewPaymentUrlElementWrapper").hide(),$("#"+e+" #studentDetailsForPaymentId").show(),$("#"+e+" #studentEmail1").prop("disabled",!1),$("#"+e+" #studentEmail1").val(""),$("#"+e+" #studentName1").prop("disabled",!1),$("#"+e+" #studentName1").val(""),$("#"+e+" #learningProgram1").prop("disabled",!1),$("#"+e+" #learningProgram1").val("").trigger("change"),$("#"+e+" #standardId1").prop("disabled",!1),$("#"+e+" #standardId1").val("").trigger("change"),$("#"+e+" #payableAmount").val(""),$("#"+e+" #status1").val("0").trigger("change"),$("#"+e+" #scheduleDate1").val("").datepicker("update"),$("#"+e+" #paymentDate1").val("").datepicker("update"),$("#"+e+" #paymentType1").html(getPaymentTitle("AE",$("#allSchoolId").val(),"REGISTRATION_FEE")),$("#"+e+" #paymentName1").val("Reserve an Enrollment Seat"),$("#"+e+" #paymentName1").prop("disabled",!0),$("#addStudentPaymentbtn").show(),$("#descriptionDiv").next().length<1&&initEditor(1,"descriptionDiv","Put description if any",!1),editor1.setData("Reserve an Enrollment Seat")}function addPayment(e,a,t,s,n,r){hideMessage(""),$("#addPaymentModal").modal("show"),$("#addStudentPaymentbtn").show(),$("#closePaymentModal").show(),$("#copyViewPaymentUrlElement").hide(),$("#viewPaymentUrlElementWrapper").hide(),$("#"+e+" #studentEmail1").val(a),$("#"+e+" #studentStandardId").val(t),$("#"+e+" #studentDetailsForPaymentId").hide(),$("#"+e+" #studentEmail1").prop("disabled",!0),$("#"+e+" #studentName1").prop("disabled",!0),$("#"+e+" #learningProgram1").prop("disabled",!0),$("#"+e+" #standardId1").prop("disabled",!0),$("#"+e+" #payableAmount").val(""),$("#"+e+" #status1").val("0").trigger("change"),$("#"+e+" #scheduleDate1").val("").datepicker("update"),$("#"+e+" #paymentDate1").val("").datepicker("update"),$("#"+e+" #paymentType1").html(getPaymentTitle("A",$("#allSchoolId").val(),"",s,r),""),n&&($("#"+e+" #paymentName1").val(""),$("#"+e+" #paymentName1").prop("disabled",!1)),$("#addStudentPaymentbtn").show(),getStudentDetailsForPayment(e,!1),$("#descriptionDiv").next().length<1&&initEditor(1,"descriptionDiv","Put description if any",!1)}function getStudentDetailsForPayment(e,a){hideMessage("");var t=$("#"+e+" #studentEmail1").val().trim();if(""==t)return!1;var s={userNameOrEmail:t,schoolId:SCHOOL_ID};$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","get-student-for-payment"),data:JSON.stringify(s),dataType:"json",async:!1,success:function(t){if($("#"+e+" #studentName1").val(""),$("#"+e+" #learningProgram1").val("").trigger("change"),$("#"+e+" #standardId1").val("").trigger("change"),"0"==t.status||"2"==t.status||"3"==t.status)"3"==t.status?redirectLoginPage():"theme1"==tt?showMessage(!1,t.message):showMessageTheme2(0,t.message,"",!0),$("#addStudentPaymentbtn").show();else if(a)$("#addStudentPaymentbtn").hide(),showMessage(!0,"User is already registered, kindly search and add the payment");else{var s=t.userData;""!=s.studentName?$("#"+e+" #studentName1").val(s.studentName):$("#"+e+" #studentName1").prop("disabled",!1),$("#"+e+" #paymentAlternateName").html(s.standardName),""!=s.registrationType?($("#"+e+" #learningProgram1").val(s.registrationType).trigger("change"),"ONE_TO_ONE_FLEX"==s.registrationType?$(".hideWhenlearningProgramFlexy").hide():$(".hideWhenlearningProgramFlexy").show()):$("#"+e+" #learningProgram1").prop("disabled",!1),""!=s.gradeId?$("#"+e+" #standardId1").val(s.gradeId).trigger("change"):$("#"+e+" #standardId1").prop("disabled",!1)}return!1}})}function addStudentPayment(e,a){var t=$("#"+e+" #studentEmail1").val();if(null==t||null==t||""==t)return showMessage(!0,"Email is mandatory."),!1;var s=$("#"+e+" #studentName1").val();if(null==s||null==s||""==s)return showMessage(!0,"Student name is mandatory."),!1;var n=$("#"+e+" #learningProgram1").val();if(null==n||null==n||""==n)return showMessage(!0,"Learning Program is mandatory."),!1;if("ONE_TO_ONE_FLEX"!=n){var r=$("#"+e+" #standardId1").val();if(null==r||null==r||""==r)return showMessage(!0,"Grade is mandatory."),!1}var l=$("#"+e+" #paymentType1").val();if(null==l||null==l||""==l)return showMessage(!0,"Payment Title is mandatory."),!1;if(""==$("#"+e+" #paymentName1").val()){var d=$("#"+e+" #installmentNumber1").val(),i=$("#"+e+" #numberOfMonth1").val();if(null==d||""==d||null==i||""==i)return showMessage(!0,"Payment Name is mandatory."),!1}if(0==$("#"+e+" #payableAmount").val())return showMessage(!0,"Pay Fee can not be zero."),!1;var o=$("#"+e+" #currency1").val();if("0"==o||""==o||null==o)return showMessage(!0,"Choose the currency in which the payment is being done."),!1;var m=$("#"+e+" #paymentDate1").val(),u=$("#"+e+" #scheduleDate1").val(),y=$("#"+e+" #status1").val();return"SUCCESS"!=y||""!=m&&null!=m?""==u||null==u?(showMessage(!0,"Please Enter the scheduled payment date."),!1):"INITIATED"!=y||""!=m&&null!=m?"0"==y||""==y||null==y?(showMessage(!0,"Please select the Payment Status."),!1):void $.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","save-payment"),data:JSON.stringify(getRequestDataForAddPaymentDetails(e,a)),dataType:"json",async:!1,success:function(e){if("0"!=e.status&&"2"!=e.status&&"3"!=e.status)return $("#viewPaymentUrlElementWrapper").show(),$("#viewPaymentUrlElement").attr("value",e.message),$("#closePaymentModal").hide(),$("#addStudentPaymentbtn").hide(),$("#copyViewPaymentUrlElement").show(),showMessage(1,"Payment Created"),!1;"3"==e.status?redirectLoginPage():"theme1"==tt?showMessage(!1,e.message):showMessageTheme2(0,e.message,"",!0)}}):(showMessage(!0,"Please Enter the payment date."),!1):(showMessage(!0,"Payment Date is a mandatory field."),!1)}function getRequestDataForAddPaymentDetails(e,a){var t={},s={},n={};return""==$("#"+e+" #studentStandardId").val()?(n.studentEmail=$("#"+e+" #studentEmail1").val(),n.studentName=$("#"+e+" #studentName1").val(),n.learningProgram=$("#"+e+" #learningProgram1").select2("val"),n.standardId=$("#"+e+" #standardId1").select2("val")):(n.studentStandardId=$("#"+e+" #studentStandardId").val().trim(),n.studentEmail=$("#"+e+" #studentEmail1").val(),n.studentName=$("#"+e+" #studentName1").val(),n.learningProgram=$("#"+e+" #learningProgram1").select2("val"),n.standardId=$("#"+e+" #standardId1").select2("val")),n.paymentTitle=$("#"+e+" #paymentType1").select2("val"),n.paymentName=$("#"+e+" #paymentName1").val().trim(),n.installmentNumber=$("#"+e+" #installmentNumber1").val().trim(),$("#"+e+" #numberOfMonth1").length>0&&(n.numberOfMonth=$("#"+e+" #numberOfMonth1").val().trim()),n.referenceNumber=$("#"+e+" #userRefNumber1").val().trim(),n.payableAmount=$("#"+e+" #payableAmount").val().trim(),n.currency=$("#"+e+" #currency1").select2("val"),n.paymentGateway=$("#"+e+" #paymentGateway1").select2("val"),n.status=$("#"+e+" #status1").select2("val"),n.paymentDate=$("#"+e+" #paymentDate1").val().trim(),n.scheduleDate=$("#"+e+" #scheduleDate1").val().trim(),n.transactionNumber=$("#"+e+" #transactionNumber").val().trim(),n.schoolId=SCHOOL_ID,null!=editor1&&(n.description=escapeCharacters(editor1.getData())),t.addPaymentDTO=n,s.hash=getHash(),s.schoolId=SCHOOL_ID,s.schoolUUID=SCHOOL_UUID,t.authentication=s,t}function editStudentPayment(e,a){var t=$("#"+e+" #paymentType2").val();if(""==t||null==t)return showMessage(!0,"Payment Title is mandatory."),!1;if(""==$("#"+e+" #paymentName2").val()){var s=$("#"+e+" #installmentNumber2").val(),n=$("#"+e+" #numberOfMonth2").val();if(null==s||""==s||null==n||""==n)return showMessage(!0,"Payment Name is mandatory."),!1}if(""==$("#"+e+" #userRefNumber2").val())return showMessage(!0,"Enter User Reference Number"),!1;if(0==$("#"+e+" #payableAmount2").val())return showMessage(!0,"Pay Amount can not be zero."),!1;var r=$("#"+e+" #currency2").val();if(null==r||"0"==r||""==r)return showMessage(!0,"Choose the currency in which the payment is being done."),!1;var l=$("#"+e+" #status2").val();if(null==l||"0"==l||""==l)return showMessage(!0,"Please select the Payment Status."),!1;var d=$("#"+e+" #paymentDate2").val(),i=$("#"+e+" #scheduleDate2").val();return"SUCCESS"!=l||""!=d&&null!=d?"SCHEDULED"!=l||""!=i&&null!=i?""==$("#"+e+" #transactionNumber2").val()&&"SCHEDULED"!=l?(showMessage(!0,"Please enter the transaction number."),!1):void $.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","edit-payment"),data:JSON.stringify(getRequestDataForEditPaymentDetails(e,a)),dataType:"json",async:!1,success:function(e){return"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status?redirectLoginPage():"theme1"==tt?showMessage(!1,e.message):showMessageTheme2(0,e.message,"",!0):(showMessage(!0,e.message),$("#editPaymentModal").modal("hide"),window.setTimeout((function(){hideMessage("")}),500),window.setTimeout((function(){hideMessage(""),$("#advSearchSubmitButtion").trigger("click")}),800)),!1}}):(showMessage(!0,"Please Enter the scheduled payment date."),!1):(showMessage(!0,"Payment Date is a mandatory field."),!1)}function getRequestDataForEditPaymentDetails(e,a){var t={},s={},n={};return n.userId=$("#"+e+" #userIdSearch").val().trim(),n.paymentTitle=$("#"+e+" #paymentType2").select2("val"),n.paymentName=$("#"+e+" #paymentName2").val().trim(),n.installmentNumber=$("#"+e+" #installmentNumber2").val().trim(),$("#"+e+" #numberOfMonth2").length>0&&(n.numberOfMonth=$("#"+e+" #numberOfMonth2").val().trim()),n.referenceNumber=$("#"+e+" #userRefNumber2").val().trim(),n.payableAmount=$("#"+e+" #payableAmount2").val().trim(),n.additionalAmount=$("#"+e+" #additionalAmount2").val().trim(),n.currency=$("#"+e+" #currency2").select2("val"),n.paymentGateway=$("#"+e+" #paymentGateway2").select2("val"),n.status=$("#"+e+" #status2").select2("val"),n.paymentDate=$("#"+e+" #paymentDate2").val().trim(),n.scheduleDate=$("#"+e+" #scheduleDate2").val().trim(),n.transactionNumber=$("#"+e+" #transactionNumber2").val().trim(),n.id=$("#"+e+" #userPayId").val().trim(),null!=editor1&&(n.description=escapeCharacters(editor1.getData())),n.schoolId=SCHOOL_ID,t.addPaymentDTO=n,s.hash=getHash(),s.schoolId=SCHOOL_ID,s.schoolUUID=SCHOOL_UUID,t.authentication=s,t}function showPaymentPopup(e,a){var t={id:e};$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","get-user-payment"),data:JSON.stringify(t),dataType:"json",async:!1,success:function(e){if("0"==e.status||"2"==e.status||"3"==e.status)"3"==e.status?redirectLoginPage():"theme1"==tt?showMessage(!1,e.message):showMessageTheme2(0,e.message,"",!0);else{if($("#showEditPopupContainer").html(editPaymentContent(roleAndModule.moduleId,e.userPaymentDetails,a,e.standardName)),$("#editPaymentModal").modal({backdrop:"static",keyboard:!1}),$("#paymentType2").select2().val(e.userPaymentDetails.paymentTitle).trigger("change"),$("#status2").select2().val(e.userPaymentDetails.status).trigger("change"),$("#currency2").select2().val(e.userPaymentDetails.selectedCurrency).trigger("change"),$("#paymentGateway2").select2().val(e.userPaymentDetails.pgName).trigger("change"),initEditor(1,"descriptionDivBox","Put description if any",!1),$("#paymentDate2").datepicker({autoclose:!0,endDate:new Date,format:"mm-dd-yyyy"}),null!=e.userPaymentDetails.payDate&&""!=e.userPaymentDetails.payDate){var t=e.userPaymentDetails.payDate.split("-"),s=new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]));$("#paymentDate2").datepicker().datepicker("setDate",s)}if($("#scheduleDate2").datepicker({autoclose:!0,format:"mm-dd-yyyy"}),null!=e.userPaymentDetails.scheduledPayDate&&""!=e.userPaymentDetails.scheduledPayDate){t=e.userPaymentDetails.scheduledPayDate.split("-"),s=new Date(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]));$("#scheduleDate2").datepicker().datepicker("setDate",s)}var n=$("#paymentName2").val();null!=n&&n.startsWith("Course Fee - ")&&(n=n.split("Course Fee - "))[1].search(/ of /i)>0&&($("#installmentNumber2").val(n[1].split(" of ")[0].split("<sup>")[0]),$("#numberOfMonth2").val(n[1].split(" of ")[1].split(" ")[0]),$("#paymentName2").val(""))}}})}function deletePayment(e,a){var t={id:e};$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","delete-user-payment"),data:JSON.stringify(t),dataType:"json",async:!1,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status?redirectLoginPage():"theme1"==tt?showMessage(!1,e.message):showMessageTheme2(0,e.message,"",!0):(showMessage(!0,e.message),$("#advPaymentSearch").DataTable().row($("#"+a)).remove().draw())},error:function(e){return!1}})}function mapUnregisteredUserPayment(e,a,t,s,n,r,l){$("#"+e+" #mapStudentModal").modal("show"),$("#"+e+" #unregistredPaymentId").val(a),$("#"+e+" #mapToStudentId").html("You are about to map <strong>"+r+" ("+l+")</strong> payment to"),$("#mapStudentModal").modal({backdrop:"static",keyboard:!1})}function mapUnregisteredUserPaymentProcess(e){hideMessage("");var a={email:$("#"+e+" #mapToUsers").val(),unregistredPaymentId:$("#"+e+" #unregistredPaymentId").val(),schoolId:SCHOOL_ID};$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","map-unregistered-payment"),data:JSON.stringify(a),dataType:"json",async:!1,success:function(e){return"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status?redirectLoginPage():"theme1"==tt?showMessage(!1,e.message):showMessageTheme2(0,e.message,"",!0):(showMessage(!0,e.message),$("#mapStudentModal").modal("hide")),!1}})}