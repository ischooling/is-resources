var today=new Date;function studentAssginedReportSearch(t,e,a,r){return""==$("#"+t+" #startDate").val()&&""!=$("#"+t+" #endDate").val()?("theme1"==tt?showMessage(!1,"Please select start date"):showMessageTheme2(0,"Please select start date","",!0),!1):""!=$("#"+t+" #startDate").val()&&""==$("#"+t+" #endDate").val()?("theme1"==tt?showMessage(!1,"Please select end date"):showMessageTheme2(0,"Please select end date","",!0),!1):new Date($("#endDate").val()).getTime()<new Date($("#startDate").val()).getTime()?("theme1"==tt?showMessage(!1,"Start date is less than or equal to end date"):showMessageTheme2(0,"Start date is less than or equal to end date","",!0),!1):void studentAssginedReportSearchData(t,"studentAssignReportList",a,r)}function studentAssginedReportSearchData(t,e,a,r,s){$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","get-assigned-teacher-report"),dataType:"json",data:JSON.stringify(getStudentAssignedRequest(t)),success:function(t){return $("#"+e).html(""),"0"==t.status||"2"==t.status||"3"==t.status?"3"==t.status?redirectLoginPage():"theme1"==tt?showMessage(!1,t.message):showMessageTheme2(0,t.message,"",!0):$("#studentAssginedReportSearchContentDiv").html(studentAssignedReportContent(t,e,s)),!1}})}function getStudentAssignedRequest(t){var e={},a={};e.profileStatus=$("#"+t+" #profileStatus").val(),e.progressStatus=$("#"+t+" #progressStatus").val(),e.schoolId=SCHOOL_ID,e.teacherId=$("#"+t+" #teacherId").val(),e.teacherName=$("#"+t+" #teacherName").val(),e.officialEmail=$("#"+t+" #officialEmail").val();var r=getDateInDateFormat($("#"+t+" #startDate").val());r=changeDateFormat(r,"yyyy-mm-dd"),e.startDateFilter=r;var s=getDateInDateFormat($("#"+t+" #endDate").val());return s=changeDateFormat(s,"yyyy-mm-dd"),e.endDateFilter=s,e.page=$("#"+t+" #page").val(),e.pageSize=$("#"+t+" #pageSize").val(),e.orderKey=$("#"+t+" #orderKey").val(),e.orderBy=$("#"+t+" #orderBy").val(),a.hash=getHash(),a.schoolId=SCHOOL_ID,a.schoolUUID=SCHOOL_UUID,a.userId=USER_ID,a.userType=moduleId,e.authentication=a,e}function getStudentAssignedReportWithFilterSubmit(t,e,a){var r="studentAssignFilterForm",s="studentAssignedFilteredTable",n=USER_ROLE,o="",d=$("#standardId").val();if($("#standardId").val(-1).trigger("change"),"TSF"==t)$("#standardId").val(d).trigger("change"),0==$("#learningProgram").val().length||4==$("#learningProgram").val().length?o="":-1==$.inArray("BATCH",$("#learningProgram").val())?(a="PL",o="O"):(a="GL",o="B");else if("TSLearingProgram"==t)studentAssgineFilterReset("studentAssignFilterForm");else if("TSTotal"==t)studentAssgineFilterReset("studentAssignFilterForm");else if("TSGrade"==t){if(""==$("#gradeId_"+e).val())return!1;$("#standardId").val([$("#gradeId_"+e).val()]).trigger("change"),$("#learningProgram").val(-1).trigger("change"),$("#color").val(-1).trigger("change")}else"TSA"!=t&&"TSI"!=t||(studentAssgineFilterReset("studentAssignFilterForm"),"TSA"==t?$("#color").val(["GREEN","YELLOW","BLUE"]).trigger("change"):"TSI"==t&&$("#color").val(["RED"]).trigger("change"));if("TSF"!=t&&("GL"==a?(o="B",$("#learningProgram").val(["BATCH"]).trigger("change")):"PL"==a&&(o="O",$("#learningProgram").val(["ONE_TO_ONE","SCHOLARSHIP","ONE_TO_ONE_FLEX"]).trigger("change"))),$("#"+r+" #teacherId").val(e),""==$("#"+r+" #batchId").html()&&""!=$("#grades_"+e).attr("grades")){var l='<option value=""></option>',i=$("#grades_"+e).attr("grades").split("~");$.each(i,(function(t,e){var a=e.split("|");l+='<option value="'+a[0]+'">'+a[1]+"</option>"})),$("#"+r+" #batchId").html(l)}$("#studentAssignWithFilterBtn").attr("onClick","getStudentAssignedReportWithFilterSubmit('TSF',"+e+",'')"),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","get-assigned-teacher-report-with-filter"),dataType:"json",data:JSON.stringify(getStudentAssignedRequestWithFilter(r,o)),success:function(t){"0"==t.status||"2"==t.status||"3"==t.status?"3"==t.status?redirectLoginPage():"theme1"==tt?showMessage(!1,t.message):showMessageTheme2(0,t.message,"",!0):(filterModal("studentAssignFilterModal","hide"),$.fn.dataTable.isDataTable("#"+s)&&$("#"+s).dataTable().fnDestroy(),$("#"+s+" > tbody").html(""),$("#studentAssginedReportWtihFilterContentDiv").html(studentAssignedReportTableWithFilter(s,n)),$("#"+s+" > tbody").append(getStudentAssignedReportWithFilterBody(t.studentAssigedReportsWithFilter,userId,n)),$("#"+s).DataTable({order:[[0,$("#"+r+" #orderBy").val()]]}),$(".filterDiv").show());return!1}})}function getStudentAssignedRequestWithFilter(t,e){var a={},r={};a.callingFrom=e,a.schoolId=SCHOOL_ID,a.teacherId=$("#"+t+" #teacherId").val();var s=getDateInDateFormat($("#studentAssignedReportFilter #startDate").val());s=changeDateFormat(s,"yyyy-mm-dd"),a.startDateFilter=s;var n=getDateInDateFormat($("#studentAssignedReportFilter #endDate").val());return n=changeDateFormat(n,"yyyy-mm-dd"),a.endDateFilter=n,a.studentName=$("#"+t+" #studentName").val(),a.studentEmail=$("#"+t+" #studentEmail").val(),a.learningProgram=$("#"+t+" #learningProgram").val(),a.standardId=$("#"+t+" #standardId").val(),a.batchId=$("#"+t+" #batchId").val(),a.color=$("#"+t+" #color").val(),a.orderBy=$("#orderBy").val(),a.page=0,a.pageSize=500,a.orderKey="X.USER_FULL_NAME",r.hash=getHash(),r.schoolId=SCHOOL_ID,r.schoolUUID=SCHOOL_UUID,r.userId=USER_ID,r.userType=moduleId,a.authentication=r,a}function studentAssginedReportSearchReset(t){$("#"+t)[0].reset(),$("#"+t+" #reportDropdown").val("oneMonth").trigger("change"),$("#"+t+" #page").val("0"),$("#"+t+" #pageSize").val("10"),$("#"+t+" #officialEmail").val(""),$("#"+t+" #teacherId").val("")}function studentAssgineFilterReset(t){$("#"+t+" #studentName").val(""),$("#"+t+" #studentEmail").val(""),$("#"+t+" #learningProgram").val(-1).trigger("change"),$("#"+t+" #standardId").val(-1).trigger("change"),$("#"+t+" #batchId").val(-1).trigger("change"),$("#"+t+" #color").val(-1).trigger("change"),$("#"+t+" #orderBy").val("ASC")}function getStudenLastActivityDetails(t,e,a){customLoader(!0),hideMessage("");var r={};r.studentUserId=t,r.lmsUserId=e,r.entityId=a,r.userId=USER_ID,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","get-student-progress-report-detail"),data:JSON.stringify(r),dataType:"json",success:function(t){}})}function filterModal(t,e){$("#"+t).modal(e)}function teacherReportByDate(t){if($("#startDate, #endDate").attr("disabled",!0),"sevenDays"==$("#reportDropdown").val()){var e=new Date(today.getFullYear(),today.getMonth(),today.getDate()-6),a=today;$("#startDate").datepicker("setDate",e),$("#endDate").datepicker("setDate",a)}else if("fifteenDays"==$("#reportDropdown").val()){e=new Date(today.getFullYear(),today.getMonth(),today.getDate()-14),a=today;$("#startDate").datepicker("setDate",e),$("#endDate").datepicker("setDate",a)}else if("oneMonth"==$("#reportDropdown").val()){e=new Date(today.getFullYear(),today.getMonth(),1),a=new Date(today.getFullYear(),today.getMonth()+1,0);$("#startDate").datepicker("setDate",e),$("#endDate").datepicker("setDate",a)}else $("#startDate").datepicker("setDate",""),$("#endDate").datepicker("setDate",""),$("#startDate").removeAttr("disabled");"custom"!=$("#reportDropdown").val()&&studentTeacherValidDate(t)}function studentTeacherValidDate(t){if($(".reportTitle").html(today.toLocaleString("default",{month:"long"})+", "+today.getFullYear()),""!=$("#"+t+" #startDate").val()&&""!=$("#"+t+" #endDate").val()&&new Date($("#endDate").val()).getTime()>=new Date($("#startDate").val()).getTime()){var e=parseInt(Math.round(new Date($("#endDate").val()).getTime()-new Date($("#startDate").val()).getTime()/864e5)+1);e=" ("+parseInt(Math.round(Math.abs(new Date($("#endDate").val()).getTime()-new Date($("#startDate").val()).getTime())/864e5)+1)+")";$(".reportTitle").html($(".reportTitle").html()+e)}}function getStudentAssignedReportFromChart(t,e,a,r,s){var n="studentAssignFilterForm",o=(USER_ROLE,"");"TSF"!=t&&("GL"==a?o="B":"PL"==a&&(o="O")),$("#"+n+" #teacherId").val(e),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","get-assigned-teacher-report-with-filter"),dataType:"json",data:JSON.stringify(getStudentAssignedRequestFromChart(n,o,r,e,s)),success:function(t){if("0"==t.status||"2"==t.status||"3"==t.status)"3"==t.status?redirectLoginPage():"theme1"==tt?showMessage(!1,t.message):showMessageTheme2(0,t.message,"",!0);else{var e="",a=1;$.each(t.studentAssigedReportsWithFilter,(function(t,r){e+="<tr>",e+="<td>"+a+++"</td>",e+="<td>"+r.studentName+"</td> ",e+="<td>"+r.studentEmail+"</td> ",e+="<td>"+r.grade+"</td> ","RED"==r.color?e+='<td class="text-danger">Inactive</td> ':e+='<td class="text-success">Active</td> ',e+="</tr> "})),$("#chartactiveStudent").html(e)}return!1}})}function getStudentAssignedRequestFromChart(t,e,a,r,s){var n={},o={};return n.callingFrom=e,n.schoolId=SCHOOL_ID,n.teacherId=r,n.startDateFilter=$("#startFilDate").val(),n.endDateFilter=$("#endFilDate").val(),n.standardId=[s],n.color="inactive"==a?["RED"]:["GREEN","YELLOW","BLUE"],n.orderBy="asc",n.page=0,n.pageSize=500,n.orderKey="X.USER_FULL_NAME",n.activeStatus=a,o.hash=getHash(),o.schoolId=SCHOOL_ID,o.schoolUUID=SCHOOL_UUID,o.userId=USER_ID,o.userType=moduleId,n.authentication=o,n}function getTeacherPerformance(t,e,a,r,s){$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","teacher-class-management-content"),dataType:"json",data:JSON.stringify(getRequestForTeacherPerformance(t,a,r,s)),success:function(t){return console.log(t),"0"==t.status||"2"==t.status||"3"==t.status?"3"==t.status?redirectLoginPage():showMessageTheme2(0,t.message,"",!0):"myperformance"==a?t.studentAssigedReports.length>0&&getHtmlTeacherPerformance(t.studentAssigedReports[0]):t.studentAssigedReports.length>0&&getHtmlTeacherSalary(t.studentAssigedReports[0]),$("#commonloaderIdNewLoaderDefaultShow").addClass("hide-loader"),!1},error:function(t){checkonlineOfflineStatus()||$("#commonloaderIdNewLoaderDefaultShow").addClass("hide-loader")}})}function getRequestForTeacherPerformance(t,e,a,r){var s={};return s.userId=USER_ID,s.schoolId=SCHOOL_ID,s.smonth=a,s.syear=r,s}function getHtmlTeacherPerformance(t){t.todayPercentHrs;var e=0,a=0,r=t.completedClasses;if(r.length>0)for(let t=0;t<r.length;t++){const s=r[t];"GL"==s.learningProgram&&(a+=s.count),"PL"==s.learningProgram&&(e+=s.count)}$("#cclassCountPlGl").text(e+a),$("#cclassCountPl").text(e),$("#cclassCountGl").text(a),$(".performanceAgreedHrs").text(t.projectAvgHours),$(".performanceAcceptCompleteHrs").text(t.projectAttendHoursDay),$(".performancePendingHrs").text(t.pendingProjectAttendHoursDay),$(".averageAgreedHrs").text(t.averageHrs),$(".averageAcceptCompleteHrs").text(t.tillAverageClass),$(".averagePendingHrs").text(t.pendingAverageHrs),$(".projectHoursPercent").text(t.projectHoursPercent+"%");var s='<div class="progress-bar bg-info" role="progressbar" aria-valuenow="'+t.projectHoursPercent+'" aria-valuemin="0" aria-valuemax="100" style="width: '+t.projectHoursPercent+'%;"></div>';$(".progressbar").html(s);var n="";n+='<div class="widget-title">You have completed <span class="text-success bold"> '+t.projectHoursPercent+"%</span>&nbsp;of total hours for {startMonth}</div>",n+='<div class="widget-title">You have completed <span class="text-warning bold">'+t.projectHoursPendingPercent+"%</span>&nbsp;"+("Y"==t.averageCompletedStatus?"more":"less")+" hours than agreed hours for {startMonth}</div>",n+='<div class="widget-title">Your daily average is <span class="text-success bold">'+t.requiredPerDayPercent+"%</span>&nbsp;"+("Y"==t.averageCompletedStatus?"higher":"lower")+" than the agreed average</div>","N"==t.averageCompletedStatus&&(n+='<div class="widget-title">You need <span class="text-warning bold">'+t.averageRequiredHrsForComplete+"</span> hours per day now to match the agreed average</div>"),"Y"==t.averageCompletedStatus&&(n+='<div class="widget-title">You are already <span class="text-success bold">'+t.averageRequiredHrsForComplete+"</span> hours per day ahead of the agreed average</div>"),$(".completedPerformance").html(n),getPerformanceChart(t)}function getPerformanceChart(t){var e=1,a=[],r=[];for(let n=0;n<t.attendanceList.length;n++){const o=t.attendanceList[n];var s={};s.x="Category "+e,s.y=o.currenthrsPercent,parseInt(o.currenthrsPercent)>79?(s.fillColor="#52ebb6",s.strokeColor="#52ebb6"):parseInt(o.currenthrsPercent)>59&&parseInt(o.currenthrsPercent)<79?(s.fillColor="#266dc4",s.strokeColor="#266dc4"):(s.fillColor="#ffaf1a",s.strokeColor="#ffaf1a"),a.push(s),r.push('"'+o.day+'"'),e+=1}var n={series:[{name:"Working Hours",data:a}],chart:{height:350,type:"bar"},plotOptions:{bar:{borderRadius:10,dataLabels:{position:"top"}}},dataLabels:{enabled:!0,formatter:function(t){return t+"%"},offsetY:-20,style:{fontSize:"12px",colors:["#304758"]}},xaxis:{categories:r,position:"bottom",axisBorder:{show:!1},axisTicks:{show:!1},crosshairs:{fill:{type:"gradient",gradient:{colorFrom:"#D8E3F0",colorTo:"#BED1E6",stops:[0,100],opacityFrom:.4,opacityTo:.5}}},tooltip:{enabled:!0}},yaxis:{axisBorder:{show:!1},axisTicks:{show:!1},labels:{show:!1,formatter:function(t){return t+"%"}}}},o=new ApexCharts(document.querySelector("#chart-combined"),n);o.render(),o.update()}function getHtmlTeacherSalary(t){var e=$("#monthwise option:selected").text()+" "+$("#yearwise option:selected").text();$(".salaryTeacherName").text(t.teacherName),$(".salarycityname").text(t.cityname),$(".salarycountryname").text(t.countryname),$(".salaryoffset").text(t.offset);for(let e=0;e<t.gradeStudentCount.length;e++){t.gradeStudentCount[e].studentCount}for(let e=0;e<t.recommendedClasses.length;e++){t.recommendedClasses[e].count}for(let e=0;e<t.completedClasses.length;e++){t.completedClasses[e].count}for(let e=0;e<t.learningProgamCount.length;e++){const a=t.completedClasses[e];"GL"==a.learningProgramName&&a.activeCount+a.inactiveCount,"PL"==a.learningProgramName&&a.activeCount+a.inactiveCount}var a="";a+='<tr><td>Employee Status</td><td class="text-dark">'+t.employeeType+"</td></tr>",a+='<tr><td>Employee Code</td><td class="text-dark">'+t.applicationno+"</td></tr>",a+='<tr><td>Joining Date</td><td class="text-dark">'+t.joindate+"</td></tr>",""==t.firstMeeting&&(a+='<tr><td>First meeting </td><td class="text-dark">'+t.firstMeeting+"</td></tr>"),a+='<tr><td>Assigned Mode</td><td class="text-dark">';for(let e=0;e<t.learningProgamCount.length;e++){var r=t.learningProgamCount[e];a+=e>0?" | "+("PL"==r.learningProgramName?"1:1":"Group"):"PL"==r.learningProgramName?"1:1":"Group"}a+="</td></tr>",a+='<tr><td>Assigned Grades</td><td class="text-dark">';for(let e=0;e<t.gradeStudentCount.length;e++){var s=t.gradeStudentCount[e];a+=e>0?" | "+s.gradeNameShort:s.gradeNameShort}a+="</td></tr>",a+='<tr><td>Agreed Working Hours</td><td class="text-dark">'+t.workingHours+"</td></tr>",$("#salary_teacher_basic").html(a);var n="";n+='<div class="p-2 text-white">Salary Calculation : <b>'+e+"</b></div>",n+='<table class="table table-bordered nowrap row-height-small blue-border mb-1 bg-white">',n+="<tbody>",n+='<tr><td>Salary Agreed</td><td class="bold" style="width:120px;color:#3f6feb">'+t.payout.agreedPayout+"</td></tr>",n+="</tbody></table>",n+='<table class="table table-bordered nowrap row-height-small blue-border mb-0 bg-white">',n+="<tbody>",n+='<tr><td>Salary Till Now</td><td class="bold text-dark" style="width:120px">'+t.currentsal+"</td></tr>",n+="</tbody></table>",n+='<table class="table table-bordered nowrap row-height-small blue-border mb-0 bg-white">',n+='<tbody><tr><td>Total Accepted Hours till now<br/>(Class+Admin) </td><td class="bold text-success" style="width:120px">'+t.total_accept_hours+"</td></tr>",n+="</tbody></table>",$(".salary_calculation").html(n);var o="";o+='<div class="p-2 text-white">Classes & Hours Calculation: <b>'+e+"</b></div>",o+='<table class="table table-bordered nowrap row-height-small blue-border mb-1 bg-white">',o+="<tbody>",o+='<tr style="background:#cbe0f6;">',o+="<td></td>",o+="<td><b>Working Hours<br/>Submitted</b></td>",o+="<td><b>Working Hours<br/>Deducted after review</b></td>",o+="<td><b>Working Hours<br/>Accepted</b></td>",o+="</tr>",o+="<tr>",o+="<td><b>Group</b></td> ",o+='<td class="text-center">'+t.total_review_batch_hours+"</td> ",o+='<td class="bold text-center">'+t.total_minus_batch_hours+"</td> ",o+='<td class="text-center">'+t.total_accept_batch_hours+"</td> ",o+="</tr> ",o+="<tr> ",o+="<td><b>1:1</b></td> ",o+='<td class="text-center">'+t.total_review_one_hours+"</td> ",o+='<td class="text-center bold">'+t.total_minus_one_hours+"</td> ",o+='<td  class="text-center">'+t.total_accept_one_hours+"</td> ",o+="</tr> ",o+="<tr> ",o+="<td><b>Admin</b></td> ",o+='<td  class="text-center">'+t.total_review_admin_hours+"</td> ",o+='<td class="text-center bold">'+t.total_minus_admin_hours+"</td> ",o+='<td class="text-center">'+t.total_accept_admin_hours+"</td> ",o+="</tr> ",o+="<tr> ",o+="<td><b>Total</b></td> ",o+='<td class="text-center">'+t.total_review_hours+"</td> ",o+='<td class="text-center">'+t.total_minus_hours+"</td> ",o+='<td class="text-center text-success bold">'+t.total_accept_hours+"</td> ",o+="</tr> ",o+="</tbody> ",o+="</table> ",$(".class_hrs_calculation").html(o);var d="";if(t.attendanceList.length>0){for(let e=0;e<t.attendanceList.length;e++){const a=t.attendanceList[e];a.attendDetails;if(d+="<tr>",d+='<td class="text-dark">1</td>',d+='<td class="text-dark text-left">'+a.dayname+", "+a.attendanceDate+"</td>",d+='<td class="text-dark">',0==a.presentInt)d+="-";else if(a.presentInt>0){var l=a.attendDate.split("-")[2]+"-"+a.attendDate.split("-")[1]+"-"+a.attendDate.split("-")[0];d+='<a href="javascript:void(0)" class="font-weight-bold" onClick="'+("getTeacherClassReviewById('"+t.userId+"', '','class-salary','"+l+"','"+l+"','0,1');")+'"> '+a.presentInt+"</a>"}d+="</td>",d+='<td class="text-dark">',""==a.attendanceReviewDuration?d+="-":d+=a.attendanceReviewDuration,d+="</td>",d+='<td class="text-dark">',""==a.attendanceMinusDuration?d+="-":d+=a.attendanceMinusDuration,d+="</td>",d+='<td class="text-dark">',""==a.attendanceDuration&&""!=a.attendanceReviewDuration?d+='<span style="font-size:10px;background:yellow">Under Review</span>':""!=a.attendanceReviewDuration?d+=a.attendanceDuration:d+="-",d+="</td>",d+="<td class="+("A"==a.attendance?"text-danger":"text-success")+">"+a.attendance+"</td>",d+="</tr>"}$("#teacher_attendance").html(d)}var i="";i+="<tr>",i+="<th></th><th></th><th></th><th>Submitted Hours</th><th>Deducted Hours</th><th>Accepted Hours</th><th></th><th></th></tr>",i+="<tr><td></td><td></td><td></td>",i+="<td>"+t.total_review_hours+"</td>",i+="<td>"+t.total_minus_hours+"</td>",i+="<td><b>"+t.total_accept_hours+"</td>",i+="<td></td><td></td></tr>",$("#teacher_attendance_footer").html(i)}"dev"==ENVIRONMENT&&today.setMonth(today.getMonth()-1);