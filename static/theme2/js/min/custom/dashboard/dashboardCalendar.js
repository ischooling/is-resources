function validateRequestForSchoolHoliday(e){return""==$("#"+e+" #holidayFor").val()?(showMessage(1,"Please select holiday for"),!1):"STUDENT"==$("#holidayFor").val()&&""==$("#"+e+" #enrollType").val()?(showMessage(1,"Please select Enrollment type for"),!1):""==$("#"+e+" #holidayHome").val()?(showMessage(1,"Please enter holiday Subject"),!1):$("#"+e+" #holidayHome").val().length>100?(showMessage(1,"You cannot have more than 100 characters in Subject"),!1):""==$("#"+e+" #holidayStartDate").val()?(showMessage(1,"Please select start date"),!1):""!=$("#"+e+" #lmsPlatform").val()||(showMessage(1,"Please select LMS Platform"),!1)}function submitSchoolHoliday(e){if(hideMessage(""),!validateRequestForSchoolHoliday(e))return!1;var t={};t.userId=$("#"+e+" #userId").val(),t.holidayId=$("#"+e+" #holidayId").val(),t.standardId=$("#"+e+" #standardId").select2("val"),t.batchId=$("#"+e+" #batchId").select2("val"),t.studentId=$("#"+e+" #studentId").select2("val"),t.schoolId=SCHOOL_ID,t.enrollType=$("#"+e+" #enrollType").val(),t.holidayFor=$("#"+e+" #holidayFor").val(),t.holidayType=$("#"+e+" #holidayType").val(),"BATCH"==$("#"+e+" #enrollType").val()?t.lmsPlatform="38":"SSP"==$("#"+e+" #enrollType").val()?t.lmsPlatform="37,40,41":"SCHOLARSHIP"==$("#"+e+" #enrollType").val()?t.lmsPlatform="37,39,40,41":"ALL"==$("#"+e+" #enrollType").val()||"TEACHER"==$("#"+e+" #holidayFor").val()?t.lmsPlatform="37,38,39,40,41":"ONE_TO_ONE_FLEX"==$("#"+e+" #enrollType").val()?t.lmsPlatform="37":t.lmsPlatform="37,39,41","TEACHER"==$("#"+e+" #holidayFor").val()&&(t.lmsPlatform="37,38,39,40,41"),t.holidayHome=escapeCharacters($("#"+e+" #holidayHome").val()),t.holidayStartDate=$("#"+e+" #holidayStartDate").val(),null!=editor1&&(t.holidayRemark=escapeCharacters(editor1.getData())),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","school-holiday-submit"),data:JSON.stringify(t),dataType:"json",success:function(t){return"0"==t.status||"2"==t.status?showMessage(!0,t.message):($("#"+e+" #enrollType").val("").trigger("change"),$("#"+e+" #holidayFor").val("").trigger("change"),$("#"+e+" #standardId").val("").trigger("change"),$("#"+e+" #batchId").val("").trigger("change"),$("#"+e+" #studentId").val("").trigger("change"),$("#"+e+" #batchId").html(""),$("#"+e+" #studentId").html(""),initEditor(1,"mymceHoliday","Please start here",!0),$("#"+e+" #fileupload1Span").text("No file chosen..."),$("#"+e)[0].reset(),showMessage(!1,t.message)),!1},error:function(e){return!1}})}function updateSchoolHolidays(e,t,a,n){hideMessage("");var l={};l.userId=e,l.holidayId=t,l.controllType=a,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","holidays-update"),data:JSON.stringify(l),dataType:"json",success:function(e){return"0"==e.status||"2"==e.status?showMessage(!0,e.message):(showMessage(!1,e.message),setTimeout((function(){callDashboardPageSchool(n,"holiday-list")}),1e3)),!1},error:function(e){return!1}})}var CALENDAR_EVENT_DATA=[];function callSchoolCalendar(e,t,a,n,l,o,r){return new Promise(((s,i)=>{$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","school-calendar"),data:JSON.stringify(getRequestForSchoolCalendar(e,t,a,n,l,o)),dataType:"json",cache:!1,timeout:6e5,async:!0,success:function(e){if("0"===e.status||"2"===e.status)showMessageTheme2(0,e.message),s([]);else if("3"===e.status)redirectLoginPage(),i("Redirected to login");else{var t=[],a=e.event||[];a.length>0&&a.forEach((a=>{if(a.id.startsWith("announce",0)||a.id.startsWith("holiday",0))t.push(a);else{a.start=convertDatetimeWithFormat(a.start,a.timezone,USER_TIMEZONE,DATE_UTC+"T"+TIME_UTC),a.end=convertDatetimeWithFormat(a.end,a.timezone,USER_TIMEZONE,DATE_UTC+"T"+TIME_UTC);var n=a.start.split("T")[0];$.inArray(n,e.holidays)<0&&t.push(a)}})),$("#schoolcalendar").fullCalendar("removeEvents"),getFullCalendar(t,n),r&&$("#schoolcalendar").fullCalendar("addEventSource",t),s(t)}},error:function(e){console.error(e),i(e)}})}))}function getRequestForSchoolCalendar(e,t,a,n,l,o){""!=l&&null!=l||(l=todayDate()),""!=o&&null!=o||(o=todayDate());var r={};return r.userId=t,r.schoolId=SCHOOL_ID,r.agenda=n,r.startDate=changeDateFormat(new Date(moment(moment(l)).add(-1,"days")),"yyyy-mm-dd"),r.endDate="agendaDay"==n?changeDateFormat(new Date(moment(moment(l)).add(1,"days")),"yyyy-mm-dd"):changeDateFormat(new Date(moment(moment(o)).add(1,"days")),"yyyy-mm-dd"),r.uniqueId=a,r}function todayDate(){var e=new Date($("#currentTimeForUser").text()),t=e.getDate(),a=e.getMonth()+1;return t<10&&(t="0"+t),a<10&&(a="0"+a),e.getFullYear()+"-"+a+"-"+t}function firstDateMonth(){var e=new Date;return[new Date(e.getFullYear(),e.getMonth(),1),new Date(e.getFullYear(),e.getMonth()+1,0)]}function getHash(){return"ajslfkjalksdf"}var todayClassArray=[];function getFullCalendar(e){todayClassArray=[];var t=window.innerWidth<768?"listDay":"agendaDay";$("#schoolcalendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"agendaDay,agendaWeek"},buttonText:{today:"Today",month:"Monthly",week:"Weekly",day:"Daily"},forceEventDuration:!0,themeSystem:"bootstrap4",bootstrapFontAwesome:!0,defaultView:t,defaultDate:todayDate(),timeFormat:"h(:mm)a",navLinks:!0,editable:!1,allDayDefault:!1,eventLimit:!0,eventStartEditable:!1,minTime:"00:00:00",maxTime:"24:00:00",slotDuration:"00:30:00",events:e,eventClick:function(e){if(e.url)return getSession()?(classDetailsOnModal(e.url),!1):(redirectLoginPage(),!1);eventDetailsOnModal(e.id,e.title,e.activities)},eventRender:function(e,t){if(e.id.startsWith("announce",0)||e.id.startsWith("holiday",0));else if(e.start&&e.end){const t=e.start.format(),a=e.end.format();todayClassArray.some((n=>n.start===t&&n.endTime===a&&n.title===e.title))||todayClassArray.push({start:t,endTime:a,title:e.title})}updateEventIcons(e,t,todayClassArray)},eventAfterAllRender:function(){scrollEvent()},windowResize:function(){updateCalendarView()}}),CALENDAR_EVENT=!0,updateCalendarView()}function updateCalendarView(){var e;window.innerWidth<768?("agendaDay"!=(e=$("#schoolcalendar").fullCalendar("getView")).name&&"listDay"!=e.name||$("#schoolcalendar").fullCalendar("changeView","listDay"),"agendaWeek"!=e.name&&"listWeek"!=e.name||$("#schoolcalendar").fullCalendar("changeView","listWeek")):("agendaDay"!=(e=$("#schoolcalendar").fullCalendar("getView")).name&&"listDay"!=e.name||$("#schoolcalendar").fullCalendar("changeView","agendaDay"),"agendaWeek"!=e.name&&"listWeek"!=e.name||$("#schoolcalendar").fullCalendar("changeView","agendaWeek"),$("#legentCalendar").remove())}$(document).ready((function(){setInterval((function(){var e=new Date($("#currentTimeForUser").text()),t=e.getFullYear(),a=e.toLocaleString("en-US",{month:"short"}),n=e.getDate(),l=e.getHours(),o=e.getMinutes(),r=e.getSeconds(),s=l>=12?"PM":"AM";o=o<=9?"0"+o:o,r=r<=9?"0"+r:r,l=(l=(l%=12)||12)<=9?"0"+l:l,$(".user_current_day").text(a+" "+n+", "+t),$(".user_current_hour").text(l),$(".user_current_mins").text(o),$(".user_current_second").text(r),$(".user_current_am_pm").text(s)}),1e3)})),$(window).off("resize").on("resize",(function(){updateCalendarView()}));var updateEventIconsStyle=!0;function updateEventIcons(e,t,a){updateEventIconsStyle&&($("head").append("<style>.tooltip-inner{max-width:500px;width:fit-content}.fc-scroller.fc-time-grid-container[style]{height:425px !important}</style>"),updateEventIconsStyle=!1),a.length>0&&(t.attr("data-toggle","tooltip"),t.attr("data-container","body"),t.attr("data-html",!0),t.attr("data-original-title","Class Start Time: "+t.find(".fc-time span").text()+"</br>"+t.find(".fc-title").text()),setInterval((function(){var n=new Date($("#currentTimeForUser").text());if(null!=e.start&&null!=e.end){var l=new Date(e.start._i),o=new Date(e.end._i),r=(n.getDate(),n.getTime()),s=(l.getDate(),l.getTime()),i=o.getTime();if(t.find(".live-symbol").remove(),t.removeClass("live-class-blink"),t.removeClass("upcoming-class-blink"),t.find(".live-symbol").remove(),t.find(".upcoming-icon").remove(),r>=s&&r<=i){t.find(".fc-time span").find(".upcoming-symbol").remove();var d=$('<b class="blink d-inline-block pull-right live-symbol font-size-lg">ðŸ”´ Live Class</b>');orignalClassBg=t.css("background-color"),orignalClassborderColor=t.css("border-color"),t.find(".fc-time span").append(d),t.addClass("live-class-blink")}else if(r<i&&r<s&&$(".upcoming-class-blink").length<1){var c=getClosestUpcomingEvent(a);if(c&&c.title===e.title){var u=$('<b class="d-inline-block pull-right live-symbol font-size-lg upcoming-icon">ðŸ•’ Upcoming</b>');t.addClass("upcoming-class-blink"),t.find(".fc-time span").append(u)}}$('[data-toggle="tooltip"]').tooltip()}}),1e3),$("#legentCalendar").length<1&&window.innerWidth<768&&$("#schoolcalendar .fc-header-toolbar").prepend('<div class="d-flex w-100 flex-wrap justify-content-center mb-1" id="legentCalendar">\n\t\t\t\t\t<div class="mb-1 d-inline-flex align-items-center">\n\t\t\t\t\t\t<span class="d-inline-block mr-1" style="width:13px;height:13px;background:green"></span>\n\t\t\t\t\t\tLive Class\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="mb-1 d-inline-flex align-items-center">\n\t\t\t\t\t\t<span class="d-inline-block mr-1" style="width:13px;height:13px;background:#453900"></span>\n\t\t\t\t\t\tUpcoming class\n\t\t\t\t\t</div>\n\t\t\t\t</div>'))}function getClosestUpcomingEvent(e){var t=new Date($("#currentTimeForUser").text()),a=null,n=1/0;return e.forEach((function(e){var l=new Date(e.start);if(l>t){var o=l-t;o<n&&(n=o,a=e)}})),a}function eventDetailsOnModal(e,t,a){$(".calendarbox").attr("id",e),$("#"+e).modal("show"),$("#calendarbox_title").html(t),$("#"+e+" .activity_type .activity").html(a)}function startAndEndOfWeek(e){var t=e?new Date(e):new Date;t.setHours(0,0,0,0);var a=new Date(t);a.setDate(a.getDate()-a.getDay());var n=a.getFullYear()+"-"+(a.getMonth()>8?a.getMonth()+1:"0"+(a.getMonth()+1))+"-"+(a.getDate()>9?a.getDate():"0"+a.getDate()),l=new Date(t);return l.setDate(l.getDate()-l.getDay()+6),[n,l.getFullYear()+"-"+(l.getMonth()>8?l.getMonth()+1:"0"+(l.getMonth()+1))+"-"+(l.getDate()>9?l.getDate():"0"+l.getDate())]}function startAndEndOfMonth(e){var t=e?new Date(e):new Date;t.setHours(0,0,0,0);var a=new Date(t.getFullYear(),t.getMonth(),1),n=a.getFullYear()+"-"+(a.getMonth()>8?a.getMonth()+1:"0"+(a.getMonth()+1))+"-"+(a.getDate()>9?a.getDate():"0"+a.getDate()),l=new Date(t.getFullYear(),t.getMonth()+1,0);return[n,l.getFullYear()+"-"+(l.getMonth()>8?l.getMonth()+1:"0"+(l.getMonth()+1))+"-"+(l.getDate()>9?l.getDate():"0"+l.getDate())]}function callTeacherLastAttendance(e,a,n,l){$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","teacher-last-class"),data:JSON.stringify(getRequestForTeacherLastclass(e,a,n,l)),dataType:"json",async:!0,success:function(e){if("0"==e.status||"2"==e.status)showMessage(!0,e.message);else{var a=e.teacherClass.teacheClassList;if(null!=a){var n="",l=1;for(n+='<table class="table table-bordered responsive nowrap"><thead><th>sr no.</th><th>Grade</th><th>Duration</th></thead>',n+="<tbody>",t=0;t<a.length;t++)n+="<tr>",n+="<td>"+l+++"</td>",n+="<td>"+a[t].standard+"</td>",n+='<td class="text-center">'+a[t].jobSpentTime+"</td>",n+="</tr>";n+="</tbody>",n+='<tfoot><tr><th></th><th></th><th class="text-center">Total Duration - '+e.teacherClass.totaltime+"</th></tr></tfoot>",n+="</table>",$("#mteacherLastClass").html(n),$("#modalTeacherClass").modal("show"),window.setTimeout((function(){$("#modalTeacherClass").modal("hide")}),8e3)}}},error:function(e){console.log(e)}})}function getRequestForTeacherLastclass(e,t,a,n){var l=startAndEndOfMonth();""!=a&&null!=a||(a=l[0]),""!=n&&null!=n||(n=l[1]);var o={};return o.userId=t,o.schoolId=SCHOOL_ID,o.startDate=a,o.endDate=n,o}function getNeedAnyHelpForTeacher(e){var t={};t.userId=e,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","need-any-help-teacher"),data:JSON.stringify(t),dataType:"json",success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?("3"==e.status&&redirectLoginPage(),$(".reserve-seat-wrapper").hide()):"Y"==e.eligible&&(0==$("body #need-help-slide-wrapper").length&&$("body").append(getNeedAnyHelpHtml(e.standardId)),setTimeout((function(){needHelpContentShowTeacher(!0),setTimeout((function(){needHelpContentShowTeacher(!1)}),1e3*e.durationTime),setInterval((function(){needHelpContentShowTeacher(!0),setTimeout((function(){needHelpContentShowTeacher(!1)}),1e3*e.durationTime)}),1e3*e.timeInterval*60+1e3*e.durationTime)}),1e3*e.durationTime))}})}function needHelpContentShowTeacher(e){e?($(".reserve-seat-btn").addClass("slide-out-btn"),$(".need-help-slide-wrapper").show(),$(".need-help-slide-wrapper").addClass("slide-in"),$(".reserve-seat-slide-wrapper").removeClass("slide-in")):$(".need-help-slide-wrapper").removeClass("slide-in")}var scrollEventInterval=null;function scrollEvent(){scrollEventInterval&&(clearInterval(scrollEventInterval),scrollEventInterval=null),scrollEventInterval=setInterval((function(){let e=$(".live-class-blink").length?$(".live-class-blink"):$(".upcoming-class-blink");if(e.length>0&&e.offset()){const t=e.offset().top-45;$(".fc-scroller.fc-time-grid-container").animate({scrollTop:t},1e3),clearInterval(scrollEventInterval)}}),100)}function calendarEventBind(){$(document).on("click",".fc-day-header, .fc-next-button, .fc-prev-button, .fc-agendaDay-button, .fc-agendaWeek-button",(function(){if(getSession()){var e=$("#schoolcalendar").fullCalendar("getView").name,t=$("#schoolcalendar").fullCalendar("getDate"),a=t.format("YYYY-MM-DD"),n=t.format("YYYY-MM-DD");if("agendaDay"===e||"listDay"==e);else if("agendaWeek"===e||"listWeek"===e){const e=startAndEndOfWeek(new Date(a));a=e[0],n=e[1]}callSchoolCalendar("",USER_ID,UNIQUEUUID,e,a,n,!0)}else redirectLoginPage()}))}