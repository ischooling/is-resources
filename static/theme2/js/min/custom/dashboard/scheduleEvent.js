var noOfPages,meeting_Id,renderRecord=10,currentPage=1,showPageLimit=2,leftLimit=currentPage-showPageLimit,rightLimit=currentPage+showPageLimit+1,startPageLimit=5,startDots=1,advSearch=!1,noRecordFlag=!1,confirmationFlag=!0;function renderDataForScheduledEvents(e,t,a,n,o){getScheduleEventContent(),getDataForScheduledEvents(e,t,a,n,o)}function getDataForScheduledEvents(e,t,a,n,o){if(customLoader(!0),"ADV"==n&&(advSearch=!0,noRecordFlag&&(noRecordFlag=!1)),""==$("#counselorName").val())return showMessageTheme2(0,"Please select a counselor"),customLoader(!1),!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("timeavailability","get-data-for-scheduled-events"),data:JSON.stringify(getCallRequestForAdvanceSearchOfEvents(e,t,a,n)),dataType:"json",async:!0,global:!1,success:function(s){if("0"==s.status||"2"==s.status||"3"==s.status)"3"==s.status?redirectLoginPage():showMessageTheme2(0,s.message,"",!0);else{var i=!1,r=$("#"+e+" #pageSize").val();null==r&&(r=10),($("#"+e+" #pageSize").val()>=s[o]||s[o]<=r)&&(i=!0),null!=s[o]&&null!=s[o]&&""!=s[o]?(currentPage=parseInt(a),noOfPages=(noOfPages=(noOfPages=parseInt(s[o])/10).toString().split(".")).length>1?parseInt(noOfPages[0])+1:parseInt(noOfPages[0])):noRecordFlag=!0,console.log(s.eventDetails),$("#scheduleEventThumbAndTableDate").html(scheduleEventthumb(s)+scheduleEventListDetails(s.eventDetails,t,currentPage,n,i,o)+moveEventModal()),$("#scheduleEventsSearchForm").slideUp(700),customLoader(!1)}},error:function(e){checkonlineOfflineStatus()||customLoader(!1)}})}function getCallRequestForAdvanceSearchOfEvents(e,t,a,n){var o={};if(o.noRecordFlag=noRecordFlag,o.advSearch=advSearch,o.userId=USER_ID,o.schoolId=SCHOOL_ID,o.clickFrom=t,o.currentPage=a,""==$("#"+e+" #eventType option:selected").val()?o.eventId=0:o.eventId=$("#"+e+" #eventType option:selected").val(),o.counselorId=$("#userId").val(),"advance-search"==t){var s=$("#sortBy").val(),i=$("#withRecordings").val();o.learningProgram=$("#"+e+" #learningProgram option:selected").val(),o.standardId=$("#"+e+" #gradeId option:selected").val(),o.inviteeName=$("#"+e+" #inviteeName").val(),o.inviteeEmail=$("#"+e+" #inviteeEmail").val(),o.phNo=$("#"+e+" #inviteePhoneNo").val(),o.eventId=$("#"+e+" #eventType option:selected").val(),o.counselorId=$("#"+e+" #counselorName option:selected").val(),o.countryId=$("#"+e+" #countryId option:selected").val(),null!=$("#"+e+" #countryId option:selected").val()&&""!=$("#"+e+" #countryId option:selected").val()&&(o.country=$("#"+e+" #countryId option:selected").text()),o.startDate=$("#"+e+" #startDate").val(),o.endDate=$("#"+e+" #endDate").val(),null!=$("#"+e+" #searchBy option:selected").val()&&""!=$("#"+e+" #searchBy option:selected").val()&&(o.searchByDate=$("#"+e+" #searchBy option:selected").text()),o.meetingStatus=$("#"+e+" #meetingStatus option:selected").val(),o.sortBy=s,o.withRecordings=i,o.subSearch=n}return null!=n&&""!=n||(o.subSearch="TD"),o.pageSize=$("#"+e+" #pageSize").val(),console.log(o),o}function scheduleEventFormReset(e){$("#"+e+" .form-control").each((function(){if($(this).hasClass("select2-hidden-accessible"))$(this).children().length>1&&""==$(this).first().children().val()&&$(this).val("").trigger("change");else if($(this).hasClass("datepicker"))$(this).val("").datepicker("update");else if($(this).hasClass("select-first-value")){var e=$(this).attr("id"),t=$("#"+e+" option:first-child").val();$(this).val(t).trigger("change")}else"pageSize"==$(this).attr("id")?$(this).val("10"):$(this).val("")}))}function sendMailToInviteeForDemo(e){var t={};t.meetingId=e,t.userId=USER_ID,t.schoolId=SCHOOL_ID,customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("timeavailability","send-demo-mail-to-invitee"),data:JSON.stringify(t),dataType:"json",async:!0,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status?redirectLoginPage():showMessageTheme2(0,e.message,"",!0):(showMessageTheme2(1,e.message,"",!0),customLoader(!1))},error:function(e){customLoader(!1)}})}function updateMeetingStatus(e,t){var a=$("#status").val(),n=$("#remarks").val();if(null==a||null==a||0==a||""==a)return showMessageTheme2(0,"Status field is required.","",!0),!1;if(confirmationFlag&&"CANCELLED"==a&&0!=t)return $("#confirmeUpdateSystemTraningModal").modal("show"),!1;var o={};o.meetingId=e,o.leadId=t,o.userId=USER_ID,o.schoolId=SCHOOL_ID,o.status=a,o.remarks=n,customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("timeavailability","update-meeting-status"),data:JSON.stringify(o),dataType:"json",async:!0,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status?redirectLoginPage():showMessageTheme2(0,e.message,"",!0):($("#meetingStatus_"+t).html($("#scheduleEventMeetingStatus #status option:selected").text()),$("#meetingComments_"+t).html($("#scheduleEventMeetingStatus #remarks").val()),$("#confirmeUpdateSystemTraningModal").modal("hide"),$("#updateSystemTraningModal").modal("hide"),showMessageTheme2(1,e.message,"",!0),customLoader(!1))},error:function(e){customLoader(!1)}})}function openUpdateStatusModal(e,t,a,n,o,s,i,r,l,d,c,u,m,g,p,h,v,f,y,T,S){confirmationFlag=!0,$("#updateModalWrapper").html(updateSystemTraningModal(e,t)),$("#confirmeUpdateModalWrapper").html(confirmeUpdateSystemTraningModal(e,t,a,n,o,s,i,r,l,d,c,u,m,g,p,h,v,f,y,T,S)),$("#updateSystemTraningModal").modal("show")}function comfirmeupdateMeetingStatus(e,t,a){"Yes"==a?(confirmationFlag=!1,updateMeetingStatus(e,t)):($("#confirmeUpdateSystemTraningModal").modal("hide"),$("#updateSystemTraningModal").modal("show"))}function openRecordingModal(e,t,a,n,o,s,i,r,l){const d={entityId:e,entityName:t,meetingDate:formatDateToYYYYMMDDHH(convertLocalToUTC(r+" "+l,"YYYY-MM-DD HH:mm:ss",BASE_TIMEZONE,"YYYY-MM-DD HH:mm:ss")),meetingType:"DEMO"};$.ajax({type:"POST",url:BASE_URL+CONTEXT_PATH+SCHOOL_UUID+"/api/v1/leads/get-event-recordings",data:JSON.stringify(d),contentType:"application/json",success:function(e){const t=JSON.parse(e);if(0===t.statusCode&&"success"===t.status){const e=t.data.recordingUrls;e&&e.length>0?populateRecordingModal(e,a,n,o,s,i):showMessageTheme2(0,"No recordings available.","",!0)}else showMessageTheme2(0,`Error: ${t.message}`,"",!0)},error:function(e){console.error("Error Fetching the data:",e.message)}})}function populateRecordingModal(e,t,a,n,o,s){const i={"shared_screen_with_speaker_view.mp4":"Shared Screen with Speaker View","active_speaker.mp4":"Active Speaker","shared_screen_with_gallery_view.mp4":"Shared Screen With Gallery View","gallery_view.mp4":"Gallery View","shared_screen.mp4":"Shared Screen","shared_screen_with_speaker_view_CC.mp4":"Shared Screen With Speaker View CC","-1.1.mp4":"Recording","-1.2.mp4":"Recording 2",audio_only:"Audio File"};let r=`\n        <div id="recordingModal" class="modal fade" tabindex="-1">\n            <div class="modal-dialog" style="max-width:70%;">\n                <div class="modal-content">\n                    <div class="modal-header theme-bg">\n                        <h5 class="modal-title text-white">Available Recordings | ${t} | ${a} | ${n} ${o} | ${s}</h5>\n                        <button onclick="closeAllVideoModal();" type="button" class="close btn-close text-white" data-bs-dismiss="modal" aria-label="Close">&times;</button>\n                    </div>\n                    <div class="modal-body" style='max-height: 80vh; overflow-y: auto;'>`;e.forEach((e=>{const t=e.meetingId,a=e.urls.map((e=>{for(const t in i)if(e.url.includes(t))return{url:e.url,title:i[t]}})),n=e.urls[e.urls.length-1]?.url;a.length>0&&(r+=`\n                <div class="session-block pb-4">\n                    <h5>Meeting ID: ${t}</h5>\n                    ${a.map(((e,t)=>`\n                        <div class="recording-item pb-3 pt-2 px-3 d-flex justify-content-between align-items-center" style="border-bottom:1px solid #eee;">\n                            <h6>${t+1}. ${e.title}</h6>\n                            <button class="btn btn-primary" onclick="playRecording('${e.url}', '${e.title}')">Play</button>\n                        </div>\n                    `)).join("")}\n                    ${n?`\n                            <div class="recording-item pb-3 pt-2 px-3 d-flex justify-content-between align-items-center" style="border-bottom:1px solid #eee;">\n                                <h6>${a.length+1}. Transcript</h6>\n                                <button class="btn btn-secondary" onclick="showVTTFile('${n}', 'Transcript')">Read</button>\n                            </div>`:""}\n                </div>`)})),r+="\n                    </div>\n                </div>\n            </div>\n        </div>\n    ";let l=$("#recordingModal");l.length>0&&l.remove(),$("body").append(r),$("#recordingModal").modal("show")}function playRecording(e,t){let a=$("#videoModal");$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:getURLForSignVideo(e),success:function(e){if(0==e.status){const n=e.url;0==a.length?$("body").append(`\n                        <div id="videoModal" class="modal fade" tabindex="-1">\n                            <div class="modal-dialog" style="max-width:70%;">\n                                <div class="modal-content">\n                                    <div class="modal-header theme-bg">\n                                        <h5 class="modal-title text-white">${t}</h5>\n                                        <button onclick="closeVideoModal();" type="button" class="close btn-close text-white" data-bs-dismiss="modal" aria-label="Close">&times;</button>\n                                    </div>\n                                    <div class="modal-body text-center">\n                                        <video class="videoTag w-100" controls>\n                                            <source src="${n}" type="video/mp4" />\n                                            Your browser does not support the video tag.\n                                        </video>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    `):(a.find(".modal-title").text(t),a.find(".videoTag source").attr("src",n),a.find(".videoTag")[0]?.load()),$("#videoModal").modal("show")}else showMessageTheme2(0,e.message||"Failed to fetch video URL","",!0);customLoader(!1)},error:function(e){console.error("Error fetching signed video URL:",e.message),showMessageTheme2(0,"Error fetching video.","",!0),customLoader(!1)}})}function getURLForSignVideo(e){const t=JSON.stringify({url:e}),a=window.btoa(t);return BASE_URL+CONTEXT_PATH+"videos/signed-url?payload="+a}function getURLForTranscriptContent(e){var t=JSON.stringify({url:e}),a=window.btoa(t);return BASE_URL+CONTEXT_PATH+"transcript/show-content?payload="+a}function convertToVTT(e){if(!e.endsWith(".mp4"))return null;const t=new URL(e),a=t.pathname.replace(/\/([^\/]+)-(\d+\.\d+)\.mp4$/,"/$1-transcript-$2.vtt");let n=t.origin+a;if(n===e){const t="https://ischoolingwise.s3.us-east-1.amazonaws.com/recordings/";n=`${t}${e.split(t)[1].split("-")[0]}-transcript-1.1.vtt`}return n}function displayVTT(e,t){const a=$("#transcript-modal-body");(a.empty(),e.includes("<Error><Code>"))?a.append('<p style="font-size: 18px;">No Transcript Available</p>'):e.split("\n").forEach((e=>{var t=$("<p></p>").text(e);a.append(t)}));$("#transcriptModalTitle").html(t),$("#transcriptModal").modal("show")}function showVTTFile(e,t){0===$("#transcriptModal").length&&$("body").append('\n            <div id="transcriptModal" class="modal fade" tabindex="-1">\n                <div class="modal-dialog" style="max-width:70%;">\n                    <div class="modal-content" style="height: 80vh;">\n                        <div class="modal-header theme-bg">\n                            <h5 id="transcriptModalTitle" class="modal-title text-white">Transcript</h5>\n                            <button type="button" class="close btn-close text-white" data-bs-dismiss="modal" aria-label="Close" onclick="closeTranscriptModal();">&times;</button>\n                        </div>\n                        <div id="transcript-modal-body" class="modal-body text-left" style="overflow-y: auto;">\n                            \x3c!-- Transcript content will be populated here --\x3e\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),customLoader(!0);const a=convertToVTT(e);$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:getURLForTranscriptContent(a),success:function(e){customLoader(!1),displayVTT(e.content,t)},error:function(){customLoader(!1),showMessageTheme2(0,"Failed to load transcript.","",!0)}})}function closeAllVideoModal(){$("#recordingModal").modal("hide")}function closeVideoModal(){const e=$("#videoModal .videoTag")[0];e&&(e.pause(),e.currentTime=0),$("#videoModal").modal("hide")}function closeTranscriptModal(){$("#transcriptModal").modal("hide")}function formatDateToYYYYMMDD(e){if(!e)return null;const t=new Date(e);if(isNaN(t))return null;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function formatDateToYYYYMMDDHH(e){if(!e)return null;const t=new Date(e);if(isNaN(t))return null;return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")+" "+String(t.getHours()).padStart(2,"0")}