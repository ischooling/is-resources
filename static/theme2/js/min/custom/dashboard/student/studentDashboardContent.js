var player,player1,flagWatchVideo=!1,isSkipped=!1,videoUrl="N";function rendereDashboardContent(e){customLoader(!0),$("body").append(batchImpAnnouncementModal());var a=getStudentDashboardOrMigrationSection();if("N"==a.studentGraduate){"Y"==a.showBatchImpAnnouncementModal?($("#batchImpAnnouncementModal").modal("hide"),$("#batchStudentMappingId").val(a.batchStudentMappingId),$("#batchStartDate").text(a.batchAcademicYearStartDate),$("#batchFeeDueDate").text(a.feePayDueDate)):$("#batchImpAnnouncementModal").modal("hide"),"Y"!=a.firstTimeRequest||"Y"!=a.timePrefrenceSelectionStatus||"Skipped"!=a.systemTrainingStatus&&"COMPLETED"!=a.systemTrainingStatus||($("#welcomeNoteModal").modal("show"),window.setTimeout((function(){$("#welcomeNoteModal").modal("hide")}),8e3));var t=getStudentDashboardDetails();videoUrl=t.videoUrl,"false"!==e&&(t.isParent=!0),renderStudentDashboard(t),renderAnnouncement(t.userId),renderActitify(t.userId),getCartDetails(t.userId),setTimeout((function(){getReserveASeatForNextGrade(t.userId)}),1e4),$("#timeStuStandardId").val(t.studentStandardId),"Y"==a.showStudentCourseSelectionModel&&getStudentTimePreference(a.studentId,a.standardId,a.providerId)}else"Y"==a.studentGraduate&&("Y"==a.showBatchImpAnnouncementModal?($("#batchStartDate").text(a.batchAcademicYearStartDate),$("#batchFeeDueDate").text(a.feePayDueDate),$("#batchImpAnnouncementModal").modal("hide"),$("#batchStudentMappingId").val(a.batchStudentMappingId)):$("#batchImpAnnouncementModal").modal("hide"),a=getStudentMigraionOptionDetails(),"false"!==e&&(t.isParent=!0),renderMigrationDetailsOptionContent(a));"true"!==e&&(a.lastPassUpdatedDate||window.setTimeout((function(){callCommonDashboardPageForPasswordChange("14","No")}),1e3)),getChat(a.email,USER_ROLE)}async function renderStudentDashboard(e){var a=dashboardContent(e);$("#dashboardContentInHTML").html(a),$("#currentTimeForUser").html(convertUTCToTimezoneAs(getUTCTime(),DATETIME_FORMATTER,e.userTimezone).format("MMM DD, YYYY hh:mm:ss a")),setInterval((function(){$("#currentTimeForUser").html(convertUTCToTimezoneAs(getUTCTime(),DATETIME_FORMATTER,e.userTimezone).format("MMM DD, YYYY hh:mm:ss a"))}),1e3);for(var t=$(".card-activity .vertical-nav-menu > .sub-menu").length,n=1;n<=t;n++){var l=$(".card-activity .vertical-nav-menu  .sub-menu:nth-child("+n+") > ul .sub-menu").length;if($(".card-activity .vertical-nav-menu > .sub-menu:nth-child("+n+") ul li").length<1)$(".card-activity .vertical-nav-menu > .sub-menu:nth-child("+n+") a").addClass("disable-activity");else if(l>=1)for(var i=1;i<=l;i++)$(".card-activity .vertical-nav-menu  .sub-menu:nth-child("+n+")").addClass("mm-active"),$(".card-activity .vertical-nav-menu > .sub-menu:nth-child("+n+")  ul").addClass("mm-show"),$(".card-activity .vertical-nav-menu > .sub-menu:nth-child("+n+") > ul > .sub-menu:nth-child("+i+")").addClass("mm-active"),$(".card-activity .vertical-nav-menu > .sub-menu:nth-child("+n+") > ul > .sub-menu:nth-child("+i+") ul").addClass("mm-show");else $(".card-activity .vertical-nav-menu > .sub-menu:nth-child("+n+")  ul").addClass("mm-show"),$(".card-activity .vertical-nav-menu  .sub-menu:nth-child("+n+")").addClass("mm-active")}$(".announcement-anchor .announcement-list").click((function(){$(this).parent().find(".horizontal-scroll-table").slideToggle(),$(this).parent().closest("li").siblings().find(".horizontal-scroll-table").slideUp()}));var o=new Date,s=moment(o).format("YYYY-MM-DD"),d=moment(o).add(1,"days").format("YYYY-MM-DD");callSchoolCalendar("",USER_ID,UNIQUEUUID,"agendaDay",s,d,!1),calendarEventBind(),setTimeout((function(){$("button.fc-today-button").unbind("click").bind("click",(function(){$("#schoolcalendar").fullCalendar("today");var e=$("#schoolcalendar").fullCalendar("getView").name,a=$("#schoolcalendar").fullCalendar("getDate");if("agendaDay"===e)var t=new Date,n=moment(t).format("YYYY-MM-DD"),l=moment(t).add(1,"days").format("YYYY-MM-DD");else if("agendaWeek"===e){n=a.format("YYYY-MM-DD");var i=new Date(n),o=startAndEndOfWeek(i);n=o[0],l=o[1]}callSchoolCalendar("",USER_ID,UNIQUEUUID,e,n,l,!0)}))}),1e3),e.schoolId,$("#moveToTimePreferencePopup").click((function(){$("#mandatoryVideoModal").modal("hide"),$("#timePreferencePopup").removeClass("d-none"),$("#timePreferencePopup").modal("show")})),"N"!=e.videoUrl&&onYouTubeIframeAPIReady(e.videoUrl)}function slideMenu(e){$("#main-nav1").metisMenu({toggle:!1})}function dashboardContent(e){var a='<div class="app-page-title pt-1 pb-1 mb-2"><div class="page-title-wrapper"><div class="page-title-heading w-100"><div class="page-title-actions mt-0 mb-1 d-lg-none pt-4"><div class="d-inline-block"><label class="switch"><input class="switch-input redirectLmsUrl" type="checkbox" value="yes" onclick="redirectLms(this, \''+e.isPayLmsPaymentPending+'\');" changeUrl="'+e.lmsProviderURL+'" /><span class="switch-label" data-on="" data-off="LMS"></span><span class="switch-handle"></span></label></div></div></div></div>'+dashboardSchoolCalendar(e);return"STUDENT"==USER_ROLE&&(a+=calendarMeetingLinkValidate()),a}function dashboardAnnouncement(e){var a='<div class="card box-shadow-none"><div class="card-header theme-bg text-white justify-content-between card-header-primary d-flex"><h6 class="pull-left m-0 font-size-md">';return null!=e.schoolAnnouncements&&e.schoolAnnouncements.newAnnouncementCount>0?a+=e.schoolAnnouncements.newAnnouncementCount+" New Announcement(s)":a+="Announcement",a+='</h6></div><div class="card-body announcement-card-scroll"><div class="announcement-wrapper"><ul>',null!=e.schoolAnnouncements&&e.schoolAnnouncements.schoolAnnounceDTO.length>0?$.each(e.schoolAnnouncements.schoolAnnounceDTO,(function(e,t){a+='<li class="col-md-12 col-sm-12 col-12 p-0"><div class="announcement-anchor" onclick="showAnnounceDataById('+t.announceId+","+moduleId+');"><div class="announcement-list"><span class="annoucement-icon"><i class="fa fa-bullhorn"></i>',"N"==t.replyStatus&&(a+='<label class="new-label">New</label>'),a+='</span><h4 class="announcement-title"><span>'+t.announceTitle,"N"==t.replyStatus&&"Y"==t.latestStstus&&(a+='<label class="m-0 announcement-ribbon">New</label><i class="fa fa-star announcement-ribbon-star"></i>'),a+="</span></h4></div></div></li>"})):a+='<li class="col-md-12 col-sm-12 col-xs-12 text-center">No new announcements</li>',a+="</ul></div></div></div>"}function dashboardSchoolCalendar(e){return html='<div class="main-card mb-3"><div class="full"><div class="card-body px-0 pb-0"><div class="row">',"STUDENT"==e.userRole||"TEACHER"==e.userRole?html+='<div class="col-lg-8 col-md-8 col-sm-12 col-12 pt-2">':html+='<div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">',html+='<div class="full  mt-1"><div class="card"><div class="card-body"><span id="currentTimeForUser" class="d-none"></span><div class="text-center mb-2"><span class="user_timezone d-inline-block font-size-lg"><label>'+e.userTimezone+'&nbsp;</label></span><span class="clock-box ml-1"><label class="user_current_day bg-primary text-white clock-bg font-size-lg time-label"></label></span><span class="clock-box ml-1"><label class="user_current_hour bg-primary text-white clock-bg font-size-lg time-label"></label></span><span class="clock-box ml-1 position-relative mr-3"><label class="user_current_mins bg-primary text-white clock-bg font-size-lg time-label"></label><label class="user_current_second bg-primary text-white clock-bg time-label"></label></span><span class="clock-box ml-2"><label class="user_current_am_pm bg-primary text-white clock-bg font-size-lg time-label"></label></span></div><hr/><div class="position-relative" style="z-index:0;" id="schoolcalendar"></div></div></div></div></div>',"STUDENT"!=e.userRole&&"TEACHER"!=e.userRole||(html+='<div class="col-lg-4 col-md-4 col-sm-12 pt-2 col-12 animated zoomIn"><div class="full" id="announcementDiv"></div><div class="full mt-3" id="activityDiv"></div></div>'),html+='</div></div></div></div><div id="announceDataId" class="full"></div>'+holidayOne()+onBordingMandotryVideo(),html}function holidayOne(){return'<div class="modal fade calendarbox" id="holiday1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-modal="true"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header pt-2 pb-2 theme-bg text-white"><h5 class="modal-title" id="calendarbox_title"></h5><button type="button" class="close text-white" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">X</span></button></div><div class="modal-body"><p class="activity_type"><b><span class="activity"></span></b></p></div></div></div></div>'}function batchImpAnnouncementModal(){return`<div id="batchImpAnnouncementModal" class="modal fade bd-example-modal-lg fade-scale" data-backdrop="static" data-keyboard="false" tabindex="" role="dialog">\n                <input type="hidden" id="batchStudentMappingId">\n                <input type="hidden" id="batchStudentMappingId">\n                <div class="modal-dialog modal-dialog-centered box-shadow-none" role="document" style="max-width: 715px;">\n                    <div class="modal-content">\n                        <div class="modal-header py-2 bg-primary">\n                            <h5 class="modal-title text-white text-left">Important Announcement</h5>\n                        </div>\n                        <div class="modal-body">\n                            <h6 class="font-weight-semi-bold text-justify text-primary" style="line-height: 26px;">Our Group Learning batch for UTC+ time zone starts on Sept 18, 2024 and for UTC- time zone starts on Sep 25, 2024! To secure your enrollment please make sure to pay the full fee at the earliest. Don't miss out - enroll today!</h6>\n                            <h6 class="d-flex flex-wrap align-items-center justify-content-start font-weight-semi-bold  mt-3 fullView" style="gap:10px">\n                                For any queries regarding enrollment, please\n                                <a target="_blank" href="https://chat.internationalschooling.org/onboarding-support?uuid=${UNIQUEUUID}" class="notify-bell-chat d-flex justify-content-center align-items-center group position-relative" style="width: fit-content;">\n                                    <svg class="chat-logo bg-primary" width="35" height="35" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                        <path d="M16.0156 16.0156V16.7969C16.0156 17.4414 15.4883 17.9688 14.8438 17.9688H7.61719L7.42188 18.125L4.88281 20.0781V17.9688H3.32031C2.67578 17.9688 2.14844 17.4414 2.14844 16.7969V8.59375C2.14844 7.94922 2.67578 7.42188 3.32031 7.42188H7.8125V6.64062H3.32031C2.24609 6.64062 1.36719 7.51953 1.36719 8.59375V16.7969C1.36719 17.8711 2.24609 18.75 3.32031 18.75H4.10156V21.6797L7.89063 18.75H14.8438C15.918 18.75 16.7969 17.8711 16.7969 16.7969V16.0156H16.0156Z" fill="white"/>\n                                        <path d="M21.6797 4.29688C22.3242 4.29688 22.8516 4.82422 22.8516 5.46875V13.6719C22.8516 14.3164 22.3242 14.8438 21.6797 14.8438H20.1172V16.9727L17.5781 15.0195L17.3828 14.8438H10.1562C9.51172 14.8438 8.98438 14.3164 8.98438 13.6719V5.46875C8.98438 4.82422 9.51172 4.29688 10.1562 4.29688H21.6797ZM21.6797 3.51562H10.1562C9.08203 3.51562 8.20312 4.39453 8.20312 5.46875V13.6719C8.20312 14.7461 9.08203 15.625 10.1562 15.625H17.1094L20.8984 18.5547V15.625H21.6797C22.7539 15.625 23.6328 14.7461 23.6328 13.6719V5.46875C23.6328 4.39453 22.7539 3.51562 21.6797 3.51562Z" fill="white"/>\n                                    </svg>\n                                    <span class="chat-message" style="box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, .5) !important;padding:8px 5px 8px 22px">\n                                        Talk to School Administration\n                                    </span>\n                                    <span class="UNSEEN start-100 translate-middle badge position-absolute"></span>\n                                </a>\n                            </h6>\n                        </div>\n                        <div class="modal-footer justify-content-center">\n                            <button type="button" class="btn bg-primary text-white btn-shadow float-right px-4 b-4" onclick="updateAnnouncementAcknowledgeStatus();">Acknowledge & Close</button>\n                        </div>\n                    </div>\n                </div>\n            </div>`}function onBordingMandotryVideo(){return'\n            <div class="modal fade fade-scale" id="mandatoryVideoModal" data-backdrop="static">\n            <div class="modal-dialog modal-lg modal-dialog-centered box-shadow-none" role="document">\n                <div class="modal-content text-center">\n                    <div class="modal-header pt-2 pb-2 bg-primary text-white justify-content-center">\n                        <h5 class="heading">Welcome! '+USER_FULL_NAME+'</h5>\n                    </div>\n                    <div class="modal-body d-flex flex-wrap px-1 full pt-1">\n                        <div class="d-flex w-100 my-2">\n                            <div class="header-dots mr-0 position-relative ml-auto" style="min-width: 60px;">\n                                <a target="_blank" href="https://chat.internationalschooling.org/signIn?uuid='+UNIQUEUUID+'" class="notify-bell-chat d-flex justify-content-center align-items-center group">\n                                    <svg class="chat-logo bg-primary" width="25" height="25" viewBox="0 0 25 25" fill="none" xmlns="http://www.w3.org/2000/svg">\n                                        <path d="M16.0156 16.0156V16.7969C16.0156 17.4414 15.4883 17.9688 14.8438 17.9688H7.61719L7.42188 18.125L4.88281 20.0781V17.9688H3.32031C2.67578 17.9688 2.14844 17.4414 2.14844 16.7969V8.59375C2.14844 7.94922 2.67578 7.42188 3.32031 7.42188H7.8125V6.64062H3.32031C2.24609 6.64062 1.36719 7.51953 1.36719 8.59375V16.7969C1.36719 17.8711 2.24609 18.75 3.32031 18.75H4.10156V21.6797L7.89063 18.75H14.8438C15.918 18.75 16.7969 17.8711 16.7969 16.7969V16.0156H16.0156Z" fill="white"/>\n                                        <path d="M21.6797 4.29688C22.3242 4.29688 22.8516 4.82422 22.8516 5.46875V13.6719C22.8516 14.3164 22.3242 14.8438 21.6797 14.8438H20.1172V16.9727L17.5781 15.0195L17.3828 14.8438H10.1562C9.51172 14.8438 8.98438 14.3164 8.98438 13.6719V5.46875C8.98438 4.82422 9.51172 4.29688 10.1562 4.29688H21.6797ZM21.6797 3.51562H10.1562C9.08203 3.51562 8.20312 4.39453 8.20312 5.46875V13.6719C8.20312 14.7461 9.08203 15.625 10.1562 15.625H17.1094L20.8984 18.5547V15.625H21.6797C22.7539 15.625 23.6328 14.7461 23.6328 13.6719V5.46875C23.6328 4.39453 22.7539 3.51562 21.6797 3.51562Z" fill="white"/>\n                                    </svg>\n                                    <span class="chat-message" style="box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.5) !important;">Talk to School Administration</span>\n                                    <span class="UNSEEN start-100 translate-middle badge position-absolute"></span>\n                                </a>\n                            </div>\n                        </div>\n                        <div class="full">\n                            <div id="player"></div>\n                        </div>\n                    </div>\n                    <div class="modal-footer">\n                        <button href="javascript:void(0)" id="play-again-btn" class="btn btn-outline-gray" onclick="playAgain()" disabled>Watch Again</button>\n                        <button href="javascript:void(0)" id="moveToTimePreferencePopup" class="btn btn-gray" disabled>Book System Training</button>\n                    </div>\n                </div>\n            </div>\n        </div>'}function onYouTubeIframeAPIReady(e){window.YT.ready((function(){flagWatchVideo?player1=new YT.Player("player1",{height:"390",width:"100%",videoId:e,playerVars:{modestbranding:1,rel:0,iv_load_policy:3,fs:0,cc_load_policy:0,disablekb:1,playsinline:1,autohide:1}}):player=new YT.Player("player",{height:"390",width:"100%",videoId:e,playerVars:{modestbranding:1,rel:0,iv_load_policy:3,fs:0,cc_load_policy:0,disablekb:1,playsinline:1,autohide:1},events:{onStateChange:onPlayerStateChange}})}))}function onPlayerStateChange(e){if(e.data==YT.PlayerState.ENDED){customLoader(!0),flagWatchVideo=!0,$("#play-again-btn").removeClass("btn-outline-gray"),$("#play-again-btn").addClass("btn-outline-primary"),$("#moveToTimePreferencePopup").removeClass("btn-gray"),$("#moveToTimePreferencePopup").addClass("btn-primary"),$("#moveToTimePreferencePopup, #play-again-btn").attr("disabled",!1);var a={flagWatchVideo:"Y"};a.userId=USER_ID,a.studentStandardId=$("#timeStuStandardId").val(),a.schoolId=SCHOOL_ID,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","update-vedio-watched-status"),data:JSON.stringify(a),dataType:"json",async:!0,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status?redirectLoginPage():showMessageTheme2(0,e.message,"",!0):customLoader(!1)},error:function(e){customLoader(!1)}})}}function playAgain(){player.seekTo(0),player.playVideo()}