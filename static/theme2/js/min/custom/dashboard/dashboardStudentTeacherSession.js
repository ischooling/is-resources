var currentDate=new Date;currentDate.setDate(currentDate.getDate()+1);var currentYear=currentDate.getFullYear(),currentMonth=currentDate.getMonth(),currentDay=currentDate.getDate();function meetingSlotModal(){null!=$("#autoCountryTimeZoneId").val()&&""!=$("#autoCountryTimeZoneId").val()&&($("#teacherMeetingSlotsForm #countryTimezoneId").select2({}),$("#teacherMeetingSlotsForm #countryTimezoneId").val($("#autoCountryTimeZoneId").val()).trigger("change")),$("#slotCtFor").val(0).trigger("change"),$("#standardDiv").show(),$("#course").show(),$("#teacherMeetingSlotsModal").modal("show"),$("#listSlotsResponse").html(""),$("#listSlots").show(),$(".meetingGetSlotSave").show(),$(".meetingSave").hide(),$("#back").hide(),$("#meetingCategory2").prop("checked",!0),$("#inActDate").val(""),$("#timeHrsFrom").val(0),$("#timeHrsTo").val(0),$("#timeMinFrom").val(0),$("#timeMinTo").val(0),$("#weekCount").val(1),$(".arrowBtn").show(),$("#nextVisitMonth").show(),$("#calendarWeek").show();var e=new Date;calendarDateMeeting("calendarWeek",e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),"Week","Create Manage Class"),$("#monthYear").html("1 Week(s) Selected"),$("#monthYear").show()}function meetingSlotModalBack(){$("#teacherMeetingSlotsModal").modal("show"),$("#listSlotsResponse").html(""),$("#listSlots").show(),$(".meetingGetSlotSave").show(),$(".meetingSave").hide(),$("#back").hide()}function bookingSlotModal(e,t,a){if("theme2"==a){var s={};s.userId=USER_ID,s.subjectId=e,s.roleModuleId=t,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","student-subject-session-booking"),data:JSON.stringify(s),dataType:"html",success:function(e){if(""!=e){var t;"FAILED"==(t=e.split("|"))[0]||"EXCEPTION"==t[0]||"SESSIONOUT"==t[0]?"SESSIONOUT"==t[0]?redirectLoginPage():showMessageTheme2(0,t[1],"",!1):($("#bookASession").html(e),$("#studentBookingSlotsModal  #course").show(),$("#studentBookingSlotsModal").modal("show"))}},error:function(e){}})}else $("#course").show(),$("#studentBookingSlotsModal").modal("show")}function meetingUrlModalAdmin(e,t,a,s,r){$("#meetingUrlForm #meetingUrl").attr("disabled",!1),$("#meetingUrlForm #remarks").attr("disabled",!1),$("#meetingUrlForm #saveMeetingUrl").show(),$("#meetingUrlForm #note").hide(),$("#meetingUrlModal").modal("show"),$("#meetingUrlForm #meetingId").val(e),$("#meetingUrlForm #userId").val(t),$("#meetingUrlForm #meetingUrl").val(a),$("#meetingUrlForm #remarks").val(r),$("#meetingUrlForm #mailSendStatus").val(s),"Y"==s&&($("#meetingUrlForm #meetingUrl").attr("disabled",!0),$("#meetingUrlForm #remarks").attr("disabled",!0),$("#meetingUrlForm #saveMeetingUrl").hide(),$("#meetingUrlForm #note").hide())}function sendMailModel(e,t,a,s){if(""==a||null==a)return showMessage(!0,"Add Meeting Link before Sending Mail"),!1;$("#sendMailModal").modal("show"),$("#sendMailForm #meetingId").val(e),$("#sendMailForm #userId").val(t)}function validateStudentSlots(e){var t="",a="",s="",r="",i="";if(null==$("#countryTimezoneId option:selected").val()||"0"==$("#countryTimezoneId option:selected").val())return $("#studentfreeSlotList").html(""),showMessage(!0,"Please select a Time Zone"),!1;if(t=$("#countryTimezoneId option:selected").val(),0==$("#subjectId").val()||null==$("#subjectId").val())return $("#studentfreeSlotList").html(""),showMessage(!0,"Course is required"),!1;a=$("#"+e+" #subjectId").val(),s=$("#"+e+" #subjectId option:selected").attr("data-teacherId"),r=$("#"+e+" #subjectId option:selected").attr("data-providerId"),i=$("#"+e+" #subjectId option:selected").attr("data-standardId");var n={};n.userId=USER_ID,n.subjectId=a,n.teacherId=s,n.timeZone=t,n.providerId=r,n.standardId=i,callStudentFreeSlots("#studentBookingSlotsForm",n)}function callStudentFreeSlots(e,t){$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","get-student-free-slots"),data:JSON.stringify(t),dataType:"html",cache:!1,timeout:6e5,success:function(e){if(""!=e){var t;return"FAILED"==(t=e.split("|"))[0]||"EXCEPTION"==t[0]||"SESSIONOUT"==t[0]?showMessage(!0,t[1]):$("#studentfreeSlotList").html(e),!1}return!1},error:function(e){showMessage(!0,e.responseText)}})}function validateRequestForStudentBookSessionSlots(e,t){return 0==$("#countryTimezoneId").val()||null==$("#countryTimezoneId").val()?(showMessageTheme2(0,"Time-Zone is required","",!1),!1):0==$("#subjectId").val()||null==$("#subjectId").val()?(showMessageTheme2(0,"Course is required","",!1),!1):null!=$("input[name='slotTime']:checked").val()||(showMessageTheme2(0,"Please select any one Slot.","",!1),!1)}function callForStudentBookSessionSlots(e,t,a){if(getSession()||redirectLoginPage(),hideMessage(""),!validateRequestForStudentBookSessionSlots(e))return!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","student-book-session-slots-submit"),data:JSON.stringify(getRequestForStudentBookSessionSlots(e,t)),dataType:"json",cache:!1,timeout:6e5,success:function(t){return"0"==t.status||"2"==t.status?showMessageTheme2(0,t.message,"",!1):(showMessageTheme2(1,t.message,"",!1),$("#studentBookingSlotsModal").modal("toggle"),$("#"+e)[0].reset(),setTimeout((function(){callSchoolInneraction("subjectsession",t.subjectId,"",a)}),1e3)),!1},error:function(e){return!1}})}function getRequestForStudentBookSessionSlots(e,t){var a={},s={},r={};return r.meetingPersoneId=$("#userId").val(),r.meetingId=$("input[name='slotTime']:checked").attr("slotIdAttr"),r.meetingDate=$("input[name='slotTime']:checked").attr("slotMeetDate"),r.meetingEndDate=$("input[name='slotTime']:checked").attr("slotMeetEndDate"),r.startTime=$("input[name='slotTime']:checked").attr("slotstTime"),r.endTime=$("input[name='slotTime']:checked").attr("slotedTime"),r.timezone=$("#countryTimezoneId option:selected").attr("custom_timezone_id"),r.timeZoneCheck=$("#countryTimezoneId").val(),r.meetingType="STUDENT_DOUBT_SESSION",r.subjectId=$("#subjectId").val(),r.standardId=$("#"+e+" #subjectId option:selected").attr("data-standardId"),r.studentStandardId=$("#"+e+" #subjectId option:selected").attr("data-studentStandardId"),r.studentSessionId=$("#"+e+" #subjectId option:selected").attr("data-studentSessionId"),r.providerId=$("#"+e+" #subjectId option:selected").attr("data-providerId"),r.teachUserId=$("#"+e+" #subjectId option:selected").attr("data-teacherid"),r.planId=$("#"+e+" #subjectId option:selected").attr("data-planid"),s.hash=getHash(),s.schoolId=SCHOOL_ID,s.schoolUUID=SCHOOL_UUID,s.userType=t,s.userId=$("#userId").val().trim(),a.authentication=s,a.meetingSlotDTO=r,a}function weekCount(e,t){var a=new Date(e,t-1,1),s=new Date(2020,t,0),r=a.getDay()+s.getDate();return Math.ceil(r/7)}function callSubjectByGradeAndTeacherId(e,t,a,s,r,i,n){hideMessage(""),$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster(e,"SUBJECT-LIST-BY-GRADE-TEACHER-ID",t,r,i,n)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(t){"0"==t.status||"2"==t.status?showMessage(!0,t.message):(console.log("Response Data  "+t),buildDropdown(t.mastersData.subject,$("#"+e+" #"+s),"Select course"))},error:function(e){console.log(e)}})}function validateRequestForRequestDemoMeetingSlots(e,t){return""==$("#weekCount").val()||null==$("#weekCount").val()?(showMessage(!0,"Session Type is required"),!1):0==$("#countryTimezoneId").val()||null==$("#countryTimezoneId").val()?(showMessage(!0,"Country Timezone is required"),!1):""==$("#dateCategory").val()||null==$("#dateCategory").val()?(showMessage(!0,"Session Type  is required"),!1):""==$("#meetingDateFrom").val()||null==$("#meetingDateFrom").val()?(showMessage(!0,"Session Date From is required"),!1):""==$("#meetingDateTo").val()||null==$("#meetingDateTo").val()?(showMessage(!0,"Session Date to is required"),!1):new Date($("#meetingDateFrom").val())>new Date($("#meetingDateTo").val())?(showMessage(!0,"From date is less than To date"),!1):""==$("#timeHrsFrom").val()||null==$("#timeHrsFrom").val()||""==$("#timeMinFrom").val()||null==$("#timeMinFrom").val()||""==$("#timeHrsTo").val()||null==$("#timeHrsTo").val()||""==$("#timeMinTo").val()||null==$("#timeMinTo").val()?(showMessage(!0,"Session time is required"),!1):0!=$("#timeInterval").val()&&null!=$("#timeInterval").val()||(showMessage(!0,"Time Interval is required"),!1)}function getRequestForRequestDemoMeetingSlots(e,t){var a={},s={},r={},i={};return i.weekCount=$("#"+e+" #weekCount").val(),i.inActDate=$("#"+e+" #inActDate").val(),i.timezone=$("#"+e+" #countryTimezoneId option:selected").attr("custom_timezone_id"),i.timeZoneCheck=$("#"+e+" #countryTimezoneId option:selected").val(),i.dateCategory=$("#"+e+" #dateCategory").val(),i.startDate=$("#"+e+" #meetingDateFrom").val(),i.endDate=$("#"+e+" #meetingDateTo").val(),i.timeHrsFrom=$("#"+e+" #timeHrsFrom").val(),i.timeMinFrom=$("#"+e+" #timeMinFrom").val(),i.timeHrsTo=$("#"+e+" #timeHrsTo").val(),i.timeMinTo=$("#"+e+" #timeMinTo").val(),i.timeInterval=$("#"+e+" #timeInterval").val(),i.userId=$("#"+e+" #userId").val(),i.meetingType=t,i.timeIntervalValue=$("#"+e+" #sessionbuffer").val(),r.meetingSlotDTO=i,s.hash=getHash(),s.schoolId=SCHOOL_ID,s.schoolUUID=SCHOOL_UUID,s.userType="SCHOOL",s.userId=$("#"+e+" #userId").val(),a.authentication=s,a.requestData=r,a}function calendarRequestMeetingSlots(e,t,a,s,r){if(hideMessage(""),!validateRequestForRequestDemoMeetingSlots(e,t))return!1;$.ajax({type:"POST",url:getURLForHTML("dashboard","meeting-dates-slots"),data:encodeURI("request="+JSON.stringify(getRequestForRequestDemoMeetingSlots(e,r))),dataType:"html",cache:!1,async:!1,timeout:6e5,success:function(e){if(""!=e){var t;return"FAILED"==(t=e.split("|"))[0]||"EXCEPTION"==t[0]||"SESSIONOUT"==t[0]?"SESSIONOUT"==t[0]?redirectLoginPage():showMessage(!0,t[1]):($("#listSlots").hide(),$(".meetingGetSlotSave").hide(),$(".meetingSave").show(),$("#back").show(),$("#"+s).html(e)),!1}},error:function(e){return!1}})}function createDate(e,t,a,s){$("#"+e+" #"+t).datepicker({autoclose:!0,format:"mm-dd-yyyy",todayHighlight:!0,startDate:a,endDate:s})}function createDateNew(e,t,a){console.log("seltDate=> ",a),$("#"+e+" #"+t).datepicker({startDate:a,autoclose:!0,format:"mm-dd-yyyy",todayHighlight:!0}),$("#"+e+" #"+t).datepicker().datepicker("setDate",a)}function setStudentTecherSessionDate(e,t,a){var s=$("#"+e+" #weekPickerId option:selected").attr("custom_startDate"),r=$("#"+e+" #weekPickerId option:selected").attr("custom_endDate"),i=s.split("-"),n=r.split("-"),o=new Date(i[0],i[1]-1,i[2]),l=new Date;createDate(e,a,o.getTime()>l.getTime()?o:l,new Date(n[0],n[1]-1,n[2]))}function callAssignStudentTeacher(e,t,a,s,r,i){hideMessage("");var n={};n.studentId=t,n.viewAssignStudentTeacher=a,n.assignStudentTeacher=s,n.viewAssignPastStudentTeacher=r,n.standardId=i,n.userId=USER_ID,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","assign-student-teacher"),data:JSON.stringify(n),dataType:"html",cache:!1,timeout:6e5,success:function(e){if(""!=e){var t;return"FAILED"==(t=e.split("|"))[0]||"EXCEPTION"==t[0]||"SESSIONOUT"==t[0]?showMessage(!0,t[1]):$("#studentAssighnTeacherSupportContent").html(e),!1}},error:function(e){return console.log(e),!1}})}function calendarDateMeeting(e,t,a){var s={startDate:t,slotType:a,disabledDate:$("#inActDate").val()};$.ajax({type:"POST",url:getURLForHTML("dashboard","meeting-dates"),contentType:"application/json",data:JSON.stringify(s),dataType:"html",cache:!1,async:!1,timeout:6e5,success:function(t){if(""!=t){var a;return"FAILED"==(a=t.split("|"))[0]||"EXCEPTION"==a[0]||"SESSIONOUT"==a[0]?"SESSIONOUT"==a[0]?redirectLoginPage():showMessage(!0,a[1]):($("#monthYear").html(""),$("#"+e).html(t)),!1}},error:function(e){return!1}})}function callAssignStudentTeacherContent(e){var t=$("#studentTeacherMappingModalLabel #studentId").html(),a=($("#studentTeacherMappingModalLabel #studentName").html(),$("#studentTeacherMappingModalLabel #standardId").html());if($("#viewStudentTeacherTab").removeClass("active"),$("#viewStudentTeacherTab").removeClass("inactive-tab"),$("#assignStudentTeacherTab").removeClass("active"),$("#assignStudentTeacherTab").removeClass("inactive-tab"),$("#viewPastStudentTeacherTab").removeClass("active"),$("#viewPastStudentTeacherTab").removeClass("inactive-tab"),"view-assignStudentTeacher"==e){var s="new";$("#viewStudentTeacherTab").addClass("active"),$("#assignStudentTeacherTab").addClass("inactive-tab"),$("#viewPastStudentTeacherTab").addClass("inactive-tab"),callForDashboardData("formIdIfAny","student-teacher-linking-content?studentId="+t+"&callFor="+e+"&standardId="+a+"&controllType="+s,"studentTeacherLinkingContent")}else if("assignStudentTeacher"==e){s="new";$("#viewStudentTeacherTab").addClass("inactive-tab"),$("#assignStudentTeacherTab").addClass("active"),$("#viewPastStudentTeacherTab").addClass("inactive-tab"),callForDashboardData("formIdIfAny","student-teacher-linking-content?studentId="+t+"&callFor="+e+"&standardId="+a+"&controllType="+s,"studentTeacherLinkingContent")}else if("view-assignPastStudentTeacher"==e){s="old";$("#viewStudentTeacherTab").addClass("inactive-tab"),$("#assignStudentTeacherTab").addClass("inactive-tab"),$("#viewPastStudentTeacherTab").addClass("active"),callForDashboardData("formIdIfAny","student-teacher-linking-content?studentId="+t+"&callFor="+e+"&standardId="+a+"&controllType="+s,"studentTeacherLinkingContent")}}function viewStudentTeacherMappingsLogs(e,t,a){hideMessage("");var s={};s.studentId=e,s.subjectId=t,s.studentTeacherMappingId=a,s.userId=USER_ID,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","student-teacher-mapping-log-content"),data:JSON.stringify(s),dataType:"html",cache:!1,timeout:6e5,success:function(e){if(""!=e){var t;return"FAILED"==(t=e.split("|"))[0]||"EXCEPTION"==t[0]||"SESSIONOUT"==t[0]?showMessage(!0,t[1]):$("#studentTeacherMappingLogContent").html(e),!1}},error:function(e){return console.log(e),!1}})}function submitStudentTeacherAssign(e,t){hideMessage("");var a=$(this);if(a.data("requestRunning"))return!1;a.data("requestRunning",!0),$.ajax({type:"POST",contentType:"application/json",url:getURLFor("dashboard","student-teacher-assign-submit"),data:JSON.stringify(getRequestForStudentTeacherAssign(e,t)),dataType:"json",cache:!1,timeout:6e5,success:function(e){return a.data("requestRunning",!1),"0"==e.status||"2"==e.status?showMessage(!0,e.message):callAssignStudentTeacherContent("view-assignStudentTeacher"),!1},error:function(e){return a.data("requestRunning",!1),!1}})}function getRequestForStudentTeacherAssign(e,t,a,s,r,i,n){var o={},l={},d={},c=$("#teacherId"+a).val().trim();if(d.subjectId=a,d.teacherId=c,d.standardId=s,d.stdEnrollDate=$("#stdEnrollDate"+a).val(),d.steachEnrollStartDate=$("#steachEnrollStartDate"+a).val(),d.steachEnrollEndDate=$("#steachEnrollEndDate"+a).val(),null==$("#steachAmount"+a).val()?d.amount=0:d.amount=$("#steachAmount"+a).val(),""!=$("#steachEnrollEndDate"+a).val().trim()){if(""==$("#reasonEnrollEnd"+a).val().trim())return showMessage(!0,"Reason for ending enrollment is required."),!1;if(d.reasonEnrollEnd=$("#reasonEnrollEnd"+a).val(),"Other"==$("#reasonEnrollEnd"+a).val().trim()){if(""==$("#otherReason"+a).val().trim())return showMessage(!0,"Reason for ending enrollment is required"),!1;d.otherReason=$("#otherReason"+a).val().trim()}}return d.studentId=r,d.oldTeacherId=i,d.courseType=n,[].push(d),o.studentTeacherSavedMappingDTO=d,l.hash=getHash(),l.schoolId=SCHOOL_ID,l.schoolUUID=SCHOOL_UUID,l.userType=t,l.sessionUserId=USER_ID,o.authentication=l,o}function validateRequestForSubmitMeetingSlots(e,t,a){if("ADD"==a){if(0==$("#countryTimezoneId").val()||null==$("#countryTimezoneId").val())return showMessage(!0,"Time-Zone is required"),!1;if(0==$("#weekPickerId").val()||null==$("#weekPickerId").val())return showMessage(!0,"Meeting week is required"),!1;if(""==$("#meetingDate").val()||null==$("#meetingDate").val())return showMessage(!0,"Meeting Date is required"),!1;if(""==$("#startTime").val()||null==$("#startTime").val())return showMessage(!0,"Start Time is required"),!1;if(0==$("#timeInterval").val()||null==$("#timeInterval").val())return showMessage(!0,"Time Interval is required"),!1}else if("UPDATE"==a){if(""==$("#meetingResult").val()||null==$("#meetingResult").val())return showMessage(!0,"Meeting Result is required"),!1}else if("ADDURL"==a&&(""==$("#meetingUrl").val()||null==$("#meetingUrl").val()))return showMessage(!0,"Meeting Link is required"),!1;return!0}function submitMeetingForSlots(e,t,a){hideMessage(""),data.moduleId=t,data.controllType=a,data.userId=USER_ID,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","student-teacher-mapping-log-content"),data:JSON.stringify(data),dataType:"html",cache:!1,timeout:6e5,success:function(e){if(""!=e){var t;return"FAILED"==(t=e.split("|"))[0]||"EXCEPTION"==t[0]||"SESSIONOUT"==t[0]?showMessage(!0,t[1]):$("#studentTeacherMappingLogContent").html(e),!1}},error:function(e){return console.log(e),!1}})}function getRequestForSubmitMeetingSlots(e,t,a){var s={},r={},i={},n={};if("ADD"==a){n.meetingType="STUDENT_DOUBT_SESSION",n.timezone=$("#countryTimezoneId option:selected").attr("custom_timezone_id"),n.timeZoneCheck=$("#countryTimezoneId").val(),n.slotType=$("#meetingCategory1").val();var o=$("#"+e+" #meetingDate").val();o=o.split("-"),meetingDate=o[2]+"-"+o[0]+"-"+o[1],n.meetingDate=meetingDate,n.weekID=$("#"+e+" #weekPickerId").val();var l=$("#"+e+" #startTime").val();n.startTime=l;var d=$("#"+e+" #timeInterval option:selected").val(),c=new Date("2016/09/12 "+l+":00");c.setMinutes(c.getMinutes()+parseInt(d)),c=c.getHours()+":"+c.getMinutes(),n.endTime=c,n.subject="STUDENT_DOUBT_SESSION",n.status="0"}else"UPDATE"==a?(n.controllType=a,n.meetingType="STUDENT_DOUBT_SESSION",n.meetingId=$("#"+e+" #meetingId").val(),n.meetingResult=$("#"+e+" #meetingResult option:selected").val()):"ADDURL"==a?(n.controllType=a,n.meetingType="STUDENT_DOUBT_SESSION",n.meetingId=$("#"+e+" #meetingId").val(),n.meetingUrl=$("#"+e+" #meetingUrl").val()):"SENDMAIL"==a&&(n.controllType=a,n.meetingType="STUDENT_DOUBT_SESSION",n.meetingId=$("#"+e+" #meetingId").val());return i.meetingSlotDTO=n,r.hash=getHash(),r.schoolId=SCHOOL_ID,r.schoolUUID=SCHOOL_UUID,r.userType=t,r.userId=$("#"+e+" #userId").val(),s.authentication=r,s.requestData=i,s}function validateRequestForRemoveMeetingsForStudentSessionSlots(e){var t=[];return $(".slotDate").each((function(){$(".slotTime"+$(this).attr("id")).each((function(){t.push($(this).attr("data-slotId"))}))})),0!=t.length||("theme1"==tt?showMessage(!0,"No slots available for delete."):showMessageTheme2(0,"No slots available for delete.","",!0),!1)}function removeMeetingsForStudentSessionSlots(e,t,a){if($(".confirmDeleteSlots").prop("disabled",!0),"theme1"==tt?hideMessage(""):hideMessageTheme2(""),!validateRequestForRemoveMeetingsForStudentSessionSlots(e))return $(".confirmDeleteSlots").prop("disabled",!0),!0;$.ajax({type:"POST",contentType:"application/json",url:getURLFor("dashboard","meetingslots-remove-submit"),data:JSON.stringify(getRemoveMeetingsForStudentSessionSlots(e,t)),dataType:"json",success:function(e){return"0"==e.status||"2"==e.status?($(".meetingSave").prop("disabled",!1),"theme1"==tt?showMessage(!0,e.message):showMessageTheme2(0,e.message,"",!0)):("theme1"==tt?showMessage(!1,e.message):showMessageTheme2(1,e.message,"",!0),$("#deleteTeacherMeetingSlotsModal").modal("toggle"),setTimeout((function(){callDashboardPageSchool(a,"create-manage-sessions")}),1e3),$("body").removeClass("modal-open")),!1}})}function getRemoveMeetingsForStudentSessionSlots(e,t){var a={},s={},r=[];return $("#"+e+" .slotDate").each((function(){$("#"+e+" .slotTime"+$(this).attr("id")).each((function(){r.push($(this).attr("data-slotId"))}))})),s.hash=getHash(),s.schoolId=SCHOOL_ID,s.schoolUUID=SCHOOL_UUID,s.userType=t,s.userId=$("#"+e+" #userId").val(),a.authentication=s,a.meetingIds=r,a}function courseProviderList(e,t){$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","ALL-COURSE-PROVIDER-LIST","courseProList")),dataType:"json",cache:!1,timeout:6e5,async:!0,success:function(a){if("0"==a.status||"2"==a.status)showMessage(!0,a.message);else{var s=a.mastersData.courseList,r=$("#"+e+" #"+t);r.html(""),"teacherAssignForm"==e||r.append('<option value="">Select LMS Platform</option>'),$.each(s,(function(t,a){"teacherAssignForm"==e?36!=a.key&&37!=a.key&&38!=a.key&&39!=a.key&&40!=a.key&&41!=a.key||(37==a.key?r.append('<option value="'+a.key+'" selected>'+a.value+" </option>"):r.append('<option value="'+a.key+'">'+a.value+" </option>")):36!=a.key&&37!=a.key&&38!=a.key&&39!=a.key&&40!=a.key&&41!=a.key||r.append('<option value="'+a.key+'">'+a.value+" </option>")}))}}})}function getRequestForTeacherAssign(e,t){""==t&&""!=$("#teacherAssignForm #subjectId").val()&&null!=$("#teacherAssignForm #subjectId").val()&&(t=$("#teacherAssignForm #subjectId").val());var a=$("#teacherAssignForm #teacherName").val(),s=$("#teacherAssignForm #applicationNo").val(),r=$("#teacherAssignForm #teacherEmail").val(),i={};return i.schoolId=SCHOOL_ID,i.subjectid=t,""!=$("#teacherAssignForm #standardId").val()&&null!=$("#teacherAssignForm #standardId").val()&&(i.standardId=$("#teacherAssignForm #standardId").val()),""!=$("#teacherAssignForm #countryId").val()&&null!=$("#teacherAssignForm #countryId").val()&&(i.countryId=$("#teacherAssignForm #countryId").val()),""!=a&&null!=a&&(i.teacherName=a.trim()),""!=s&&null!=s&&(i.applicationNo=s.trim()),""!=r&&null!=r&&(i.officialEmail=r.trim()),i.callFrom=e,i.courseProviderId=$("#teacherAssignForm #lmsPlatform").val(),i}function getTeacherAssignList(e,t,a){customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","teacher-assign-form-content"),data:JSON.stringify(getRequestForTeacherAssign(e,a)),dataType:"json",cache:!1,timeout:6e5,async:!0,success:function(e){if(customLoader(!1),"0"==e.status||"2"==e.status||"3"==e.status)"3"==e.status?redirectLoginPage():"theme2"==tt?$("#"+t).html('<tr><td colspan="8"><b>Teacher not found on the basis of filter</b></td></tr>'):tt;else{var a=userLogList(e.teacherAssign,t);$("#"+t).html(""),$("#"+t).html(a),$(".leaveDates").datepicker({startDate:new Date,multidate:!0,format:"M dd, yyyy",keyboardNavigation:!1}).on("change",(function(e){LEAVE_DATES=$(this).val(),LEAVE_DATES=LEAVE_DATES.match(/[^,]+,[^,]+/g);var t=$(this).attr("data-leave-dates");$("."+t).html(""),$.each(LEAVE_DATES,(function(e,a){$("."+t).append("<li class='nav-item px-2'><p class='mb-0 full font-weight-bold text-left' data-leave-type='AUTO'>"+a+"</p></li>")}))})),setTimeout((function(){bindLeaveDate(e.teacherAssign)}),500)}},error:function(e){"theme2"==tt?showMessageTheme2(2,TECHNICAL_GLITCH,"",!0):"theme1"==tt&&showMessage(!0,TECHNICAL_GLITCH)}})}function userLogList(e,t){var a="",s=1;if(e.length>0){var r=0,i=0;for(md=0;md<e.length;md++){var n="",o="",l=e[md].teacherTimeList;if(null!=l)for(var d=0;d<l.length;d++){var c="<label class='mb-0 font-weight-bold' data-teach-day='"+l[d].dayId+"'>"+l[d].dayName+"</label>";n="<label class='mb-0 font-weight-bold' data-teach-strtime='"+l[d].startTime+"'>"+l[d].displayStartTime+"</label>",o="<label class='mb-0 font-weight-bold' data-teach-entime='"+l[d].endTime+"' >"+l[d].displayEndTime+"</label>";'<div class="full text-left mt-1 mr-1 day_time-'+e[md].teacherId+'">'+c+"</div>",'<div class="full text-left mt-1 mr-1 start_time-'+e[md].teacherId+'">'+n+"</div>",'<div class="full text-left mt-1 ml-1 end_time-'+e[md].teacherId+'">'+o+"</div>",'<a class="text-danger text-white cursor" onclick="removeTime('+l[d].dayId+')"><i class="fa fa-trash"></i></a></span>'}var m=e[md].userLeaveDate;if(null!=m){$.each(m,(function(e,t){"<p class='mb-0 full font-weight-bold text-left' data-leave-type='"+t.dataType+"'>"+t.displayStartDate+"</p>"}))}else 0;"Full-Time"==e[md].employeeType&&(r+=1),"Part-Time"==e[md].employeeType&&(i+=1);var u=divPopup("Grade's","grade",e[md].teacherId),h=divPopup("Course","course",e[md].teacherId);getTeacherAssignStudentList("Grade","STANDARD","grade",e[md].teacherId,e[md].workingHrs),getTeacherAssignStudentList("Course","SUBJECT","course",e[md].teacherId,e[md].workingHrs);a+='<tr class="assignTeacherItem teacher-ord-'+s+'" id="assignTeacherItem'+e[md].teacherId+'">',a+='<td class="text-center">&nbsp;&nbsp;'+s+"</td>",a+='<td class="text-left"><input type="hidden" class="assignTeacherto"  value="'+e[md].userId+'">',a+='<input type="hidden" class="assignSubject"  value="'+e[md].subjectId+'" />',a+='<input type="hidden" class="assignTeacherId"  value="'+e[md].teacherId+'" />',a+='<span id="teachername'+e[md].teacherId+'">'+e[md].teacherName+" | "+e[md].employeeType+" | "+e[md].applicationNo+"</span>",a+="<br/>"+u+" |  "+h,a+="<br/>"+e[md].cityName+" | "+e[md].countryName+" | "+e[md].timezone.toString().replace("/",","),a+="</td>",a+='<td class="text-left" ><span class="d-inline-block bg-danger text-white p-1 font-weight-bold mr-1 mb-1 text-center" style="min-width:30px;">'+e[md].agreedHrs+'</span><span class="d-inline-block bg-success text-white p-1 font-weight-bold mr-1 mb-1 text-center" style="min-width:30px;">'+e[md].completeHrs+'</span><span class="d-inline-block bg-warning text-white p-1 font-weight-bold mr-1 mb-1 text-center" style="min-width:30px;">'+e[md].pendingHrs+"</span>",a+='<br/><span class="d-inline-block bg-alternate text-white p-1 font-weight-bold mr-1 mb-1 text-center" style="min-width:30px;" id="ass_student_'+e[md].teacherId+'">0</span><span class="d-inline-block mr-1 mb-1 text-center" id="total_student_'+e[md].teacherId+'">0</span>',a+='<br/><span class="d-inline-block bg-dark text-white p-1 font-weight-bold mr-1 mb-1 text-center" style="min-width:30px;" id="pl_student_'+e[md].teacherId+'">0</span><span class="d-inline-block text-white p-1 font-weight-bold mr-1 mb-1 text-center" style="min-width:30px; background-color: #ff059d;" id="gl_student_'+e[md].teacherId+'">0</span>',a+="</td>",a+='<td class="text-center"><input type="text" name="orderBy" class="rowindex" value="'+(null==e[md].orderBy?s:e[md].orderBy)+'" size="5"  maxlength="5" '+("Y"==e[md].teacherActivate?"":"disabled")+" autocomplete=\"off\" onfocusout=\"tableOrdering(this,'TeacherAssignToStudent','assignTeacherItem"+e[md].teacherId+"')\" /></td>",a+='<td class="text-center"><input type="text" name="totalAssignStudent" class="totalAssignStudent" value="'+e[md].totalStudent+'" size="5"  maxlength="5"  '+("Y"==e[md].teacherActivate?"":"disabled")+"/></td>",a+='<td class="text-center"><label class="switch" >',a+='<input class="switch-input assignActiveStudent" id="assignActiveStudent'+s+'"  type="checkbox" '+("Y"==e[md].teacherActivate?"checked":"")+'  value="'+e[md].teacherActivate+'"',a+='onclick="activeTeacher('+e[md].userId+","+("Y"==e[md].teacherActivate?0:1)+","+(null==e[md].orderBy?s:e[md].orderBy)+","+e[md].subjectId+');"  data-size="mini"/>',a+='<span class="switch-label" data-on="Yes" data-off="No"></span> <span class="switch-handle"></span>',a+="</label></td>",a+='<td class="text-center teacher-start-end-time'+e[md].teacherId+'">',a+='<br/><a href="javascript:void(0);" class="btn btn-sm btn-primary mr-1" onclick="getAvailability('+e[md].userId+');" >Add | Edit Teacher Availablity</a>',a+="</td>",a+="</tr>",s+=1}$(".span-fulltime").text(r),$(".span-parttime").text(i)}return a}function getOpenPrefrenceTimePopup(e,t,a,s,r,i,n,o,l,d,c,m,u,h,p,g,v,T,S){$("#"+t+" #teacherTimeSaveDismiss").show(),$("#"+t+" #availabilityDay").attr("disabled",!1),$("#"+t).scrollTop(0),WEEKLIST_ARR=[];var f=c.split("-"),y="view";f.length>1&&(c=f[0],y=f[1]),$("#"+t+" #changeSlotLimit").val(0),$("#"+t+" #changeSlotStartDay").val(0),$("#"+t+" #changeSlotValid").val(0),$("#"+t+" #changeSlotDate").val(""),$("#"+t+" #updateSlotDate").val(""),$("#"+t+" #controlType").val(c),$("#"+t+" #timeSaveTeacherId").val(a),$("#"+t+" #timeSaveTeacherUserId").val(s),$("#"+t+" #slotTillDate").val(d),$("#"+t+" #slotLimitHrs").val(u),$("#"+t+" #slotLimitMaxHrs").val(h),$("#"+t+" #timeSlotType").val(p),$("#"+t+" #agreedHrs").val(g),$("#"+t+" #agreedAvgHrs").val(T),$("#"+t+" .agreedHrs").text(g),$("#"+t+" .agreedHalfHrs").text(v),$("#"+t+" .agreedAvgHrs").text(T),$(".added-availability").html(""),$("#"+t+" #changeSlotLimit").val(r),$("#"+t+" #changeSlotStartDay").val(i),$("#"+t+" #changeSlotValid").val(n),$("#"+t+" #changeSlotDate").val(o),$("#"+t+" #updateSlotDate").val(l),$("#"+t+" #submitFrom").val(e),"edit"==c&&callTimePreferenceByDate(e,a,s,S,l,t,y,0),"teacher-profile"!=e&&"teacher-my-slot"!=e||($("#timePreferencePopup").removeClass("d-none"),$("#timePreferencePopup").modal("show"))}function addLiveClassModal(e,t,a,s,r,i,n,o,l,d){$("#"+a+" #timeSaveTeacherId").val(e),$("#"+a+" #timeSaveTeacherUserId").val(t),$("#"+a+" #controlType").val(r),$("#"+a+" #agreedHalfHrs").val(l),$("#"+a+" #availabilityDay").attr("disabled",!1),$("#"+a+" .added-availability").html(""),WEEKLY_TIME=[],WEEKLIST_ARR=[],$(".added-live-class").html(""),$(".add-live-class").empty(),$(".add-leave").empty(),$("#"+a+" #changeSlotDate").val(i);var c='<a href="javascript:void(0);" class="btn btn-outline-primary py-2 d-inline-flex align-items-center" onclick="getTimeForTeacher('+t+",'"+a+"','"+s+"','success','added-availability', 'availabilityDay', 'start_time_','end_time_','taskNameDropdow')\"><i class=\"fa fa-plus\"></i>Add</a>";$(".add-live-class > .btn").length<1&&$(".add-admin-task > .btn").length<1&&$(".add-leave > .btn").length<1&&$(".add-live-class").append(c),$(".live-class-start-time,.live-class-end-time,.admin-task-start-time,.admin-task-end-time,.leave-start-time,.leave-end-time,.leave-dates").val(""),$(".live-class-dropdown, .admin-task-dropdown").val("").trigger("change"),$(".live-class-start-time").attr("id","start_time_"+t),$(".live-class-end-time").attr("id","end_time_"+t),$(".live-class-start-time").attr("name","start_time_"+t),$(".live-class-end-time").attr("name","end_time_"+t),$(".leaveDates").datepicker({startDate:new Date,multidate:!0,format:"M dd, yyyy",keyboardNavigation:!1}).on("change",(function(e){LEAVE_DATES=$(this).val(),LEAVE_DATES=LEAVE_DATES.match(/[^,]+,[^,]+/g);var t=$(this).attr("data-leave-dates");$("."+t).html(""),$.each(LEAVE_DATES,(function(e,a){$("."+t).append("<li class='nav-item px-2'><p class='mb-0 full font-weight-bold text-left' data-leave-type='AUTO'>"+a+"</p></li>")}))})),$(".leaveDates").keyup((function(e){8!=e.keyCode&&46!=e.keyCode||$(".leaveDates").datepicker("update","")})),$("#start_time_"+t).timepicker({format:"HH:mm"}),$("#end_time_"+t).timepicker({format:"HH:mm"}),$(".timepicker").on("click",(function(){var e=parseInt($(this).closest(".modal.fade.show, .modal.fade-scale").css("z-index"))+1999;$(".popover.timepicker-popover").css({"z-index":e})})),$(".live-class-dropdown").select2({theme:"bootstrap4",placeholder:"Select day"}).on("select2:open",(function(){var e=parseInt($(this).closest(".modal.fade.show, .modal.fade-scale").css("z-index"))+1999;$(".select2-container--open").css({"z-index":e})})),$(".admin-task-dropdown").select2({theme:"bootstrap4",placeholder:"Select day"}).on("select2:open",(function(){var e=parseInt($(this).closest(".modal.fade.show, .modal.fade-scale").css("z-index"))+1999;$(".select2-container--open").css({"z-index":e})})),"TEACHER"!=USER_ROLE?callTeacherTimePreference("admin-panel",e,t,d,a,"N"):$("#"+a).modal("show")}function bindLeaveDate(e){if(e.length>0)for(md=0;md<e.length;md++){var t=e[md].userLeaveDate;if(null!=t){var a=[];$.each(t,(function(e,t){if(null!=t.startDate){var s=t.startDate.toString().split("-");a.push(new Date(s[0],parseInt(s[1])-1,s[2]))}})),$("#leave_dates-"+e[md].teacherId).datepicker("setDate",a)}}}function getRequestForTeacherAssignStd(e,t,a,s){var r={};return r.schoolId=SCHOOL_ID,r.reportType=t,r.teacherId=a,r.workinghr=s,r.callFrom="",r}function getTeacherAssignStudentList(e,t,a,s,r){customLoader(!1),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","teacher-assign-student-content"),data:JSON.stringify(getRequestForTeacherAssignStd(e,t,s,r)),dataType:"json",cache:!1,timeout:6e5,async:!0,success:function(e){if("0"==e.status||"2"==e.status||"3"==e.status)"3"==e.status?redirectLoginPage():"theme2"==tt||tt;else if(""!=t){var r=getStuddentCountTr(e.gradeList,t,a,s,e.changeSlotDate);$("#"+a+"_"+s).html(""),$("#"+a+"_"+s).html(r)}else{var i=getStuddentListTbody(e.teacherAssign);$("#stdAssignList").dataTable().fnDestroy(),$("#"+a).html(""),$("#"+a).html(i),$("#stdAssignList").DataTable();var n=$("#teachername"+s).text();$("#teacherAssignName").text(n),$("#studentAssignListPopup").modal("show")}},error:function(e){"theme2"==tt?showMessageTheme2(2,TECHNICAL_GLITCH,"",!0):"theme1"==tt&&showMessage(!0,TECHNICAL_GLITCH)}})}function divPopup(e,t,a){var s="dropdown-menu-md";"course"==t&&(s="dropdown-menu-xl");var r="";return r+='<div class="btn-group dropdown" style="vertical-align: top !important;font-size:11px">',r+='<a href="#" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="mb-2 mr-2 dropdown-toggle">'+e+'<span class="gctotal_'+t+"_"+a+'"></span></a>',r+='<div tabindex="-1" role="menu" aria-hidden="true" class="'+s+' dropdown-menu" style="font-size:11px !important;">',r+='<div class="menu-header-content"><h5 class="menu-header-title text-center ">'+e+'<span class="gctotal_'+t+"_"+a+'"></span></h5></div>',r+='<div class="grid-menu grid-menu-3col">',r+='<div class="no-gutters row">',r+='<div class="col-sm-12 col-xl-12 pt-0" style="max-height: 200px;overflow-y: auto;">',r+='<table class="row-height-small" style="width:100%;">',r+='<tr><thead class="table-head-sticky">',r+="<th>"+e+'</th><th>Total</th><th style="width:60px">In-Active</th>',r+="</thead></tr>",r+='<tbody id="'+t+"_"+a+'">',r+="</tbody>",r+="</table>",r+="</div></div></div></div></div>"}function getStuddentCountTr(e,t,a,s,r){var i="",n=0,o=0,l=0,d=0;if(e.length>0)for($(".gctotal_"+a+"_"+s).html(" ("+e.length+")"),md=0;md<e.length;md++)i+="<tr>",i+="<td>"+e[md].gradeName+"</td>",i+="<td>"+e[md].studentCount+"</td>",i+="<td>"+e[md].studentInActiveCount+"</td>",i+="</tr>","STANDARD"==t&&(parseInt(e[md].assinedTotalStudent)>0&&(n=parseInt(e[md].assinedTotalStudent)),o+=parseInt(e[md].studentCount),l+=parseInt(e[md].studentPlActiveCount),d+=parseInt(e[md].studentGlActiveCount));if("STANDARD"==t){$("#ass_student_"+s).text(n);var c='<a style="min-width:30px;" class="d-inline-block text-center bg-info text-white p-1 font-weight-bold" href="javascript:void(0)" onclick="'+("getTeacherAssignStudentList('','','studentTeachAssignList','"+s+"', '');")+'">'+o+"</a>";$("#total_student_"+s).html(c),$("#pl_student_"+s).html(l),$("#gl_student_"+s).html(d)}return i}function getStuddentListTbody(e){var t="",a=1;if(e.length>0)for(md=0;md<e.length;md++)t+="<tr>",t+="<td>"+a+"</td>",t+="<td>"+e[md].studentName+"</td>",t+="<td>"+e[md].gradeName+"</td>",t+="<td>"+e[md].registerType+"</td>",t+="</tr>",a+=1;return t}function saveInactiveAssignTeacher(e,t,a,s,r,i){i?hideMessageTheme2(""):hideMessage(""),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","inactive-assign-teacher"),data:JSON.stringify(getRequestForInactiveAssignTeacher(e,t,a,s,r)),dataType:"json",cache:!1,timeout:6e5,success:function(e){return"0"==e.status||"2"==e.status?i?showMessageTheme2(0,e.message,"",!0):showMessage(!0,e.message):(i?showMessageTheme2(1,e.message,"",!0):showMessage(!0,e.message),setTimeout((function(){var e="";""!=$("#teacherAssignForm #subjectId").val()&&(e=$("#teacherAssignForm #subjectId").val()),getTeacherAssignList("subjectwise","teacherAssignBody",e)}),1500)),!1},error:function(e){return!1}})}function getRequestForInactiveAssignTeacher(e,t,a,s,r){var i={},n={};return n.orderBy=s,n.userId=e,n.subjectid=r,n.teacherActivate=0==a?"N":"Y",n.updateAll=t,i.hash=getHash(),i.schoolId=SCHOOL_ID,i.schoolUUID=SCHOOL_UUID,i.userId=USER_ID,i.userType="COMMON",n.authentication=i,n}function saveTeacherAssignToStudent(e,t,a,s){s?hideMessageTheme2(""):hideMessage(""),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","save-assign-teacher-tostudent"),data:JSON.stringify(getRequestForTeacherAssignStudent(e,t,a)),dataType:"json",cache:!1,timeout:6e5,success:function(e){return"0"==e.status||"2"==e.status?s?showMessageTheme2(0,e.message,"",!0):showMessage(!0,e.message):s?(showMessageTheme2(1,e.message,"",!0),setTimeout((function(){var e="";""!=$("#teacherAssignForm #subjectId").val()&&(e=$("#teacherAssignForm #subjectId").val()),getTeacherAssignList("subjectwise","teacherAssignBody",e)}),1500)):showMessage(!0,e.message),!1},error:function(e){return!1}})}function getRequestForTeacherAssignStudent(e,t,a){var s={},r={},i=[];$("#"+t+" tr.assignTeacherItem").each((function(){var e=[],t=[],s={},r=$(this).find("td .assignTeacherId").val();s.userId=$(this).find("td .assignTeacherto").val(),s.subjectId=$(this).find("td .assignSubject").val(),s.orderBy=$(this).find("td .rowindex").val(),s.totalStudent=$(this).find("td .totalAssignStudent").val();var n=$(this).find("td .leadGrades").select2("val");null!=n&&(s.leadGrade=n.toString());var o=$(this).find("td .assignActiveStudent").val();null==o||(s.teacherActive=o),$("#time-wrapper-"+r+" span").each((function(){var t={},a=$(this).find(".day_time-"+r).find("label").attr("data-teach-day"),s=$(this).find(".start_time-"+r).find("label").attr("data-teach-strtime"),i=$(this).find(".end_time-"+r).find("label").attr("data-teach-entime");null!=s&&(t.dayId=a,t.startTime=s,t.endTime=i,e.push(t))})),$(".leave_dates"+r+" li").each((function(){if("LEAVE"!=$(this).find("p").attr("data-leave-type")){var e=$(this).find("p").text();t.push(e)}})),s.teacherTimeList=e,s.teacherLeaveDate=t,s.activeDays=[],"TEACH-ASSIGN-SYS"==a&&(s.userRole="TEACHER"),i.push(s)})),r.teacherAssignList=i,r.callFrom=a;var n="N";return $("#allCourseAssign").is(":checked")&&(n="Y"),r.updateAll=n,s.hash=getHash(),s.schoolId=SCHOOL_ID,s.schoolUUID=SCHOOL_UUID,s.userId=USER_ID,s.userType="COMMON",r.authentication=s,r}function teacherOrderTr(e){var t=[];$("#"+e+" tr.assignTeacherItem").each((function(){if(""!=$(this).find("td .rowindex").val()){var e=parseInt($(this).find("td .rowindex").val());t.push(e)}}));for(var a=t.sort(),s=0;s<a.length;s++){var r=a[s]-1;$(".teacher-ord-"+a[s]).insertAfter(".teacher-ord-"+r)}}var WEEKLY_LIST={},WEEKLIST_ARR=[],weekDayList={};function getTimeForTeacher(e,t,a,s,r,i,n,o,l){console.log("getTimeForTeacher");var d=$("#"+t+" #slotLimitHrs").val(),c=($("#"+t+" #agreedHalfHrs").val(),$("#"+t+" #changeSlotLimit").val()),m=$("#"+t+" #changeSlotDate").val(),u=$("#"+t+" #controlType").val(),h=$("#"+t+" #slotTillDate").val(),p=$("#"+t+" #timeSlotType").val(),g="",v=$("#"+n+e).val(),T=$("#"+o+e).val(),S=$("#"+l+" option:selected").attr("data-task-name");if(""==S)return showMessageTheme2(0,"Please select a task"),!1;if(v==T)return showMessageTheme2(0,"Invaild start time and end time"),!1;if(""==v)return showMessageTheme2(0,"Invaild start time"),!1;if(""==T)return showMessageTheme2(0,"Invaild end time"),!1;if("leave-dates"==i){if(null==$(".leave-dates").val()&&null==$(".leave-dates").val()&&""==$(".leave-dates").val())return showMessageTheme2(0,"Please select date"),!1}else{if(null==$("."+i).val()||null==$("."+i).val()||""==$("."+i).val())return showMessageTheme2(0,"Please select day"),!1;g=$("."+i).val(),$("."+i+" option:selected").attr("data-day-name")}if(""==g)return D=!1,showMessageTheme2(2,"Please select Day"),!1;var f=v.split(":"),y=T.split(":");var b=new Date(1990,1,1,f[0],f[1],0),I=new Date(1990,1,1,y[0],y[1],0),D=!0,w=[],k=[];if("edit"==u){if(""!=$("#"+t+" #updateSlotDate").val()&&null!=$("#"+t+" #updateSlotDate").val()){var E=new Date($("#"+t+" #updateSlotDate").val());w[0]=E}}else w=getMonthDaysDate(g-1,c,m,h);if(0==w.length)return showMessageTheme2(0,"The selected day has passed, please select a future day."),!1;if(!(b.getTime()<I.getTime()&&""!=v&&""!=T))return null==$("#"+n+teacherid).val()||""==$("#"+n+teacherid).val()?(showMessageTheme2(2,"Please select start time"),!1):null==$("#"+o+teacherid).val()||""==$("#"+o+teacherid).val()?(showMessageTheme2(2,"Please select end time"),!1):b.getTime()>I.getTime()?(showMessageTheme2(0,"Invaild start time and end time"),!1):(showMessageTheme2(2,"Please select start time and end time"),!1);if(a){var M=v;var L=new Date("1970-01-01T"+M+"Z").toLocaleTimeString("en-US",{timeZone:"UTC",hour12:!0,hour:"numeric",minute:"numeric"}),A=T;var x=new Date("1970-01-01T"+A+"Z").toLocaleTimeString("en-US",{timeZone:"UTC",hour12:!0,hour:"numeric",minute:"numeric"}),C=b.toLocaleString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}),R=I.toLocaleString("en-US",{hour:"numeric",minute:"numeric",second:"numeric",hour12:!1}),O=!0,_=new Date("1970-01-01T"+M+"Z"),P=new Date("1970-01-01T"+A+"Z"),H=(Date.parse(P)-Date.parse(_))/1e3/60,F=String(100+Math.floor(H/60)).substr(1),N=String(100+H%60).substr(1);if("Live Classes"==S&&parseFloat(F+"."+N)<parseFloat(d)){var U=d="2";return D=!1,showMessageTheme2(2,"Minimum "+U+" hours of slot can be added in 'Live classes' Task."),!1}var j=0,q=0;$(".curr-slot-hours").each((function(){var e=$(this).attr("data-total-hours");null!=e&&(q+=parseInt(e))}));var W=0;$(".next-slot-hours").each((function(){var e=$(this).attr("data-total-hours");null!=e&&(W+=parseInt(e))})),"curr-slot"==p?j=q:"next-slot"==p&&(j=W);var z=0;$(".vr-slot").each((function(){var e=$(this).attr("data-total-vrhours");null!=e&&(z+=parseInt(e))})),j+=z,j=Number(j);Math.floor(j/3600);if(D){var Y=!0;$.each(w,(function(t,a){O=!0;var s=a.toDateString().split(" ");s=s[1]+" "+s[2]+", "+s[3];var r=(r=a.toDateString().split(" "))[0]+" "+r[1]+" "+r[2]+", "+r[3];if($(".tr-live-class").each((function(){var t=$(this).attr("data-day-id"),a=$(this).attr("data-teach-date"),r=$(this).attr("data-slot-type");if((r="SYS-TRAINING"==r?"System Training":"LIVE"==r?"Live Classes":"Admin Task",s===a)&&$(this).find("span").length>3)return O=!1,showMessageTheme2(2,"You have reached your maximum of 3 time slots per day."),!1;$($(this).find("span")).each((function(){var r=$(this).attr("data-teach-strtime"),i=$(this).attr("data-teach-entime");if(null!=r&&t==g&&s===a&&(r<=C&&i>C||r<R&&i>=R))return O=!1,$("#startTime"+e).val(""),$("#endTime"+e).val(""),showMessageTheme2(2,"Time already selected for "+s),!1}))})),$(".tr-live-class-profile").each((function(){var e=$(this).attr("data-day-id"),t=$(this).attr("data-teach-date");$($(this).find("span")).each((function(){var a=$(this).attr("data-teach-strtime"),r=$(this).attr("data-teach-entime");if(null!=a&&e==g&&s===t&&(a<=C&&r>C||a<R&&r>=R))return O=!1,showMessageTheme2(2,"Time already selected for "+t),!1}))})),O){var i=[],n={};n.startTime=M+":00",n.endTime=A+":00",n.displayStartTime=L,n.displayEndTime=x;var o=toSeconds(F,N,0);if(n.totalHrsSpent=secondsToHms(o),i.push(n),WEEKLIST_ARR.length>0){var l=WEEKLIST_ARR[t];if(null==l){(T={}).displayStartDate=r,T.startDate=s,T.dayId=g,T.taskName=S,T.teacherPreferTime=i,T.duration=secondsToHms(o),k.push(T),weekDayList={},WEEKLY=[],null==k[t]?WEEKLY[0]=k[0]:WEEKLY[0]=k[t],null!=WEEKLY[0]&&(weekDayList.weeklyTime=WEEKLY,WEEKLIST_ARR.push(weekDayList))}else{for(var d=l.weeklyTime,c=0;c<d.length;c++){var m=d[c];if(null!=m){if(m.startDate==s&&m.dayId==g&&m.taskName==S){var u=m.duration.replace("h ",".").replace("m","").toString().split("."),h=0;if(u.length>1){var p=u[0]>0?u[0]:0,v=u[1]>0?u[1]:0;h=toSeconds(p,v,0)}else{p=u[0]>0?u[0]:0;h=toSeconds(p,0,0)}m.duration=secondsToHms(h+o),m.teacherPreferTime.push(n),Y=!1;break}Y=!0}}if(Y)(T={}).displayStartDate=r,T.startDate=s,T.dayId=g,T.taskName=S,T.teacherPreferTime=i,T.duration=secondsToHms(o),k.push(T),null==k[t]?d.push(k[0]):d.push(k[t])}}else{var T;(T={}).displayStartDate=r,T.startDate=s,T.dayId=g,T.taskName=S,T.teacherPreferTime=i,T.duration=secondsToHms(o),k.push(T),weekDayList={},WEEKLY=[],WEEKLY[0]=k[0],null!=WEEKLY[0]&&(weekDayList.weeklyTime=WEEKLY,WEEKLIST_ARR.push(weekDayList))}}})),"edit"==u?($("#teacherTimeSave").show(),bindEditVertualslot(r,WEEKLIST_ARR,e)):(html="",html=bindVertualSlot(r,WEEKLIST_ARR,e),""!=html&&($("#slotAddText").text("Add More"),$("#teacherTimeSave").show()),$("."+r).html(html))}return!0}}function bindEditVertualslot(e,t,a){for(var s=0;s<t.length;s++){for(var r=t[s].weeklyTime,i="",n=0;n<r.length;n++){var o=r[n];if(null!=o){var l=o.teacherPreferTime,d="";d="System Training"==o.taskName?"SYS-TRAINING":"Live Classes"==o.taskName?"LIVE":"ADMIN";var c="rm-day-"+s+"_"+n,m="removeTime('"+e+"','"+c+"','"+s+"','"+n+"')";i+='<tr  class="tr-live-class '+c+'" data-userid="'+a+'" data-day-id="'+o.dayId+'" data-teach-date="'+o.startDate+'"  data-slot-type="'+d+'"><td >'+o.displayStartDate+"</td><td>"+o.taskName+'</td><td style="max-width: 300px;">';for(var u="",h=0;h<l.length;h++){var p=l[h];u+='<span class="p-1 mb-1 text-center font-weight-semi-bold d-inline-block text-success border border-success rounded-5 font-10" data-teach-strtime="'+p.startTime+'" data-teach-entime="'+p.endTime+'">'+p.displayStartTime+" - "+p.displayEndTime+"</span>"}i+=u,i+='</td><td class="text-center">'+o.duration+'</td><td class="text-center"><span class="full"><a href="javascript:void(0)" class="border-0 btn-transition btn btn-outline-danger" onclick="'+m+'" tabindex="0"><i class="fa fa-trash"></i></a></span></td></tr>';var g=o.duration.split("h"),v=0,T=0;g.length>1?(v=g[0],T=" "==g[1]?0:g[1].replace("m","")):T=g[0].replace("m","");var S=(v+"."+T).toString().split("."),f=0;if(S.length>1){var y=S[0]>0?S[0]:0,b=S[1]>0?S[1]:0;f=toSeconds(y,b,0)}else{y=S[0]>0?S[0]:0;f=toSeconds(y,0,0)}0}}$("#editTimeVertualSlot").html(i)}}function bindVertualSlot(e,t,a){for(var s="",r=1,i=0;i<t.length;i++){var n=t[i].weeklyTime;n.sort(((e,t)=>e.startDate-t.startDate));1==r?"1st":2==r?"2nd":3==r&&"3rd";var o="",l="";l+='<thead class="text-primary"><tr><th valign="middle">Day &amp; Date</th><th valign="middle">Task Name</th><th valign="middle">Slots</th><th valign="middle" class="text-center">Total Time</th><th valign="middle">Action</th></tr></thead><tbody>';for(var d=0,c=0;c<n.length;c++){var m=n[c],u="";u="System Training"==m.taskName?"SYS-TRAINING":"Live Classes"==m.taskName?"LIVE":"ADMIN";var h=m.teacherPreferTime,p="rm-day-"+i+"_"+c,g="removeTime('"+e+"', '"+p+"','"+i+"','"+c+"')";o+='<tr  class="tr-live-class '+p+'" data-userid="'+a+'" data-day-id="'+m.dayId+'" data-teach-date="'+m.startDate+'"  data-slot-type="'+u+'"><td >'+m.displayStartDate+"</td><td>"+m.taskName+'</td><td style="">';for(var v="",T=0;T<h.length;T++){var S=h[T];v+='<span class="p-1 mb-1 text-center font-weight-semi-bold d-inline-block text-success border border-success rounded-5 font-10" data-teach-strtime="'+S.startTime+'" data-teach-entime="'+S.endTime+'">'+S.displayStartTime+" - "+S.displayEndTime+"</span>"}o+=v,o+='</td><td class="text-center">'+m.duration+'</td><td class="text-center"><span class="full"><a href="javascript:void(0)" class="border-0 btn-transition btn btn-outline-danger" onclick="'+g+'" tabindex="0"><i class="fa fa-trash"></i></a></span></td></tr>';var f=m.duration.split("h"),y=0,b=0;f.length>1?(y=f[0],b=" "==f[1]?0:f[1].replace("m","")):b=f[0].replace("m","");var I=(y+"."+$.trim(b)).toString().split("."),D=0;if(I.length>1){var w=I[0]>0?I[0]:0,k=I[1]>0?I[1]:0;D=toSeconds(w,k,0)}else{w=I[0]>0?I[0]:0;D=toSeconds(w,0,0)}d+=D}l+=o+='<tr><td colspan="4" class="text-right"><span class="bg-primary text-white d-inline-block py-1 px-2 rounded vr-slot" id="vr-slot-'+r+'" data-total-vrhours="'+d+'">Total time: '+secondsToHms(d)+"</span></td><td></td></tr>",l+="</tbody>",n.length>0&&(s+='<div class="card mb-2 full" id="week_'+r+'" style="border-top-left-radius:12px;border-bottom-left-radius:12px;"><table class="table mb-0"><tbody class=""><tr><td rowspan="5" class="font-weight-semi-bold bg-primary text-white font-size-lg position-relative availability-week-row" style="border-top-left-radius:12px;border-bottom-left-radius:12px;"><span class="availability-week">WEEK '+r+'</span></td><td class="border-top-0"><table class="table roop-table">'+l+"</table></td></tr></tbody></table></div>",r+=1)}return s}function removeTime(e,t,a,s){if($("."+t).remove(),null!=a){var r=WEEKLIST_ARR[a];if(null!=r){var i=r.weeklyTime,n=i[s];removeItemOnce(i,n);var o=0,l=n.duration.split("h"),d=0,c=0;l.length>1?(d=l[0],c=" "==l[1]?0:l[1].replace("m","")):c=l[0].replace("m","");var m=(d+"."+$.trim(c)).toString().split("."),u=0;if(m.length>1){var h=m[0]>0?m[0]:0,p=m[1]>0?m[1]:0;u=toSeconds(h,p,0)}else{h=m[0]>0?m[0]:0;u=toSeconds(h,0,0)}o+=u;var g=parseInt(a)+1,v=$("#vr-slot-"+g).attr("data-total-vrhours")-o;1==g?"1st":2==g?"2nd":3==g&&"3rd";var T="Total time: "+secondsToHms(v);$("#vr-slot-"+g).attr("data-total-vrhours",v),$("#vr-slot-"+g).text(T)}if(null==(r=WEEKLIST_ARR[a]))return!1;0==r.weeklyTime.length&&(WEEKLIST_ARR=removeItemOnce(WEEKLIST_ARR,a))}a=parseInt(a)+1,$("#week_"+a+" .tr-live-class span").length<1&&$("#week_"+a).html(" ");var S=$("#timeSaveTeacherUserId").val();if("edit"==$("#controlType").val())bindEditVertualslot(e,WEEKLIST_ARR,S);else{var f=bindVertualSlot(e,WEEKLIST_ARR,S);$("."+e).html(f)}}function getMonthDaysDate(e,t,a,s){var r=null;if(""!=a){var i=a.split("-");(r=new Date(parseInt(i[0]),parseInt(i[1])-1,parseInt(i[2]))).setDate(r.getDate()),currentYear=r.getFullYear(),currentMonth=r.getMonth(),currentDay=r.getDate(),r=new Date(s)}else{r=new Date(s)}var n=t,o=new Date(currentYear,currentMonth+1,0).getDate()-(currentDay-1),l=currentMonth;n>=o&&(l=currentMonth+1);for(var d=[],c=0;c<=n;c++){var m=new Date(currentYear,currentMonth,currentDay+c);if(!(m<=r))break;if(m.getMonth()<=l&&m.getDay()===e&&d.push(m),m.getMonth()>l)break}return d}function getRequestForStudentTimePreference(e,t){var a={};return a.userId=USER_ID,a.userRole=USER_ROLE,a.schoolId=SCHOOL_ID,a.callFrom=e,a.studentStandardId=t,a}function callStudentTimePreference(e,t){$("#timeStuStandardId").val(t),$("#mandatoryVideoModal").modal("hide"),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","get-time-preference"),data:JSON.stringify(getRequestForStudentTimePreference(e,t)),dataType:"json",cache:!1,timeout:6e5,async:!0,success:function(e){if("0"==e.status||"2"==e.status||"3"==e.status||"1"==e.status)if("3"==e.status)redirectLoginPage();else{if(isSkipped&&"STUDENT"==USER_ROLE)return $("#timePreferencePopup").addClass("d-none"),$("#timePreferencePopup").modal("hide"),!1;"theme2"==tt?"STUDENT"!=USER_ROLE||"REGISTRATION_FRESH"!=e.enrollType&&"REGISTRATION_FLEX_COURSE"!=e.enrollType?($(".thumbnail-frame").parent().hide(),$("#timePreferencePopup .modal-dialog").removeClass("modal-xl"),$("#timePreferencePopup .modal-dialog").addClass("modal-lg"),$("#timePreferenceDiv").removeClass("col-xl-6 col-lg-6 col-md-12 col-sm-12 col-12"),$("#timePreferenceDiv").addClass("col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12"),$("#timePreferencePopup").removeClass("d-none"),$("#timePreferencePopup").modal("show"),$("#mandatoryVideoModal").modal("hide")):"N"!=videoUrl&&(flagWatchVideo?($("#mandatoryVideoModal").hide("hide"),$("#timePreferencePopup").removeClass("d-none"),$("#timePreferencePopup").modal("show")):($("#mandatoryVideoModal").modal("show"),$("#timePreferencePopup").addClass("d-none"),$("#timePreferencePopup").modal("hide"))):tt}},error:function(e){"theme2"==tt?showMessageTheme2(2,TECHNICAL_GLITCH,"",!0):"theme1"==tt&&showMessage(!0,TECHNICAL_GLITCH)}})}function closeMaxLimitsWariningModal(){$(".modal-save-btn").attr("disabled",!1)}function saveTeacherTimePreference(e,t,a){$(".academit-step, #decideLater, #chooseAcademicDateBtnToCountinue").hide(),$(".school-system-training-step, #skipTraining, #moveToDashboardProcess").show(),$(".modal-save-btn").attr("disabled","disabled"),a?hideMessageTheme2(""):hideMessage("");var s=$("#saveType").val(),r=$("#enrollmentType").val(),i=$("#regstrationType").val(),n=$("#"+t+" #submitFrom").val();$("#totalRescheduleNumber").val(),$("#rescheduleNumber").val();if("STUDENT"==e&&"BATCH"!=i){if("SKIP"==s){if(null==$("#chooseDateToStartSemster").val()||""==$("#chooseDateToStartSemster").val()||null==$("#chooseDateToStartSemster").val())return showMessageTheme2(0,"Please select your academic year start date.","",!0),!1}else if("STUDENT_PROFILE"==s){if(null==$("#preferedStartTime").val()||""==$("#preferedStartTime").val()||null==$("#preferedStartTime").val())return showMessageTheme2(0,"Please select your live classes start time.","",!0),!1;if(null==$("#preferedEndTime").val()||""==$("#preferedEndTime").val()||null==$("#preferedEndTime").val())return showMessageTheme2(0,"Please select your live classes end time.","",!0),!1}else if(null==$("#chooseDateSystemTrainingDate").val()||""==$("#chooseDateSystemTrainingDate").val()||null==$("#chooseDateSystemTrainingDate").val())return showMessageTheme2(0,"Please select your system training date.","",!0),!1;if(!("REGISTRATION_FRESH"!=r&&"REGISTRATION_FLEX_COURSE"!=r||"ORIENT"!=s&&"RESH"!=s||null!=$(".viewOrientFreeSlot input[name='slotTime']:checked").attr("slotedtime")&&null!=$(".viewOrientFreeSlot input[name='slotTime']:checked").attr("slotedtime")&&""!=$(".viewOrientFreeSlot input[name='slotTime']:checked").attr("slotedtime")))return showMessageTheme2(0,"Please select your system training time.","",!0),!1}if("student-profile"==e&&$("#preferedTimeSavedByStudentCount").val()>=1)return showMessageTheme2(0,"You have used your free reschedule for training. Please contact us at admin.support@internationalschooling.org or WhatsApp +65 82553106 if you need to further reschedule your system training","",!0),!1;var o=USER_ID;USER_ID;if("STUDENT"!=USER_ROLE&&"STUDENT_PROFILE"!=s)if(s="LIVE",null!=$("#timeSaveTeacherUserId").val()&&""!=$("#timeSaveTeacherUserId").val()){if(o=$("#timeSaveTeacherUserId").val(),$(".tr-live-class span").length<1)return showMessageTheme2(2,"Please add preferred time"),!1}else if($(".tr-live-class span").length<1)return showMessageTheme2(2,"Please add preferred time"),!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","save-time-preference"),data:JSON.stringify(getRequestForTeacherTimePreference(e,o,t)),dataType:"json",cache:!1,timeout:6e5,success:function(e){if(console.log(e),"0"==e.status||"2"==e.status||"3"==e.status)"3"==e.status&&redirectLoginPage(),a?showMessageTheme2(0,e.message,"",!0):showMessage(!0,e.message);else if("3"==e.status)showMessageTheme2(0,e.message,"",!0),redirectLoginPage();else if(a){var t="";setTimeout((function(){if("STUDENT_PROFILE"==s)showMessageTheme2(1,e.message,"",!0),location.reload();else if("teacher-profile"==n)showMessageTheme2(1,e.message,"",!0),sessionStorage.reloadAfterPageLoad=!0,location.reload();else if("teacher-my-slot"==n)showMessageTheme2(1,e.message,"",!0),callDashboardPageSchool(163,"teacher-manage-slot"),$("#timePreferencePopup").modal("hide"),$("#timePreferencePopup").addClass("d-none"),$("#teacherTimeSave").hide();else{if("RESH"==s)showMessageTheme2(1,e.message,"",!0),location.reload(!0);else if("ORIENT"==s)showMessageTheme2(1,e.message,"",!0),$("#orientAndSemesterChangeSpanHeading").text("School System Training"),t+="<div class='p-2 border rounded-10' style='border-color: #007fff !important;'> <p class='mb-3 text-primary font-weight-semi-bold' style='font-size:18px'>Your School System Training is on "+e.orientationdateTimeInStudentTimeZone+".</p><p class='mt-3 mb-1'><a href='"+e.joinOrientationUrl+"' class='btn btn-success font-size-lg py-1 px-5' target='_blank'>Join</a></p></div>",t+="<p class='mb-0 mt-2 text-primary font-weight-semi-bold' style='font-size:16px'>If you wish to reschedule, please <a href='"+e.rescheduleOrientationUrl+"' class='text-primary' style='text-decoration:underline' target='_blank'>click here</a></p>",$("#thankyouClassesMsg").html(t),$("#thankyouClassesMsg").show(),$("#sartDateWrapper, .timeSlotWrapper").hide(),$("#studentTimeSkipPrev").hide(),$("#studentTimeSkipNext").hide(),$("#startTimeAndEndTimeWrapper").show(),$("#hideAllData").hide(),$("#studentTimeSave").hide(),$("#closeButton").show(),$("#studentTimeSave").text("Confirm");else{if(null!=e.semesterStartDate)var a=e.semesterStartDate.split("-"),r=new Date(parseInt(a[2]),parseInt(a[0])-1,parseInt(a[1])),i=new Date(parseInt(a[2]),parseInt(a[0])-1,parseInt(a[1]));showMessageTheme2(1,e.message,"",!0),"REGISTRATION_FRESH"==e.enrollmentType||"REGISTRATION_FLEX_COURSE"==e.enrollmentType?($("#startTimeAndEndTimeWrapper").hide(),$("#sartDateWrapper, .timeSlotWrapper").show(),$("#orientAndSemesterChangeSpanHeading").text("CHOOSE YOUR SCHOOL SYSTEM TRAINING DATE"),$("#orientAndSemesterChangeSpan").text("I want to schedule my school system training on"),$("#thankyouClassesMsg").html("<p class='full text-center text-primary' style='font-size:16px' onclick='showMobileViewSystemTrainingInfo()'>Join your School System Training where the School Administration will tell you how to book classes, join classes, access progress reports & course material, appear for assessments, etc.</p>"),$("#mobileViewSystemTrainingInfo .modal-body").html("<p class='full text-center border border-primary rounded p-2 text-primary' style='font-size:16px'>Join your School System Training where the School Administration will tell you how to book classes, join classes, access progress reports & course material, appear for assessments, etc.</p>"),$(window).width()<600&&($("#thankyouClassesMsg p .circle-info").length<1&&$("#thankyouClassesMsg p").prepend('<svg xmlns="http://www.w3.org/2000/svg" class="circle-info mr-2 mb-1" width="16px" viewBox="0 0 512 512"><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>'),$("#thankyouClassesMsg p").css({"text-overflow":"ellipsis","-webkit-line-clamp":"1","white-space":"normal","max-height":"38px",overflow:"hidden","word-break":"break-word",display:"-webkit-box","-webkit-box-orient":"vertical"}),$("#thankyouClassesMsg p").addClass("btn btn-outline-primary mb-2"),$("#thankyouClassesMsg p").removeClass("text-primary")),$("#thankyouClassesMsg, #studentTimeSkipNext").show(),$("#chooseDateToStartSemster").val("").datepicker("update")):location.reload(!0),$("#chooseDateToStartSemster-wrapper").removeClass("d-inline-block").addClass("d-none"),$("#chooseDateSystemTrainingDate-wrapper").removeClass("d-none").addClass("d-inline-block"),null!=e.semesterStartDate&&(i.setDate(i.getDate()+(e.activeNumberOfDaysForSystemTraining-1)),$("#chooseDateSystemTrainingDate").datepicker("destroy").datepicker({autoclose:!0,container:"#timePreferencePopup .modal-body",format:"M dd, yyyy",startDate:r,endDate:i}).on("changeDate",(function(){"ORIENT"==$("#saveType").val()&&($("#timePreferencePopup .modal-body").css({"max-height":"500px","overflow-y":"auto"}),"REGISTRATION_FRESH"!=e.enrollmentType&&"REGISTRATION_FLEX_COURSE"!=e.enrollmentType||callOrientationtime())})))}$("#saveType").val("ORIENT")}}),500)}else showMessage(!0,e.message);return!1},error:function(e){return!1}})}function studentTimeSkipNext(e,t,a){$("#saveType").val("SKIP"),$("#orientAndSemesterChangeSpan").html("I want to start my academic year on"),$("#orientAndSemesterChangeSpanHeading").html("CHOOSE YOUR ACADEMIC YEAR START DATE"),$("#startTimeAndEndTimeWrapper").show(),$("#studentTimeSkipPrev").show(),$("#studentTimeSkipPrev").text("Back"),$("#studentTimeSave").text("Confirm"),$("#studentTimeSkipNext, .timeSlotWrapper").hide(),$("#chooseDateToStartSemster").val("").datepicker("update")}function studentTimeSkipPrev(e,t,a){$("#saveType").val("ORIENT"),$("#orientAndSemesterChangeSpan").html("I want to schedule my school system training on"),$("#orientAndSemesterChangeSpanHeading").html("CHOOSE YOUR SCHOOL SYSTEM TRAINING DATE"),$("#startTimeAndEndTimeWrapper").hide(),$("#studentTimeSkipPrev").hide(),$("#studentTimeSkipNext").show(),$("#chooseDateToStartSemster").val("").datepicker("update")}function rescheduleOrientation(){$("#saveType").val("RESH"),$("#orientationTimeWrapper").hide(),$("#orientationDateWrapper").show()}function getRequestForTeacherTimePreference(e,t,a){var s={},r=[],i={};if(s.userId=t,s.schoolId=SCHOOL_ID,s.slotAddUserId=USER_ID,"STUDENT"==e){if(s.studentStandardId=$("#timeStuStandardId").val(),s.userRole="STUDENT",s.saveType=$("#saveType").val(),"BATCH"!=$("#regstrationType").val()){var n=changeDateFormat(new Date($("#chooseDateToStartSemster").val()),"mm-dd-yyyy");i.startDate=$("#chooseDateToStartSemster").val(),s.semesterStartDate=n}if("SKIP"==$("#saveType").val()||"STUDENT_PROFILE"==$("#saveType").val()){var o,l;"STUDENT_PROFILE"==$("#saveType").val()?(o=$("#preferedStartTime").val(),l=$("#preferedEndTime").val()):(o=$("#startTime"+USER_ID).val(),l=$("#endTime"+USER_ID).val()),"SKIP"==$("#saveType").val()&&(o="9:00  AM",l="9:00_AM");var d=o.split(":"),c=parseInt(d[0]),m=d[1].split(" ")[0];"PM"==d[1].split(" ")[1]&&c<12?c+=12:"AM"==d[1].split(" ")[1]&&12==c&&(c=0);var u=l.split(":"),h=parseInt(u[0]),p=u[1].split("_")[0];if("PM"==u[1].split("_")[1]&&h<12&&(h+=12),new Date(1990,1,1,c,m,0)>new Date(1990,1,1,h,p,0))return showMessageTheme2(0,"Invaild start time and end time"),!1;i.startTime=c+":"+m+":00",i.endTime=h+":"+p+":00",r.push(i)}var g=$("#enrollmentType").val();if(!("REGISTRATION_FRESH"!=g&&"REGISTRATION_FLEX_COURSE"!=g||"ORIENT"!=$("#saveType").val()&&"RESH"!=$("#saveType").val())){var v=$("#chooseDateSystemTrainingDate").val(),T=$(".viewOrientFreeSlot input[name='slotTime']:checked").attr("slotsttime"),S=$(".viewOrientFreeSlot input[name='slotTime']:checked").attr("slotedtime"),f=$(".viewOrientFreeSlot input[name='slotTime']:checked").attr("slotduration");console.log(T),console.log(S),s.bookDate=v,s.bookStartTime=T,T=T.split(":");var y=new Date(1990,1,1,T[0],T[1],0),b=Date.parse(y),I=new Date(b),D=getTimePlusInterval(I,f);S=convertTo24Hour(D);s.bookEndTime=S+":00"}}else s.userRole="TEACHER"!=e?"ADMIN":"TEACHER",$(".tr-live-class").each((function(){var e=$(this).attr("data-day-id"),t=$(this).attr("data-slot-type"),a=$(this).attr("data-teach-date");$($(this).find("span")).each((function(){var s={},i=$(this).attr("data-teach-strtime"),n=$(this).attr("data-teach-entime");null!=i&&(s.slotType=t,s.startDate=a,s.dayId=e,s.startTime=i,s.endTime=n,r.push(s))}))})),s.slotUpdateDate=$("#"+a+" #updateSlotDate").val(),s.controlType=$("#"+a+" #controlType").val();return s.teacherTimeList=r,console.log(s),s}function getRequestForTeacherTime(e,t,a,s){var r={};return r.userId=t,r.userRole=a,r.schoolId=SCHOOL_ID,r.callFrom=e,r.autoForwordStatus=s,console.log(r),r}function callTeacherTimePreference(e,t,a,s,r,i){console.log(s),customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","get-teacher-time-preference"),data:JSON.stringify(getRequestForTeacherTime(e,a,s,i)),dataType:"json",cache:!1,timeout:6e5,async:!0,success:function(i){if(console.log(i),"0"==i.status||"2"==i.status||"3"==i.status)"3"==i.status?redirectLoginPage():"theme2"==tt||tt;else{$("#teacherSchedulingHTML").html(""),$("#teacherSchedulingHTML").hasClass("slick-slider")&&$(".slick-slider-wrapper").slick("unslick"),$("#"+r+" #changeSlotLimit").val(i.changeSlotLimit),$("#"+r+" #changeSlotStartDay").val(i.changeSlotStartDay),$("#"+r+" #changeSlotValid").val(i.changeSlotValid),$("#"+r+" #changeSlotDate").val(i.changeSlotDate),$("#"+r+" #updateSlotDate").val(i.updateSlotDate),$("#"+r+" #slotTillDate").val(i.slotTillDate),$("#"+r+" #admin_teacher_name").html(i.teacherName),$("#"+r+" #slotLimitHrs").val(i.agreedMiniHourse),$("#"+r+" #agreedHalfHrs").val(i.agreedHalfHourse);var n=randerWeeklyContent(e,i,t,a,r,s);"teacher-profile-farword"==e?$("#"+r+" .added-availability").html(n):($("#teacherSchedulingHTML").html(n),$(".slick-slider-wrapper").not(".slick-initialized").slick({infinite:!1,adaptiveHeight:!0}),$("#"+r).on("shown.bs.modal",(function(){$(".slick-slider-wrapper").slick("setPosition")})),$(".slick-initialized").append("<div class='slick-nav'></div>"),$(".slick-initialized .slick-prev").appendTo(".slick-initialized .slick-nav"),$("<div class='stutas-nav d-inline-block'><b>Current Availability</b></div>").appendTo(".slick-initialized .slick-nav"),$(".slick-initialized .slick-next").appendTo(".slick-initialized .slick-nav"),$(".slick-initialized .slick-next").click((function(){$(".slick-initialized .stutas-nav b").text("Next Availability")})),$(".slick-initialized .slick-prev").click((function(){$(".slick-initialized .stutas-nav b").text("Current Availability")}))),$("#counselorLeaveSchedule .slick-nav").css({position:"absolute",top:"-27px",left:"0",right:"0px","text-align":"center"}),$("#"+r).modal("show")}customLoader(!1)},error:function(e){"theme2"==tt?showMessageTheme2(2,TECHNICAL_GLITCH,"",!0):"theme1"==tt&&showMessage(!0,TECHNICAL_GLITCH)}})}function randerWeeklyContent(e,t,a,s,r,i){console.log("randerWeeklyContent "+i);var n="";return n+="<div>",$.each(t.teacherWeeklyTimeCurrLiveClass.teacherAssignTimeWeekList,(function(o,l){var d=0;n+='<div class="card mb-2 full" id="week_'+(o+1)+'" style="border-top-left-radius:12px;border-bottom-left-radius:12px;"><table class="table mb-0"><tbody class=""><tr><td rowspan="5" class="font-weight-semi-bold bg-primary text-white font-size-lg position-relative availability-week-row" style="border-top-left-radius:12px;border-bottom-left-radius:12px;"><span class="availability-week">WEEK '+(o+1)+'</span></td><td class="border-top-0"><table class="table roop-table">',n+='<thead class="text-primary"><tr>',n+='<th valign="middle">Day &amp; Date</th><th valign="middle">Task Name</th><th valign="middle">Slots</th><th valign="middle" class="text-center">Total Time</th>',"teacher-profile-farword"!=e&&l.weekStartDate!=l.weekEndDate&&(n+='<th valign="middle" class="text-center">Action</th>'),n+="</tr></thead><tbody>",$.each(l.weeklyTime,(function(l,c){var m=c.totalHrsSpent.split("h"),u=0,h=0;m.length>1?(u=m[0],h=" "==m[1]?0:m[1].replace("m","")):h=m[0].replace("m","");var p=(u+"."+$.trim(h)).toString().split("."),g=0;if(p.length>1){var v=p[0]>0?p[0]:0,T=p[1]>0?p[1]:0;g=toSeconds(v,T,0)}else{v=p[0]>0?p[0]:0;g=toSeconds(v,0,0)}d+=g,c.teacherPreferTime.length>0&&(n+=weeklyContent(e,c,"editView",a,s,o,l,t,r,"curr-slot",i))})),"teacher-profile-farword"!=e&&(l.weekStartDate!=l.weekEndDate?n+='<tr><td colspan="6" class="text-center"><a href="javascript:void(0)" id="add_week_'+(o+1)+'" class="border-1 btn-transition btn btn-outline-primary" onclick="getOpenPrefrenceTimePopup(\'admin-profile\', \''+r+"','"+a+"', '"+t.teacherUserId+"', '"+t.changeSlotLimit+"','"+t.changeSlotStartDay+"' , '"+t.changeSlotValid+"', '"+l.weekStartDate+"', '"+t.updateSlotDate+"', '"+l.weekEndDate+"','add','taskNameDropdow', '"+t.agreedMiniHours+"', '"+t.agreedMaxHours+"','curr-slot', '"+t.agreedHours+"', '"+t.agreedHalfHours+"', '"+t.agreedAvgHours+"','"+i+'\');"><i class="fa fa-plus"></i>Add more days within this week</a></td></tr>':o+1==3&&null==l.weeklyTime&&(n+='<tr><td colspan="6" class="text-center"><a href="javascript:void(0)" id="add_week_'+(o+1)+'" class="border-1 btn-transition btn btn-outline-primary" onclick="getOpenPrefrenceTimePopup(\'admin-profile\', \''+r+"','"+a+"', '"+t.teacherUserId+"', '"+t.changeSlotLimit+"','"+t.changeSlotStartDay+"' , '"+t.changeSlotValid+"', '"+l.weekStartDate+"',  '"+t.updateSlotDate+"', '"+l.weekEndDate+"','add','taskNameDropdow', '"+t.agreedMiniHours+"', '"+t.agreedMaxHours+"','next-slot', '"+t.agreedHours+"', '"+t.agreedHalfHours+"', '"+t.agreedAvgHours+"','"+i+'\');"><i class="fa fa-plus"></i>Add more days within this week</a></td></tr>')),n+='<tr><td colspan="4" class="text-right"><span class="bg-primary text-white d-inline-block py-1 px-2 rounded">Total time: '+secondsToHms(d)+"</span></td>",n+="<td>&nbsp;</td>",n+="</tr>",n+="</tbody></table></td></tr></tbody></table></div>"})),n+="</div>",null!=t.teacherWeeklyTimeNextLiveClass&&"Y"==t.teacherWeeklyTimeNextLiveClass.nextSlotStatus&&(n+="<div>",$.each(t.teacherWeeklyTimeNextLiveClass.teacherAssignTimeWeekList,(function(o,l){var d=0;n+='<div class="card mb-2 full"  id="week_next_'+(o+1)+'"><table class="table mb-0"><tbody class=""><tr><td rowspan="5" class="font-weight-semi-bold bg-primary text-white font-size-lg position-relative availability-week-row" style="border-top-left-radius:12px;border-bottom-left-radius:12px;"><span class="availability-week">WEEK '+(o+1)+'</span></td><td class="border-top-0"><table class="table roop-table">',n+='<thead class="text-primary"><tr>',n+='<th valign="middle">Day &amp; Date</th><th valign="middle">Task Name</th><th valign="middle">Slots</th><th valign="middle" class="text-center">Total Time</th>',"teacher-profile-farword"!=e&&(n+='<th valign="middle" class="text-center">Action',n+="</th>"),n+="</tr></thead><tbody>",$.each(l.weeklyTime,(function(l,c){var m=c.totalHrsSpent.split("h"),u=0,h=0;m.length>1?(u=m[0],h=" "==m[1]?0:m[1].replace("m","")):h=m[0].replace("m","");var p=(u+"."+$.trim(h)).toString().split("."),g=0;if(p.length>1){var v=p[0]>0?p[0]:0,T=p[1]>0?p[1]:0;g=toSeconds(v,T,0)}else{v=p[0]>0?p[0]:0;g=toSeconds(v,0,0)}d+=g,c.teacherPreferTime.length>0&&(n+=weeklyContent(e,c,"editView",a,s,o,l,t,r,"next-slot",i))})),"teacher-profile-farword"!=e&&(l.weekStartDate!=l.weekEndDate||o+1==3&&null==l.weeklyTime)&&(n+='<tr><td colspan="6" class="text-center"><a href="javascript:void(0)" id="add_week_'+(o+1)+'" class="border-1 btn-transition btn btn-outline-primary" onclick="getOpenPrefrenceTimePopup(\'admin-profile\', \''+r+"','"+a+"', '"+t.teacherUserId+"', '"+t.changeSlotLimit+"','"+t.changeSlotStartDay+"' , '"+t.changeSlotValid+"', '"+l.weekStartDate+"',  '"+t.updateSlotDate+"', '"+l.weekEndDate+"','add','taskNameDropdow', '"+t.agreedMiniHours+"', '"+t.agreedMaxHours+"','next-slot', '"+t.agreedHours+"', '"+t.agreedHalfHours+"', '"+t.agreedAvgHours+"','"+i+'\');"><i class="fa fa-plus"></i>Add more days within this week</a></td></tr>'),n+='<tr><td colspan="4" class="text-right"><span class="bg-primary text-white d-inline-block py-1 px-2 rounded">Total time: '+secondsToHms(d)+"</span></td>",n+="<td>&nbsp;</td>",n+="</tr></tbody></table></td></tr></tbody></table></div>"})),n+="</div>"),n}function weeklyContent(e,t,a,s,r,i,n,o,l,d,c){var m="",u=new Date(t.startDate).toDateString().split(" ");u=u[1]+" "+u[2]+", "+u[3];var h="tr-live-class-profile",p=t.slotType,g=!0,v="";"teacher-profile-farword"==e&&(h="tr-live-class",g=!1,p="",p="System Training"==t.slotType?"SYS-TRAINING":"Live Classes"==t.slotType?"LIVE":"ADMIN",v="rm-day-"+i+"_"+n);var T="removeTime('added-availability','"+v+"','"+i+"','"+n+"')",S="getOpenPrefrenceTimePopup('admin-profile', '"+l+"','"+s+"', '"+r+"', '"+o.changeSlotLimit+"', '"+o.changeSlotStartDay+"', '"+o.changeSlotValid+"', '"+o.changeSlotDate+"', '"+t.startDate+"','','edit','taskNameDropdow', '"+o.agreedMiniHours+"', '"+o.agreedMaxHours+"','"+d+"', '"+o.agreedHours+"','"+o.agreedHalfHours+"', '"+o.agreedAvgHours+"','"+c+"')",f="showWarningMessage('Are you sure you want to delete?','"+("callTimePreferenceByDate(\\'admin-profile\\', \\'"+s+"\\', \\'"+r+"\\', \\'"+c+"\\', \\'"+t.startDate+"\\', \\'"+l+"\\', \\'delete\\',\\'0\\')")+"')";return m+='<tr class="'+h+" "+v+'" data-userid="'+r+'" data-day-id="'+t.dayId+'" data-teach-date="'+u+'"  data-slot-type="'+p+'">',m+="<td>"+t.displayStartDate+"</td><td>"+t.slotType+'</td><td style="display: inline-block;">',$.each(t.teacherPreferTime,(function(e,a){var i="showWarningMessage('Are you sure you want to delete?','"+("callTimePreferenceByDate(\\'admin-profile\\', \\'"+s+"\\', \\'"+r+"\\', \\'"+c+"\\', \\'"+t.startDate+"\\', \\'"+l+"\\', \\'delete\\',\\'"+a.timeid+"\\')")+"')";m+='<span class="p-1 mb-1 text-center font-weight-semi-bold d-inline-block text-success border border-success rounded-5 font-10" data-teach-strtime="'+a.startTime+'" data-teach-entime="'+a.endTime+'">'+a.displayStartTime+" - "+a.displayEndTime,t.editDeleteStatus&&(m+='<a href="javascript:void(0)" class="border-0 btn-transition btn btn-outline-danger" onclick="'+i+'" tabindex="0"><i class="fa fa-trash"></i></a>'),m+="</span>"})),m+='</td><td class="text-center">'+t.totalHrsSpent+"</td>","viewOnly"!=a&&t.editDeleteStatus&&(m+='<td class="text-center"><span class="full">',g?(m+='<a href="javascript:void(0)" class="border-0 btn-transition btn btn-outline-primary" onclick="'+S+'"><i class="fa fa-plus"></i></a>',m+='<a href="javascript:void(0)" class="border-0 btn-transition btn btn-outline-danger" onclick="'+f+'" tabindex="0"><i class="fa fa-trash"></i></a>'):m+='<a href="javascript:void(0)" class="border-0 btn-transition btn btn-outline-danger" onclick="'+T+'" tabindex="0"><i class="fa fa-trash"></i></a>',m+="</span></td>"),m+="</tr>"}function getRequestForTeacherTimeByDate(e,t,a,s,r,i){var n={};return n.teacherUserId=t,n.startDate=s,n.userRole=a,n.schoolId=SCHOOL_ID,n.callFrom=e,n.controlType=r,n.slotId=i,n.userId=USER_ID,n}function callTimePreferenceByDate(e,t,a,s,r,i,n,o){$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("report","get-time-preference-by-date"),data:JSON.stringify(getRequestForTeacherTimeByDate(e,a,s,r,n,o)),dataType:"json",cache:!1,timeout:6e5,async:!0,success:function(r){if(console.log(r),"0"==r.status||"2"==r.status||"3"==r.status)"3"==r.status?redirectLoginPage():"theme2"==tt?"delete"==n&&showMessageTheme2(1,r.message,"",!0):tt;else if("delete"==n)showMessageTheme2(1,r.message,"",!0),"teacher-profile"==e?(sessionStorage.reloadAfterPageLoad=!0,location.reload()):"teacher-my-slot"==e?callDashboardPageSchool(163,"teacher-manage-slot"):"admin-profile"==e&&callTeacherTimePreference("admin-panel",t,a,s,i,"N");else{var o=bindEditPrefrence(i,r,n);$("#"+i+" .added-availability").html(o)}},error:function(e){"theme2"==tt?showMessageTheme2(2,TECHNICAL_GLITCH,"",!0):"theme1"==tt&&showMessage(!0,TECHNICAL_GLITCH)}})}function bindEditPrefrence(e,t,a){var s=t.teacherAssignTime;$("#"+e+" #availabilityDay").val(s.dayId).trigger("change"),$("#"+e+" #availabilityDay").attr("disabled",!0);var r="";return $("#"+e+" .added-availability").html(""),r+='<div><div class="card mb-2 full" id="week_1"><table class="table mb-0"><tbody class=""><tr><td class="border-top-0"><table class="table roop-table"><thead class="text-primary"><tr><th valign="middle">Day &amp; Date</th><th valign="middle">Task Name</th><th valign="middle">Slots</th><th valign="middle" class="text-center">Total Time</th><th valign="middle" class="text-center">Action</th></tr></thead><tbody id="editTimeSlot">',$.each(s.teacherPreferTime,(function(e,t){var a=new Date(s.startDate).toDateString().split(" ");a=a[1]+" "+a[2]+", "+a[3];var i="";i="SYS-TRAINING"==t.slotType?"System Training":"LIVE"==t.slotType?"Live Classes":"Admin Task";var n="rm-day_"+e;r+='<tr class="tr-live-class '+n+'" data-userid="'+s.teacherUserId+'" data-day-id="'+s.dayId+'" data-teach-date="'+a+'"  data-slot-type="'+t.slotType+'"><td>'+s.displayStartDate+"</td><td>"+i+'</td><td style="max-width: 300px;display: inline-block;"><span class="p-1 mb-1 text-center font-weight-semi-bold d-inline-block text-success border border-success rounded-5 font-10" data-teach-strtime="'+t.startTime+'" data-teach-entime="'+t.endTime+'">'+t.displayStartTime+" - "+t.displayEndTime+'</span></td><td class="text-center">'+t.totalHrsSpent+'</td><td class="text-center">',r+="</td></tr>"})),r+='</tbody><tbody id="editTimeVertualSlot"></tbody></table></td></tr></tbody></table></div></div>'}function callOrientationtime(){customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLFor("orientation","get-orientation-time"),data:JSON.stringify(getRequestForOrientationTime()),dataType:"json",cache:!1,timeout:6e5,async:!0,success:function(e){if(console.log(e),"0"==e.status||"2"==e.status||"3"==e.status);else{var t=getOrientSlot(e.demoFreeSlotsList);$(".viewOrientFreeSlot").html(t),$(".timeSlotWrapper").removeClass("d-none"),$(".timeSlotWrapper").show(),$(".meeting-time").click((function(){var e=$(this).attr("for");$("#"+e).prop("checked")&&($(this).parent().addClass("bg-primary text-white").removeClass("text-primary"),$(this).parent().closest(".time-slot").siblings().find(".form-check").addClass("text-primary").removeClass("bg-primary text-white"),$("#moveToDashboardProcess").removeClass("disabled btn-light"),$("#moveToDashboardProcess").addClass("btn-success"),$("#moveToDashboardProcess").text("Confirm"))}))}customLoader(!1)},error:function(e){"theme2"==tt?showMessageTheme2(2,TECHNICAL_GLITCH,"",!0):"theme1"==tt&&showMessage(!0,TECHNICAL_GLITCH)}})}function getRequestForOrientationTime(){var e={};return e.userId=USER_ID,e.userRole=USER_ROLE,e.schoolId=SCHOOL_ID,e.slotType="SYS-TRAINING",e.bookDate=$("#chooseDateSystemTrainingDate").val(),e}function getOrientSlot(e){var t="No slot available. Please pick another date";if($(".viewOrientFreeSlot").css({"pointer-events":"none"}),e.length>0){$("#userTimeZone").text("("+e[0].studentTimeZone+")");t="";var a=1;if(e.length>0)for(let s=0;s<e.length;s++){const r=e[s];t+='<div class="time-slot col-lg-6 col-md-6 col-sm-12"> ',t+='<div class="form-check border-primary text-primary p-0"> ',t+='<label class="meeting-time full d-inline-flex justify-content-flex-start align-items-center pl-4 ml-2" for="'+a+'"> ',t+='<input class="form-check-input time-radio orient_time" type="radio" name="slotTime" id="'+a+'"  slotsttime="'+r.stTime+'" slotedtime="'+r.edTime+'" slotmeetdate="'+r.meetDate+'" slotTime="'+r.startTime+'" slotDuration="'+r.meetingDuration+'"  />'+r.meetingDate+" "+r.startTime+" ",t+="</label> ",t+="</div> ",t+="</div> ",a+=1,'<option value="'+r.stTime+"-"+r.edTime+'">'+r.startTime+" - "+r.endTime+"</option>"}$(".viewOrientFreeSlot").css({"pointer-events":"inherit"})}return t}function getAvailability(e){getAsPost("/timeavailability/time-availability?moduleId=182&schoolId="+SCHOOL_ID+"&euid="+e),customLoader(!1)}$((function(){sessionStorage.reloadAfterPageLoad&&($(".my-availability").trigger("click"),sessionStorage.reloadAfterPageLoad=!1)}));