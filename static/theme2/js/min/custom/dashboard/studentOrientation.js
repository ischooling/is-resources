function validateRequestForBookOrientation(e,t,a){hideMessage("");return null==$("#"+e+" #leadSource").val()||"0"==$("#"+e+" #leadSource").val()?(t?showMessageTheme2(0,"Please select Lead Source","",!0):showMessage(!0,"Please select Lead Source"),!1):5!=$("#"+e+" #leadSource").val()||null!=$("#"+e+" #leadDemoAssign").val()&&0!=$("#"+e+" #leadDemoAssign").val()||(t?showMessageTheme2(0,"Please choose Demo Assigned to","",!0):showMessage(!0,"Please choose Demo Assigned to"),!1)}function submitBookOrientation(e,t,a,n,o){if(console.log("submitBookOrientation",o),n?hideMessageTheme2(""):hideMessage(""),!validateRequestForBookOrientation(e,n,o))return!1;$.ajax({type:"POST",contentType:"application/json",url:getURLFor("orientation","save-book-orientation"),data:JSON.stringify(getRequestForBookOrientation(e,o)),dataType:"json",cache:!1,timeout:6e5,success:function(e){return"FAILED"==e.status||"EXCEPTION"==e.status||"SESSIONOUT"==e.status?n?showMessageTheme2(0,e.message,"",!0):showMessage(!0,e.message):(showMessageTheme2(1,e.message,"",!0),$("#leadPopupForm").modal("hide")),!1},error:function(e){return!1}})}function getRequestForBookOrientation(e,t){var a={bookDate:!1,bookStartTime:!1,bookEndTime:!1,controlType:!1};return a.schoolId=SCHOOL_ID,a.userId=USER_ID,a}function advanceSearchStudentOrient(e,t,a,n,o,s,i){customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLFor("orientation","get-orientation-student"),data:JSON.stringify(getCallRequestForAdvanceSearchStudentOrient(e,t,a,n,o,s,i)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(e){if(console.log(e),"FAILED"==e.status||"EXCEPTION"==e.status||"SESSIONOUT"==e.status)i?showMessageTheme2(0,e.message,"",!0):showMessage(!0,e.message);else{$.fn.dataTable.isDataTable("#orientTbl")&&$("#orientTbl").dataTable().fnDestroy();var t=getOrientList(e);$("#studentOrientList").html(t).promise().done((function(){customLoader(!1)})),$("#orientTbl").DataTable(),$("#orientTbl").DataTable().data().any()?$(".moveOrientation-wrapper").removeClass("d-none"):$(".moveOrientation-wrapper").addClass("d-none"),$("#orientationSearch").modal("hide")}},error:function(e){console.log(e),customLoader(!1)}})}function getCallRequestForAdvanceSearchStudentOrient(e,t,a,n,o,s,i){$(".orientationErrorText").html("");var r={};return r.searchType=a,r.userWiseStatus=s,r.studentName=$("#"+e+" #stdfnameSearch").val(),r.parentName=$("#"+e+" #parentfnameSearch").val(),r.country=$("#"+e+" #countryId option:selected").val(),r.state=$("#"+e+" #stateId option:selected").val(),r.city=$("#"+e+" #cityId option:selected").val(),r.standardId=$("#"+e+" #gradeSearch option:selected").val(),r.email=$("#"+e+" #emailIdSearch").val(),r.phoneNo=$("#"+e+" #phoneNoSearch").val(),r.bookStartDate=$("#"+e+" #startDateSearch").val(),r.bookEndDate=$("#"+e+" #endDateSearch").val(),r.orientStatus=$("#"+e+" #statusSearch").val(),null!=$("#"+e+" #assignToSearch option:selected").val()&&(r.assignTo=$("#"+e+" #assignToSearch option:selected").val()),null==o&&(o=0),r.currentPage=o,r.recordsPerPage=10,r.userId=USER_ID,r.schoolId=SCHOOL_ID,r}function getOrientList(e){var t="",a=getSettingsByTypeAndKey("CONFIGURATION","SHOW_RECORDINGS_LIMIT"),n=(a=JSON.parse(a)).data.metaValue,o=new Date;if(o.setDate(o.getDate()-n),e.studentOrientationList.length>0)for(var s=1,i=0;i<e.studentOrientationList.length;i++){var r=e.studentOrientationList[i],l="return callOrientPopup('orientStatusUpdate','"+r.id+"','edit','"+r.rescheduleNumber+"','"+r.totalRescheduleNumber+"')",d=(r.id,"return sendOrientationMail('orientStatusUpdate','"+r.id+"','sendMail')"),c=r.bookDate.split("<br/>"),u=c[1].split("-"),h=new Date(c[0])>=o;t=(t=(t=(t=(t=(t=(t=(t=t+"<tr class='row-status-"+r.status+"'>")+"<td><input type='checkbox' class='mt-1 checkOrientation' id='orientation-"+r.id+"' name='orientation-move-another' value="+r.id+" data-assignToUserId="+r.assignToUserId+" onchange='toggleOption(this)' /></td>")+"<td>"+s+"</td>")+"<td><b>"+r.studentName+"</b><br/>"+r.learningPlan+"<br/>"+r.grade+"<br/>"+r.studentStringId+"</td>")+"<td>"+r.bookDate+" ("+r.teacherTimeZone+")</td>")+"<td>"+r.bookStudentDate+" ("+r.studentTimeZone+")</td>")+"<td>"+r.assignName+"</td>")+"<td class='position-relative'>"+r.status,t+='<a href="'+r.startUrl+'" target="_blank" class=\'text-decoration-none full\''+(null==r.meetingId?" style='pointer-events: none; color: grey; text-decoration: none; cursor: default;' onclick='return false;'":"")+">Start System Training</a>",t+='<a href="'+r.rescheduleUrl+'" target="_blank" class=\'text-decoration-none full\''+(null==r.meetingId?" style='pointer-events: none; color: grey; text-decoration: none; cursor: default;' onclick='return false;'":"")+">Reschedule System Training</a>",t=(t=(t+="<a href=\"javascript:void(0);\" class='text-decoration-none full'"+(null==r.meetingId?" style='pointer-events: none; color: grey; text-decoration: none; cursor: default;'":' onclick="'+l+'"')+">Update</a>")+'<b class="copy-msg-'+i+' text-success"></b></br>')+"<div class='position-absolute' style='top:0;left:0;'><input type='text' id='copyUrl"+i+"' value=\""+r.joinUrl+"\" style='opacity:0;height:0px'></div>",t+="<button class='text-decoration-none btn btn-sm btn-primary' "+(null==r.meetingId?"disabled ":"")+"onclick='copyURL(\"copyUrl"+i+'","copy-msg-'+i+"\");'></i>Copy joining link</button>",t+="</td>","Y"==r.sendMailStatus?t+="<td>Mail sent</td>":(t+="<td>",t=(t+="<p class='m-0'></p>")+'<a href="javascript:void(0);" onclick="'+d+"\" class='text-decoration-none full font-weight-semi-bold' style='margin-bottom:5px;'>Send Mail</a>",0==r.recordingsCount||"DIRECTOR"!=USER_ROLE&&!h||(t=t+'<a href="javascript:void(0);" class="text-primary font-weight-semi-bold" style="display: inline-block;width: max-content;" onclick="openRecordingModal(\''+r.meetingId+"','MEETINGS','"+r.studentName+"','System Training','"+c[0]+"','"+u[0]+"','"+r.assignName+"','"+r.bookStartDateTimeSingapore+'\')">View Recording <i class="fa fa-eye mt-2"><i/></a>'),t+="</td>"),t=(t=t+"<td>"+r.remarks+"</td>")+"<td>"+r.createDate+"</td>",t+="</tr>",s+=1}return t}function advanceOrientationSearchStudentReset(e){$("#"+e+" #statusSearch").val("").trigger("change"),$("#"+e+" #assignToSearch").val("").trigger("change"),$("#"+e+" #followMedSearch").val("").trigger("change"),$("#"+e+" #gradeSearch").val("").trigger("change"),$("#"+e+" #emailIdSearch").val(""),$("#"+e+" #phoneNoSearch").val(""),$("#"+e+" #stdfnameSearch").val(""),$("#"+e+" #parentfnameSearch").val(""),$("#"+e+" #gradeSearch").val(""),$("#"+e+" #city").val("0").trigger("change"),$("#"+e+" #stateId").val("0").trigger("change"),$("#"+e+" #countryId").val("0").trigger("change"),$("#"+e+" #startDateSearch").val(""),$("#"+e+" #endDateSearch").val(""),$("#"+e+" #leadModifyStartDateSearch").val(""),$("#"+e+" #leadModifyEndDateSearch").val(""),$("#"+e+" #leadCallStartDateSearch").val(""),$("#"+e+" #leadCallEndDateSearch").val("")}function callOrientPopup(e,t,a,n,o){$("#orientStatus").val("").trigger("change"),$("#"+e).modal("show"),$("#orientId").val(t),$("#rescheduleNumber").val(n),$("#totalRescheduleNumber").val(o)}function createOrientMeeting(e,t,a){hideMessageTheme2("");var n={};n.orientationId=t,n.schoolId=SCHOOL_ID,$.ajax({type:"POST",contentType:"application/json",url:getURLFor("orientation","create-orientation-meeting"),data:JSON.stringify(n),dataType:"json",cache:!1,timeout:6e5,success:function(e){return"0"==e.status||"2"==e.status||"FAILED"==e.status?showMessageTheme2(0,e.message,"",!0):showMessageTheme2(1,e.message,"",!1),!1},error:function(e){return!1}})}function sendOrientationMail(e,t,a){hideMessageTheme2("");var n={};n.orientationId=t,n.schoolId=SCHOOL_ID,$.ajax({type:"POST",contentType:"application/json",url:getURLFor("orientation","send-orientation-mail"),data:JSON.stringify(n),dataType:"json",cache:!1,timeout:6e5,success:function(e){return"0"==e.status||"2"==e.status||"FAILED"==e.status?showMessageTheme2(0,e.message,"",!0):showMessageTheme2(1,e.message,"",!1),!1},error:function(e){return!1}})}function saveOrientStatus(e,t){if(customLoader(!0),hideMessageTheme2(""),""==$("#orientStatus").val()||null==$("#orientStatus").val()||0==$("#orientStatus").val())return showMessageTheme2(0,"Please select status to update system training."),customLoader(!1),!1;if(""==$("#orientRemark").val()||null==$("#orientRemark").val()||0==$("#orientRemark").val())return showMessageTheme2(0,"Please fill remarks to update system training."),customLoader(!1),!1;if("RESCHEDULE"==$("#orientStatus").val()){var a=$("#rescheduleNumber").val();if(a==$("#totalRescheduleNumber").val()&&0!=a&&!$("#rescheduleFeeStatus").is(":checked"))return showMessageTheme2(0,"Please Check if student has paid fee for rescheduling system training."),customLoader(!1),!1}$.ajax({type:"POST",contentType:"application/json",url:getURLFor("orientation","update-orientation-status"),data:JSON.stringify(getRequestForOrientStatus(e)),dataType:"json",cache:!1,timeout:6e5,success:function(a){return"0"==a.status||"2"==a.status||"FAILED"==a.status?(showMessageTheme2(0,a.message,"",!0),$("#"+e)[0].reset()):(showMessageTheme2(1,a.message,"",!1),$("#"+e)[0].reset(),$("#orientStatusUpdate").modal("hide"),advanceSearchStudentOrient("orientationSearchForm",t,"advance-search","",0,!1,!0)),customLoader(!1),!1},error:function(e){return customLoader(!1),!1}})}function getRequestForOrientStatus(e){var t={};$("#meetingDate").val(),$("#startTimeHour").val(),$("#startTimeMin").val(),$("#endTimeHour").val(),$("#endTimeMin").val();return t.orientId=$("#orientId").val(),t.userId=USER_ID,t.orientStatus=$("#orientStatus").val(),"RESCHEDULE"==$("#orientStatus").val()&&$("#rescheduleFeeStatus").is(":checked")&&(t.paymentStatus="SUCCESS"),t.orientRemark=$("#orientRemark").val(),t}function moveOrientationData(e,t,a,n,o){o?hideMessageTheme2(""):hideMessage(""),$.ajax({type:"POST",contentType:"application/json",url:getURLFor("orientation","move-orientation"),data:JSON.stringify(getRequestForMoveOrientationsData(e)),dataType:"json",cache:!1,timeout:6e5,success:function(e){return console.log(e),"0"==e.statusCode||"2"==e.statusCode||"FAILED"==e.status?o?(showMessageTheme2(0,e.message,"",!0),$("#orientationAssignMove").val("0")):(showMessage(!0,e.message),$("#leadNoMove").val("")):o?(showMessageTheme2(1,e.message,"",!1),$("#leadNoMove").val(""),setTimeout((function(){location.reload()}),1500)):(showMessage(!0,e.message),$("#moveLeads").modal("hide"),setTimeout((function(){callForDashboardData("formIdIfAny","lead-list?moduleId="+t+"&leadFrom="+leadFrom+"&clickFrom=list&currentPage="+n)}),1500)),!1},error:function(e){return!1}})}function getRequestForMoveOrientationsData(e){var t={},a={},n={},o=$("#orientationNoMove").val();return n.orientationNo=o.substring(1,o.length),n.assignTo=$("#orientationAssignMove").val(),0==$("#orientationAssignMove").val()||null==$("#orientationAssignMove").val()||""==$("#orientationAssignMove").val()?(showMessageTheme2(2,"Please select atleast one asignee to move system training."),!1):(a.hash=getHash(),a.schoolId=SCHOOL_ID,a.schoolUUID=SCHOOL_UUID,a.userId=e,a.userType="COMMON",t.authentication=a,t.studentOrientationDto=n,t)}function updateOrientStatus(e){if("RESCHEDULE"==$(e).val()){var t=$("#rescheduleNumber").val();t==$("#totalRescheduleNumber").val()&&0!=t?$(".checkboxStatus").show():$(".checkboxStatus").hide()}else $(".checkboxStatus").hide(),$(".reschedule-Orient-Status").hide()}function openRecordingModal(e,t,a,n,o,s,i,r){const l={entityId:e,entityName:t,meetingDate:formatDateToYYYYMMDDHH(convertLocalToUTC(r,"YYYY-MM-DD HH:mm:ss",BASE_TIMEZONE,"YYYY-MM-DD HH:mm:ss")),meetingType:"SYS-TRAINING"};$.ajax({type:"POST",url:BASE_URL+CONTEXT_PATH+SCHOOL_UUID+"/api/v1/leads/get-event-recordings",data:JSON.stringify(l),contentType:"application/json",success:function(e){const t=JSON.parse(e);if(0===t.statusCode&&"success"===t.status){const e=t.data.recordingUrls;e&&e.length>0?populateRecordingModal(e,a,n,o,s,i):showMessageTheme2(0,"No recordings available.","",!0)}else showMessageTheme2(0,`Error: ${t.message}`,"",!0)},error:function(e){console.error("Error Fetching the data:",e.message)}})}function populateRecordingModal(e,t,a,n,o,s){const i={"shared_screen_with_speaker_view.mp4":"Shared Screen with Speaker View","active_speaker.mp4":"Active Speaker","shared_screen_with_gallery_view.mp4":"Shared Screen With Gallery View","gallery_view.mp4":"Gallery View","shared_screen.mp4":"Shared Screen","shared_screen_with_speaker_view_CC.mp4":"Shared Screen With Speaker View CC","-1.1.mp4":"Recording","-1.2.mp4":"Recording 2",audio_only:"Audio File"};let r=`\n        <div id="recordingModal" class="modal fade" tabindex="-1">\n            <div class="modal-dialog" style="max-width:70%;">\n                <div class="modal-content">\n                    <div class="modal-header theme-bg">\n                        <h5 class="modal-title text-white">Available Recordings | ${t} | ${a} | ${n} ${o} | ${s}</h5>\n                        <button onclick="closeAllVideoModal();" type="button" class="close btn-close text-white" data-bs-dismiss="modal" aria-label="Close">&times;</button>\n                    </div>\n                    <div class="modal-body">`;e.forEach((e=>{const t=e.meetingId,a=e.urls.map((e=>{for(const t in i)if(e.url.includes(t))return{url:e.url,title:i[t]}})),n=e.urls[e.urls.length-1]?.url;a.length>0&&(r+=`\n                <div class="session-block pb-4">\n                    <h5>Meeting ID: ${t}</h5>\n                    ${a.map(((e,t)=>`\n                        <div class="recording-item pb-3 pt-2 px-3 d-flex justify-content-between align-items-center" style="border-bottom:1px solid #eee;">\n                            <h6>${t+1}. ${e.title}</h6>\n                            <button class="btn btn-primary" onclick="playRecording('${e.url}', '${e.title}')">Play</button>\n                        </div>\n                    `)).join("")}\n                    ${n?`\n                            <div class="recording-item pb-3 pt-2 px-3 d-flex justify-content-between align-items-center" style="border-bottom:1px solid #eee;">\n                                <h6>${a.length+1}. Transcript</h6>\n                                <button class="btn btn-secondary" onclick="showVTTFile('${n}', 'Transcript')">Read</button>\n                            </div>`:""}\n                </div>`)})),r+="\n                    </div>\n                </div>\n            </div>\n        </div>\n    ";let l=$("#recordingModal");l.length>0&&l.remove(),$("body").append(r),$("#recordingModal").modal("show")}function playRecording(e,t){let a=$("#videoModal");$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:getURLForSignVideo(e),success:function(e){if(0==e.status){const n=e.url;0==a.length?$("body").append(`\n                        <div id="videoModal" class="modal fade" tabindex="-1">\n                            <div class="modal-dialog" style="max-width:70%;">\n                                <div class="modal-content">\n                                    <div class="modal-header theme-bg">\n                                        <h5 class="modal-title text-white">${t}</h5>\n                                        <button onclick="closeVideoModal();" type="button" class="close btn-close text-white" data-bs-dismiss="modal" aria-label="Close">&times;</button>\n                                    </div>\n                                    <div class="modal-body text-center">\n                                        <video class="videoTag w-100" controls>\n                                            <source src="${n}" type="video/mp4" />\n                                            Your browser does not support the video tag.\n                                        </video>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    `):(a.find(".modal-title").text(t),a.find(".videoTag source").attr("src",n),a.find(".videoTag")[0]?.load()),$("#videoModal").modal("show")}else showMessageTheme2(0,e.message||"Failed to fetch video URL","",!0);customLoader(!1)},error:function(e){console.error("Error fetching signed video URL:",e.message),showMessageTheme2(0,"Error fetching video.","",!0),customLoader(!1)}})}function getURLForSignVideo(e){const t=JSON.stringify({url:e}),a=window.btoa(t);return BASE_URL+CONTEXT_PATH+"videos/signed-url?payload="+a}function getURLForTranscriptContent(e){var t=JSON.stringify({url:e}),a=window.btoa(t);return BASE_URL+CONTEXT_PATH+"transcript/show-content?payload="+a}function convertToVTT(e){if(!e.endsWith(".mp4"))return null;const t=new URL(e),a=t.pathname.replace(/\/([^\/]+)-(\d+\.\d+)\.mp4$/,"/$1-transcript-$2.vtt");let n=t.origin+a;if(n===e){const t="https://ischoolingwise.s3.us-east-1.amazonaws.com/recordings/";n=`${t}${e.split(t)[1].split("-")[0]}-transcript-1.1.vtt`}return n}function displayVTT(e,t){const a=$("#transcript-modal-body");(a.empty(),e.includes("<Error><Code>"))?a.append('<p style="font-size: 18px;">No Transcript Available</p>'):e.split("\n").forEach((e=>{var t=$("<p></p>").text(e);a.append(t)}));$("#transcriptModalTitle").html(t),$("#transcriptModal").modal("show")}function showVTTFile(e,t){0===$("#transcriptModal").length&&$("body").append('\n            <div id="transcriptModal" class="modal fade" tabindex="-1">\n                <div class="modal-dialog" style="max-width:70%;">\n                    <div class="modal-content" style="height: 80vh;">\n                        <div class="modal-header theme-bg">\n                            <h5 id="transcriptModalTitle" class="modal-title text-white">Transcript</h5>\n                            <button type="button" class="close btn-close text-white" data-bs-dismiss="modal" aria-label="Close" onclick="closeTranscriptModal();">&times;</button>\n                        </div>\n                        <div id="transcript-modal-body" class="modal-body text-left" style="overflow-y: auto;">\n                            \x3c!-- Transcript content will be populated here --\x3e\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '),customLoader(!0);const a=convertToVTT(e);$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:getURLForTranscriptContent(a),success:function(e){customLoader(!1),displayVTT(e.content,t)},error:function(){customLoader(!1),showMessageTheme2(0,"Failed to load transcript.","",!0)}})}function closeAllVideoModal(){$("#recordingModal").modal("hide")}function closeVideoModal(){const e=$("#videoModal .videoTag")[0];e&&(e.pause(),e.currentTime=0),$("#videoModal").modal("hide")}function closeTranscriptModal(){$("#transcriptModal").modal("hide")}function formatDateToYYYYMMDD(e){if(!e)return null;const t=new Date(e);if(isNaN(t))return null;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function formatDateToYYYYMMDDHH(e){if(!e)return null;const t=new Date(e);if(isNaN(t))return null;return t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")+" "+String(t.getHours()).padStart(2,"0")}$((function(){}));