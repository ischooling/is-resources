function callStudentBatchAttendance(t,e,a){console.log("callStudentBatchAttendance",e),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","student-batch-attendance-list"),data:JSON.stringify(getRequestForStudentBatchAttendance(t,e)),dataType:"html",success:function(t){if("0"==t.status||"2"==t.status)showMessage(!0,t.message);else{$("#stuBatchAttendence").html("");var n=[],d=[],s=[],c=[],r=[],o=0,i=0,l=0;if(console.log(t.attendance),null!=t.attendance){var h='<table class="fixedtable month-name" >';h+='<thead class="student-h-scroll-view"><tr>';var u=t.attendance.header;for(m=0;m<u.length;m++){h=h+'<th class="headcol"><div class="h_scroll"><img src="'+PATH_FOLDER_IMAGE2+'h_scroll.png"></div></th>';var g=u[m].details;for(md=0;md<g.length;md++)h=h+'<th class="headcol">'+g[md].day+"</th>"}h+="</tr></thead>",h+="<tbody><tr>";var b=t.attendance.monthWise;for(m=0;m<b.length;m++){var p=""+b[m].entityName;n.push(p),d.push(b[m].presentInt),s.push(b[m].apsentInt),c.push(b[m].leaveInt),o+=b[m].presentInt,i+=b[m].apsentInt,l+=b[m].leaveInt,h=h+'<th class="headcol" style="padding:0px !important; text-align:center">'+b[m].entityName+"</th>";var v=b[m].details;for(md=0;md<v.length;md++)h+='<td class="long"><div class="text-center jvectormap-legend-cnt-v ">',h="P"==v[md].attendance||"M"==v[md].attendance?h+"<a href=\"javascript:void(0);\" onClick=\"callStudentBatchAttendanceDateWise('','"+a+"','"+v[md].attendanceDate+"','"+e+"','"+b[m].entityRole+"','"+b[m].subjectId+'\');" class="circle-icon '+v[md].attendanceClass+'"><b>'+v[md].attendance+"</b></a>":h+'<span class="circle-icon '+v[md].attendanceClass+'"> '+v[md].attendance+"</span>",h+="</div></td>";h+="</tr><tr>"}h+="</tbody>",h+="</table>"}$("#stuBatchAttendence").html(h),getLinChartAttendance(n,d,s,c,"chart-teacher-attendance"),r.push(o),r.push(i),r.push(l),getAttendPercentWise(r,"chartPer")}},error:function(t){console.log(t)}})}function getRequestForStudentBatchAttendance(t,e){var a={},n={},d={};return d.userId=e,d.schoolId=SCHOOL_ID,a.attendanceFilterRequest=d,n.hash=getHash(),n.schoolId=SCHOOL_ID,n.schoolUUID=SCHOOL_UUID,a.authentication=n,a}function getHash(){return"ajslfkjalksdf"}function getLinChartAttendance(t,e,a,n,d){var s={series:[{name:"Present",data:e},{name:"Absent",data:a},{name:"Leave",data:n}],chart:{type:"bar",height:350},colors:["#3ac47d","#ff4560","#f7ab19"],plotOptions:{bar:{horizontal:!1,columnWidth:"55%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:t},yaxis:{title:!1},fill:{opacity:1},tooltip:{y:{formatter:function(t){return t}}}};new ApexCharts(document.querySelector("#"+d),s).render()}function getAttendPercentWise(t,e){var a={series:t,chart:{height:250,type:"donut"},labels:["Present","Absent","Leave"],colors:["#3ac47d","#ff4560","#f7ab19"],responsive:[{breakpoint:480,options:{chart:{width:300,height:250},legend:{show:!1,position:"bottom"}}}]};new ApexCharts(document.querySelector("#"+e),a).render()}function sortJSON(t,e,a){return t.sort((function(t,n){var d=t[e],s=n[e];return"123"===a?d<s?-1:d>s?1:0:"321"===a?d>s?-1:d<s?1:0:void 0}))}function callStudentBatchAttendanceDateWise(t,e,a,n,d,s){$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","student-batch-attendance-daywise"),data:JSON.stringify(getRequestForAttendanceFilterDate(t,a,n,d,s)),dataType:"json",cache:!1,timeout:6e5,success:function(t){if("0"==t.status||"2"==t.status)showMessage(!0,t.message);else{$("#"+e).html(""),console.log(t.attendance);var a=t.attendance.monthWise;if(null!=(a=sortJSON(a,"day","123"))){var n='<table class="table table-striped table-bordered">';if(n+="<thead><tr>",n+="<th>S.N.</th>",n+="<th>Course Name</th>",n+="<th>Class with</th>",n+="<th>Joining Date</th>",n+="<th>Joining Time</th>",n+="<th>Leaving Time</th>",n+="<th>Total Duration<br/>HH:MM:SS</th>",n+="</tr></thead><tbody >",null!=a)for(ms=0;ms<a.length;ms++){var d=a[ms].details,s=1;if(null!=d)for(mds=0;mds<d.length;mds++)n=(n=(n=(n=(n=(n+="<tr>")+"<td>"+s+"</td>")+"<td>"+d[mds].attendance+"</td>")+"<td>"+d[mds].meetingPerson+"</td>")+"<td>"+d[mds].attendanceDate+"<br/>("+d[mds].timezone+")</td>")+"<td>"+d[mds].attendanceJoinTime+"</td>",null!=d[mds].attendanceLeaveTime?n=n+"<td>"+d[mds].attendanceLeaveTime+"</td>":n+="<td>-</td>",n=n+"<td>"+d[mds].attendanceDuration+"</td>",n+="</tr>",s+=1}n=n+('<tr><td colspan="6" align="right"><b>Total</b></td><td><b>'+t.attendance.totalDayAttendanceDuration+"</b></td></tr>")+"</tbody> </table>"}$("#"+e).html(n)}},error:function(t){console.log(t)}})}function getRequestForAttendanceFilterDate(t,e,a,n,d){var s={},c={},r={};return r.attendanceStartDate=e,r.attendanceEndDate=e,r.attendanceTodayDate=e,r.attendaceFor=n,r.subjectId=d,r.userId=a,r.schoolId=SCHOOL_ID,c.hash=getHash(),c.schoolId=SCHOOL_ID,c.schoolUUID=SCHOOL_UUID,s.authentication=c,s.data=r,s}function callBatchAttendanceFilter(t,e,a,n,d,s,c,r,o,i){var l="N";$("#"+t+" #subjectWiseCheck").is(":checked")&&(l="Y"),"byteacher"==c&&(l="Y"),customLoader(!0),checkTextBox(t),$.ajax({type:"POST",global:!1,contentType:"application/json",url:getURLForHTML("dashboard","batch-attendance-by-filter"),data:JSON.stringify(getRequestForBatchAttendanceFilter(t,a,n,d,s,c,r)),dataType:"json",cache:!1,timeout:6e5,success:function(t){if(customLoader(!1),"0"==t.status||"2"==t.status)showMessage(!0,t.message);else{$("#"+e).html("");var a="";null!=t.attendance&&(a=allAttendance(t.attendance,l,r,o,i)),$("#attendanceAdvanceSearch").modal("hide"),$("#teacherAdvanceSearch").modal("hide"),$("#"+e).html(a)}},error:function(t){checkonlineOfflineStatus()||(console.log(t),customLoader(!1))}})}function getRequestForBatchAttendanceFilter(t,e,a,n,d,s,c){var r={},o={},i={};if(""!=a&&(i.attendanceTodayDate=a),"byteacher"==s){i.attendaceFor="STUDENT",i.subjectWise="Y",i.learningmode=c;var l=$("#"+t+" #standardId").val();i.standardIdString=l.toString();var m=$("#"+t+" #batchId").val();i.batchIdString=m.toString();var h=$("#"+t+" #subjectIds").val();i.subjectIdString=h.toString();var u=$("#"+t+" #studentId").val();i.entityIdString=u.toString();var g=$("#"+t+" #enrollType").val();i.enrollType=g.toString();var b="37,38";"BATCH"==g?b="38":"ONE_TO_ONE"==g?b="37,39":"SSP"==g?b="37,40":"SCHOLARSHIP"==g&&(b="37,39,40"),b=b.toString(),i.lmsProvider=b.toString(),$("#"+t+" #subjectWiseCheck").is(":checked")?i.subjectWise="Y":i.subjectWise="N"}else{i.attendaceFor=n.toString();l=$("#"+t+" #standardId").val();i.standardIdString=l.toString();m=$("#"+t+" #batchId").val();i.batchIdString=m.toString();h=$("#"+t+" #subjectIds").val();i.subjectIdString=h.toString();u=$("#"+t+" #studentId").val();i.entityIdString=u.toString();g=$("#"+t+" #enrollType").val();i.enrollType=g.toString();b=$("#"+t+" #lmsPlatform").val();i.lmsProvider=b.toString(),$("#"+t+" #subjectWiseCheck").is(":checked")?i.subjectWise="Y":i.subjectWise="N"}return i.callfrom=s,i.month=$("#"+t+" #monthWise").val(),i.year=$("#"+t+" #yearWise").val(),i.selectDateType=d,i.userId=e,i.schoolId=SCHOOL_ID,o.hash=getHash(),o.schoolId=SCHOOL_ID,o.schoolUUID=SCHOOL_UUID,r.authentication=o,r.data=i,r}function allAttendance(t,e,a,n,d){var s='<table class="fixedtable month-name" >';$(".month-name").html(t.entityName),$("#nextDate").val(t.nextDate),$("#prevDate").val(t.preDate),$("#seletDateType").val(t.dataType),$("#dataFrom").val(t.dataFrom),s+='<thead class="admin-h-scroll-view"><tr>';var c=t.header;for(m=0;m<c.length;m++){s=s+'<th class="headcol"><div class="h_scroll"><img src="'+PATH_FOLDER_IMAGE2+'h_scroll.png"></div></th>';var r=c[m].details;for(md=0;md<r.length;md++)s=s+'<th class="headcol"><div><b class="full">'+r[md].weekday+'</b><b class="full">'+r[md].day+"</b></div></th>"}s+="</tr></thead>",s+="<tbody><tr>";var o=t.monthWise;return null!=o&&(s+=getRowAttendance(o,e,a,n,d),s+="</tbody>"),s+="</table>"}function getRowAttendance(t,e,a,n,d){var s="";for(m=0;m<t.length;m++)if("one-to-one"==a){if(""==t[m].batchName){t[m].entityName;var c='<a target="_bleank" href="javaScript:void(0)" onclick="getAsPost('+("/dashboard/get-student-attendance?moduleId="+n+"&userId="+t[m].entityId)+')">'+t[m].entityName+"</a>",r=null==t[m].subjectName?"":t[m].subjectName;s=s+'<th class="headcol" style="padding:0px !important; text-align:center;min-width:200px;"><table><tr><td>'+c+"</br>"+t[m].batchName+"</br>"+r+"</td></table></th>";var o=t[m].details;for(md=0;md<o.length;md++)s+='<td class="long">',"Y"==e?(s+='<div class="text-center jvectormap-legend-cnt-v ">',s="P"==o[md].attendance||"M"==o[md].attendance?s+"<a href=\"javascript:void(0);\" onClick=\"callStudentBatchAttendanceDateWise('','"+d+"','"+o[md].attendanceDate+"','"+t[m].entityId+"','"+t[m].entityRole+"','"+t[m].subjectId+'\');" class="circle-icon '+o[md].attendanceClass+'"><span data-tooltip="Join Time: '+o[md].attendanceJoinTime+"  Leave Time: "+o[md].attendanceLeaveTime+" Duration: "+o[md].attendanceDuration+" &nbsp; Total Duration: "+o[md].totalAttendanceDuration+'" data-tooltip-position="left">'+o[md].attendance+"</span></a>":s+'<span class="circle-icon '+o[md].attendanceClass+'"> '+o[md].attendance+"</span>",s+="</div>"):"P"==o[md].attendance||"M"==o[md].attendance?s+=o[md].totalAttendanceDuration:s+="-",s+="</td>";s+="</tr><tr>"}}else if("group"==a){if(""!=t[m].batchName){t[m].entityName,c='<a target="_bleank"  href="javaScript:void(0)" onclick="getAsPost('+("/dashboard/get-student-attendance?moduleId="+n+"&userId="+t[m].entityId)+')">'+t[m].entityName+"</a>",r=null==t[m].subjectName?"":t[m].subjectName;s=s+'<th class="headcol" style="padding:0px !important; text-align:center;min-width:200px;"><table><tr><td>'+c+"</br>"+t[m].batchName+"</br>"+r+"</td></table></th>";o=t[m].details;for(md=0;md<o.length;md++)s+='<td class="long">',"Y"==e?(s+='<div class="text-center jvectormap-legend-cnt-v ">',s="P"==o[md].attendance||"M"==o[md].attendance?s+"<a href=\"javascript:void(0);\" onClick=\"callStudentBatchAttendanceDateWise('','"+d+"','"+o[md].attendanceDate+"','"+t[m].entityId+"','"+t[m].entityRole+"','"+t[m].subjectId+'\');" class="circle-icon '+o[md].attendanceClass+'"><span data-tooltip="Join Time: '+o[md].attendanceJoinTime+"  Leave Time: "+o[md].attendanceLeaveTime+" Duration: "+o[md].attendanceDuration+" &nbsp; Total Duration: "+o[md].totalAttendanceDuration+'" data-tooltip-position="left">'+o[md].attendance+"</span></a>":s+'<span class="circle-icon '+o[md].attendanceClass+'"> '+o[md].attendance+"</span>",s+="</div>"):"P"==o[md].attendance||"M"==o[md].attendance?s+=o[md].totalAttendanceDuration:s+="-",s+="</td>";s+="</tr><tr>"}}else{t[m].entityName,c='<a target="_bleank"  href="javaScript:void(0)" onclick="getAsPost('+("/dashboard/get-student-attendance?moduleId="+n+"&userId="+t[m].entityId)+')">'+t[m].entityName+"</a>",r=null==t[m].subjectName?"":t[m].subjectName;s=s+'<th class="headcol" style="padding:0px !important; text-align:center;min-width:200px;"><table><tr><td>'+c+"</br>"+t[m].batchName+"</br>"+r+"</td></table></th>";o=t[m].details;for(md=0;md<o.length;md++)s+='<td class="long">',"Y"==e?(s+='<div class="text-center jvectormap-legend-cnt-v ">',s="P"==o[md].attendance||"M"==o[md].attendance?s+"<a href=\"javascript:void(0);\" onClick=\"callStudentBatchAttendanceDateWise('','"+d+"','"+o[md].attendanceDate+"','"+t[m].entityId+"','"+t[m].entityRole+"','"+t[m].subjectId+'\');" class="circle-icon '+o[md].attendanceClass+'"><span data-tooltip="Join Time: '+o[md].attendanceJoinTime+"  Leave Time: "+o[md].attendanceLeaveTime+" Duration: "+o[md].attendanceDuration+" &nbsp; Total Duration: "+o[md].totalAttendanceDuration+'" data-tooltip-position="left">'+o[md].attendance+"</span></a>":s+'<span class="circle-icon '+o[md].attendanceClass+'"> '+o[md].attendance+"</span>",s+="</div>"):"P"==o[md].attendance||"M"==o[md].attendance?s+=o[md].totalAttendanceDuration:s+="-",s+="</td>";s+="</tr><tr>"}return s}function callSubjectNameMultipleList(t,e,a,n,d,s){e=e.toString(),console.log("Building Subject dropdown",e),$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","SUBJECT-NAME-LIST-BASED-ON-BATCHES",a,n,d,s,e)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(e){if("0"==e.status||"2"==e.status)showMessage(!0,e.message);else{var a=e.mastersData.courseList;console.log(a);var n=$("#"+t+" #subjectIds");n.html(""),$.each(a,(function(t,e){n.append('<option value="'+e.key+'">'+e.value+" </option>")}))}},error:function(t){console.log(t)}})}function courseProviderList(t,e){$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","ALL-COURSE-PROVIDER-LIST","courseProList")),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(a){if("0"==a.status||"2"==a.status)showMessage(!0,a.message);else{var n=a.mastersData.courseList,d=$("#"+t+" #"+e);d.html(""),d.append('<option value="">Select LMS Platform</option>'),$.each(n,(function(t,e){36!=e.key&&37!=e.key&&38!=e.key&&39!=e.key&&40!=e.key&&41!=e.key||d.append('<option value="'+e.key+'">'+e.value+" </option>")}))}}})}function advanceAttendSearchReset(t){customLoader(!0),$("#"+t)[0].reset(),$("#"+t+" #attendanceFor").val("0").trigger("change"),$("#"+t+" #enrollType").val("").trigger("change"),$("#"+t+" #lmsPlatform").val("").trigger("change"),$("#"+t+" #standardId").val("").trigger("change"),$("#"+t+" #batchId").val("").trigger("change"),$("#"+t+" #subjectIds").val("").trigger("change"),$("#"+t+" #studentId").val("").trigger("change"),customLoader(!1)}$(document).ready((function(){console.log("inside dashboardAttendance.js")}));var attarAttend=[];function callTeacherAttendance(t,e,a,n,d){customLoader(!0),$.ajax({type:"POST",global:!1,contentType:"application/json",url:getURLForHTML("dashboard","teacher-attendance-list"),data:JSON.stringify({startDate:a,slotType:n,userId:d}),dataType:"json",cache:!1,timeout:6e5,success:function(t){if("0"==t.status||"2"==t.status)showMessage(!0,t.message);else{console.log(e),$("#"+e).html(""),$(".mymonth-name").html(t.startMonthDate),$("#firstDateNextMonth").val(t.firstDateNextMonth),$("#firstDatePreMonth").val(t.firstDatePreMonth);var a="";for(null!=t.attendanceList&&(a=teachAttendance(t.attendanceList,d)),attarAttend=[],md=0;md<t.attendanceList.length;md++)void 0===t.attendanceList[md].attendDetails?attarAttend.push(""):attarAttend.push(""+t.attendanceList[md].attendDetails);"Y"==t.activeNextbutton&&$("#nextMySelectDate").hide(),$("#"+e).html(a)}customLoader(!1)},error:function(t){checkonlineOfflineStatus()||(console.log(t),customLoader(!1))}})}function teachAttendance(t,e){var a="";a='<table class="table row-height-small table-bordered table-hover text-center"><thead><tr class="bg-primary"><th class="text-white"><b>Day</b></th><th class="text-white"><b>Date</b></th><th class="text-white"><b>Total Class</b></th><th class="text-white"><b>Total Time</b></th><th class="text-white"><b>Attendance</b></th><th class="text-white"><b>Add More</b></th></tr></thead><tbody>';var n=1;for(md=0;md<t.length;md++){a+='<tr><td class="text-dark">'+n+++'</td><td class="text-dark">'+t[md].dayname+", "+t[md].attendanceDate+'</td><td class="text-dark">',0==t[md].presentInt?a+="-":t[md].presentInt>0&&(a+='<a href="javascript:void(0)" onClick="getMyTotalAtt('+md+')"><b>'+t[md].presentInt+"</b></a>"),a+='</td><td class="text-dark">',0==t[md].presentInt?a+="-":t[md].presentInt>0&&(a+=t[md].attendanceDuration),a+="</td>";var d="A"==t[md].attendance?"text-danger":"text-success";a+='<td class="'+d+'">'+t[md].attendance+"</td>",a+='<td class="'+d+'"><a href="javascript:void(0);" onClick="callAddAttendanceModal(\''+t[md].attendDate+"','"+t[md].attendanceDate+"','"+e+'\')"><i class="fa fa-fw" aria-hidden="true">ÔÅß</i></a></td>'}return a+="</tbody>"}function getMyTotalAtt(t){var e="",a=1;attendanceArr=JSON.parse(attarAttend[t]),console.log(attendanceArr),$.each(attendanceArr,(function(t,n){$(".popTeacherClassHead").text(n.attendanceDate);var d="1:1",s=n.subjectName;if("OFFLINE_MEETING"==n.meetingType?(d="Teacher Created Link",s="N/A"):"BATCH_TEACHER_MAPPING"==n.meetingType&&"BATCH_TEACHER_MAPPING"==n.meetingType?d="Group":"EXTRA_ACTIVITY_DETAILS"==n.meetingType&&(d="Activity"),"OFFLINE_MEETING"==n.meetingType&&"E"==n.offMeetingType?d+=" Extra Link":"OFFLINE_MEETING"==n.meetingType&&"A"==n.offMeetingType?d=" Admin Task":"OFFLINE_MEETING"!=n.meetingType||"R"!=n.offMeetingType&&"O"!=n.offMeetingType?"OFFLINE_MEETING"==n.meetingType&&"G"==n.offMeetingType&&(d+=" For Group"):d+=" For 1:1",e+="<tr>",e+="<td class='text-center'>"+a+++"</td>",e+="<td class='vertical-align-top' style='min-width:200px'><b>Mode:</b> "+d+"<br/><br/>",null!=n.attendanceRecording&&""!=n.attendanceRecording)$.each(n.attendanceRecording,(function(t,a){e+="<b>Joined Time: </b> "+a.jointimes+"<br/><b>Ended Time:</b> "+a.endTimes+"<br/><b>Spent time:</b> "+a.durations+"<br/>";var n=1==a.publishStatus?"Published":"Under Review",d=1==a.publishStatus?"text-success":"text-danger";0==a.publishStatus&&(e+="<span class="+d+">"+n+"</span><br/>")}));else{e+="<b>Joined Time: </b> "+n.attendanceJoinTime+"<br/><b>Ended Time:</b> "+n.attendanceLeaveTime+"<br/><b>Spent time:</b> "+n.attendanceDuration+"<br/>";var c=1==n.publishStatus?"Published":"Under Review",r=1==n.publishStatus?"text-success":"text-danger";0==n.publishStatus&&(e+="<span class="+r+">"+c+"</span><br/>")}e+="</td>",e+="<td class='vertical-align-top'><b>Meeting Topic:</b> "+n.meetingtopic+"<br/><b>Course Name:</b> "+s,""!=n.timezone&&(e+="<br/><b>Meeting Timzone:</b> "+n.timezone),""!=n.userMeetingPerson&&(e+="<br/><b>Teacher:</b> "+n.meetingPerson+" ("+n.teachtimezone+")<br/><b>Student:</b> "+n.userMeetingPerson+" ("+n.stdtimezone+")"),""!=n.meetingId&&(e+="<br/><b>Meeting Id:</b> "+n.meetingId),e+="<br/>",null!=n.attendanceRecording&&""!=n.attendanceRecording&&$.each(n.attendanceRecording,(function(t,a){if(null!=a.recordingUrl&&""!=a.recordingUrl){var n=null==a.recordingUrl?"Recording not present ":a.recordingUrl;e+="<br/><b>Recording Url:</b> "+n}null!=a.password&&""!=a.password&&(e+="<br/><b>Password:</b> "+a.password),null!=a.recordingPlayPasscode&&""!=a.recordingPlayPasscode&&(e+="<br/><b>Recording Play Passcode:</b> "+a.recordingPlayPasscode)})),null!=n.attendanceRemarks&&""!=n.attendanceRemarks&&(e+="<br/><b>Comments:</b>",$.each(n.attendanceRemarks,(function(t,a){null!=a.comments&&(e+="<br/>"+a.comments,"TEACHER"==a.userType&&(e+='<span style="font-size:14px;color:red;float:right"><a href="javascript:void(0);" class="click-to-catalog" onclick="return editAttendanceComments(\''+a.attendid+"','"+a.remarkId+"','N','remove-comment');\"><i class=\"fa fa-times\"></i></a></span>"))}))),e+="</td>",e+="</tr>"})),$("#myteacherAllClassBody").html(e),$("#myteacherAllClassModel").modal("show")}