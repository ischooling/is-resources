var newId="";function getSchoolSettingDetails(){var e=$("#schoolSettigsSelection").val();hideMessage(""),$.ajax({type:"GET",url:getURLForHTML("dashboard","school-settings-details"),data:"SCHOOLID="+e,dataType:"html",cache:!1,timeout:6e5,success:function(e){if(""!=e){var t;return"FAILED"==(t=e.split("|"))[0]||"EXCEPTION"==t[0]||"SESSIONOUT"==t[0]?"SESSIONOUT"==t[0]?redirectLoginPage():showMessage(!0,t[1]):($("#schoolSettingsContent").hide(),$("#schoolSettingsOnChangeData").html(e),$("#schoolSettingsOnChangeData").show()),!1}},error:function(e){return!1}})}function saveSchoolSettings(e,t,a){if(hideMessage(""),!validateRequestForSchoolSettings(e,t,a))return!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","send-referralcode-to-user"),data:JSON.stringify(getRequestForUserReferral(e,moduleId,isForSpecificUser)),dataType:"json",success:function(e){return"0"==e.status||"2"==e.status?showMessage(!0,e.message):(showMessage(!0,e.message),$("#sendReferralModal").modal("hide")),!1}})}function validateRequestForSchoolSettings(e,t,a){return!0}function getRequestForUserReferral(e,t,a){var s={},l={},r={},o="";return r.id=$("#"+e+" #referralSendId").val(),r.counselorId=$("#"+e+" #counselorId").val(),r.referralCode=$("#"+e+" #referralCode").val(),$("input[name='emailId']").each((function(){o=o+$(this).val()+","})),r.emailId=o,l.hash=getHash(),l.schoolId=SCHOOL_ID,l.schoolUUID=SCHOOL_UUID,l.userType=moduleId,l.userId=$("#"+e+" #userId").val(),s.authentication=l,s.data=r,s}function saveSchoolSettingData(e,t,a,s){$("#errMsg").text(""),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","save-school-setting-lms-role-pg-data"),data:JSON.stringify(getRequestForSaveSchoolSettingData(e,t,a,s)),dataType:"json",success:function(e){return"0"==e.status||e.status,$("#errMsg").text(e.message),$("body,html").animate({scrollTop:$("#errMsg").offset().top-70},800),!1}})}function getRequestForSaveSchoolSettingData(e,t,a,s){request={};var l={},r={};if("PG"==t)r.gatewayName=$("#"+e+" #paymentGateway").val(),r.gatewayMode=$("#"+e+" #gatewayMode").val(),r.endpointUrl=$("#"+e+" #endPointUrl").val(),r.merchantEmail=$("#"+e+" #merchantEmail").val(),r.secretKey=$("#"+e+" #secretKey").val(),r.clientId=$("#"+e+" #clientId").val(),r.paymentModeIp=$("#"+e+" #paymentModeIp").val(),"ACTIVE"==$("#"+e+" #pgStatus").val()?r.status="Y":r.status="N";else if("LMSSM"==t){r.domainId=$("#"+e+" #domainId").val(),r.domainName=$("#"+e+" #domainName").val(),r.lmsLoginUrl=$("#"+e+" #lmsLoginUrl").val(),r.userSpace=$("#"+e+" #userSpace").val(),r.prefixStudent=$("#"+e+" #prefixStudent").val(),r.prefixTeacher=$("#"+e+" #prefixTeacher").val(),r.prefixAdmin=$("#"+e+" #prefixAdmin").val(),"ACTIVE"==$("#"+e+" #schoolLmsStatus").val()?r.status="Y":r.status="N";var o=$("#"+e+" #lmsProviderId").val();r.lmsProviderId="Buzz"===o?31:"Agilix Buzz"==o?1:"Odysseyware"==o?2:"BUZZ-GC"==o?37:"BUZZ"===o?36:"BUZZ-GR"==o?38:"Exact-Path"==o?39:"Edmentum-Canvas"==o?40:41}else if("LMSRM"==t){r.roleName=$("#"+e+" #rolelmsRoleName"+a).val(),r.roleLmsId=$("#"+e+" #roleLmsId"+a).val(),"ACTIVE"==$("#"+e+" #roleLmsStatus"+a).val()?r.status="Y":r.status="N";o=$("#"+e+" #rolelmsProvider"+a).val();r.lmsProviderId="Buzz"===o?31:"Agilix Buzz"==o?1:"Odysseyware"==o?2:"BUZZ-GC"==o?37:"BUZZ"===o?36:"BUZZ-GR"==o?38:"Exact-Path"==o?39:"Edmentum-Canvas"==o?40:41}else"SSO"==t?(r.schoolUuid=$("#"+e+" #schoolUuid").val(),r.schoolName=$("#"+e+" #schoolDisplayName").val(),r.address=$("#"+e+" #schoolAddress").val(),r.contactEmail=$("#"+e+" #contactEmail").val(),r.whatsAppCode=$("#"+e+" #whatsAppCode").val(),r.whatsAppContact=$("#"+e+" #whatsAppContact").val(),r.schoolContactCode=$("#"+e+" #schoolContactCode").val(),r.schoolContact=$("#"+e+" #contactNumber").val(),r.landlineCode=$("#"+e+" #lanlineCode").val(),r.landlineContact=$("#"+e+" #landlineContact").val(),r.schoolTimeZone=$("#"+e+" #schoolTimezone").val()):"SSL"==t?(r.schoolWebsite=$("#"+e+" #website").val(),r.logoUrl=$("#"+e+" #logoUrl").val(),r.emailLogoUrl=$("#"+e+" #emailLogoUrl").val(),r.favIconUrl=$("#"+e+" #favUrl").val(),r.signupUrl=$("#"+e+" #signupUrl").val(),r.ticketRaisedUrl=$("#"+e+" #ticketRaisedUrl").val(),r.termsOfUserUrl=$("#"+e+" #termsUrl").val(),r.privacyPolicyUrl=$("#"+e+" #privacyPolicyUrl").val(),r.contactUsActive=$("#"+e+" #contactUsStatus").val(),r.contactUsUrl=$("#"+e+" #contactUsUrl").val(),r.instagramUrl=$("#"+e+" #instagramUrl").val(),r.fbUrl=$("#"+e+" #facebookUrl").val(),r.pintrestUrl=$("#"+e+" #pintrestUrl").val(),r.twitterUrl=$("#"+e+" #twitterUrl").val(),r.linkdinUrl=$("#"+e+" #linkedinUrl").val(),r.codeConductUrl=$("#"+e+" #codeConductUrl").val(),r.studHBookUrl=$("#"+e+" #stdtHandbokUrl").val(),r.chatBoatActive=$("#"+e+" #chatbotStatus").val(),r.chatBoatUrl=$("#"+e+" #chatbotUrl").val()):"SSM"==t?(r.senderEmail=$("#"+e+" #senderEmail").val(),r.emailForClassRoomSession=$("#"+e+" #classroomEmail").val(),r.emailForDemoCouncelling=$("#"+e+" #demoEmail").val(),r.emailForStudentInstallmentFee=$("#"+e+" #feeEmail").val(),r.emailForPpcRequest=$("#"+e+" #ppcEmail").val(),r.emailForClientSignup=$("#"+e+" #signupEmail").val(),r.emailForHiring=$("#"+e+" #hiringEmail").val(),r.emailAccountName=$("#"+e+" #accountNameEmail").val(),r.emailAccountAdminName=$("#"+e+" #accountAdminEmail").val(),r.emailAccountSupport=$("#"+e+" #supportEmail").val(),r.emailOtherAdmin=$("#"+e+" #otherAdminEmail").val(),r.technicalEmail=$("#"+e+" #technicalEmail").val(),r.emailAccountForAuditor=$("#"+e+" #auditorEmail").val(),r.withdrawalRequestAdmin=$("#"+e+" #withdrawalRequestAdmin").val()):"SST"==t&&(r.vendorId=$("#"+e+" #vendorId").val(),r.showSubjectCostOnSignup=$("#"+e+" #showSubjectCost").val(),r.flexEnrollment=$("#"+e+" #flexEnrollment").val(),r.schoolEnrollment=$("#"+e+" #schoolEnrollment").val(),r.letterHeadImg=$("#"+e+" #letterHead").val(),r.teachAgreementSign=$("#"+e+" #teacherAgreementSign").val(),r.courseProviderName=$("#"+e+" #coureProviderName").val());return r.schoolId=s,r.moduleName=t,r.id=a,request.schoolSettingLmsDTO=r,l.hash=getHash(),l.schoolId=SCHOOL_ID,l.schoolUUID=SCHOOL_UUID,request.authentication=l,request}function lmsProviderChagedDetails(e){var t=36;"Agilix Buzz"==$("#lmsProviderId").val()?t=1:"Odysseyware"==$("#lmsProviderId").val()?t=2:"Buzz"===$("#lmsProviderId").val()?t=31:"BUZZ"===$("#lmsProviderId").val()?t=36:"BUZZ-GC"===$("#lmsProviderId").val()?t=37:"BUZZ-GR"===$("#lmsProviderId").val()?t=38:"Exact-Path"==$("#lmsProviderId").val()?t=39:"Courseware"==$("#lmsProviderId").val()&&(t=40),hideMessage(""),$.ajax({type:"GET",url:getURLForHTML("dashboard","school-setting-lms-details"),data:"SCHOOLID="+e+"&lmsProviderId="+t,dataType:"html",cache:!1,timeout:6e5,success:function(e){if(""!=e){var a;return"FAILED"==(a=e.split("|"))[0]||"EXCEPTION"==a[0]||"SESSIONOUT"==a[0]?"SESSIONOUT"==a[0]?redirectLoginPage():showMessage(!0,a[1]):($("#schoolSettingsContent").hide(),$("#schoolSettingsOnChangeData").html(e),$("#schoolSettingsOnChangeData").show(),1==t?$("#lmsProviderId").val("Agilix Buzz"):2==t?$("#lmsProviderId").val("Odysseyware"):31==t?$("#lmsProviderId").val("Buzz"):$("#lmsProviderId").val("FLVS")),!1}},error:function(e){return!1}})}function getAdmissionCycles(){var e=$("#sessionList").val();return $("#stateId").prop("disabled",!0),$.ajax({type:"GET",contentType:"application/json",url:getURLForAdmissionCycle("dashboard","admission-cycle",e),dataType:"json",async:!1,success:function(e){"1"==e.statusCode?setAdmissionCycleTableData("schoolSettingForm","admissionCycleData",e.admissionCycleDTOList):showMessage(0,e.message,!0)},error:function(e){}}),!0}function saveEditAdmissionCycle(e,t){if(!validateAdmissionCycleData(e))return!1;console.log("schoolsettings"),$.ajax({type:"POST",contentType:"application/json",url:getURLForAdmissionCycle("dashboard","admission-cycle",""),data:JSON.stringify(getDataForAdmissionCycle(e,t)),dataType:"json",async:!1,success:function(t){return"001"==t.statusCode?(showMessageTheme2(1,t.status,"",!0),clearDataForSaveEditAdmissionCycle(e),!0):(showMessageTheme2(0,t.status,"",!0),!1)},error:function(e){}})}function validateAdmissionCycleData(e){if(""==$("#"+e+" #groupName").val()||null==$("#"+e+" #groupName").val())return showMessageTheme2(2," Please Enter Group Name","",!0),!1;if(""==$("#"+e+" #semesterStartDate1").val()||null==$("#"+e+" #semesterStartDate1").val())return showMessageTheme2(2," Please select semester 1 start date","",!0),!1;if(""==$("#"+e+" #semesterEndDate1").val()||null==$("#"+e+" #semesterEndDate1").val())return showMessageTheme2(2," Please select semester 1 end date.","",!0),!1;if(""==$("#"+e+" #semesterStartDate2").val()||null==$("#"+e+" #semesterStartDate2").val())return showMessageTheme2(2," Please select semester 2 start date.","",!0),!1;if(""==$("#"+e+" #semesterEndDate2").val()||null==$("#"+e+" #semesterEndDate2").val())return showMessageTheme2(2," Please select semester 2 end date.","",!0),!1;if(""==$("#"+e+" #LateAppFeeDate").val()||null==$("#"+e+" #LateAppFeeDate").val())return showMessageTheme2(2," Please select Late Fee Start Date.","",!0),!1;if(""==$("#"+e+" #LateAppFeeDateEnd").val()||null==$("#"+e+" #LateAppFeeDateEnd").val())return showMessageTheme2(2," Please Select Late Fee End Date.","",!0),!1;if(""==$("#"+e+" #discountSem1").val()||null==$("#"+e+" #discountSem1").val())return showMessageTheme2(2," Please Discount % For Annual Plan before start of 1st day of academic year.","",!0),!1;if(""==$("#"+e+" #discountSem2").val()||null==$("#"+e+" #discountSem2").val())return showMessageTheme2(2," Please Discount % For Annual Plan before start of second semester.","",!0),!1;var t=$("#semesterStartDate1").val().split("-"),a=new Date(t[2],t[0]-1,t[1]),s=$("#semesterEndDate1").val().split("-"),l=new Date(s[2],s[0]-1,s[1]),r=$("#semesterStartDate2").val().split("-");start2Date=new Date(r[2],r[0]-1,r[1]);var o=$("#semesterEndDate2").val().split("-");if(end2Date=new Date(o[2],o[0]-1,o[1]),a>l||a==l)return showMessageTheme2(2," Semester 1 start date must be before semester 1 end date","",!0),!1;if(start2Date>end2Date||start2Date==end2Date)return showMessageTheme2(2," Semester 2 start date must be before semester 2 end date","",!0),!1;if(l>start2Date||l==start2Date)return showMessageTheme2(2," Semester 2 start date must be after semester 1 end date","",!0),!1;var n=$("#LateAppFeeDate").val().split("-");lateFeeStartDate=new Date(n[2],n[0]-1,n[1]);var i=$("#LateAppFeeDateEnd").val().split("-");return lateFeeEndDate=new Date(i[2],i[0]-1,i[1]),!(lateFeeStartDate>lateFeeEndDate||lateFeeStartDate==lateFeeEndDate)||(showMessageTheme2(2," Late Fee Start Date Must be Before Late Fee End Date","",!0),!1)}function getDataForAdmissionCycle(e,t){var a=$("#schoolSettigsSelection").val();newId=$("#admissionCycleId").val();var s={},l={},r={},o={};return o.id=newId,o.schoolId=a,o.groupName=$("#"+e+" #groupName").val().trim(),o.semesterOneStartDateString=$("#"+e+" #semesterStartDate1").val().trim(),o.semesterOneEndDateString=$("#"+e+" #semesterEndDate1").val().trim(),o.feeRule1Batch=$("#"+e+" #feeRule1Batch").val().trim(),o.feeRule1OneToOne=$("#"+e+" #feeRule1OneToOne").val().trim(),o.feeRule1Scholarship=$("#"+e+" #feeRule1Scholarship").val().trim(),o.feeStructureForRule1=$("#"+e+" #feeStructureForRule1").val().trim(),o.semesterTwoStartDateString=$("#"+e+" #semesterStartDate2").val().trim(),o.semesterTwoEndDateString=$("#"+e+" #semesterEndDate2").val().trim(),o.feeRule2Batch=$("#"+e+" #feeRule2Batch").val().trim(),o.feeRule2OneToOne=$("#"+e+" #feeRule2OneToOne").val().trim(),o.feeRule2Scholarship=$("#"+e+" #feeRule2Scholarship").val().trim(),o.feeStructureForRule2=$("#"+e+" #feeStructureForRule2").val().trim(),o.lateAppFeeStartDateString=$("#"+e+" #LateAppFeeDate").val().trim(),o.lateAppFeeEndDateString=$("#"+e+" #LateAppFeeDateEnd").val().trim(),o.admissionStatus=null,o.session=null,o.discountOne=$("#"+e+" #discountSem1").val().trim(),o.discountTwo=$("#"+e+" #discountSem2").val().trim(),o.allowAdmissionStatus=$("#"+e+" #admissionStatus").val().trim(),r.admissionCycleDTO=o,l.hash=getHash(),l.schoolId=SCHOOL_ID,l.schoolUUID=SCHOOL_UUID,l.userType="STUDENT",s.authentication=l,s.requestData=r,s}function clearDataForSaveEditAdmissionCycle(e){$("#admissionCycleId").val(""),newId="",$("#"+e+" #groupName").val(""),$("#"+e+" #semesterStartDate1").val(""),$("#"+e+" #semesterEndDate1").val(""),$("#"+e+" #semesterStartDate2").val(""),$("#"+e+" #feeRule1Batch").val(""),$("#"+e+" #feeRule1OneToOne").val(""),$("#"+e+" #feeRule1Scholarship").val(""),$("#"+e+" #feeStructureForRule1").val(""),$("#"+e+" #semesterEndDate2").val(""),$("#"+e+" #LateAppFeeDate").val(""),$("#"+e+" #feeRule2Batch").val(""),$("#"+e+" #feeRule2OneToOne").val(""),$("#"+e+" #feeRule2Scholarship").val(""),$("#"+e+" #feeStructureForRule2").val(""),$("#"+e+" #LateAppFeeDateEnd").val(""),$("#"+e+" #discountSem1").val(""),$("#"+e+" #discountSem2").val(""),$("#"+e+" #admissionStatus").val("Y").trigger("change")}function dltAdmissionCycle(e){console.log("schoolsettings"),$.ajax({type:"GET",contentType:"application/json",url:getURLForAdmissionCycle("dashboard","dlt-admission-cycle",e),dataType:"json",async:!1,success:function(e){return"1"==e.statusCode?(showMessageTheme2(1,e.message,"",!0),!0):(showMessageTheme2(0,e.message,"",!0),!1)},error:function(e){}})}function setAdmissionCycleTableData(e,t,a){if(admissionCycle=$("#"+t+" tbody"),admissionCycle.html(""),""!=a){var s=1;$.each(a,(function(e,t){var a="Y"==t.allowAdmissionStatus?"Active":"Inactive";admissionCycle.append('<tr><td style="text-align: center;">'+s+"</td><td>"+t.groupName+"</td><td>"+t.durationSem1+"</td><td>"+t.durationSem2+"</td><td>"+t.lateFeeDuration+"</td><td>"+t.discountOne+"</td><td>"+t.discountTwo+"</td><td>"+a+'</td><td><a class="mt-2 btn btn-primary" href="javascript:void(0);" id="editAdmissionCycle" name="editAdmissionCycle" onclick=\'editAdmissionCycle('+t.id+");'>Edit</a></td></tr>"),s+=1}))}}function editAdmissionCycle(e){console.log("schoolsettings"),$.ajax({type:"get",contentType:"application/json",url:getURLForAdmissionCycle("dashboard","get-admission-cycle",e),dataType:"json",async:!1,success:function(t){return"1"==t.statusCode?(setvaluesForEditAdmissionCycle(t.admissionCycleDTOList[0],schoolSettingForm,e),!0):(showMessageTheme2(0,"Error Occured in Editing Admission Cycle","",!0),!1)},error:function(e){}})}function setvaluesForEditAdmissionCycle(e,t){$("#groupName").val(e.groupName),$("#admissionCycleId").val(e.id);var a=e.semesterOneStartDateString.split("-"),s=new Date(parseInt(a[2]),parseInt(a[0])-1,parseInt(a[1]));$("#semesterStartDate1").datepicker().datepicker("setDate",s);var l=e.semesterOneEndDateString.split("-"),r=new Date(parseInt(l[2]),parseInt(l[0])-1,parseInt(l[1]));$("#semesterEndDate1").datepicker().datepicker("setDate",r),$("#feeRule1Batch").val(e.feeRule1Batch),$("#feeRule1OneToOne").val(e.feeRule1OneToOne),$("#feeRule1Scholarship").val(e.feeRule1Scholarship),$("#feeStructureForRule1").val(e.feeStructureForRule1);var o=e.semesterTwoStartDateString.split("-"),n=new Date(parseInt(o[2]),parseInt(o[0])-1,parseInt(o[1]));$("#semesterStartDate2").datepicker().datepicker("setDate",n);var i=e.semesterTwoEndDateString.split("-"),d=new Date(parseInt(i[2]),parseInt(i[0])-1,parseInt(i[1]));$("#semesterEndDate2").datepicker().datepicker("setDate",d),$("#feeRule2Batch").val(e.feeRule2Batch),$("#feeRule2OneToOne").val(e.feeRule2OneToOne),$("#feeRule2Scholarship").val(e.feeRule2Scholarship),$("#feeStructureForRule2").val(e.feeStructureForRule2);var c=e.lateAppFeeStartDateString.split("-"),u=new Date(parseInt(c[2]),parseInt(c[0])-1,parseInt(c[1]));$("#LateAppFeeDate").datepicker().datepicker("setDate",u);var m=e.lateAppFeeEndDateString.split("-"),v=new Date(parseInt(m[2]),parseInt(m[0])-1,parseInt(m[1]));return $("#LateAppFeeDateEnd").datepicker().datepicker("setDate",v),$("#admissionStatus").val(e.allowAdmissionStatus).trigger("change"),$("#discountSem1").val(e.discountOne),$("#discountSem2").val(e.discountTwo),!0}