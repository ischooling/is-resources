var retryCount=0,eventSource="",myTriggerEvent="",retryCountAfterScheduleTime=0,initiateRequest=!1,eventInitiated=!1;function initiateEvensforClass(e,t,n,r){initiateRequest||(initiateRequest=!0,(eventSource=new EventSource(BASE_URL+CONTEXT_PATH+"sse/subscribe?key="+(r+"_"+n+"~"+t))).onopen=e=>{console.log("The connection has been established.")},eventSource.onmessage=e=>{console.log("The connection has been called.")},eventSource.onerror=function(e){console.log("Event: error"),this.readyState==EventSource.CONNECTING?console.log(`Reconnecting (readyState=${this.readyState})...`):console.log("Error has occured."),eventSource.close()},eventSource.addEventListener("class-started",(function(s){var o=JSON.parse(s.data);console.log("class-started "+JSON.stringify(o)),"I"!=e&&"E"!=e||window.setTimeout((function(){"I"==e?"ORIENTATION"==r?proceedForOrientation("N",e,t,n,r):checkClassStatus(t,r,n):proceedForExternalClass(e,t,n,r),2==++retryCount&&window.location.reload()}),1e4)})))}function stopEvensforClass(){""!=eventSource&&(eventSource.close(),console.log("eventSource.close()"),eventSource="")}function callClassOrActivityExternalClass(e,t,n,r){retryCountAfterScheduleTime<15&&(console.log("retryCountAfterScheduleTime "+retryCountAfterScheduleTime),retryCountAfterScheduleTime++,proceedForExternalClass(e,t,n,r))}function triggerReloadExternalClass(e,t,n,r,s,o){currentDate=new Date;var a=convertTZ(s,o);console.log("triggerReloadExternalClass currentDate "+currentDate),console.log("triggerReloadExternalClass scheduledDate"+a),a.getTime()-1e3<=currentDate.getTime()&&(stopFunction(),setInterval((function(){callClassOrActivityExternalClass(e,t,n,r,s,o)}),6e4))}function proceedForExternalClass(e,t,n,r,s,o,a){$.ajax({type:"POST",contentType:"application/json",url:BASE_URL+CONTEXT_PATH+SCHOOL_UUID+"/external-class-status",data:JSON.stringify(prepareClassJoinRequest(e,t,n,r,s,o,a)),dataType:"json",async:!0,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status&&redirectLoginPage():(stopEvensforClass(),window.location.href=e.redirectUrl)},error:function(e){return console.log("error ",e),!1}})}function prepareClassJoinRequest(e,t,n,r,s,o,a){var i={};return i.schoolId=SCHOOL_ID,i.type=e,i.userId=t,i.entityId=n,i.entityType=r,i.profile="student",i.hostId=o,i.timezone=s,i.subject=a,i}function changeIFrameUrl(e){var t=document.getElementById("zoom-meeting-iframe");$("#hide-when-zoom-meeting-start").hide(),t.src=e,$("#meeting-after-join-ui").removeClass("d-none")}function checkClassStatus(e,t,n){customLoader(!0),$.ajax({type:"GET",contentType:"application/json",url:BASE_URL+CONTEXT_PATH+SCHOOL_UUID+"/"+UNIQUEUUID+"/check-class-status/"+e+"/"+t+"/"+n,dataType:"json",async:!0,global:!1,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?("3"==e.status?redirectLoginPage():showMessage(!1,e.message),initiateEvensforClass("I",e.userId,n,t)):(stopEvensforClass(),changeIFrameUrl(e.redirectUrl),stopFunction()),customLoader(!1)},error:function(e){checkonlineOfflineStatus()}})}function callClassOrActivityOrientation(e,t,n,r,s,o,a,i){retryCountAfterScheduleTime<15&&(console.log("callClassOrActivityOrientation "+retryCountAfterScheduleTime),retryCountAfterScheduleTime++,"REQUESTDEMO"==i?proceedForDemoClass("N",e,t,n,r,s,o,i,a):proceedForOrientation("Y",e,t,n,r,s,o,a,i))}function triggerReloadOrientation(e,t,n,r,s,o,a,i){currentDate=new Date;var l=convertTZ(s,o);console.log("triggerReloadOrientation currentDate "+currentDate),console.log("triggerReloadOrientation scheduledDate"+l),l.getTime()-1e3<=currentDate.getTime()&&(stopFunction(),setInterval((function(){callClassOrActivityOrientation(e,t,n,r,s,o,a,i)}),1e4))}function proceedForOrientation(e,t,n,r,s,o,a,i,l){$.ajax({type:"POST",contentType:"application/json",url:BASE_URL+CONTEXT_PATH+SCHOOL_UUID+"/orientation-class-status",data:JSON.stringify(prepareClassJoinRequest(t,n,r,s,a,i,l)),dataType:"json",async:!0,success:function(c){if("0"==c.status||"2"==c.status||"3"==c.status)c.status;else if(null!=c.redirectUrl&&""!=c.redirectUrl)stopEvensforClass(),window.location.href=c.redirectUrl;else{var u=new Date,d=convertTZ(o,a);console.log("proceedForOrientation currentDate "+u),console.log("proceedForOrientation scheduledDate "+d),eventInitiated||(eventInitiated=!0,"Y"==e?$(".showValidationMessage").html("<br/><strong>Your system training has not started yet. You will be redirected automatically when it begins..</strong>"):$(".showValidationMessage").html(""),initiateEvensforClass(t,n,r,s)),""==myTriggerEvent&&(console.log("triggerReloadOrientation called"),myTriggerEvent=window.setInterval((function(){triggerReloadOrientation(t,n,r,s,o,a,i,l)}),2e4))}}})}function stopFunction(){console.log("stopFunction called"),clearInterval(myTriggerEvent)}function registerExternalClass(e,t,n,r,s,o,a,i,l,c){return null==$("#userName").val()||""==$("#userName").val()?(e&&showMessageTheme2(0,"Name is mandatory to join class"),!1):null==$("#userEmail").val()||null==$("#userEmail").val()||""==$("#userEmail").val()||validateEmail($("#userEmail").val().trim())?void $.ajax({type:"POST",contentType:"application/json",url:BASE_URL+CONTEXT_PATH+SCHOOL_UUID+"/register-external-class",data:JSON.stringify(registerExternalClassRequest(t,n,r,s,l,a,c)),dataType:"json",async:!0,success:function(e){"0"==e.status||"2"==e.status||"3"==e.status?"3"==e.status&&redirectLoginPage():($("#server-message").html(e.message),null!=e.redirectUrl&&""!=e.redirectUrl?window.location.href=e.redirectUrl:$("#server-message").html(e.message))},error:function(e){return console.log("error ",e),!1}}):(showMessageTheme2(0,"Invalid Email"),!1)}function registerExternalClassRequest(e,t,n,r,s,o,a){var i={};return i.schoolId=SCHOOL_ID,i.type=e,i.userId=t,i.entityId=n,i.entityType=r,i.name=$("#userName").val(),i.email=$("#userEmail").val(),i.profile="student",i.hostId=s,i.timezone=o,i.subject=a,i}