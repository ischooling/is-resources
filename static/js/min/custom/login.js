var schoolSettingsLinks,schoolSettingsTechnical,schoolSettings,API_VERSION=CONTEXT_PATH+SCHOOL_UUID+"/api/v1/";function goAhead(e,t){var a=$('<form action="'+e+'" method="POST"><input type="hidden" name="hash" id="hash" value="'+t+'" /></form>');$("body").append(a),$(a).target="_blank",$(a).submit()}function hideMessage(e){$("#errorHeading").html(""),$("#statusMessage").removeClass("success-color"),$("#statusMessage").removeClass("danger-color"),$("#statusMessage").html(""),$("#modalMessage").modal("hide")}function chooseValueByElement(e,t){$("#"+e).length&&$("#"+e+" option").map((function(){var e=$(this).text();if((e=e.substr(e.indexOf(" ")+1))===t)return this})).attr("selected","selected")}function chooseCountryElement(e,t){$("#"+e).length&&($("#"+e+" option").map((function(){if($(this).text()===t)return this})).attr("selected","selected"),$("#"+e).trigger("change"))}function getPrimaryColor(){return ROOTCSS.split(":#")[1].split(";")[0]}function checkAndReturn(e,t){var a=JSON.parse(localStorage.getItem("SCRIPT_VERSION"));JSON.parse(a.metaKey).data.metaValue!=SCRIPT_VERSION?(localStorage.clear(),t(getNeedToCall())):null==localStorage.getItem(e)?t(getNeedToCall()):t(JSON.parse(localStorage.getItem(e)))}function getSettingsByTypeAndKey(e,t){var a={};return $.ajax({url:BASE_URL+CONTEXT_PATH+SCHOOL_UUID+`/api/v1/get-setting?metaType=${e}&metaKey=${t}`,method:"GET",contentType:"application/json",async:!1,success:function(e){a=e},error:function(e){console.error("Error fetching settings")}}),a}function getNeedToCall(){return{ntc:!0}}async function getFreshValue(e,t){const a={metaType:t,metaKey:await getSettingsByTypeAndKey(e,t)};localStorage.setItem(t,JSON.stringify(a))}function getDesiredObject(e){var t="SCRIPT_VERSION";return new Promise(((a,o)=>{null==localStorage.getItem(t)?getFreshValue("CONFIGURATION",t).then((()=>{checkAndReturn(e,a)})).catch(o):checkAndReturn(e,a)}))}async function getOnetimeDetails(e,t){try{var a=await getDesiredObject("one-time-details"+e);if("object"==typeof a&&!a.ntc)return a;var o={};return o.schoolId=e,o.requestFor=t,a=await getDataBasedUrlAndPayload("one-time-details",o),localStorage.setItem("one-time-details"+e,JSON.stringify(a)),a}catch(e){showMessage(!0,e)}}async function getSchoolSettingsLinks(e){try{var t=await getDesiredObject("sslink"+e);return"object"!=typeof t||t.ntc?(t=await getDataBasedUrlAndPayload("links",getSettingRequest(e)),localStorage.setItem("sslink"+e,JSON.stringify(t)),t):t}catch(e){showMessage(!0,e)}}function getSettingRequest(e){var t={};return t.schoolId=e,t}async function getSchoolSettingsTechnical(e){try{var t=await getDesiredObject("sst"+e);return"object"!=typeof t||t.ntc?(t=await getDataBasedUrlAndPayload("technical",getSettingRequest(e)),localStorage.setItem("sst"+e,JSON.stringify(t)),t):t}catch(e){showMessage(!0,e)}}async function getSchoolSettingsOffice(e){try{var t=await getDesiredObject("ssoffice"+e);return"object"!=typeof t||t.ntc?(t=await getDataBasedUrlAndPayload("office",getSettingRequest(e)),localStorage.setItem("ssoffice"+e,JSON.stringify(t)),t):t}catch(e){showMessage(!0,e)}}var debouncing=function(e,t){var a;return function(...o){clearTimeout(a),a=setTimeout((()=>{e(...o)}),t)}};async function initiateSetting(){var e=[],t={entity:"office"};e.push(t);var a={entity:"links"};e.push(a);var o={entity:"technical"};e.push(o);var s={setttings:"SCRIPT_VERSION"};e.push(s);var n=await getOnetimeDetails(SCHOOL_ID,e);schoolSettingsLinks=JSON.parse(n.schoolSettingsLinks),schoolSettingsTechnical=JSON.parse(n.schoolSettingsTechnical),schoolSettings=JSON.parse(n.schoolSettings)}async function loginPageOnLoadEvent(){callLocationAndSelectCountryNew("loginForm"),$("form").attr("autocomplete","off"),$("#email").blur((function(){validEndInvalidField(null,"email")})),$("#password").blur((function(){validEndInvalidField(null,"password")})),$('[data-toggle="tooltip"]').tooltip(),$("#marqueeDiv").css({color:"red"}),$("#loginButton").click((function(e){e.preventDefault(),callUserLogin("loginForm",moduleId,"FRESH")})),$("#forgotSubmit").click((function(){callForEmailForgot("forgetForm",moduleId,"messageTypeTheme2")})),$("#resetPassword").click((function(){callForResetPassword("changeForm",moduleId)})),$("#notVerify").click((function(){callForEmailResend($("#loginForm #email").val().trim(),moduleId,"false")}))}function callFocusForForgotPassword(){$("#forgotPassword").modal("show"),$("#forgotPassword input").keydown((function(e){if(13==e.keyCode)return e.preventDefault(),!1}))}function validateRequestForLogin(e){return validateEmail($("#"+e+" #email").val().trim())?validPassword($("#"+e+" #password").val().trim())?!!validateCaptcha($("#"+e+" #captcha").val().trim())||(showMessage(!1,"Either captcha is empty or invalid"),!1):(showMessage(!1,"Either password is empty or invalid"),!1):(showMessage(!1,"Email is either empty or invalid"),!1)}function getRequestForLogin(e,t,a){var o={},s={},n={},i=getSystemTimezone();return"Asia/Calcutta"==i&&(i="Asia/Kolkata"),n.timezone=i,n.userName=$("#"+e+" #email").val().trim(),n.password=encode($("#"+e+" #password").val().trim()),n.captcha=$("#"+e+" #captcha").val().toUpperCase().trim(),n.location=$("#"+e+" #location").val().trim(),s.hash=getHash(),s.schoolId=SCHOOL_ID,s.schoolUUID=SCHOOL_UUID,s.userType=t,o.authentication=s,o.login=n,o}function getRequestForProceedToChangeTimezoneForCommon(e,t){var a={},o={},s={};return o.userType="common",o.userId=t,o.hash=getHash(),o.schoolId=SCHOOL_ID,o.schoolUUID=SCHOOL_UUID,s.timezoneId=e,a.authentication=o,a.data=s,a}function proceedWithUserChangedTimezone(e,t){return $("#modalMessage.in").length>0?(hideMessage(""),!1):null!=(e=$("#countryTimezoneFromId").val())&&null!=e&&""!=e&&($("#proceed").prop("disabled",!0),customLoader(!0),void $.ajax({type:"POST",contentType:"application/json",url:getURLFor("common","save-user-new-timezone"),data:JSON.stringify(getRequestForProceedToChangeTimezoneForCommon(e,t)),dataType:"json",cache:!1,timeout:6e5,success:function(e){if("0"==e.status||"2"==e.status)showMessage(!0,e.message),customLoader(!1);else if("3"==e.status)showMessage(!0,e.message),customLoader(!1),redirectLoginPage();else{customLoader(!1),goAhead($("#ssoUrl").val(),$("#hash").val()),$("#proceed").prop("disabled",!1)}},error:function(e){$("#proceed").prop("disabled",!1)}}))}const callUserLogin=debouncing(callUserLoginFun,300);function callUserLoginFun(e,t,a){return $("#modalMessage.in").length>0?(hideMessage(""),!1):!!validateRequestForLogin(e)&&($("#"+e+" #login").prop("disabled",!0),void $.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("login"),data:JSON.stringify(getRequestForLogin(e,t,a)),dataType:"json",cache:!1,timeout:6e5,success:function(o){if(localStorage.setItem("welcome",!1),"0"==o.status||"2"==o.status)"0043"==o.statusCode?($("#allReadyEmail #emailNotVerify").show(),$("#allReadyEmailFooter").show(),$("#allReadyEmail #emailVerify").hide(),$("#allReadyEmail #userDeclined").hide(),$("#allReadyEmail").modal("toggle")):"02"==o.statusCode?($("#allReadyEmail #emailNotVerify").hide(),$("#allReadyEmail #emailVerify").hide(),$("#allReadyEmail #userDeclined").show(),$("#allReadyEmail").modal("toggle")):"STUDENT"==t?(showMessage(!1,o.message,"",!0),validEndInvalidField(!1,"email"),validEndInvalidField(!1,"password"),validEndInvalidField(!1,"captcha")):(showMessage(!1,o.message),validEndInvalidField(!1,"email"),validEndInvalidField(!1,"password"),validEndInvalidField(!1,"captcha")),customLoader(!1);else{customLoader(!0),UNIQUEUUID=o.uniqueId;var s=o.redirectUrl;console.log("redirectUrl :: "+s),s.startsWith("http")?"FRESH"==a?(showMessage(!0,o.message),goAhead(s,o.userLoginHash)):"CONTINUE"==a&&(customLoader(!1),"STUDENT"==t?showMessage(!0,o.message,"",!0):showMessage(!0,o.message),$("#sessionOutPermission").modal("hide")):showMessage(!0,s),validEndInvalidField(!0,"email"),validEndInvalidField(!0,"password"),validEndInvalidField(!0,"captcha")}return $("#"+e+" #login").prop("disabled",!1),!1},error:function(t){$("#"+e+" #login").prop("disabled",!1)}}))}function callLocationAndSelectCountryNewFill(e,t){$("#"+e+" #countryTimezoneId").length&&$("#"+e+" #countryTimezoneId").select2(),null!=t&&""!=t&&($("#"+e+" #countryTimezoneId").length&&$("#countryTimezoneId").val(t.timezone).trigger("change"),$("#"+e+" #chooseDate").length&&$("#"+e+" #chooseDate").datepicker().datepicker("setDate",new Date),chooseValueByElement("isdCodeMobileNo",t.country),chooseValueByElement("isdCodeWhatsupNo",t.country),chooseCountryElement("countryId",t.country),setTimeout((function(){$("#countryId").trigger("change")}),500),$("#"+e+" #location").val(JSON.stringify(t)),$("#"+e+"Alternet #location").length&&$("#"+e+"Alternet #location").val($("#"+e+" #location").val()))}function callLocationAndSelectCountryNew(e){callLocationAndSelectCountryNewFill(e,getActualData())}function showMessage(e,t,a){window.scrollTo({top:100,left:100,behavior:"smooth"}),e?($("#errorHeading").html("Error! Be focus on work"),$("#statusMessage").addClass("danger-color"),$("#statusMessage").removeClass("success-color")):($("#errorHeading").html("Information!"),$("#statusMessage").removeClass("danger-color"),$("#statusMessage").addClass("success-color")),$("#statusMessage").html(t),$("#modalMessage").modal("show"),signupPage>0&&(setTimeout((function(){$("#modalMessage").modal("hide")}),3e3),setTimeout((function(){tabActiveStatus(signupPage)}),1))}function validateForEmailForgot(e){return!!validateEmail($("#"+e+" #emailid").val().trim())||($("#"+e+" #emailid").css("color","#a9a9a9"),showMessage(!1,"Please enter a valid email."),!1)}function getRequestForForgot(e,t){var a={},o={},s={requestKey:"FORGOT-PASSWORD"};return s.email=$("#"+e+" #emailid").val().trim(),o.hash=getHash(),o.schoolId=SCHOOL_ID,o.schoolUUID=SCHOOL_UUID,o.userType=t,a.authentication=o,a.data=s,a}function refreshCaptcha(e){null!=e&&""!=e&&$("#"+e).length>0&&(document.images[e].src=BASE_URL+API_VERSION+"common/captcha.jpg?v="+(new Date).getTime())}function getURLForCommon(e){return BASE_URL+API_VERSION+"common/"+e}function getURLFor(e,t){return BASE_URL+API_VERSION+e+"/"+t}function getDataBasedUrlAndPayload(e,t){return new Promise((function(a,o){$.ajax({type:"POST",contentType:"application/json",url:getURLFor(e,""),data:JSON.stringify(t),dataType:"json",global:!1,success:function(e){a(e)},error:function(e,t,a){o(a),"theme1"==tt?showMessage(!0,TECHNICAL_GLITCH):showMessageTheme2(0,TECHNICAL_GLITCH,"",!0)}})}))}function callForEmailForgot(e,t){return $("#modalMessage.in").length>0?(hideMessage(""),!1):!!validateForEmailForgot(e)&&void $.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("forgot-password"),data:JSON.stringify(getRequestForForgot(e,t)),dataType:"json",cache:!1,timeout:6e5,success:function(e){return"0"==e.status||"2"==e.status?"0047"==e.statusCode?($("#allReadyEmail #emailNotVerify").html(e.message),$("#allReadyEmail #emailNotVerify").show(),$("#allReadyEmailFooter").show(),$("#allReadyEmail #emailVerify").hide(),$("#allReadyEmail #userDeclined").hide(),$("#allReadyEmail").modal("toggle")):showMessage(!0,e.message):($("#forgotPassword #emailid").val().trim(""),$("#forgotPassword").modal("hide"),showMessage(!1,e.message)),!1},error:function(e){console.log("ERROR : ",e)}})}function validEndInvalidField(e,t){e?($("#"+t).closest(".valid-field").addClass("true"),$("#"+t).closest(".valid-field").removeClass("false")):null==e?($("#"+t).closest(".valid-field").removeClass("false"),$("#"+t).closest(".valid-field").removeClass("true")):($("#"+t).closest(".valid-field").addClass("false"),$("#"+t).closest(".valid-field").removeClass("true"))}function getSystemTimezone(){var e="";try{e=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){console.log("getSystemTimezone: "+e.message)}return e}function encode(e){return window.btoa(encodeURI(e))}function getHash(){return Math.random().toString(36)}function showPassWord(e,t){var a=document.getElementById(e),o=document.getElementById(t);if(a.disabled)return!1;"password"===a.type?(a.type="text",o.classList.remove("fa-eye-slash"),o.classList.add("fa-eye")):(a.type="password",o.classList.remove("fa-eye"),o.classList.add("fa-eye-slash"))}function customLoader(e){e?($("#commonloaderId").removeClass("hide"),$("#commonloaderBody").addClass("loader"),$("#commonloaderId").addClass("loader-bg"),$("#commonloaderId").show()):($("#commonloaderBody").removeClass("loader"),$("#commonloaderId").removeClass("loader-bg"),$("#commonloaderId").addClass("hide"),$("#commonloaderId").hide())}$(document).on("show.bs.modal",".modal",(function(e){const t=$(this);$(".modal-backdrop");let a=1050+20*$(".modal.in").not(this).length;t.css("z-index",a),setTimeout((()=>{$(".modal-backdrop").last().css("z-index",a-10).addClass("modal-stack")}),10)})),$.ajaxSetup({beforeSend:function(e,t){if(null!=t.data&&"application/json"==t.contentType){var a={};a.payload=encode(t.data),t.data=JSON.stringify(a)}e.setRequestHeader("UNIQUEUUID",UNIQUEUUID)}}),$(document).ajaxStart((function(){customLoader(!0)})),$(document).ajaxSuccess((function(){customLoader(!1)}));