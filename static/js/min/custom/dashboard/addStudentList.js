function validateRequestForAddStudent(e){if(!validateFormAscii(e))return showMessage(!1,"Please use the English Keyboard while providing information"),!1;if(!validateFormAscii("tbl_gen_marks_pre tbody tr"))return showMessage(!1,"Please use the English Keyboard while providing information"),!1;if(""==$("#"+e+" #studentFirstName").val().trim()||null==$("#"+e+" #studentFirstName").val())return showMessage(!1,"Student Name is required"),!1;if(""==$("#"+e+" #fatherFirstName").val().trim()||null==$("#"+e+" #fatherFirstName").val())return showMessage(!1,"Father Name is required"),!1;if(""==$("#"+e+" #fatherLastName").val().trim()||null==$("#"+e+" #fatherLastName").val())return showMessage(!1,"Father Last Name is required"),!1;if(""==$("#"+e+" #motherFirstName").val().trim()||null==$("#"+e+" #motherFirstName").val())return showMessage(!1,"Mother Name is required"),!1;if(""==$("#"+e+" #motherLastName").val().trim()||null==$("#"+e+" #motherLastName").val())return showMessage(!1,"Mother Last Name is required"),!1;if("0"==$("#"+e+" #gender").val().trim()||null==$("#"+e+" #gender").val())return showMessage(!1,"Gender is required"),!1;if(""==$("#"+e+" #dob").val().trim()||null==$("#"+e+" #dob").val())return showMessage(!1,"DOB is required"),!1;if(0==$("#currentGrade option:selected").index())return showMessage(!1,"Grade must be selected"),!1;var t=$("#fileupload1").parent("span").parent("p").parent("div").find("span.fileName").html();return""==t||null==t||-1!=$.inArray($.trim(t.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg"])||(showMessage(!0,"Please upload Student Passport Size Photo in following formats (jpg, jpeg or png)."),!1)}function callForAddStudentDetails(e){if(console.log("validateDuplicateSubjects: "+validateDuplicateSubjects()),!validateDuplicateSubjects())return customLoader(!1),!1;hideMessage(""),$.ajax({type:"POST",url:getURLForHTML("dashboard","save-student-details"),data:encodeURI("request="+JSON.stringify(getRequestForAddStudentDetails(e))),dataType:"html",cache:!1,timeout:6e5,success:function(e){if(""!=e){var t;if(t=e.split("|"),console.log("stringMessage: "+t),"FAILED"==t[0]||"EXCEPTION"==t[0]||"SESSIONOUT"==t[0])showMessage(!0,t[1]);else{showMessage(!0,t[1]),$("#form-modal").modal("hide"),$("#studentFirstName").val(""),$("#studentMiddleName").val(""),$("#studentLastName").val(""),$("#fatherFirstName").val(""),$("#fatherMiddleName").val(""),$("#fatherLastName").val(""),$("#motherFirstName").val(""),$("#motherMiddleName").val(""),$("#motherLastName").val(""),$("#gender").val("0"),$("#disablityTypes").val(""),$("#currentGrade").val("0"),$("#disablityTypes").hide(),$("#subHide").hide(),$("#passportPhoto").val(""),$("#dob").val(""),$("#fileupload1").parents(".file-tab").find("span.fileName").text(""),$("#fileupload2").parents(".file-tab").find("span.fileName").text(""),$("#fileupload6").parents(".file-tab").find("span.fileName").text(""),$("#fileupload4").parents(".file-tab").find("span.fileName").text(""),$("#fileupload5").parents(".file-tab").find("span.fileName").text(""),$("#subject").hide("");var a=$("#dashboardFor").val().trim();""!=a&&null!=a&&"SCHOOL_ADMIN"!=a?(setTimeout((function(){callDashboardPageSchoolB2B("3a")}),1e3),$("html, body").animate({scrollTop:$("#divStudentBucketList").offset().top-100},"slow")):setTimeout((function(){callDashboardPageSchool("21a1")}),1e3)}return!1}customLoader(!1)},error:function(e){return!1}})}function callForAddStudentModal(e){return customLoader(!0),validateRequestForAddStudent(e)&&validateCurrSubjectDetails()?validateMarks("tbl_gen_marks_pre")?($("#form-modal").modal({backdrop:"static",keyboard:!1}),void customLoader(!1)):(customLoader(!1),$("#callPreviousSubMarksModal").modal("show"),!1):(customLoader(!1),!1)}function getRequestForAddStudentDetails(e){var t,a={},r={},s={},i={};i.id=$("#studentId").val().trim(),i.schoolId=$("#schoolId").val().trim(),i.studentFirstName=escapeCharacters($("#"+e+" #studentFirstName").val().trim()),i.studentMiddleName=escapeCharacters($("#"+e+" #studentMiddleName").val().trim()),i.studentLastName=escapeCharacters($("#"+e+" #studentLastName").val().trim()),i.fatherFirstName=escapeCharacters($("#"+e+" #fatherFirstName").val().trim()),i.fatherMiddleName=escapeCharacters($("#"+e+" #fatherMiddleName").val().trim()),i.fatherLastName=escapeCharacters($("#"+e+" #fatherLastName").val().trim()),i.motherFirstName=escapeCharacters($("#"+e+" #motherFirstName").val().trim()),i.motherMiddleName=escapeCharacters($("#"+e+" #motherMiddleName").val().trim()),i.motherLastName=escapeCharacters($("#"+e+" #motherLastName").val().trim()),i.gender=$("#"+e+" #gender").val().trim(),""!=(t=$("#fileupload1").parent("span").parent("p").parent("div").find("span.fileName").html())&&null!=t&&(-1==$.inArray($.trim(t.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg"])?showMessage(!0,"Please upload Student Sign in following formats (jpg, jpeg or png)."):i.passportPhoto=t),""!=(t=$("#fileupload2").parent("span").parent("p").parent("div").find("span.fileName").html())&&null!=t&&(-1==$.inArray($.trim(t.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg","pdf"])||(i.birthCertificate=t)),""!=(t=$("#fileupload6").parent("span").parent("p").parent("div").find("span.fileName").html())&&null!=t&&(-1==$.inArray($.trim(t.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg","pdf"])||(i.addressProof=t)),""!=(t=$("#fileupload4").parent("span").parent("p").parent("div").find("span.fileName").html())&&null!=t&&(-1==$.inArray($.trim(t.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg","pdf"])||(i.immunizationCard=t)),""!=(t=$("#fileupload5").parent("span").parent("p").parent("div").find("span.fileName").html())&&null!=t&&(-1==$.inArray($.trim(t.split(".").pop().toLowerCase()),["gif","png","jpg","jpeg","pdf"])||(i.academicProof=t)),i.currentGrade=$("#"+e+" #currentGrade").val().trim(),i.currentSubjectId=calculateCurrentSubjects(),i.dob=$("#"+e+" #dob").val().trim(),i.disablity=$("input[name='isDisablity']:checked").val().trim(),i.disablityType=escapeCharacters($("#"+e+" #disablityType").val().trim()),i.isFromSameSchool=$("input[name='isFromSameSchool']:checked").val().trim();var n={};return n.studentPrevGenerateMarksDTO=calculatePreviousMarks(),i.prevQualificationData=JSON.stringify(n),s.addStudentListDTO=i,r.hash=getHash(),r.schoolId=SCHOOL_ID,r.schoolUUID=SCHOOL_UUID,r.userType="SCHOOL",r.userId=$("#"+e+" #userId").val().trim(),a.authentication=r,a.requestData=s,a}function calculatePreviousMarks(){var e=[];return $("#tbl_gen_marks_pre tbody tr").each((function(){var t={};if($(this).find("select.subjectId option:selected").val().trim()>0){t.practicalMarks=$(this).find("input.e_p_marks").val().trim(),t.theoryMarks=$(this).find("input.e_t_marks").val().trim(),t.marksCount=$(this).find("span.marks-count").text(),t.subjectId=$(this).find("select.subjectId option:selected").val().trim(),t.subjectName=$(this).find("select.subjectId option:selected").attr("subNameAttr"),t.maxTheoryMarks=$(this).find("span.maxTheoryMarks").text(),t.theoryPassingMarks=$(this).find("span.theoryPassingMarks").text(),t.maxPracticalMarks=$(this).find("span.maxPracMarks").text(),t.practicalPassingMarks=$(this).find("span.pracPassigMarks").text();var a=$(this).find("input.sub_maxid").val();t.maxMarks=""!=a?parseInt(a):"0",t.grade=$(this).find("span.grade").text(),console.log("grade::: :"+t.grade),t.cumulativeGrade=escapeCharacters($(this).find("input.credit").val().trim()),t.preSubResult=$(this).find("span.result").text()}e.push(t)})),e}function validateDuplicateSubjects(){var e=!0,t=[];$("#tbl_gen_marks_pre tbody tr").each((function(){var e;0!=(e=$(this).find("select.subjectId option:selected").val())&&t.push(e)})),console.log("sorted: "+t.sort());t.sort();for(var a=0;a<t.length-1;a++)if(t[a+1]==t[a])return showMessage(!0,"Two Subjects can not be same"),e=!1;return e}function callMandSubjects(e,t,a){if(hideMessage(""),!validateRequestForMaster(e,a))return $("#"+e+" #currentsubject11").val().trim(0),resetDropdown($("#"+e+" #currentsubject11"),"Select course"),!1;$("#"+e+" #currentsubject11").prop("disabled",!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","COMP-SUBJECT-LIST-BY-GRADE",t,$("#schoolId").val)),dataType:"json",cache:!1,timeout:6e5,success:function(t){"0"==t.status||"2"==t.status?showMessage(!0,t.message):(console.log("mastersData "+t.mastersData.currentSub),$.each(t.mastersData.currentSub,(function(e,t){var a='<tr onclick="selectSubject(this, false);" id="'+t.key+'" class="block greenDiv"><td><strong>'+t.value+" - "+t.extra+'</strong></td><td style="text-align:center;"><i class="fa fa-check"></i></td></tr>';$("#mandatorySubjects tbody").append(a)})),$("#"+e+" #countAreaOfspecialization").text(t.mastersData.currentSub.length)),$("#currentsubject11").prop("disabled",!1)},error:function(e){$("#currentsubject11").prop("disabled",!1)}})}function callOptSubjects(e,t,a){if(hideMessage(""),!validateRequestForMaster(e,a))return $("#"+e+" #currentsubject11").val().trim(0),resetDropdown($("#"+e+" #currentsubject11"),"Select course"),!1;$("#"+e+" #currentsubject11").prop("disabled",!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","OPTIONAL-SUBJECT-LIST-BY-GRADE",t,$("#schoolId").val)),dataType:"json",cache:!1,timeout:6e5,success:function(t){"0"==t.status||"2"==t.status?showMessage(!0,t.message):(console.log("mastersData "+t.mastersData.currentSub),$.each(t.mastersData.currentSub,(function(e,t){var a='<tr onclick="selectSubject(this, true);" id="'+t.key+'" class="block "><td><strong>'+t.value+" - "+t.extra+'</strong></td><td style="text-align:center;"><i class="fa fa-check"></i></td></tr>';$("#optionalSubjects tbody").append(a)})),$("#"+e+" #countAreaOfspecialization").text(t.mastersData.currentSub.length)),$("#currentsubject11").prop("disabled",!1)},error:function(e){showMessage(!0,e.responseText),$("#currentsubject11").prop("disabled",!1)}})}function callSubjectsByGrade(e,t,a){if(hideMessage(""),!validateRequestForMasterGrade(e,a))return $("#"+e+" #"+a).val().trim(0),resetDropdown($("#"+e+" #"+a),"Select course"),!1;$("#"+e+" #prevSubject").prop("disabled",!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster(e,"PREVSUBJECT-LIST",t)),dataType:"json",cache:!1,timeout:6e5,success:function(t){"0"==t.status||"2"==t.status?showMessage(!0,t.message):(buildDropdown(t.mastersData.prevSub,$("#prevSubject"),"Select course"),$("#"+e+" #prevSubject").prop("disabled",!1)),$("#"+e+" #prevSubject").prop("disabled",!1)},error:function(t){$("#"+e+" #prevSubject").prop("disabled",!1)}})}function selectSubject(e,t){t&&($(e).hasClass("greenDiv")?$(e).removeClass("greenDiv"):$(e).addClass("greenDiv"))}$("#exampleRadios1").click((function(){$("#disablityTypes").show()})),$("#exampleRadios2").click((function(){$("#disablityTypes").hide()})),$("#isFromSameSchool1").click((function(){$("#isFromSameSchool").show()})),$("#isFromSameSchool2").click((function(){$("#isFromSameSchool").hide()}));var PRESERVE_AREA_OF_SPECIALIZATION="";function calculateCurrentSubjects(e){if(null==e||""==e);else if(null==$("#currentGrade").val()||0==$("#currentGrade").val()||""==$("#currentGrade").val())return"0";var t="",a=1;$("#mandatorySubjects tbody tr").each((function(){-1!=this.className.indexOf("greenDiv")&&(t=t+","+this.id,$("#totalSubjectSelected").text(a),a++)})),$("#optionalSubjects tbody tr").each((function(){-1!=this.className.indexOf("greenDiv")&&(t=t+","+this.id,$("#totalSubjectSelected").text(a),a++)}));var r=PRESERVE_AREA_OF_SPECIALIZATION;return $("#countAreaOfspecialization").text(t.substr(1).split(",").length),PRESERVE_AREA_OF_SPECIALIZATION=t.substr(1),""!=r&&r!=PRESERVE_AREA_OF_SPECIALIZATION&&(needToCallPreviousSubject=!0),PRESERVE_AREA_OF_SPECIALIZATION}function validateCurrSubjectDetails(){var e=!1;return $("#mandatorySubjects tbody tr").each((function(){console.log(),$(this).hasClass("greenDiv")&&(e=!0)})),e||(showMessage(!0,"Mandatory Subjects are required."),showCurrentSubject(!0)),e}function applyPassingRule(e,t){console.log("src.id "+e.id),console.log("applyPassingRule called");var a=$("#"+e.id+" option:selected").attr("pracMandAttr");1==a?($("#maxPracMarks-"+t).text($("#"+e.id+" option:selected").attr("maxpracmarks")),$("#pracPassigMarks-"+t).text($("#"+e.id+" option:selected").attr("maxpracmarks")),$("#practicalMarks-"+t).val(""),$("#practicalMarks-"+t).prop("disabled",!1)):($("#maxPracMarks-"+t).text("N/A"),$("#pracPassigMarks-"+t).text("N/A"),$("#practicalMarks-"+t).val(""),$("#practicalMarks-"+t).prop("disabled",!0)),$("#maximumMarks-"+t).text($("#"+e.id+" option:selected").attr("totalMarks")),$("#maxTheoryMarks-"+t).text($("#"+e.id+" option:selected").attr("maxTheoryMarks")),1==a&&$("#pracPassigMarks-"+t).text($("#"+e.id+" option:selected").attr("pracPassingMarks")),$("#theoryPassingMarks-"+t).text($("#"+e.id+" option:selected").attr("theoryPassingMarks")),$("#maximumMarks-"+t).val($("#"+e.id+" option:selected").attr("totalMarks")),0==(r=$(e).val())&&($("#maxTheoryMarks-"+t).text(""),$("#theoryPassingMarks-"+t).text(""),$("#theoryMarks-"+t).val(""),$("#practicalMarks-"+t).val(""),$("#pracPassigMarks-"+t).text(""),$("#practicalMarks-"+t).val(""),$("#maxPracMarks-"+t).text(""),$("#marksCount-"+t).text(""),$("#grade-"+t).text(""),$("#credits-"+t).val(""),$("#cumulativeGrade-"+t).val(""),$("#result-"+t).text(""));var r=$(e).val(),s=$("#schoolId").val();return console.log("subjectId: "+r+" schoolId: "+s),0==r||null==r?(showMessage(!0,"Please select course"),!1):(1==$("input[name='isFromSameSchool']:checked").val()||$(".sub_maxid").val("100"),!0)}function changeMarks(e,t){$("#cumulativeGrade-"+t).val("")}function calculatePassingRule(e,t){console.log("calculatePassingRule called");var a=!0;$("#tr-"+t).removeClass("tr-red");var r=$("#subjectId-"+t).val(),s=$("#subjectId-"+t+" option:selected").attr("pracMandAttr"),i=parseInt($("#maxTheoryMarks-"+t).text()),n=($("#theoryPassingMarks-"+t).text(),$("#theoryMarks-"+t).val()),l=$("#maxPracMarks-"+t).text(),o=($("#pracPassigMarks-"+t).text(),$("#practicalMarks-"+t).val()),d=(parseInt($("#maximumMarks-"+t).val()),$("#cumulativeGrade-"+t).val()),c=$("#grade-"+t).text(),u=$("#result-"+t).text();if(r>0&&(o>=0||n>=0)){if(n>0&&o>0&&(n=parseInt(n),o=parseInt(o)),n>i)return showMessage(!0,"Theory Marks can not be more than Max Theory Marks"),$("#tr-"+t).addClass("tr-red"),a=!1;if(1==s&&o>l)return showMessage(!0,"Practical Marks can not be more than Max Practical Marks"),$("#tr-"+t).addClass("tr-red"),a=!1;if(""==n)return showMessage(!0,"Theory Marks is required"),$("#tr-"+t).addClass("tr-red"),a=!1;if(1==s&&""==o)return showMessage(!0,"Practical Marks is required"),$("#tr-"+t).addClass("tr-red"),a=!1;if(""==d)return showMessage(!0,"Credit is required"),$("#tr-"+t).addClass("tr-red"),a=!1;var p=0;p=1==s?parseInt(n)+parseInt(o):n,$("#marksCount-"+t).text(p);c=getGradeNew(p,50);$("#grade-"+t).html(c);u=getResult(p,50);if($("#result-"+t).text(u),""!=c&&("NA"==c||"N/A"==c))return showMessage(!0,"Grade is not valid"),$("#tr-"+t).addClass("tr-red"),a=!1;if(""!=u&&("NA"==u||"N/A"==u))return showMessage(!0,"Result is not valid"),$("#tr-"+t).addClass("tr-red"),a=!1}return a}function validateMarks(e){console.log("validateMarks called");var t=[],a=!0,r=1,s=!0;return $("#"+e+" tbody tr").each((function(){$(this).removeClass("tr-red");var e=$(this).find("select.sub_id").val();e>0&&(0==$.inArray(e,t)?($("#tr-"+r).addClass("tr-red"),a=!1):t.push(e));if(a){var i=calculatePassingRule(this,r);console.log("ruleStatus :: "+i),i||s&&(s=!1)}r++})),0==t.length?(showMessage(!0,"Subjects is required"),!1):a?(s&&$("#callPreviousSubMarksModal").modal("hide"),s?a:s):(showMessage(!0,"Two Subjects cannot be same"),!1)}function getGradeNew(e,t){var a="N/A";return console.log("GRADE_CAL_RULE: "+GRADE_CAL_RULE),$.each(GRADE_CAL_RULE,(function(t,r){parseInt(r.minMark)<=e&&parseInt(r.maxMark)>=e&&(a=r.grade)})),a}function getResult(e,t){var a="N/A";return $.each(GRADE_CAL_RULE,(function(t,r){parseInt(r.minMark)<=e&&parseInt(r.maxMark)>=e&&(a=r.result)})),a}function getCurrentSubjectMarks(e,t,a){hideMessage(""),$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","GET_CURRENT_SUBJECT_MARKS_BY_SUBJECT_ID",t,$("#schoolId").val())),dataType:"json",cache:!1,timeout:6e5,success:function(e){"0"==e.status||"2"==e.status?showMessage(!0,e.message):(console.log("mastersData "+e.mastersData.currentSubjectMarks.value),$("#tbl_gen_marks_pre tbody tr").each((function(){$(this).find("select.subjectId").val()==t&&$(this).find("input.sub_maxid").val(e.mastersData.currentSubjectMarks.value)})),$("#currentSubMarkstbl tbody tr").each((function(){$(this).find("select.subjectId").val()==t&&$(this).find("input.sub_maxid").val(e.mastersData.currentSubjectMarks.value)})))},error:function(e){}})}function removeDocument(e,t){console.log(e),1==t||2==t||3==t&&($("#fileupload"+e).parent("span").next("a.view").hide(),$("#fileupload"+e).parent("span").next("a.view").next("a.remove").hide(),$("#fileupload"+e).parent("span").parent("p").parent("div").find("span.fileName").html(""),$("#fileupload"+e).parent("span").parent("p").parent("div").find("i").removeClass("fa-check-circle-o"),$("#fileupload"+e).parent("span").parent("p").parent("div").find("i").removeClass("fa-close"),$("#fileupload"+e).parent("span").parent("p").parent("div").find("h1").removeAttr("style"),$("#fileupload"+e).parent("span").next("a.view").attr("href",""),$("#fileupload"+e).parent("span").next("a.remove").attr("href",""))}