function getWatiNumbersContent(){$("<style>").prop("type","text/css").html("\n      table {\n        border-collapse: separate;\n        border-spacing: 0;\n        min-width: 350px;\n      }\n\n      table tr th,\n      table tr td {\n        border-right: 1px solid #E5E1DA;\n        border-bottom: 1px solid #E5E1DA;\n        padding: 5px;\n      }\n\n      table tr th:first-child,\n      table tr td:first-child {\n        border-left: 1px solid #E5E1DA;\n      }\n      table tr th {\n        background: #F2EFE7;\n        text-align: left;\n        border-top: solid 1px #E5E1DA;\n        font-weight: 700;\n        padding: 10px 5px;\n      }\n\n      table tr:first-child th:first-child {\n        border-top-left-radius: 6px;\n      }\n\n      table tr:first-child th:last-child {\n        border-top-right-radius: 6px;\n      }\n\n      table tr:last-child td:first-child {\n        border-bottom-left-radius: 6px;\n      }\n\n      table tr:last-child td:last-child {\n        border-bottom-right-radius: 6px;\n      }\n    ").appendTo("head");return getBodyOfTable(),'\n    <div class="container mt-4 w-75">\n      <div class="d-flex justify-content-between">\n        <div>\n          <h2 class="mb-3" style="font-weight:700">Wati Number Distribution</h2>\n          <h5 class="mb-4" style="font-size: 16px;font-weight:600"">Manage Numbers with Users</h5>\n        </div>\n        <div>\n          <button onclick="addWatiNumber();" class="border-0 rounded px-5 py-3" style="background-color:#FFB200;font-weight:600;">Add Wati Number <span><i class="fa fa-plus" aria-hidden="true"></i></span></button>\n        </div>\n      </div>\n\n      <div class="filter-container mb-3 p-3">\n        <div class="d-flex" style="gap:16px;">\n          <div class="w-100">\n            <input type="text" id="filterName" class="rounded border p-3 w-100" placeholder="Enter Name">\n          </div>\n          <div class="w-100">\n            <input type="text" id="filterNumber" class="rounded border p-3 w-100" placeholder="Enter Number">\n          </div>\n          <div class="w-100">\n            <select id="filterStatus" class="rounded border p-3 w-100">\n              <option value="">Select Status</option>\n              <option value="A">Active</option>\n              <option value="I">Inactive</option>\n            </select>\n          </div>\n          <div class="d-flex w-100" style="gap: 16px;">\n            <button onclick="showFilterData();" class="border-0 rounded px-5 py-2 text-white" style="background-color:#027FFF;">Search <i class="fa fa-search"></i></button>\n            <button onclick="resetField();" class="border-0 rounded px-5 py-2" style="background-color:#F1EFE7;">Reset <i class="fa fa-refresh"></i></button>\n          </div>\n        </div>\n      </div>\n\n      <div class="table-responsive">\n        <table class="w-100">\n          <thead class="">\n            <tr>\n              <th>#</th>\n              <th>Number</th>\n              <th>Status</th>\n              <th>Actions</th>\n            </tr>\n          </thead>\n          <tbody id="watiNumbersBody">\n            <tr>\n              <td colspan="4" class="text-center py-3">Loading...</td>\n            </tr>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  '}function getBodyOfTable(){$.ajax({type:"GET",url:BASE_URL+CONTEXT_PATH+"wati/api/get-all-numbers",dataType:"json",success:function(t){var e=t.list;if(0==e.length)$("#watiNumbersBody").html('<tr><td colspan="4" class="text-center text-danger">No Data Found</td></tr>');else{var n=e.map(((t,e)=>`\n              <tr>\n                <td>${e+1}</td>\n                <td>${t.waNumber}</td>\n                <td style="font-size: 14px;">\n                  ${"A"===t.status?'<span class="text-success fw-bold">Active <i class="fa fa-check-circle"></i></span>':'<span class="text-danger fw-bold">Inactive <i class="fa fa-times-circle"></i></span>'}\n                </td>\n                <td style="width:30%;">\n                  <button onclick="updateWati('${t.waNumber}', '${t.watiToken}', '${t.watiUrl}', '${t.status}');" class="update-btn rounded border-0 text-white px-3 py-2" style="background-color:#1F509A" data-id="${t.id}">\n                    Update <i class="fa fa-pencil"></i>\n                  </button>\n                  <button onclick="showFilterData(true, '${t.waNumber}');" class="border-0 rounded px-3 py-2 text-white" style="background-color:#027FFF;">\n                    About Number <i class="fa fa-info-circle"></i>\n                  </button>\n                  <button onclick="addWatiUser('${t.waNumber}');" class="border-0 rounded px-3 py-2 text-white" style="background-color:#3D8D7A;">\n                    Add User <i class="fa fa-plus"></i>\n                  </button>\n                </td>\n              </tr>`)).join("");$("#watiNumbersBody").html(n)}},error:function(){$("#watiNumbersBody").html('<tr><td colspan="4" class="text-center text-danger">Failed to load data</td></tr>')}})}function showFilterData(t=!1,e=null){$("body").append('\n    <div id="filteredNumbersModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 999;">\n      <div style="background: white; border-radius: 12px; overflow: hidden; width: 70%; max-height: 90vh;">\n        <div class="d-flex justify-content-between align-items-center" style="padding: 50px; background: #027FFF; padding: 15px 10px;">\n          <h4 style="font-size: 18px; font-weight: bold; color: white; text-align: center;">List</h4>\n          <button id="closePopup" class="d-flex" style="padding: 5px 10px; border: none; background: #ef4444; color: white; border-radius: 5px; cursor: pointer;"><i class="fa fa-times" aria-hidden="true"></i></button>\n        </div>\n        <div class="m-3" style="max-height: 80vh;overflow: auto;">\n          <table class="w-100">\n            <thead style="position: sticky;top: 0;">\n              <tr>\n                <th>#</th>\n                <th>Name</th>\n                <th>Number</th>\n                \n                <th>User Linking</th>\n                <th>Date</th>\n                <th>Action</th>\n              </tr>\n            </thead>\n            <tbody id="filteredNumbersBody">\n              <tr>\n                <td colspan="6" class="text-center py-3">Loading...</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  '),getFilteredNumbers(t,e),$("#closePopup").on("click",(function(){$("#filteredNumbersModal").remove()}))}function getFilteredNumbers(t,e){var n={name:t?"":$("#filterName").val().trim(),number:e||$("#filterNumber").val().trim(),status:t?"":$("#filterStatus").val().trim()};$.ajax({type:"POST",url:BASE_URL+CONTEXT_PATH+"wati/api/get-numbers-by-filter",data:JSON.stringify(n),contentType:"application/json",dataType:"json",success:function(t){var e=t.data;if(0==e.length)$("#filteredNumbersBody").html('<tr><td colspan="6" class="text-center">No Data Found For Searched Entries.</td></tr>');else{var n=e.map(((t,e)=>{var n=changeDateFormat(new Date(t.date),"MMM-dd-yyyy");return`\n              <tr>\n                <td>${e+1}</td>\n                <td>${t.name||"N/A"}</td>\n                <td>${t.number}</td>\n                \n                <td class="linkingStatus" data-status="${t.userLinkingStatus}" style="font-size: 14px;">\n                  ${"A"===t.userLinkingStatus?'<span class="text-success fw-bold">Linked <i class="fa fa-check"></i></span>':'<span class="text-danger fw-bold">Unlinked <i class="fa fa-times"></i></span>'}\n                </td>\n                <td>${n||"N/A"}</td>\n                <td>\n                  <button onclick="changeLinkingStatus(this, '${t.number}', '${t.uId}');" class="border-0 rounded px-3 py-2 text-white" style="background-color:#027FFF;">Change Linking Status</button>\n                </td>\n              </tr>`})).join("");$("#filteredNumbersBody").html(n)}$("#filteredNumbersModal").show()},error:function(){$("#filteredNumbersBody").html('<tr><td colspan="6" class="text-center text-danger">Failed to load filtered data</td></tr>')}})}function changeLinkingStatus(t,e,n){var a=$(t).closest("tr"),d=a.find(".linkingStatus").attr("data-status"),s=`\n    <select class="rounded border p-2 w-50 linkingStatusDropdown">\n      <option value="A" ${"A"===d?"selected":""}>Active</option>\n      <option value="I" ${"I"===d?"selected":""}>Inactive</option>\n    </select>\n    <button class="border-0 rounded px-3 py-2 text-white saveStatusBtn" style="background-color:#027FFF;">Enter</button>\n  `;a.find(".linkingStatus").html(s),a.find(".saveStatusBtn").on("click",(function(){saveLinkingStatus(a,e,n)}))}function saveLinkingStatus(t,e,n){var a=t.find(".linkingStatusDropdown").val(),d={number:e,userId:n,status:a};$.ajax({type:"POST",url:BASE_URL+CONTEXT_PATH+"wati/api/update-wati-user",data:JSON.stringify(d),contentType:"application/json",dataType:"json",success:function(e){if("success"===e.status){showMessage(!0,"Status updated successfully!");var n="A"===a?'<span class="text-success fw-bold linkingStatus" data-status="A">Linked <i class="fa fa-check"></i></span>':'<span class="text-danger fw-bold linkingStatus" data-status="I">Unlinked <i class="fa fa-times"></i></span>';t.find(".linkingStatus").html(n)}else showMessage(!1,e.message)},error:function(t){showMessage(!1,t.message)}})}function resetField(){$("#filterName").val(""),$("#filterNumber").val(""),$("#filterStatus").val("")}function addWatiNumber(){$("body").append('\n    <div id="addWatiNumberModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 999;">\n      <div style="background: white; border-radius: 12px; overflow: hidden; width: 50%;">\n        <div class="d-flex justify-content-between align-items-center" style="background: #027FFF; padding: 15px 10px;">\n          <h4 style="font-size: 18px; font-weight: bold; color: white;">Add Wati Number</h4>\n          <button id="closeAddWatiNumberModal" class="d-flex" style="padding: 5px 10px; border: none; background: #ef4444; color: white; border-radius: 5px; cursor: pointer;">\n            <i class="fa fa-times" aria-hidden="true"></i>\n          </button>\n        </div>\n\n        <div class="p-4">\n          <form onsubmit="submitAddNumberForm(event);" id="addWatiNumberForm">\n            <div class="mb-3">\n              <label for="addNumber" class="">Wati Number</label>\n              <input type="text" id="addNumber" class="rounded border p-3 w-100" placeholder="Enter Wati Number" required autocomplete="off">\n            </div>\n            <div class="mb-3">\n              <label for="addWUrl" class="">Wati URL</label>\n              <input type="text" id="addWUrl" class="rounded border p-3 w-100" placeholder="Enter Wati URL" required autocomplete="off">\n            </div>\n            <div class="mb-3">\n              <label for="addWToken" class="">Wati Token</label>\n              <input type="text" id="addWToken" class="rounded border p-3 w-100" placeholder="Enter Wati Token" required autocomplete="off">\n            </div>\n\n            <div class="d-flex justify-content-end" style="gap: 10px;">\n              <button type="submit" class="border-0 rounded px-5 py-2 text-white" style="background-color:#027FFF;">Add Number</button>\n              <button type="button" id="closeAddWatiNumberModalBtn" class="border-0 rounded px-5 py-2" style="background-color:#F1EFE7;">Cancel</button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  '),$("#closeAddWatiNumberModal, #closeAddWatiNumberModalBtn").on("click",(function(){$("#addWatiNumberModal").remove()}))}function submitAddNumberForm(t){t.preventDefault();var e={number:$("#addNumber").val().trim(),wUrl:$("#addWUrl").val().trim(),wToken:$("#addWToken").val().trim()};$.ajax({type:"POST",url:BASE_URL+CONTEXT_PATH+"wati/api/add-number",data:JSON.stringify(e),contentType:"application/json",dataType:"json",success:function(t){"success"==t.status?(showMessage(!0,"Wati number added successfully!"),$("#addWatiNumberModal").remove(),getBodyOfTable()):showMessage(!1,"Failed to add Wati number.")},error:function(){showMessage(!1,"Error in adding Wati number.")}})}function updateWati(t,e,n,a){var d=`\n    <div id="updateWatiNumberModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 999;">\n      <div style="background: white; border-radius: 12px; overflow: hidden; width: 50%;">\n        <div class="d-flex justify-content-between align-items-center" style="background: #027FFF; padding: 15px 10px;">\n          <h4 style="font-size: 18px; font-weight: bold; color: white;">Update Wati Number</h4>\n          <button id="closeUpdateWatiNumberModal" class="d-flex" style="padding: 5px 10px; border: none; background: #ef4444; color: white; border-radius: 5px; cursor: pointer;">\n            <i class="fa fa-times" aria-hidden="true"></i>\n          </button>\n        </div>\n\n        <div class="p-4">\n          <form onsubmit="submitUpdateNumberForm(event, '${t}', '${e}', '${n}', '${a}');" id="updateWatiNumberForm">\n            <div class="mb-3">\n              <label for="updateNumber">Wati Number</label>\n              <input type="text" id="updateNumber" class="rounded border p-3 w-100" value="${t}" required autocomplete="off">\n            </div>\n            <div class="mb-3">\n              <label for="updateWUrl">Wati URL</label>\n              <input type="text" id="updateWUrl" class="rounded border p-3 w-100" value="${n}" required autocomplete="off">\n            </div>\n            <div class="mb-3">\n              <label for="updateWToken">Wati Token</label>\n              <input type="text" id="updateWToken" class="rounded border p-3 w-100" value="${e}" required autocomplete="off">\n            </div>\n            <div class="mb-3">\n              <label for="updateStatus">Status</label>\n              <select id="updateStatus" class="rounded border p-3 w-100">\n                <option value="A" ${"A"==a?"selected":""}>Active</option>\n                <option value="I" ${"I"==a?"selected":""}>Inactive</option>\n              </select>\n            </div>\n\n            <div class="d-flex justify-content-end" style="gap: 10px;">\n              <button type="submit" class="border-0 rounded px-5 py-2 text-white" style="background-color:#027FFF;">Update Number</button>\n              <button type="button" id="closeUpdateWatiNumberModalBtn" class="border-0 rounded px-5 py-2" style="background-color:#F1EFE7;">Cancel</button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  `;$("body").append(d),$("#closeUpdateWatiNumberModal, #closeUpdateWatiNumberModalBtn").on("click",(function(){$("#updateWatiNumberModal").remove()}))}function submitUpdateNumberForm(t,e,n,a,d){t.preventDefault();var s={number:$("#updateNumber").val().trim(),wUrl:$("#updateWUrl").val().trim(),wToken:$("#updateWToken").val().trim(),status:$("#updateStatus").val()};$.ajax({type:"POST",url:BASE_URL+CONTEXT_PATH+"wati/api/update-number",data:JSON.stringify(s),contentType:"application/json",dataType:"json",success:function(t){"success"==t.status?(showMessage(!0,"Wati number updated successfully!"),$("#updateWatiNumberModal").remove(),getBodyOfTable()):showMessage(!1,"Failed to update Wati number.")},error:function(){showMessage(!1,"Error in updating Wati number.")}})}var selectedUserKeys=[];function addWatiUser(t){var e=`\n    <div id="addWatiUserModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center; z-index: 999;">\n      <div style="background: white; border-radius: 12px; overflow: hidden; width: 50%;">\n        <div class="d-flex justify-content-between align-items-center" style="background: #027FFF; padding: 15px 10px;">\n          <h4 style="font-size: 18px; font-weight: bold; color: white;">Add Wati User</h4>\n          <button id="closeAddWatiUserModal" class="d-flex" style="padding: 5px 10px; border: none; background: #ef4444; color: white; border-radius: 5px; cursor: pointer;">\n            <i class="fa fa-times" aria-hidden="true"></i>\n          </button>\n        </div>\n\n        <div class="p-4">\n          <form onsubmit="submitAddWatiUserForm(event, '${t}');" id="addWatiUserForm">\n            <div class="mb-3">\n              <label for="addWatiUserNumber">Wati Number</label>\n              <input type="text" id="addWatiUserNumber" class="rounded border p-3 w-100" style="cursor:not-allowed;" value="${t}" required disabled autocomplete="off">\n            </div>\n            <div class="mb-3">\n              <label for="addUsers">Add Users</label>\n              <select id="addUsers" class="rounded border p-3 w-100" autocomplete="off"></select>\n            </div>\n\n            <div class="d-flex justify-content-end" style="gap: 10px;">\n              <button type="submit" class="border-0 rounded px-5 py-2 text-white" style="background-color:#027FFF;">Update Number</button>\n              <button type="button" id="closeAddWatiUserBtn" class="border-0 rounded px-5 py-2" style="background-color:#F1EFE7;">Cancel</button>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  `;$("head").append('\n    <style id="customSelectStyle">\n      .select2-selection.select2-selection--single {\n        border: 1px solid #a1a1a1 !important;\n        border-radius: 5px !important;\n      }\n      .select2-container--default.select2-container--focus .select2-selection--multiple, \n      .select2-container--default .select2-selection--multiple {\n        border: 1px solid #a1a1a1 !important;\n        border-radius: 5px !important;\n      }\n      .select2-selection__rendered {\n        margin-top: 5px !important;\n      }\n      .select2-selection__choice {\n        border-radius: 5px !important;\n      }\n      .select2-selection__choice__remove {\n        margin-right: 4px !important;\n      }\n      .select2-search__field {\n        margin-top: 3px !important;\n      }\n    </style>\n  '),$("body").append(e),$("#closeAddWatiUserModal, #closeAddWatiUserBtn").on("click",(function(){$("#addWatiUserModal").remove(),$("#customSelectStyle").remove()})),$.ajax({type:"POST",url:BASE_URL+CONTEXT_PATH+"wati/api/get-user-list",data:JSON.stringify({name:""}),contentType:"application/json",dataType:"json",success:function(t){t&&t.data.length>0&&t.data.forEach((t=>{var e=`${t.name} (${t.role})`;$("#addUsers").append(new Option(e,t.id))})),$("#addUsers").select2({placeholder:"Select Users",allowClear:!0,multiple:!0}),$("#addUsers").on("change",(function(){selectedUserKeys=$(this).val()||[]})).val(null).trigger("change")},error:function(){showMessage(!1,"Failed to fetch users.")}})}function submitAddWatiUserForm(t,e){if(t.preventDefault(),0==selectedUserKeys.length)showMessage(0,"Select Users");else{var n={number:e,ids:selectedUserKeys.join(",")};$.ajax({type:"POST",url:BASE_URL+CONTEXT_PATH+"wati/api/save-wati-user",data:JSON.stringify(n),contentType:"application/json",dataType:"json",success:function(t){"success"==t.status?(showMessage(!0,"User added successfully!"),$("#addWatiUserModal").remove(),getBodyOfTable()):showMessage(!1,"Failed to add user.")},error:function(){showMessage(!1,"Error in adding users.")}})}}