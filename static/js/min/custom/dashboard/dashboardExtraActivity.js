function getChildActivityList(t){$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","CHILD-ACTIVITY-LIST-BY-PARENT-ID",t,SCHOOL_ID)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(t){if("0"==t.status||"2"==t.status)showMessage(!0,t.message);else{var e=t.mastersData.remarksList;if($("#extraActivityForm #subActivityLength").val(e.length),e.length>0){$("#subActivityTypeDiv").show();var a=$("#extraActivityForm #subActivityType");a.html(""),a.append('<option value="0">Select Sub Activity</option>'),$.each(e,(function(t,e){a.append('<option value="'+e.key+'">'+e.value+" </option>")}))}else $("#subActivityTypeDiv").hide()}},error:function(t){console.log(t)}})}function callBatchNameList(t){var e=$("#"+t+" #standardIds").select2("val");$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","BATCH-NAME-LIST-BASED-ON-STANDARD","","","","",e)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(t){if("0"==t.status||"2"==t.status)showMessage(!0,t.message);else{var e=t.mastersData.remarksList,a=$("#extraActivityForm #batchIds");a.html(""),$.each(e,(function(t,e){a.append('<option value="'+e.key+'">'+e.value+" </option>")}))}},error:function(t){console.log(t)}})}function callSubjectNameList(t){$("#userIds").val("").trigger("change");var e=$("#"+t+" #batchIds").select2("val");if(0===e.length)return $("#"+t+" #subjectIds").html(""),!1;$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","SUBJECT-NAME-LIST-BASED-ON-BATCHES","","","","",e)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(t){if("0"==t.status||"2"==t.status)showMessage(!0,t.message);else{var e=t.mastersData.courseList,a=$("#extraActivityForm #subjectIds");a.html(""),$.each(e,(function(t,e){a.append('<option value="'+e.key+'">'+e.value+" </option>")}))}},error:function(t){console.log(t)}})}function callBatchNameListForTeacher(t){var e=$("#"+t+" #userId").val();$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","BATCH-NAME-LIST-BASED-ON-TEACHER",e)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(t){if("0"==t.status||"2"==t.status)showMessage(!0,t.message);else{var e=t.mastersData.remarksList,a=t.mastersData.courseList,i=$("#extraActivityForm #batchIds"),s=$("#extraActivityForm #subjectIds");i.html(""),s.html(""),$.each(e,(function(t,e){i.append('<option value="'+e.key+'">'+e.value+" </option>")})),$.each(a,(function(t,e){s.append('<option value="'+e.key+'">'+e.value+" </option>")}))}},error:function(t){console.log(t)}})}function validateExtraActivityDetails(t){if(0==$("#"+t+" #activityType").val()||null==$("#"+t+" #activityType").val())return showMessage(!0,"Activity Type is required."),!1;if($("#"+t+" #subActivityLength").val()>0&&(0==$("#"+t+" #subActivityType").val()||null==$("#"+t+" #subActivityType").val()))return showMessage(!0,"Sub Activity Type is required."),!1;if(""==$("#"+t+" #activityFor").val()||null==$("#"+t+" #activityFor").val())return showMessage(!0,"Activity For is required."),!1;if("ODM"==$("#"+t+" #activityMeetingType").val()){if(""==$("#"+t+" #startDate").val()||null==$("#"+t+" #startDate").val())return showMessage(!0,"Start Date is required."),!1}else{if(""==$("#"+t+" #startDate").val()||null==$("#"+t+" #startDate").val())return showMessage(!0,"Start Date is required."),!1;if(""==$("#"+t+" #endDate").val()||null==$("#"+t+" #endDate").val())return showMessage(!0,"End Date is required."),!1;var e=$("#"+t+" #daycheckboxDiv input:checked").length;if(null==e||""==e||0==e)return showMessage(!0,"Please Select atleast a day to add activity."),!1}return""==$("#"+t+" #timeHrsFrom").val()||null==$("#"+t+" #timeHrsFrom").val()?(showMessage(!0," Start time hour is required."),!1):""==$("#"+t+" #timeMinFrom").val()||null==$("#"+t+" #timeMinFrom").val()?(showMessage(!0," Start time minute is required."),!1):""==$("#"+t+" #durationMin").val()||null==$("#"+t+" #durationMin").val()?(showMessage(!0," Duration minute is required."),!1):""==$("#"+t+" #activityTitle").val()||null==$("#"+t+" #activityTitle").val()?(showMessage(!0,"Activity Title is required."),!1):""==$("#"+t+" #meetingVendor").val()||null==$("#"+t+" #meetingVendor").val()?(showMessage(!0,"Meeting Vendor is required."),!1):"External"!=$("#"+t+" #meetingVendor").val()||""!=$("#"+t+" #joiningLink").val()&&null!=$("#"+t+" #joiningLink").val()||(showMessage(!0,"Joining Link is required."),!1)}function showaddExtraActivityModal(){$("#addExtraActivityModal").modal("show"),$("#booksclassOutsideAvailabilityConfirmationModal").modal("hide")}function getDaysDifference(t,e){const a=Math.abs(e.getTime()-t.getTime());return Math.ceil(a/864e5)}function validateExtraActivityDetail(t,e){hideMessage(""),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","validate-extra-activity"),data:JSON.stringify(getRequestForExtraActivity(t)),dataType:"json",cache:!1,timeout:6e5,success:function(e){if("0"==e.status||"2"==e.status)showMessage(!0,e.message);else{var a=$("#"+t+" #activityMeetingType").val(),i=e.recurringClassListForAvailability,s=e.dateSpecificDays;if("REC"==a){var r=getDateInDateFormat($("#"+t+" #startDate").val()),o=getDateInDateFormat($("#"+t+" #endDate").val());daysDifference=getDaysDifference(r,o)}i.length>0&&"REC"!=a||i.length>0&&"REC"==a&&daysDifference<=s?$("#teacherAvailabilityWarningTitle").html('<h4 class="text-center bold text-danger">This slot is not in teacher\'s availability. If you book this class a date-specific availability will be created for this date.</h4>'):$("#teacherAvailabilityWarningTitle").html("");var n=e.message;if($("#availaibilityHeading").hide(),"Admin Host"==n){$("#teacherAvailabilityTable, .teacherAvailabilityTableWrapper").hide(),$(".activitySave").show();var l="<tr><td colspan='5'>Please Proceed to save Extra Activity</td></tr>";$("#trRecurring").html(l),$("#tableRecurring").hide(),$("#activityValidationHeading").hide(),$("#recurringTableHeading").text("This Activity will be held by Admin as there is no host selected. Please Proceed to confirm the activity."),$("#recurringTableHeading").show(),$("#validateActivityShowValidationModel").modal("show")}else{$("#tableRecurring").show(),$("#activityValidationHeading").show();var c=e.saveForcefully;if("REC"==$("#"+t+" #activityMeetingType").val()&&"N"==c&&daysDifference>s){$("#recurringTableHeading").text(""),$("#recurringTableHeading").hide();var v="";if($("#teacherAvailabilityTable #teacherAvailabilityTbody").html(v),(i=e.recurringClassListForAvailability).length>0){$("#availaibilityHeading").show(),$("#needToAddTimePreferrence").val(!0),$("#teacherAvailabilityTable, .teacherAvailabilityTableWrapper").show();for(var u=0;u<i.length;u++)v+="<tr class='text-danger'>\n\t\t\t\t\t\t\t\t\t\t\t<td>"+i[u].meetingDate+"</td>\n\t\t\t\t\t\t\t\t\t\t\t<td>"+i[u].teacherTime+"</td>\n\t\t\t\t\t\t\t\t\t\t\t<td>"+i[u].slotAvailableReason+"</td>\n\t\t\t\t\t\t\t\t\t\t</tr>";$("#teacherAvailabilityTable #teacherAvailabilityTbody").html(v),$(".activitySave").hide(),$("#validateActivityShowModel").modal("show")}else $("#teacherAvailabilityTable, .teacherAvailabilityTableWrapper").hide(),$("#needToAddTimePreferrence").val(!1),$("#validateActivityShowValidationModel").modal("show")}else c="Y",$("#teacherAvailabilityTable, .teacherAvailabilityTableWrapper").hide(),$("#needToAddTimePreferrence").val(!1),$("#validateActivityShowValidationModel").modal("show");"Y"==c&&$(".activitySave").show(),$("#saveForcefully").val(c);for(var d=e.recurringClassList,y=(l="",1),h=!0,g=0;g<d.length;g++){"Available"!=d[g].slotAvailable?l+="<tr class='text-danger'>":l+="<tr>",l=(l=(l=(l=l+" <td>"+y+++"</td>")+'<td><p class="mb-0">'+d[g].teachName+"</p></td>")+'<td><p class="mb-0"><b>Teacher Timezone: </b>'+d[g].teacherTime+'</p><p class="mb-0"><b>Admin Timezone: </b>'+d[g].meetingDate+" ("+d[g].startTime+" - "+d[g].endTime+")</p></td>")+" <td>"+d[g].slotAvailable+"</td>";var m=d[g].slotAvailableReason;l=null!=m&&""!=m&&"NA"!=m&&null!=m?l+" <td>"+m.replaceAll("~","<br>")+"</td>":l+" <td>"+m+"</td>",l+="</tr>","Available"!=d[g].slotAvailable&&(h=!1)}h?$(".activitySave").show():$(".activitySave").hide(),$("#trRecurring").html(l)}}return!1},error:function(t){return!1}})}var saveExtraActivityDetails=debouncing(saveExtraActivityDetailsFun,300);function saveExtraActivityDetailsFun(t,e,a){hideMessage(""),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","save-extra-activity"),data:JSON.stringify(getRequestForExtraActivity(t)),dataType:"json",cache:!1,timeout:6e5,success:function(t){return"0"==t.status||"2"==t.status?showMessage(!0,t.message):(showMessage(!1,t.message),$("#booksclassOutsideAvailabilityConfirmationModal, #validateActivityShowValidationModel").modal("hide"),$("#addExtraActivityModal").modal("hide"),setTimeout((function(){callDashboardPageSchool(a,"extra-activity")}),2e3)),!1},error:function(t){return!1}})}function getRequestForExtraActivity(t){var e={},a={},i={};if(i.activityTypeId=$("#"+t+" #activityType").val(),null!=$("#"+t+" #subActivityLength").val()&&(i.subActivityTypeId=$("#"+t+" #subActivityType").val()),i.activityFor=$("#"+t+" #activityFor").val(),i.enrollType=$("#"+t+" #enrollType").val(),"BATCH"==$("#"+t+" #enrollType").val()?i.courseProIds="38":"ALL"==$("#"+t+" #enrollType").val()?i.courseProIds="37,38,39,40,41":"SSP"==$("#"+t+" #enrollType").val()?i.courseProIds="37,40,41":"SCHOLARSHIP"==$("#"+t+" #enrollType").val()?i.courseProIds="37,39,40,41":"ONE_TO_ONE_FLEX"==$("#"+t+" #enrollType").val()?i.courseProIds="37":i.courseProIds="37,39,41","Teachers"==$("#"+t+" #activityFor").val()&&(i.courseProIds="37,38,39,40,41"),i.standardIds=$("#"+t+" #standardIds").select2("val"),i.batchIds=$("#"+t+" #batchIds").select2("val"),i.userIds=$("#"+t+" #userIds").select2("val"),i.teacherIds=[$("#"+t+" #teacherIds").select2("val")],null!=$("#"+t+" #teacherIds").select2("val")&&null!=$("#"+t+" #teacherIds").select2("val")&&0!=$("#"+t+" #teacherIds").select2("val")&&"[null]"!=$("#"+t+" #teacherIds").select2("val")||(i.teacherIds=[10547]),i.subjectIds=$("#"+t+" #subjectIds").select2("val"),i.activityMeetingType=$("#"+t+" #activityMeetingType").val(),i.startDate=$("#"+t+" #startDate").val(),"ODM"==$("#"+t+" #activityMeetingType").val()?i.endDate=$("#"+t+" #startDate").val():i.endDate=$("#"+t+" #endDate").val(),i.startTimeHrsFrom=$("#"+t+" #timeHrsFrom").val(),i.startTimeMinFrom=$("#"+t+" #timeMinFrom").val(),i.durationHours=$("#"+t+" #duration").val(),i.durationMinutes=$("#"+t+" #durationMin").val(),i.showLinkBefore=$("#"+t+" #showLinkBefore").val(),i.activityTitle=$("#"+t+" #activityTitle").val(),"No file chosen..."==$("#"+t+" #fileupload1Span").text()?i.uploadFile="":i.uploadFile=$("#"+t+" #fileupload1Span").text(),i.joiningLink=$("#"+t+" #joiningLink").val(),i.activityPurpose=$("#"+t+" #activityPurpose").val(),i.meetingVendor=$("#"+t+" #meetingVendor").val(),i.schoolId=SCHOOL_ID,"REC"==$("#"+t+" #activityMeetingType").val()){var s=$("#"+t+" #daycheckboxDiv input[type='checkbox']:checked").map((function(){return this.value})).get();s.length>0&&(i.daysId=s),getAllDaysDate(t)}return i.recurringDates=$("#"+t+" #recurringDates").val(),i.schoolId=SCHOOL_ID,e.extraActivityDetailsDTO=i,a.hash=getHash(),a.schoolId=SCHOOL_ID,a.schoolUUID=SCHOOL_UUID,a.userId=USER_ID,e.authentication=a,e}function getWeekdayDates(t,e,a){for(var i=[],s=moment(t).startOf("day"),r=moment(e).startOf("day");s.isBefore(r)||s.isSame(r,"day");)a.includes(s.day())&&i.push(s.format("YYYY-MM-DD")),s.add(1,"days");return i}function getAllDaysDate(t){var e=getWeekdayDates($("#"+t+" #startDate").val(),$("#"+t+" #endDate").val(),$("#"+t+" #daycheckboxDiv input[type='checkbox']:checked").map((function(){return parseInt(this.value-1)})).get());$("#"+t+" #recurringDates").val(e.join(", "))}function resetExtraActivityForm(t){$("#"+t+" #activityFor").val("").trigger("change"),$("#"+t+" #standardIds").val("").trigger("change"),$("#"+t+" #batchIds").val("").trigger("change"),$("#"+t+" #subjectIds").val("").trigger("change"),$("#"+t+" #activityTitle").val(""),$("#"+t+" #startDate").val(""),$("#"+t+" #endDate").val(""),$("#"+t+" #recurringDates").val(""),$("#"+t+" #timeHrsFrom").val(""),$("#"+t+" #timeMinFrom").val(""),$("#"+t+" #duration").val("0"),$("#"+t+" #durationMin").val("0"),$("#"+t+" #fileupload1Span").text(""),$("#"+t+" #activityMeetingType").val("ODM").trigger("change"),$("#"+t+" #joiningLink").val(""),$("#"+t+" #activityPurpose").val("")}function activeInactiveExtraActivity(t,e,a,i){var s={},r={},o={};o.activeInactiveStatus=e,o.id=a,s.extraActivityDetailsDTO=o,r.hash=getHash(),r.schoolId=SCHOOL_ID,r.schoolUUID=SCHOOL_UUID,s.authentication=r,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","active-inactive-extra-activity"),data:JSON.stringify(s),dataType:"json",cache:!1,timeout:6e5,success:function(t){return"0"==t.status||"2"==t.status?showMessage(!0,t.message):(showMessage(!1,t.message),setTimeout((function(){callDashboardPageSchool(i,"extra-activity")}),3e3)),!1},error:function(t){return!1}})}function editExtraActivity(t){var e={},a={},i={},s={};s.id=t,i.extraActivityDetailsDTO=s,a.hash=getHash(),a.schoolId=SCHOOL_ID,a.schoolUUID=SCHOOL_UUID,e.authentication=a,e.requestData=i,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","edit-extra-activity"),data:JSON.stringify(e),dataType:"json",cache:!1,timeout:6e5,success:function(t){return"0"==t.status||"2"==t.status?showMessage(!0,t.message):showMessage(!1,t.message),!1},error:function(t){return!1}})}function sendMailForExtraActivity(t){var e={},a={},i={};i.id=t,e.extraActivityDetailsDTO=i,a.hash=getHash(),a.schoolId=SCHOOL_ID,a.schoolUUID=SCHOOL_UUID,e.authentication=a,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","extra-activity-send-Mail"),data:JSON.stringify(e),dataType:"json",cache:!1,timeout:6e5,success:function(t){return"0"==t.status||"2"==t.status?showMessage(!0,t.message):showMessage(!1,t.message),!1},error:function(t){return!1}})}function copyExtraActivityDetails(t,e,a,i,s,r,o,n,l,c,v,u,d,y,h,g,m,p,T,f){$("#addExtraActivityModal").modal("show"),$("#extraActivityForm #activityTitle").val(i.replace("- Assessment","")),$("#extraActivityForm #activityType").val(t).trigger("change"),$("#extraActivityForm #activityFor").val(e).trigger("change"),$("#extraActivityForm #startDate").val(o),$("#extraActivityForm #endDate").val(n),$("#extraActivityForm #recurringDates").val(v),$("#extraActivityForm #subActivityType option:selected").text(m),$("#extraActivityForm #enrollType").val(T),$.each(l.split(","),(function(t,e){$("#extraActivityForm #batchIds option[value='"+e+"']").prop("selected",!0)})),$.each(c.split(","),(function(t,e){callSubjectNameList("extraActivityForm"),$("#extraActivityForm #subjectIds option[value='"+e+"']").prop("selected",!0)})),""!=p&&null!=p&&null!=p&&(getUserListByActivityFor("extraActivityForm",128),$.each(p.split(","),(function(t,e){$("#extraActivityForm #userIds option[value='"+e+"']").prop("selected",!0)}))),$("#extraActivityForm #timeHrsFrom").val(u),$("#extraActivityForm #timeMinFrom").val(d),$("#extraActivityForm #duration").val(y),h<60?$("#extraActivityForm #durationMin").val(h):$("#extraActivityForm #durationMin").val("0"),$("#extraActivityForm #fileupload1Span").text(g),"One Day Meeting"==a?$("#extraActivityForm #activityMeetingType").val("ODM").trigger("change"):$("#extraActivityForm #activityMeetingType").val("REC").trigger("change"),$("#extraActivityForm #joiningLink").val(s),$("#extraActivityForm #activityPurpose").val(r)}function getHash(){return"ajslfkjalksdf"}function callSubjectNameMultipleList(t,e,a,i,s,r){e=e.toString(),$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","SUBJECT-NAME-LIST-BASED-ON-BATCHES",a,i,s,r,e)),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(e){if("0"==e.status||"2"==e.status)showMessage(!0,e.message);else{var a=e.mastersData.courseList,i=$("#"+t+" #subjectIds");i.html(""),$.each(a,(function(t,e){i.append('<option value="'+e.key+'">'+e.value+" </option>")}))}},error:function(t){console.log(t)}})}function courseProviderList(t,e){$.ajax({type:"POST",contentType:"application/json",url:getURLForCommon("masters"),data:JSON.stringify(getRequestForMaster("formId","ALL-COURSE-PROVIDER-LIST","courseProList")),dataType:"json",cache:!1,timeout:6e5,async:!1,success:function(a){if("0"==a.status||"2"==a.status)showMessage(!0,a.message);else{var i=a.mastersData.courseList,s=$("#"+t+" #"+e);s.html(""),$.each(i,(function(t,e){36!=e.key&&37!=e.key&&38!=e.key&&39!=e.key&&40!=e.key&&41!=e.key||s.append('<option value="'+e.key+'">'+e.value+" </option>")}))}}})}function getRequestForHostList(t){var e={},a={},i={};return i.hash=getHash(),i.schoolId=SCHOOL_ID,i.schoolUUID=SCHOOL_UUID,i.userType="COMMON",a.requestKey=t,a.requestValue=SCHOOL_ID,e.requestData=a,e.authentication=i,e}