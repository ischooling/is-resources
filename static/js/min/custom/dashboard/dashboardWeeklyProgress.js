function sendSWPREmail(e,t){$("#sendSWPR").attr("disabled","disabled");var a={};a.studentId=e,a.uploadId=t,a.userId=USER_ID,a.schoolUUID=schoolUUID,a.forDownload="false",$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","send-mail-student-weekly-progress-report"),data:JSON.stringify(a),dataType:"html",cache:!1,timeout:6e5,success:function(e){alert("Progress report has been sent")},error:function(e){return $("#sendSWPR").removeAttr("disabled","disabled"),!1}})}function setCalenderDate(e){console.log($("#semesterId :selected").attr("semesterDateStart")+" - "+$("#semesterId :selected").attr("semesterDateEnd"));var t=new Date($("#semesterId :selected").attr("semesterDateStart")),a=new Date($("#semesterId :selected").attr("semesterDateEnd"));a.setDate(a.getDate()+7),console.log(t+" - "+a),$("#frequencyDate").datepicker("remove"),$("#frequencyDate").val(""),$("#frequencyDate").datepicker({startDate:t,endDate:a,format:"mm-dd-yyyy",autoclose:!0,daysOfWeekDisabled:e})}function showSWPRForUpload(e,t,a){$("#swprUploadModelTitleUpload").html("Upload Weekly Progress Report for "+t),callSWPRForUpload("SWPRUploadForm",e,a),$("#swprUploadModule").modal("show")}function showSWPRForView(e,t,a){$("#swprUploadModelTitleView").html("View Weekly Progress Report for "+t),callSWPRForUpload("SWPRUploadForm",e,a),$("#swprViewModule").modal("show")}function callSWPRForUpload(e,t,a){hideMessage("");var s={};s.studentId=t,s.standardId=a,s.userId=USER_ID,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","get-swpr-for-upload"),data:JSON.stringify(s),dataType:"html",cache:!1,timeout:6e5,success:function(e){if(""!=e){var t;return"FAILED"==(t=e.split("|"))[0]||"EXCEPTION"==t[0]||"SESSIONOUT"==t[0]?"SESSIONOUT"==t[0]?redirectLoginPage():showMessage(!0,t[1]):$("#swprUploadModuleContents").html(e),!1}},error:function(e){return!1}})}$(document).ready((function(){}));var studentIds=[];function uploadSWPRCSV(e,t,a){if(hideMessage(""),""==$("#semesterId").val())return showMessage(!0,"Please select session"),!1;if(""==$("#reportId").val())return showMessage(!0,"Please select Report Type"),!1;if(""==$("#frequencyDate").val())return showMessage(!0,"Please select weekly report date"),!1;if(""==$("#fileupload1Hash").val())return showMessage(!0,"Please upload csv file"),!1;var s=$("#frequencyDate").val(),r=(s=s.split("-"))[2]+"-"+s[0]+"-"+s[1],d=$("#startDate").val();if(null==d)var o=null;else o=(d=d.split("-"))[2]+"-"+d[0]+"-"+d[1];var n=$("#endDate").val();if(null==n)var l=null;else l=(n=n.split("-"))[2]+"-"+n[0]+"-"+n[1];var i=$("#retrievedDate").val();if(null==i)var u=null;else u=(i=i.split("-"))[2]+"-"+i[0]+"-"+i[1];$("#semesterId").val();null==$("#semesterId").val()&&(semsterId=0);var p={};p.studentId=t,p.uploadHashId=$("#fileupload1Hash").val(),p.semesterId=semsterId,p.uploadDate=r,p.standardId=a,p.reportId=$("#reportId").val(),p.uploadstartDate=o,p.uploadendDate=l,p.uploadRetrievedDate=u,p.userId=USER_ID,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","upload-student-weekly-progress-report"),data:JSON.stringify(p),dataType:"html",cache:!1,timeout:6e5,success:function(e){if(""!=e){var s;return"FAILED"==(s=e.split("|"))[0]||"EXCEPTION"==s[0]||"SESSIONOUT"==s[0]?"SESSIONOUT"==s[0]?redirectLoginPage():showMessage(!0,s[1]):showMessage(!1,s[1]),setTimeout((function(){hideMessage(""),callSWPRForUpload("SWPRUploadForm",t,a)}),3100),!1}},error:function(e){return!1}})}function callAutoWeeklyStudent(e,t){hideMessage(""),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","auto-weekly-progress-report-api"),data:JSON.stringify(getRequestForWeeklyReport(e,t)),dataType:"json",cache:!1,timeout:6e5,success:function(e){if("0"==e.status||"2"==e.status)showMessage(!0,e.message);else{$("#generateReportTable, #generateReport").show();var t=e.studentWeeklyDTOList;console.log(t);for(var a="",s=0;s<t.length;s++)a=(a=(a=(a=(a=(a+="<tr>")+"<td>"+(s+1)+"</td>")+'<td><input type="checkbox" class="checkAllStd" name="studentWeek'+t[s].studentId+'[]" id="studentWeek'+t[s].studentId+'"  value='+t[s].studentId+" /> </td>")+"<td>"+t[s].courseProviderName+"</td>")+"<td>"+t[s].studentName+"</td>")+"<td>"+t[s].grade+"</td>",a+="</tr>";$("#autoStudentReportLog").html(a)}}})}function getRequestForWeeklyReport(e,t){var a={},s={};return a.userId=t,a.schoolId=SCHOOL_ID,a.courseProviderId=$("#"+e+" #lmsPlatform").val(),a.standardId=$("#"+e+" #standardId").val(),a.email=$("#"+e+" #userNameOrEmail").val(),a.studentName=$("#"+e+" #studentName").val(),s.studentWeeklyDTO=a,s}function callAutoWeeklyStudentSendMail(e,t,a,s){hideMessage(""),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","auto-weekly-progress-report-send-api"),data:JSON.stringify(getRequestForWeeklyReportSendMail(e,t,a)),dataType:"json",cache:!1,timeout:1e4,success:function(e){"0"==e.status||"2"==e.status?showMessage(!0,e.message):(showMessage(!1,e.message),$("#autoViewModule").modal("hide"),$("#autoFailedMailStudent").modal("hide"),$(".modal-backdrop").remove(),$("body").removeClass("modal-open"),$("body").css({"padding-left":"0px"}),getActiveSession())}})}function againSendAllFailedMail(e){hideMessage("");var t={attempt:2};t.reportId=e,$.ajax({type:"GET",contentType:"text/plain",url:BASE_URL+CONTEXT_PATH+"crons/auto-weekly-progress-report-send-api",data:JSON.stringify(t),dataType:"html",cache:!1,timeout:1e4,success:function(e){$("#autoFailedMailStudent").modal("hide")},error:function(e){console.log(e)}})}function getRequestForWeeklyReportSendMail(e,t,a){var s={},r={},d=[];s.userId=t,s.schoolId=SCHOOL_ID,s.uniueId=a,s.daysType=$("#reporttype").val();var o=getDateInDateFormat($("#startReportDate").val());o=changeDateFormat(o,"mm-dd-yyyy"),s.reportStartDate=o;var n=getDateInDateFormat($("#endReportDate").val());return n=changeDateFormat(n,"mm-dd-yyyy"),s.reportEndDate=n,$(".checkAllStd").each((function(){this.checked&&d.push(parseInt($(this).val()))})),d.length<=0?s.studentUserIds=studentIds:s.studentUserIds=d,r.studentWeeklyDTO=s,r}function callOpenStudentWeeklyReportPopup(e,t,a,s,r,d,o){"view"===o?($("#autoMailStudent").modal("hide"),$("#isCron").val(d)):$("#autoFailedMailStudent").modal("hide"),getStudentMailHistory(e,t,a,s,r,d,o)}function callFilterdStudentWeeklyReport(e,t,a,s,r,d,o){getStudentMailHistory($("#reportID").val(),t,a,s,r,$("#isCron").val(),o,$("#reportFilter").val())}function getStudentMailHistory(e,t,a,s,r,d,o,n){hideMessage(""),customLoader(!0),$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","mail-student-weekly-progress"),data:JSON.stringify(getRequestForWeeklyReportStudent(e,t,a,s,r,d,o,n)),dataType:"json",cache:!1,timeout:6e5,success:function(t){if(customLoader(!1),"0"==t.status||"2"==t.status)showMessage(!0,t.message);else{if("view"===o){$("#autoWeeklyMailStudent").dataTable().fnDestroy(),$("#studentReportSendMail").html("");var a=t.studentWeeklyDTOList;console.log(a);for(var s="",r=1,d=0;d<a.length;d++)s=(s=(s=(s=(s=(s=(s+="<tr>")+"<td> "+r+"</td>")+"<td>"+a[d].courseProviderName+"</td>")+"<td>"+a[d].studentName+"</td>")+"<td>"+a[d].studentStringId+"</td>")+"<td>"+a[d].grade+"</td>")+"<td><a href="+a[d].playloadUrl+' target="_blank" data-toggle="tooltip" title="View and Send Report"><i class="fa fa-eye"></i></a></td>',"Y"==a[d].mailStatus?s+='<td><i class="fa fa-check"></i></td>':s+='<td><i class="fa fa-times"></i></td>',"B"==a[d].mailStatus||"N"==a[d].mailStatus?s+="<td>Yes</td>":s+="<td>No</td>",s=s+"<td>"+a[d].createdDate+"</td>",s+="</tr>",r+=1;$("#studentReportSendMail").html(s),$("#autoWeeklyMailStudent").DataTable(),$("#autoMailStudent").modal("show")}else{$("#autoFailedWeeklyMailStudent").dataTable().fnDestroy(),$("#studentFailedReportSendMail").html("");a=t.studentWeeklyDTOList;console.log(a);for(s="",r=1,d=0;d<a.length;d++)studentIds.push(a[d].studentId),s=(s=(s=(s=(s=(s=(s=(s=(s+="<tr>")+"<td> "+r+"</td>")+"<td>"+a[d].courseProviderName+"</td>")+"<td>"+a[d].studentName+"</td>")+"<td>"+a[d].studentStringId+"</td>")+"<td>"+a[d].grade+"</td>")+"<td>"+a[d].createdDate+"</td>")+"<td><a href='javascript:void(0);' onclick = \"sendMailStudentGradebookSummery('"+e+"','"+a[d].payload+"','"+a[d].uploadId+"','"+a[d].startDate+"','"+a[d].endDate+'\',\'weekly\')" data-toggle="tooltip" title=" Send Report"><i class="fa fa-view"></i>&nbsp;Resend Report</a></td>')+"<input type='hidden' class='studentsId' value='"+a[d].studentId+"'/>",s+="</tr>",r+=1;$("#sendAllMail").attr("onclick","return showWarningMessageForGenerate('Are you sure you want to generate the report?','againSendAllFailedMail("+e+")')"),$("#studentFailedReportSendMail").html(s),$("#autoFailedWeeklyMailStudent").DataTable(),$("#autoFailedMailStudent").modal("show")}$("#reportID").val(e)}},error:function(e){customLoader(!1)}})}function sendMailStudentGradebookSummery(e,t,a,s,r,d){var o={};o.data=t,o.uploadId=a,o.forDownload="false",o.startdate=s,o.enddate=r,o.subReportType=d,o.reportId=e,$.ajax({type:"POST",contentType:"application/json",url:getURLForHTML("dashboard","send-mail-student-get-user-gradebook/"+UNIQUEUUID),data:JSON.stringify(o),dataType:"html",success:function(e){alert("Progress report has been sent")},error:function(e){return $("#sendSWPR").removeAttr("disabled","disabled"),!1}})}function getRequestForWeeklyReportStudent(e,t,a,s,r,d,o,n){var l={},i={};return l.userId=t,l.schoolId=SCHOOL_ID,l.weeklyReportId=e,l.uniueId=a,l.reportType=o,l.courseProviderId=s,l.standardId=r,l.cron=d,l.isFilter=n,i.studentWeeklyDTO=l,i}function showWarningMessageForGenerate(e,t){return""==$("#startReportDate").val()?(showMessage(!0,"Please select Start report date"),!1):""==$("#endReportDate").val()?(showMessage(!0,"Please select End report date"),!1):new Date($("#startReportDate").val())>new Date($("#endReportDate").val())?(showMessage(!0,"Report start date must be less than Report end date."),!1):(""==t?($("#generateReportWarningYes").hide(),$("#generateReportWarningNo").hide(),$("#generateReportWarningCancel*").show()):($("#generateReportWarningYes").show(),$("#generateReportWarningNo").show(),$("#generateReportWarningCancel*").hide()),t="$('#resetProgressReport').modal('hide');"+t+";",$("#warningMessage").html(e),$("#generateReportWarningYes").attr("onclick",t),void $("#resetProgressReport").modal("show"))}